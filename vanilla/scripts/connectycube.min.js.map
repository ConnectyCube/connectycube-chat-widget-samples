{"version":3,"file":"connectycube.min.js","sources":["../src/types/addressbook.ts","../src/types/auth.ts","../src/types/calls.ts","../src/types/chat.ts","../src/types/config.ts","../src/types/data.ts","../src/types/dialogs.ts","../src/types/janus.ts","../src/types/media.ts","../src/types/meetings.ts","../src/types/proxy.ts","../src/types/pushnotifications.ts","../../../node_modules/js-base64/base64.mjs","../src/platform.ts","../src/config.ts","../src/Utils.ts","../src/Proxy.ts","../src/AddressBook.ts","../src/Auth.ts","../../../node_modules/ltx/lib/escape.js","../../../node_modules/ltx/lib/Element.js","../../../node_modules/ltx/lib/createElement.js","../../../node_modules/eventemitter3/index.js","../../../node_modules/ltx/lib/parsers/ltx.js","../../../node_modules/@xmpp/events/lib/TimeoutError.js","../../../node_modules/@xmpp/events/lib/timeout.js","../../../node_modules/@xmpp/events/lib/delay.js","../../../node_modules/@xmpp/events/lib/onoff.js","../../../node_modules/@xmpp/events/lib/promise.js","../../../node_modules/@xmpp/events/lib/Deferred.js","../../../node_modules/@xmpp/events/lib/procedure.js","../../../node_modules/@xmpp/events/lib/listeners.js","../../../node_modules/@xmpp/xml/lib/XMLError.js","../../../node_modules/@xmpp/xml/lib/Parser.js","../../../node_modules/@xmpp/xml/index.js","../../../node_modules/@xmpp/jid/lib/escaping.js","../../../node_modules/@xmpp/jid/lib/JID.js","../../../node_modules/@xmpp/jid/lib/parse.js","../../../node_modules/@xmpp/jid/index.js","../../../node_modules/@xmpp/error/index.js","../../../node_modules/@xmpp/connection/lib/StreamError.js","../../../node_modules/@xmpp/connection/lib/util.js","../../../node_modules/@xmpp/connection/index.js","../../../node_modules/@xmpp/client-core/lib/Client.js","../../../node_modules/@xmpp/reconnect/index.js","../../../node_modules/@xmpp/websocket/lib/Socket.js","../../../node_modules/@xmpp/websocket/lib/Connection.js","../../../node_modules/@xmpp/websocket/lib/FramedParser.js","../../../node_modules/koa-compose/index.js","../../../node_modules/@xmpp/middleware/lib/Context.js","../../../node_modules/@xmpp/middleware/lib/IncomingContext.js","../../../node_modules/@xmpp/middleware/lib/OutgoingContext.js","../../../node_modules/@xmpp/middleware/index.js","../../../node_modules/@xmpp/middleware/lib/StanzaError.js","../../../node_modules/@xmpp/iq/caller.js","../../../node_modules/@xmpp/id/index.js","../../../node_modules/@xmpp/iq/callee.js","../../../node_modules/@xmpp/base64/index.js","../../../node_modules/@xmpp/sasl/lib/SASLError.js","../../../node_modules/@xmpp/sasl/index.js","../../../node_modules/@xmpp/sasl2/index.js","../../../node_modules/@xmpp/resource-binding/index.js","../../../node_modules/@xmpp/client-core/src/bind2/bind2.js","../../../node_modules/saslmechanisms/main.js","../../../node_modules/saslmechanisms/lib/factory.js","../../../node_modules/@xmpp/client-core/src/fast/fast.js","../../../node_modules/sasl-plain/main.js","../../../node_modules/sasl-plain/lib/mechanism.js","../../../node_modules/@xmpp/sasl-plain/index.js","../src/messaging/xmpp/StreamManagement.ts","../../../node_modules/sasl-anonymous/main.js","../../../node_modules/sasl-anonymous/lib/mechanism.js","../../../node_modules/@xmpp/sasl-anonymous/index.js","../../../node_modules/@xmpp/sasl-ht-sha-256-none/index.js","../src/messaging/xmpp/xmpp.utils.ts","../src/messaging/xmpp/ChatUtils.ts","../src/messaging/xmpp/xmpp.ts","../../../node_modules/@xmpp/websocket/index.js","../../../node_modules/@xmpp/stream-features/index.js","../src/messaging/xmpp/Helpers.ts","../src/messaging/xmpp/PrivacyList.ts","../src/messaging/xmpp/MultiUserChat.ts","../src/messaging/xmpp/Dialogs.ts","../src/messaging/xmpp/Messages.ts","../src/videocalling/WebRTCSignalingProcessor.ts","../src/messaging/AbstractChatService.ts","../src/messaging/xmpp/index.ts","../../../node_modules/@sama-communications/sdk/dist/@sama-communications.sdk.mjs","../src/messaging/sama/BlockList.ts","../src/messaging/sama/index.ts","../src/videocalling_conference/janus.js","../src/videocalling_conference/JanusClient.ts","../src/videocalling_conference/ConferenceSession.ts","../src/videocalling_conference/ConferenceClient.ts","../src/Data.ts","../src/Meetings.ts","../src/PushNotifications.ts","../src/Storage.ts","../src/Users.ts","../src/videocalling/WebRTCHelpers.ts","../src/videocalling/WebRTCPeerConnection.ts","../src/videocalling/WebRTCSignalingProvider.ts","../src/videocalling/WebRTCSession.ts","../src/videocalling/WebRTCClient.ts","../src/Whiteboard.ts","../src/LinkPreview.ts","../src/ConnectyCube.ts","../src/index.umd.ts"],"sourcesContent":["import type { ForceParams } from './common';\nimport type { ConnectyCubeUsers } from './users';\n\nexport enum AddressBookUserDataType {\n  COMPACT = 1,\n  FULL = 0,\n}\n\nexport namespace ConnectyCubeAddressBook {\n  export type Contact = { name: string; phone: string; destroy?: number | string };\n  // Request parameters type\n  export type UploadParams = { udid?: string } & ForceParams;\n  export type GetRegisteredUsersParams = boolean | { udid?: string; compact: AddressBookUserDataType | number }; // 1 - compact user data, 0 - full user data\n  // Response data types\n  export type UploadResponse = {\n    deleted: number;\n    rejected: Record<string | number, string[]>;\n    created: number;\n    updated: number;\n  };\n  export type GetRegisteredUsersResponse = {\n    items: Partial<ConnectyCubeUsers.User> & { address_book_name: string }[];\n  };\n}\n","import type { DateOrTimestamp } from './common';\nimport type { ConnectyCubeUsers } from './users';\n\nexport enum LoginProviderNames {\n  FACEBOOK = 'facebook',\n  TWITTER = 'twitter',\n  FIREBASE_PHONE = 'firebase_phone',\n  FIREBASE_EMAIL = 'firebase_email',\n}\n\nexport namespace ConnectyCubeAuth {\n  export type Session = {\n    id: number;\n    user_id: number;\n    application_id: string | number;\n    token: string;\n    ts: DateOrTimestamp;\n    created_at: DateOrTimestamp;\n    updated_at: DateOrTimestamp;\n    user?: ConnectyCubeUsers.User | null;\n  };\n  export type LoginProviderKeys = { token: string; secret?: string };\n  export type LoginFirebaseKeys = { project_id: string | number; access_token: string };\n  export type LoginByLogin = { login: string; password: string };\n  export type LoginByEmail = { email: string; password: string };\n  export type LoginByGuest = { guest: '1'; full_name: string };\n  // Login by social providers\n  export type LoginByFacebook = {\n    provider: LoginProviderNames.FACEBOOK;\n    keys: LoginProviderKeys;\n  };\n  export type LoginByTwitter = {\n    provider: LoginProviderNames.TWITTER;\n    keys: LoginProviderKeys;\n  };\n  export type LoginByFirebasePhone = {\n    provider: LoginProviderNames.FIREBASE_PHONE;\n    firebase_phone: LoginFirebaseKeys;\n  };\n  export type LoginByFirebaseEmail = {\n    provider: LoginProviderNames.FIREBASE_EMAIL;\n    firebase_email: LoginFirebaseKeys;\n  };\n  // Request parameters type\n  export type LoginParams =\n    | LoginByLogin\n    | LoginByEmail\n    | LoginByGuest\n    | LoginByFacebook\n    | LoginByTwitter\n    | LoginByFirebasePhone\n    | LoginByFirebaseEmail;\n  export type GeneratedSessionParams = {\n    application_id: string | number;\n    auth_key: string;\n    user?: LoginByLogin | LoginByEmail | LoginByGuest;\n    provider?: LoginProviderNames;\n    keys?: LoginProviderKeys;\n    firebase_phone?: LoginFirebaseKeys;\n    firebase_email?: LoginFirebaseKeys;\n  };\n  // Response data type\n  export type LoginRawResponse = { user: ConnectyCubeUsers.User; [key: string]: any };\n  export type GetSessionRawResponse = { session: Session; [key: string]: any };\n}\n","import type WebRTCSession from '../videocalling/WebRTCSession';\nimport type WebRTCSignalingProvider from '../videocalling/WebRTCSignalingProvider';\n\nexport const CallSignalingModuleIdentifier = 'WebRTCVideoChat';\n\nexport enum CallSignalingType {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  STOP = 'hangUp',\n  RESTART = 'iceRestart',\n  RESTART_ACCEPT = 'iceRestartAccept',\n  CANDIDATE = 'iceCandidates',\n}\nexport enum CallSessionConnectionState {\n  UNDEFINED = 0,\n  CONNECTING = 1,\n  CONNECTED = 2,\n  FAILED = 3,\n  DISCONNECTED = 4,\n  CLOSED = 5,\n  COMPLETED = 6,\n}\nexport enum CallSessionState {\n  NEW = 1,\n  ACTIVE = 2,\n  STOPPED = 3,\n  REJECTED = 4,\n  CLOSED = 5,\n}\nexport enum CallType {\n  VIDEO = 1,\n  AUDIO = 2,\n}\nexport enum CallEvent {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  STOP = 'stop',\n  INVALID = 'invalid',\n  NOT_ANSWER = 'not-answer',\n  REMOTE_STREAM = 'remote-stream',\n  CONNECTION_STATE = 'connection-state',\n  CLOSE = 'close',\n  STATS_REPORT = 'stats-report',\n  DEVICES = 'devices',\n}\nexport enum PeerConnectionState {\n  NEW = 1,\n  CONNECTING = 2,\n  CHECKING = 3,\n  CONNECTED = 4,\n  DISCONNECTED = 5,\n  FAILED = 6,\n  CLOSED = 7,\n  COMPLETED = 8,\n}\n\nexport namespace ConnectyCubeCalls {\n  export type UserInfo = {\n    maxBandwidth?: number;\n    bandwidth?: number;\n    [key: string]: any;\n  };\n  export type ExtensionParams = {\n    callType?: CallType;\n    callerID?: number;\n    iceCandidates?: RTCIceCandidateInit[];\n    opponentsIDs?: number[];\n    userInfo?: UserInfo;\n    sessionID?: string;\n    [key: string]: any;\n  };\n  export type Session = WebRTCSession;\n  export type SignalingProvider = WebRTCSignalingProvider;\n  export type SessionParams = {\n    ID: string | null;\n    initiatorID: number;\n    opponentsIDs: number[];\n    callType: CallType;\n    signalingProvider: SignalingProvider;\n    currentUserID: number;\n    maxBandwidth: number;\n  };\n  // Listeners\n  export type OnCallListener = (session: Session, userInfo: UserInfo) => void;\n  export type OnAcceptCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnRejectCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnStopCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnInvalidEventsListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnUserNotAnswerListener = (session: Session, userID: number) => void;\n  export type OnRemoteStreamListener = (session: Session, userID: number, stream: MediaStream) => void;\n  export type OnSessionConnectionStateChangedListener = (\n    session: Session,\n    userID: number,\n    connectionState: CallSessionConnectionState\n  ) => void;\n  export type OnSessionCloseListener = (session: Session) => void;\n  export type OnCallStatsReportListener = (session: Session, userID: number, stats: any, error: Error) => void;\n  export type OnDevicesChangeListener = ((this: MediaDevices, ev: Event) => any) | ((ev: Event) => any);\n  export type Listeners =\n    | OnCallListener\n    | OnAcceptCallListener\n    | OnRejectCallListener\n    | OnStopCallListener\n    | OnInvalidEventsListener\n    | OnUserNotAnswerListener\n    | OnRemoteStreamListener\n    | OnSessionConnectionStateChangedListener\n    | OnSessionCloseListener\n    | OnCallStatsReportListener\n    | OnDevicesChangeListener;\n  export type ListenerName =\n    | 'onCallListener'\n    | 'onAcceptCallListener'\n    | 'onRejectCallListener'\n    | 'onStopCallListener'\n    | 'onInvalidEventsListener'\n    | 'onUserNotAnswerListener'\n    | 'onRemoteStreamListener'\n    | 'onSessionConnectionStateChangedListener'\n    | 'onSessionCloseListener'\n    | 'onCallStatsReport'\n    | 'onDevicesChangeListener';\n}\n","import type { Element, Node } from '@xmpp/xml';\nimport type { StatusEvents } from '@xmpp/connection';\nimport type { ConnectyCubeDialogs } from './dialogs';\nimport type { ConnectyCubeUsers } from './users';\n\nexport enum ChatType {\n  CHAT = 'chat',\n  GROUPCHAT = 'groupchat',\n}\nexport enum ChatEvent {\n  STATUS = 'status',\n  ERROR = 'error',\n  DISCONNECTED = 'disconnected',\n  RECONNECTED = 'reconnected',\n  MESSAGE = 'message',\n  SYSTEM_MESSAGE = 'system-message',\n  ERROR_MESSAGE = 'error-message',\n  TYPING_MESSAGE = 'typing-message',\n  UPDATE_MESSAGE = 'update-message',\n  DELETE_MESSAGE = 'delete-message',\n  REACTIONS_MESSAGE = 'reactions-message',\n  DELIVERED_MESSAGE = 'delivered-message',\n  READ_MESSAGE = 'read-message',\n  SENT_MESSAGE = 'sent-message',\n  USER_LAST_ACTIVITY = 'user-last-activity',\n  JOIN = 'join',\n  LEAVE = 'leave',\n  KICK = 'kick',\n}\nexport enum PrivacyListAction {\n  ALLOW = 'allow',\n  DENY = 'deny',\n}\nexport namespace ConnectyCubeChat {\n  export type XmlElement = Element;\n  export type XmlNode = Node;\n  export type StanzaCallback = (stanza: Element) => void;\n  export type StanzasCallbacks = { [stanzaId: string]: StanzaCallback };\n  export type ConnectionParams = { userId: number; password: string; deviceId?: string };\n  export type ConnectionStatus = keyof StatusEvents;\n  export type MessageParams = {\n    id?: string;\n    type?: ChatType;\n    body?: string | null;\n    extension?: any;\n  };\n  export type Message = {\n    id: string;\n    dialog_id: string | null;\n    recipient_id?: string | number | null;\n    is_forwarded?: boolean;\n    type?: ChatType | string;\n    body: string | null;\n    extension: any;\n    delay?: any;\n  };\n  export type SystemMessageParams = {\n    id?: string;\n    body?: string | null;\n    extension?: any;\n  };\n  export type SystemMessage = {\n    id: string;\n    body: string;\n    userId: number;\n    extension: any;\n  };\n  export type MessageStatusParams = {\n    messageId: string;\n    dialogId: string;\n    userId: number;\n  };\n  export type DialogReadParams = {\n    dialogId: string;\n  };\n  export type EditMessageParams = {\n    to: string | number;\n    dialogId: string;\n    body: string;\n    originMessageId: string;\n    extension?: any;\n    last?: boolean;\n  };\n  export type DeleteMessageParams = {\n    to: string;\n    dialogId: string;\n    messageId: string;\n  };\n  export type LastActivity = {\n    userId: number | null;\n    seconds: number;\n  };\n  export type SearchParams = {\n    search_text?: string;\n    start_date?: number | string | Date;\n    end_date?: number | string | Date;\n    chat_dialog_ids?: string | string[];\n  };\n  export type SearchResult = {\n    results: {\n      dialogs: ConnectyCubeDialogs.Dialog[];\n      messages: any[];\n      users: ConnectyCubeUsers.User[];\n    };\n    [key: string]: any;\n  };\n  export type UserJIDParams = {\n    userId?: number;\n    resource?: string;\n    jid?: string;\n    [key: string]: any;\n  };\n  // XMPP client events and listeners\n  export type XMPPClientEvent = string | symbol;\n  export type XMPPClientListener = (...args: any[]) => void;\n  export type XMPPClientListeners = Map<XMPPClientEvent, XMPPClientListener>;\n  // Chat listeners\n  export type OnChatStatusListener = (status: ConnectionStatus) => void;\n  export type OnChatConnectionErrorListener = (error: Error) => void;\n  export type OnChatDisconnectedListener = () => void;\n  export type OnChatReconnectedListener = () => void;\n  export type OnMessageListener = (userId: number, message: Message) => void;\n  export type OnMessageSystemListener = (message: SystemMessage) => void;\n  export type OnMessageErrorListener = (messageId: string, error: { code: number; info: string }) => void;\n  export type OnMessageTypingListener = (typing: boolean, userId: number, dialogId: string) => void;\n  export type OnMessageUpdateListener = (\n    messageId: string,\n    isLast: boolean,\n    updatedBody: string,\n    dialogId: string,\n    userId: number,\n    extraParams: object | null\n  ) => void;\n  export type OnMessageDeleteListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReactionsListener = (\n    messageId: string,\n    userId: number,\n    dialogId: string,\n    add: string,\n    remove: string\n  ) => void;\n  export type OnMessageDeliveredListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReadListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageSentListener = (lost: MessageParams | null, sent: MessageParams | null) => void;\n  export type OnLastUserActivityListener = (userId: number, seconds: number) => void;\n  export type OnDialogJoinListener = (dialogId: string, userId: number) => void;\n  export type OnDialogLeaveListener = (dialogId: string, userId: number) => void;\n  export type OnDialogKickListener = (dialogId: string, initiatorId: number) => void;\n  export type Listeners =\n    | OnChatStatusListener\n    | OnChatConnectionErrorListener\n    | OnChatDisconnectedListener\n    | OnChatReconnectedListener\n    | OnMessageListener\n    | OnMessageSystemListener\n    | OnMessageErrorListener\n    | OnMessageTypingListener\n    | OnMessageUpdateListener\n    | OnMessageDeleteListener\n    | OnMessageReactionsListener\n    | OnMessageDeliveredListener\n    | OnMessageReadListener\n    | OnMessageSentListener\n    | OnLastUserActivityListener\n    | OnDialogJoinListener\n    | OnDialogLeaveListener\n    | OnDialogKickListener;\n  export type ListenerName =\n    | 'onChatStatusListener'\n    | 'onConnectionErrorListener'\n    | 'onDisconnectedListener'\n    | 'onReconnectListener'\n    | 'onMessageListener'\n    | 'onSystemMessageListener'\n    | 'onMessageErrorListener'\n    | 'onMessageTypingListener'\n    | 'onMessageUpdateListener'\n    | 'onMessageDeleteListener'\n    | 'onMessageReactionsListener'\n    | 'onDeliveredStatusListener'\n    | 'onReadStatusListener'\n    | 'onSentMessageCallback'\n    | 'onLastUserActivityListener'\n    | 'onJoinOccupant'\n    | 'onLeaveOccupant'\n    | 'onKickOccupant';\n  // PrivacyList\n  export type PrivacyListItem = {\n    user_id: string | number;\n    action: PrivacyListAction | string;\n    mutualBlock?: boolean;\n  };\n  export type PrivacyList = {\n    name: string;\n    items: PrivacyListItem[];\n  };\n  export type PrivacyListNames = {\n    default: string | null;\n    active: string | null;\n    names: string[];\n  };\n  export type PrivacyListItemParams = {\n    value: string;\n    action: string;\n    order: number;\n    isMutual: boolean;\n  };\n  export type DialogId = string;\n  export type UserId = number;\n}\n\nexport interface IChatRealTimeService {\n  onChatStatusListener: ConnectyCubeChat.OnChatStatusListener;\n  onConnectionErrorListener: ConnectyCubeChat.OnChatConnectionErrorListener;\n  onDisconnectedListener: ConnectyCubeChat.OnChatDisconnectedListener;\n  onReconnectListener: ConnectyCubeChat.OnChatReconnectedListener;\n  onMessageListener: ConnectyCubeChat.OnMessageListener;\n  onSystemMessageListener: ConnectyCubeChat.OnMessageSystemListener;\n  onMessageTypingListener: ConnectyCubeChat.OnMessageTypingListener;\n  onMessageUpdateListener: ConnectyCubeChat.OnMessageUpdateListener;\n  onMessageDeleteListener: ConnectyCubeChat.OnMessageDeleteListener;\n  onMessageReactionsListener: ConnectyCubeChat.OnMessageReactionsListener;\n  onReadStatusListener: ConnectyCubeChat.OnMessageReadListener;\n  onLastUserActivityListener: ConnectyCubeChat.OnLastUserActivityListener;\n\n  get connectionStatus(): string;\n  get currentUserId(): ConnectyCubeChat.UserId;\n\n  connect(params: ConnectyCubeChat.ConnectionParams): Promise<boolean>;\n  disconnect(): Promise<boolean>;\n  terminate(): void;\n\n  ping(): Promise<void>;\n  pingWithTimeout(timeout: number): Promise<unknown>;\n\n  send(dialogId: ConnectyCubeChat.DialogId, message: ConnectyCubeChat.MessageParams): string | Promise<string>;\n  sendSystemMessage(\n    userId: ConnectyCubeChat.UserId,\n    message: ConnectyCubeChat.SystemMessageParams\n  ): string | Promise<string>;\n  sendWebRTCSignalingMessage(\n    userId: ConnectyCubeChat.UserId,\n    message: ConnectyCubeChat.SystemMessageParams\n  ): string | Promise<string>;\n\n  sendIsTypingStatus(dialogId: ConnectyCubeChat.DialogId): void | Promise<void>;\n  sendIsStopTypingStatus(dialogId: ConnectyCubeChat.DialogId): void | Promise<void>;\n\n  sendDeliveredStatus(params: ConnectyCubeChat.MessageStatusParams): void;\n  sendReadStatus(params: ConnectyCubeChat.MessageStatusParams): void;\n\n  editMessage(params: ConnectyCubeChat.EditMessageParams): void;\n  deleteMessage(params: ConnectyCubeChat.DeleteMessageParams): void;\n\n  getLastUserActivity(userId: ConnectyCubeChat.UserId): Promise<ConnectyCubeChat.LastActivity>;\n  subscribeToUserLastActivityStatus(userId: ConnectyCubeChat.UserId): void;\n  unsubscribeFromUserLastActivityStatus(userId: ConnectyCubeChat.UserId): void;\n\n  markActive(): void;\n  markInactive(): void;\n\n  addListener(name: ChatEvent, listener: ConnectyCubeChat.Listeners): () => void;\n  removeListener(name: ChatEvent): void;\n  removeAllListeners(): void;\n}\n","import type { ConnectyCubeAuth } from './auth';\nimport type { Config } from '../config';\n\nexport enum ChatProtocol {\n  BOSH = 1,\n  WS = 2,\n}\nexport enum JanusDebugMode {\n  ALL = 'all',\n  TRACE = 'trace',\n  DEBUG = 'debug',\n  VDEBUG = 'vdebug',\n  LOG = 'log',\n  WARN = 'warn',\n  ERROR = 'error',\n}\nexport enum ChatAPIs {\n  SAMA = 'sama',\n  XMPP = 'xmpp',\n}\n\nexport namespace ConnectyCubeConfig {\n  export type Object = Partial<Config>;\n  export type Credentials = {\n    appId: number | string;\n    authKey?: string;\n    token?: string;\n    systemApiKey?: string;\n    authSecret?: string;\n  };\n  export type Endpoints = { api: string; api_url?: string; chat: string; chat_url?: string; muc?: string };\n  export type ChatProtocolURLs = { bosh?: string; websocket?: string; active: ChatProtocol | number };\n  export type ChatStreamManagement = { enable: boolean; acknowledgementTimeout?: number };\n  export type ChatReconnect = { enable: boolean; timeInterval: number };\n  export type Chat = {\n    streamManagement?: ChatStreamManagement;\n    reconnect?: ChatReconnect;\n    apiImp?: ChatAPIs;\n  };\n  export type VideochatIceServer = {\n    urls: string | string[];\n    url?: string;\n    credential?: string;\n    username?: string;\n  };\n  export type Videochat = {\n    alwaysRelayCalls?: boolean;\n    answerTimeInterval?: number;\n    dialingTimeInterval?: number;\n    disconnectTimeInterval?: number;\n    statsReportTimeInterval?: number | null;\n    iceServers?: VideochatIceServer[];\n  };\n  export type JanusDebug = JanusDebugMode | JanusDebugMode[] | boolean;\n  export type Conference = {\n    server: string;\n    debug?: JanusDebug;\n  };\n  export type Whiteboard = {\n    server: string;\n  };\n  export type LinkPreview = {\n    server: string;\n  };\n  export type ApiRoutes = {\n    session: string;\n    login: string;\n    users: string;\n    chat: string;\n    blobs: string;\n    subscriptions: string;\n    events: string;\n    data: string;\n    addressbook: string;\n    meetings: string;\n    whiteboards: string;\n    unfurl: string;\n    calls: string;\n    type: string;\n  };\n  export type SessionHandlerResponse = () => void;\n  export type SessionRetryCallback = (session: Partial<ConnectyCubeAuth.Session>) => void;\n  export type SessionExpiredListener = (\n    handler: SessionHandlerResponse,\n    retry: SessionRetryCallback\n  ) => void | Promise<void>;\n  export type XMPPDataListener = (size: number, data?: { body?: string; headers?: string }) => number;\n  export type Listeners = {\n    sessionExpired?: SessionExpiredListener;\n    xmppDataWrite?: XMPPDataListener;\n    xmppDataRead?: XMPPDataListener;\n  };\n  export type Debug = { mode: number | boolean };\n  export type Options = {\n    creds?: Credentials;\n    endpoints?: Endpoints;\n    chatProtocol?: ChatProtocolURLs;\n    chat?: Chat;\n    videochat?: Videochat;\n    conference?: Conference;\n    whiteboard?: Whiteboard;\n    on?: Listeners;\n    timeout?: number;\n    debug?: Debug;\n  };\n}\n","import type { DateOrTimestamp, SearchCondition } from './common';\n\nexport enum DataPermission {\n  CREATE = 'create',\n  READ = 'read',\n  UPDATE = 'update',\n  DELETE = 'delete',\n}\nexport enum DataPermissionAccess {\n  OPEN = 'open',\n  OWNER = 'owner',\n  NOT_ALLOWED = 'not_allowed',\n  OPEN_FOR_GROUPS = 'open_for_groups',\n  OPEN_FOR_USERS_IDS = 'open_for_users_ids',\n}\n\nexport namespace ConnectyCubeData {\n  export type PermissionOptions = {\n    access: DataPermissionAccess | string;\n    user_ids?: string[];\n    user_groups?: string[];\n  };\n  export type Permissions = Record<DataPermission | string, PermissionOptions>;\n  export type CreateRecord = Record<string, any> & {\n    permissions?: Permissions;\n  };\n  export type DataRecord = Record<string, any> & {\n    _id: string;\n    _parent_id: string | null;\n    created_at: DateOrTimestamp;\n    updated_at: DateOrTimestamp;\n    user_id: number;\n    permissions: Permissions;\n  };\n  // Request parameters type\n  export type CreateParams = CreateRecord | CreateRecord[];\n  export type ListParams =\n    | ({\n        sort_asc?: string;\n        sort_desc?: string;\n        skip?: number;\n        limit?: number;\n        count?: number;\n        output?: { include?: string[]; exclude?: string[] };\n        near?: string;\n      } & SearchCondition<any>)\n    | undefined;\n  export type ReadParams = { permissions: 1 };\n  export type UpdateOptions = {\n    [key: string]: any;\n    inc?: Record<string, number>;\n    pull?: Record<string, any>;\n    pull_with_filter?: Record<string, Record<string, any>>;\n    pull_all?: Record<string, any[]>;\n    pop?: Record<string, 1 | -1>;\n    push?: Record<string, any[]>;\n    add_to_set?: Record<string, any[]>;\n    update_by_index?: Record<string, Record<number, any>>;\n    search_criteria?: SearchCondition<any>;\n  };\n  // Response data types\n  export type ListResponse = { class_name: string; items: DataRecord[] };\n  export type ReadPermissionsResponse = { record_id: string; permissions: Permissions };\n  export type UpdateResponse = {\n    class_name: string;\n    skip?: number;\n    limit?: number;\n    total_found?: number;\n    not_found?: { ids: string[] };\n    items: DataRecord[];\n  };\n  export type DeleteResponse =\n    | {\n        SuccessfullyDeleted: { ids: string[] };\n        WrongPermissions: { ids: string[] };\n        NotFound: { ids: string[] };\n      }\n    | { total_deleted: number };\n}\n","import type { ISODateString, SearchableProps, Timestamp } from './common';\nimport type { ConnectyCubeUsers } from './users';\n\nexport enum DialogType {\n  PUBLIC = 1,\n  GROUP = 2,\n  PRIVATE = 3,\n  BROADCAST = 4,\n  MEETING = 5,\n}\nexport enum LastMessageMessageStatus {\n  SENT = 'sent',\n  DELIVERED = 'delivered',\n  READ = 'read',\n}\nexport enum DialogDateProp {\n  CREATED = 'created_at',\n  UPDATED = 'updated_at',\n  LAST_MESSAGE = 'last_message_date_sent',\n}\n\nexport namespace ConnectyCubeDialogs {\n  export type Dialog = {\n    _id: string;\n    name: string;\n    description: string | null;\n    photo: string | null;\n    type: DialogType | number;\n    user_id: number;\n    created_at: ISODateString;\n    updated_at: ISODateString;\n    xmpp_room_jid?: string | null;\n    admins_ids?: number[];\n    last_message: string | null;\n    last_message_date_sent?: Timestamp;\n    last_message_id: string | null;\n    last_message_user_id: number | null;\n    last_message_status: LastMessageMessageStatus | string | null;\n    occupants_ids: number[];\n    occupants_count?: number;\n    pinned_messages_ids?: string[];\n    unread_messages_count: number;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  // Request parameters type\n  export type ListParams = SearchableProps<Dialog> & {\n    skip?: number;\n    limit?: number;\n    count?: number;\n    sort_asc?: DialogDateProp | string;\n    sort_desc?: DialogDateProp | string;\n  };\n  export type CreateParams = {\n    type: DialogType;\n    occupants_ids?: (string | number)[] | string;\n    admins_ids?: (string | number)[] | string;\n    name?: string;\n    photo?: string | null;\n    description?: string;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  export type UpdateParams = {\n    push_all?: {\n      occupants_ids?: (string | number)[];\n      admins_ids?: (string | number)[];\n      pinned_messages_ids?: string[];\n    };\n    pull_all?: {\n      occupants_ids?: (string | number)[];\n      admins_ids?: (string | number)[];\n      pinned_messages_ids?: string[];\n    };\n    name?: string;\n    photo?: string | null;\n    description?: string;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  export type GetPublicOccupantsParams = {\n    limit?: number;\n    skip?: number;\n  };\n  // Response data types\n  export type ListResponse = {\n    total_entries: number;\n    skip: number;\n    limit: number;\n    items: Dialog[];\n  };\n  export type DeleteResponse = {\n    SuccessfullyDeleted: { ids: string[] };\n    NotFound: { ids: string[] };\n    WrongPermissions: { ids: string[] };\n  };\n  export type GetNotificationsSettingsResponse = { notifications: { enabled: number | string } };\n  export type UpdateNotificationsSettingsResponse = { notifications: { enabled: number | string } };\n  export type GetPublicOccupantsResponse = { items: ConnectyCubeUsers.User[] };\n}\n","import type ConferenceSession from '../videocalling_conference/ConferenceSession';\n\nexport enum DeviceInputType {\n  VIDEO = 'videoinput',\n  AUDIO = 'audioinput',\n}\nexport enum JanusEvent {\n  PARTICIPANT_JOINED = 'participant_joined',\n  PARTICIPANT_LEFT = 'participant_left',\n  LOCAL_STREAM = 'local_stream',\n  REMOTE_STREAM = 'remote_stream',\n  REMOTE_TRACKS_UPDATED = 'remote_tracks_updated',\n  DATA_CHANNEL_OPEN = 'data_channel_open',\n  DATA_CHANNEL_MESSAGE = 'data_channel_message',\n  ERROR = 'error',\n}\nexport enum JanusCallType {\n  VIDEO = 'video',\n  AUDIO = 'audio',\n}\nexport enum JanusMediaTrackReason {\n  CREATED = 'created',\n  ENDED = 'ended',\n  MUTE = 'mute',\n  UNMUTE = 'unmute',\n}\nexport enum ConferenceEvent {\n  JOIN = 'join',\n  LEFT = 'left',\n  SLOW_LINK = 'slow-link',\n  REMOTE_TRACKS_UPDATED = 'remote-tracks',\n  REMOTE_STREAM = 'remote-stream',\n  REMOTE_CONNECTION_STATE = 'remote-connection-state',\n  DATA_CHANNEL_OPENED = 'data-channel-opened',\n  DATA_CHANNEL_MESSAGE = 'data-channel-message',\n  SESSION_CONNECTION_STATE = 'session-connection-state',\n  ERROR = 'error',\n}\n\nexport namespace ConnectyCubeJanus {\n  export interface SuccessErrorCallbacks {\n    success?: (...args: any[]) => void;\n    error?: (error: any) => void;\n  }\n  export interface InitCallbacks extends SuccessErrorCallbacks {\n    destroyed?: () => void;\n    timeoutSessionCallback?: () => void;\n  }\n  export interface PluginCallbacks extends SuccessErrorCallbacks {\n    localStream?: MediaStream;\n    displayName?: string;\n    iceState?: (iceState: any) => void;\n    slowLink?: (uplink: any, nacks: any) => void;\n    consentDialog?: (on: any) => void;\n    mediaState?: (medium: any, on: any) => void;\n    webrtcState?: (on: any) => void;\n    oncleanup?: () => void;\n  }\n  export type Session = ConferenceSession;\n  export interface RequestCallbacks extends SuccessErrorCallbacks {\n    displayName?: string;\n  }\n  // Listeners\n  export type OnParticipantJoinedListener = (\n    session: Session,\n    userId: number,\n    userName: string,\n    isExist: boolean\n  ) => void;\n  export type OnParticipantLeftListener = (session: Session, ...args: any[]) => void;\n  export type OnSlowLinkListener = (session: Session, userId: number | null, uplink: any, nacks: any) => void;\n  export type OnRemoteStreamListener = (session: Session, userId: number, stream: MediaStream) => void;\n  export type OnRemoteTracksUpdatedListener = (\n    session: Session,\n    userId: number,\n    track: MediaStreamTrack,\n    eventType: any\n  ) => void;\n  export type OnRemoteConnectionStateChangedListener = (session: Session, userId: number, iceState: any) => void;\n  export type OnDataChannelOpenedListener = (session: Session, label: any) => void;\n  export type OnDataChannelMessageListener = (session: Session, label: any, data: any) => void;\n  export type OnSessionConnectionStateChangedListener = (session: Session, iceState: any) => void;\n  export type OnErrorListener = (session: Session, error: any) => void;\n  export type Listeners =\n    | OnParticipantJoinedListener\n    | OnParticipantLeftListener\n    | OnSlowLinkListener\n    | OnRemoteStreamListener\n    | OnRemoteTracksUpdatedListener\n    | OnRemoteConnectionStateChangedListener\n    | OnDataChannelOpenedListener\n    | OnDataChannelMessageListener\n    | OnSessionConnectionStateChangedListener\n    | OnErrorListener;\n  export type ListenerName =\n    | 'onParticipantJoinedListener'\n    | 'onParticipantLeftListener'\n    | 'onSlowLinkListener'\n    | 'onRemoteStreamListener'\n    | 'onRemoteTracksUpdatedListener'\n    | 'onRemoteConnectionStateChangedListener'\n    | 'onDataChannelOpenedListener'\n    | 'onDataChannelMessageListener'\n    | 'onSessionConnectionStateChangedListener'\n    | 'onErrorListener';\n}\n","export enum MediaType {\n  AUDIO = 'audio',\n  VIDEO = 'video',\n  NONE = 'none',\n}\n\nexport namespace ConnectyCubeMedia {\n  export interface ElementOptions {\n    muted?: boolean;\n    mirror?: boolean;\n  }\n  export interface ElementParams {\n    elementId?: string;\n    options?: ElementOptions;\n  }\n  export interface DisplayParams extends DisplayMediaStreamOptions, ElementParams {}\n  export interface UserParams extends MediaStreamConstraints, ElementParams {}\n  export type DeviceIdOrTrackConstraints = MediaTrackConstraints | string;\n  export type TrackConstraintsOrDeviceIds = {\n    audio?: DeviceIdOrTrackConstraints;\n    video?: DeviceIdOrTrackConstraints;\n  };\n}\n","import type { DateOrTimestamp, SearchCondition } from './common';\n\nexport enum MeetingDateMetric {\n  MINUTES = 'minutes',\n  HOURS = 'hours',\n  DAYS = 'days',\n  WEEK = 'weeks',\n}\n\nexport namespace ConnectyCubeMeetings {\n  export type Attendee = { id?: number; email?: string };\n  export type MeetingParams = {\n    name?: string;\n    start_date?: DateOrTimestamp;\n    end_date?: DateOrTimestamp;\n    attendees?: Attendee[];\n    record?: boolean | null;\n    public?: boolean;\n    scheduled?: boolean;\n    notify?: boolean;\n    notify_before?: {\n      metric: MeetingDateMetric | string;\n      value: number; // 'minutes' range [0 - 55], 'hours' range [1 - 24], 'days' range [1 - 30], 'weeks' range [1 - 4]\n    };\n    timezone?: {\n      offset: number; // Minutes UTC offset\n      name: string; // Timezone Name\n    };\n  };\n  export type Meeting = {\n    _id: string;\n    chat_dialog_id?: string | null;\n    host_id: number;\n    created_at: DateOrTimestamp;\n    updated_at: DateOrTimestamp;\n  } & MeetingParams;\n  export type Recording = {\n    _id: string;\n    room_id: string;\n    participants_ids: number[];\n    updated_at: string;\n    created_at: string;\n    download_url: string;\n    participants_count: number;\n    duration: number;\n    size: number;\n  };\n  // Request parameters type\n  export type GetParams = {\n    _id?: string;\n    limit?: number;\n    offset?: number;\n    start_at?: SearchCondition<DateOrTimestamp>;\n    end_at?: SearchCondition<DateOrTimestamp>;\n    updated_at?: SearchCondition<DateOrTimestamp>;\n    created_at?: SearchCondition<DateOrTimestamp>;\n    scheduled?: SearchCondition<boolean>;\n  };\n  export type CreateParams = { chat?: boolean } & MeetingParams;\n}\n","import type { ConnectyCubeConfig } from './config';\nimport type { ConnectyCubeAuth } from './auth';\n\nexport enum ProxyMethod {\n  GET = 'GET',\n  POST = 'POST',\n  PUT = 'PUT',\n  PATCH = 'PATCH',\n  DELETE = 'DELETE',\n  HEAD = 'HEAD',\n}\nexport enum ProxyType {\n  JSON = 'json',\n  TEXT = 'text',\n}\n\nexport namespace ConnectyCubeProxy {\n  export type Params = {\n    url: string;\n    type?: ProxyMethod;\n    data?: any;\n    contentType?: boolean;\n    dataType?: ProxyType;\n    useArrayQuery?: boolean;\n    fileToCustomObject?: boolean;\n    authKey?: string;\n    abort_id?: string | number;\n  };\n  export type AbortControllersMap = {\n    [key: string | number]: {\n      controllers: AbortController[];\n      doneRequestsCount?: number;\n    };\n  };\n  export type SDKInstance = {\n    config: ConnectyCubeConfig.Object;\n    session: Partial<ConnectyCubeAuth.Session> | null;\n  };\n  export type ErrorObject = {\n    code?: number;\n    info?: { errors?: { base?: string[] } };\n  };\n}\n","import type { DateOrTimestamp } from './common';\n\nexport enum NotificationChannel {\n  APNS = 'apns',\n  VOIP = 'apns_voip',\n  GCM = 'gcm',\n  WEB = 'web',\n}\nexport enum DevicePlatform {\n  IOS = 'ios',\n  ANDROID = 'android',\n  WEB = 'web',\n}\nexport enum PushEnvironment {\n  DEV = 'development',\n  PROD = 'production',\n}\n\nexport namespace ConnectyCubePushNotifications {\n  export type Subscription = {\n    subscription: {\n      id: number | string;\n      notification_channel: {\n        name: NotificationChannel | string;\n      };\n      device: {\n        udid: string;\n        platform: {\n          name: DevicePlatform | string;\n        };\n      };\n    };\n  };\n  export type Event = {\n    event: {\n      id: number;\n      event_type: string | null;\n      message: string | null;\n      date: DateOrTimestamp;\n      period: DateOrTimestamp;\n      name: string | null;\n      occured_count?: number;\n      created_at?: DateOrTimestamp;\n      updated_at?: DateOrTimestamp;\n      end_date?: DateOrTimestamp;\n      active?: boolean | null;\n      application_id: number | null;\n      user_id: number | null;\n      kind: string | null;\n      environment: PushEnvironment | null;\n      tag_query?: any;\n      notification_channel?: {\n        name?: NotificationChannel | null;\n      };\n    };\n  };\n  export type PushTokenBaseParams = {\n    environment: PushEnvironment | string;\n  };\n  export type PushTokenMobileParams = PushTokenBaseParams & {\n    client_identification_sequence: string;\n    bundle_identifier?: string;\n  };\n  export type PushTokenWebParams = PushTokenBaseParams & {\n    web_endpoint: string;\n    web_auth: string;\n    web_p256dh: string;\n  };\n  // Request parameters type\n  export type SubscriptionsCreateParams = {\n    notification_channel: NotificationChannel | string;\n    push_token: PushTokenMobileParams | PushTokenWebParams;\n    device: {\n      platform: DevicePlatform | string;\n      udid: string;\n    };\n  };\n  export type EventsCreateParams = {\n    notification_type: 'push' | string;\n    push_type: NotificationChannel | string;\n    environment: PushEnvironment | string;\n    event_type?: 'one_shot' | string;\n    message?: string | null;\n    user?: {\n      ids: string;\n      tags?: {\n        any?: string;\n        all?: string;\n        exclude?: string;\n      };\n    };\n    external_user?: { ids: string };\n  };\n}\n","/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.8';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = ((a) => {\n    let tab = {};\n    a.forEach((c, i) => tab[c] = i);\n    return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function'\n    ? Uint8Array.from.bind(Uint8Array)\n    : (it) => new Uint8Array(Array.prototype.slice.call(it, 0));\nconst _mkUriSafe = (src) => src\n    .replace(/=/g, '').replace(/[+\\/]/g, (m0) => m0 == '+' ? '-' : '_');\nconst _tidyB64 = (s) => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = (bin) => {\n    // console.log('polyfilled');\n    let u32, c0, c1, c2, asc = '';\n    const pad = bin.length % 3;\n    for (let i = 0; i < bin.length;) {\n        if ((c0 = bin.charCodeAt(i++)) > 255 ||\n            (c1 = bin.charCodeAt(i++)) > 255 ||\n            (c2 = bin.charCodeAt(i++)) > 255)\n            throw new TypeError('invalid character found');\n        u32 = (c0 << 16) | (c1 << 8) | c2;\n        asc += b64chs[u32 >> 18 & 63]\n            + b64chs[u32 >> 12 & 63]\n            + b64chs[u32 >> 6 & 63]\n            + b64chs[u32 & 63];\n    }\n    return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = typeof btoa === 'function' ? (bin) => btoa(bin)\n    : _hasBuffer ? (bin) => Buffer.from(bin, 'binary').toString('base64')\n        : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer\n    ? (u8a) => Buffer.from(u8a).toString('base64')\n    : (u8a) => {\n        // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n        const maxargs = 0x1000;\n        let strs = [];\n        for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n            strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n        }\n        return _btoa(strs.join(''));\n    };\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 ยง5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = (u8a, urlsafe = false) => urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = (c) => {\n    if (c.length < 2) {\n        var cc = c.charCodeAt(0);\n        return cc < 0x80 ? c\n            : cc < 0x800 ? (_fromCC(0xc0 | (cc >>> 6))\n                + _fromCC(0x80 | (cc & 0x3f)))\n                : (_fromCC(0xe0 | ((cc >>> 12) & 0x0f))\n                    + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n                    + _fromCC(0x80 | (cc & 0x3f)));\n    }\n    else {\n        var cc = 0x10000\n            + (c.charCodeAt(0) - 0xD800) * 0x400\n            + (c.charCodeAt(1) - 0xDC00);\n        return (_fromCC(0xf0 | ((cc >>> 18) & 0x07))\n            + _fromCC(0x80 | ((cc >>> 12) & 0x3f))\n            + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n            + _fromCC(0x80 | (cc & 0x3f)));\n    }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = (u) => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer\n    ? (s) => Buffer.from(s, 'utf8').toString('base64')\n    : _TE\n        ? (s) => _fromUint8Array(_TE.encode(s))\n        : (s) => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = (src, urlsafe = false) => urlsafe\n    ? _mkUriSafe(_encode(src))\n    : _encode(src);\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 ยง5.\n * @returns {string} Base64 string\n */\nconst encodeURI = (src) => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = (cccc) => {\n    switch (cccc.length) {\n        case 4:\n            var cp = ((0x07 & cccc.charCodeAt(0)) << 18)\n                | ((0x3f & cccc.charCodeAt(1)) << 12)\n                | ((0x3f & cccc.charCodeAt(2)) << 6)\n                | (0x3f & cccc.charCodeAt(3)), offset = cp - 0x10000;\n            return (_fromCC((offset >>> 10) + 0xD800)\n                + _fromCC((offset & 0x3FF) + 0xDC00));\n        case 3:\n            return _fromCC(((0x0f & cccc.charCodeAt(0)) << 12)\n                | ((0x3f & cccc.charCodeAt(1)) << 6)\n                | (0x3f & cccc.charCodeAt(2)));\n        default:\n            return _fromCC(((0x1f & cccc.charCodeAt(0)) << 6)\n                | (0x3f & cccc.charCodeAt(1)));\n    }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = (b) => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = (asc) => {\n    // console.log('polyfilled');\n    asc = asc.replace(/\\s+/g, '');\n    if (!b64re.test(asc))\n        throw new TypeError('malformed base64.');\n    asc += '=='.slice(2 - (asc.length & 3));\n    let u24, r1, r2;\n    let binArray = []; // use array to avoid minor gc in loop\n    for (let i = 0; i < asc.length;) {\n        u24 = b64tab[asc.charAt(i++)] << 18\n            | b64tab[asc.charAt(i++)] << 12\n            | (r1 = b64tab[asc.charAt(i++)]) << 6\n            | (r2 = b64tab[asc.charAt(i++)]);\n        if (r1 === 64) {\n            binArray.push(_fromCC(u24 >> 16 & 255));\n        }\n        else if (r2 === 64) {\n            binArray.push(_fromCC(u24 >> 16 & 255, u24 >> 8 & 255));\n        }\n        else {\n            binArray.push(_fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255));\n        }\n    }\n    return binArray.join('');\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = typeof atob === 'function' ? (asc) => atob(_tidyB64(asc))\n    : _hasBuffer ? (asc) => Buffer.from(asc, 'base64').toString('binary')\n        : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer\n    ? (a) => _U8Afrom(Buffer.from(a, 'base64'))\n    : (a) => _U8Afrom(_atob(a).split('').map(c => c.charCodeAt(0)));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = (a) => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer\n    ? (a) => Buffer.from(a, 'base64').toString('utf8')\n    : _TD\n        ? (a) => _TD.decode(_toUint8Array(a))\n        : (a) => btou(_atob(a));\nconst _unURI = (a) => _tidyB64(a.replace(/[-_]/g, (m0) => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = (src) => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = (src) => {\n    if (typeof src !== 'string')\n        return false;\n    const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n    return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = (v) => {\n    return {\n        value: v, enumerable: false, writable: true, configurable: true\n    };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n    const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n    _add('fromBase64', function () { return decode(this); });\n    _add('toBase64', function (urlsafe) { return encode(this, urlsafe); });\n    _add('toBase64URI', function () { return encode(this, true); });\n    _add('toBase64URL', function () { return encode(this, true); });\n    _add('toUint8Array', function () { return toUint8Array(this); });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n    const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n    _add('toBase64', function (urlsafe) { return fromUint8Array(this, urlsafe); });\n    _add('toBase64URI', function () { return fromUint8Array(this, true); });\n    _add('toBase64URL', function () { return fromUint8Array(this, true); });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n    extendString();\n    extendUint8Array();\n};\nconst gBase64 = {\n    version: version,\n    VERSION: VERSION,\n    atob: _atob,\n    atobPolyfill: atobPolyfill,\n    btoa: _btoa,\n    btoaPolyfill: btoaPolyfill,\n    fromBase64: decode,\n    toBase64: encode,\n    encode: encode,\n    encodeURI: encodeURI,\n    encodeURL: encodeURI,\n    utob: utob,\n    btou: btou,\n    decode: decode,\n    isValid: isValid,\n    fromUint8Array: fromUint8Array,\n    toUint8Array: toUint8Array,\n    extendString: extendString,\n    extendUint8Array: extendUint8Array,\n    extendBuiltins: extendBuiltins\n};\n// makecjs:CUT //\nexport { version };\nexport { VERSION };\nexport { _atob as atob };\nexport { atobPolyfill };\nexport { _btoa as btoa };\nexport { btoaPolyfill };\nexport { decode as fromBase64 };\nexport { encode as toBase64 };\nexport { utob };\nexport { encode };\nexport { encodeURI };\nexport { encodeURI as encodeURL };\nexport { btou };\nexport { decode };\nexport { isValid };\nexport { fromUint8Array };\nexport { toUint8Array };\nexport { extendString };\nexport { extendUint8Array };\nexport { extendBuiltins };\n// and finally,\nexport { gBase64 as Base64 };\n","declare global {\n  interface Window {\n    adapter: any;\n  }\n}\n\nexport const sdkVersion = '__package_version__';\n\nexport { encode as base64Encode } from 'js-base64';\n\nexport const isBrowser = typeof window !== 'undefined' && typeof document === 'object';\nexport const isNodeJS: boolean =\n  typeof process === 'object' && typeof process.versions === 'object' && Boolean(process.versions.node);\nexport const isReactNative = false;\nexport const isExpo = false;\n\nexport const fetchImpl = fetch;\nexport const FormDataImpl = FormData;\n\nexport const adapter = isBrowser ? window.adapter : undefined;\nexport const navigator = isBrowser ? window.navigator : undefined;\nexport const mediaDevices = isBrowser && navigator ? navigator.mediaDevices : undefined;\nexport const MediaStream = isBrowser ? window.MediaStream : undefined;\nexport const MediaStreamTrack = isBrowser ? window.MediaStreamTrack : undefined;\nexport const RTCIceCandidate = isBrowser ? window.RTCIceCandidate : undefined;\nexport const RTCPeerConnection = isBrowser ? window.RTCPeerConnection : undefined;\nexport const RTCRtpReceiver = isBrowser ? window.RTCRtpReceiver : undefined;\nexport const RTCRtpSender = isBrowser ? window.RTCRtpSender : undefined;\nexport const RTCSessionDescription = isBrowser ? window.RTCSessionDescription : undefined;\nexport const isWebRTCAvailable: boolean = isBrowser ? Boolean(mediaDevices && RTCPeerConnection) : false;\n\nif (isWebRTCAvailable && !adapter) {\n  console.warn(\n    'Install WebRTC adapter if you want to use ConnectyCube.videochatconference. More info https://github.com/webrtc/adapter'\n  );\n}\n","import type { Config as ConnectyCubeConfig } from './types';\nimport { ChatAPIs } from './types/enums';\nimport { JanusDebugMode } from './types/enums';\nimport { sdkVersion } from '@platform';\n\nexport class Config {\n  private static instance: Config;\n\n  public version: string = sdkVersion;\n  public creds: ConnectyCubeConfig.Credentials = { appId: '', authKey: '' };\n  public endpoints: ConnectyCubeConfig.Endpoints = {\n    api: 'api.connectycube.com',\n    chat: 'chat.connectycube.com',\n    muc: 'muc.chat.connectycube.com',\n  };\n  public chatProtocol: ConnectyCubeConfig.ChatProtocolURLs = {\n    bosh: 'https://chat.connectycube.com:5281',\n    websocket: 'wss://chat.connectycube.com:5291',\n    active: 2,\n  };\n  public chat: ConnectyCubeConfig.Chat = {\n    streamManagement: { enable: false },\n    reconnect: { enable: true, timeInterval: 5 },\n    apiImp: ChatAPIs.XMPP,\n  };\n  public videochat: ConnectyCubeConfig.Videochat = {\n    alwaysRelayCalls: false,\n    answerTimeInterval: 60,\n    dialingTimeInterval: 5,\n    disconnectTimeInterval: 30,\n    statsReportTimeInterval: null,\n    iceServers: [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:turn.connectycube.com' },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=udp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=tcp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n    ],\n  };\n  public conference: ConnectyCubeConfig.Conference = {\n    server: 'wss://janus.connectycube.com:8989',\n    debug: JanusDebugMode.ALL,\n  };\n  public whiteboard: ConnectyCubeConfig.Whiteboard = { server: 'https://whiteboard.connectycube.com' };\n  public linkpreview: ConnectyCubeConfig.LinkPreview = { server: 'https://linkpreview.connectycube.com' };\n  readonly urls: ConnectyCubeConfig.ApiRoutes = {\n    session: 'session',\n    login: 'login',\n    users: 'users',\n    chat: 'chat',\n    blobs: 'blobs',\n    subscriptions: 'subscriptions',\n    events: 'events',\n    data: 'data',\n    addressbook: 'address_book',\n    meetings: 'meetings',\n    whiteboards: 'whiteboards',\n    unfurl: 'unfurl',\n    calls: 'calls',\n    type: '.json',\n  };\n  public on: ConnectyCubeConfig.Listeners = {\n    sessionExpired: undefined,\n    xmppDataWrite: undefined,\n    xmppDataRead: undefined,\n  };\n  public timeout: number | null = null;\n  public debug: ConnectyCubeConfig.Debug = { mode: 1 };\n\n  private constructor() {}\n\n  public static getInstance(): Config {\n    if (!Config.instance) {\n      Config.instance = new Config();\n    }\n    return Config.instance;\n  }\n\n  public set(options: ConnectyCubeConfig.Options): void {\n    this.endpoints.api_url = options.endpoints?.api_url;\n\n    if (options.endpoints?.chat) {\n      this.endpoints.muc = `muc.${options.endpoints.chat}`;\n      this.chatProtocol.bosh = `https://${options.endpoints.chat}:5281`;\n      this.chatProtocol.websocket = options.endpoints.chat_url ?? `wss://${options.endpoints.chat}:5291`;\n    }\n\n    Object.keys(options).forEach((key: string) => {\n      if (key !== 'set' && this.hasOwnProperty(key)) {\n        const optionValue = options[key as keyof ConnectyCubeConfig.Options];\n\n        if (typeof optionValue === 'object' && optionValue !== null) {\n          Object.keys(optionValue).forEach((nextKey) => {\n            if (this[key as keyof Config]?.hasOwnProperty(nextKey)) {\n              this[key as keyof Config][nextKey] = optionValue[nextKey];\n            }\n          });\n        } else {\n          (this[key as keyof Config] as Config[keyof Config]) = optionValue as Config[keyof Config];\n        }\n      }\n    });\n  }\n}\n\nexport default Config.getInstance();\n","import type { Config } from './types';\nimport { isBrowser, isExpo, isNodeJS, isReactNative } from '@platform';\nimport config from './config';\n\nexport default class Utils {\n  static loggers: Array<(args: any[]) => void> = [];\n\n  static env = {\n    isReactNative,\n    isBrowser,\n    isNodeJS,\n    isExpo,\n  };\n\n  static safeCallbackCall(cb: (...args: any[]) => void = () => {}): (...args: any[]) => void {\n    return (...args: any[]) => {\n      if (typeof cb === 'function') {\n        try {\n          cb(...args);\n        } catch (err) {\n          console.error('Error in listener:', err, `Check the code:\\n>>>\\n${cb.toString()}\\n<<<`);\n        }\n      }\n    };\n  }\n\n  static getUrl(base: Config.ApiRoutes[keyof Config.ApiRoutes], res?: string | number, ext?: string | number): string {\n    const resource = res ? `/${res}` : '';\n    const extension = ext ? `/${ext}` : '';\n    return `${config.endpoints.api_url ?? `https://${config.endpoints.api}`}/${base}${resource}${extension}${config.urls.type}`;\n  }\n\n  static isArray(arg: any): arg is any[] {\n    return Array.isArray(arg);\n  }\n\n  static isObject(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  static getBsonObjectId(): string {\n    // The object for type MongoDB.Bson.ObjectId\n    // http://docs.mongodb.org/manual/reference/object-id/\n    const ObjectId = {\n      machine: Math.floor(Math.random() * 16777216).toString(16),\n      pid: Math.floor(Math.random() * 32767).toString(16),\n      increment: 0,\n    };\n    const timestamp = Math.floor(Date.now() / 1000).toString(16);\n    const increment = (ObjectId.increment++).toString(16);\n\n    if (parseInt(increment, 16) > 0xffffff) {\n      ObjectId.increment = 0;\n    }\n\n    return (\n      timestamp.padStart(8, '0') +\n      ObjectId.machine.padStart(6, '0') +\n      ObjectId.pid.padStart(4, '0') +\n      increment.padStart(6, '0')\n    );\n  }\n\n  static DLog(...args: any[]): void {\n    if (Utils.loggers.length > 0) {\n      Utils.loggers.forEach((logger) => logger(args));\n      return;\n    }\n\n    const consoleLoggerFunction = () => {\n      return (args: any[]) => {\n        console.log(...args);\n      };\n    };\n\n    if (typeof config.debug === 'object') {\n      const modes = Array.isArray(config.debug.mode) ? config.debug.mode : [config.debug.mode];\n      modes.forEach((mode) => {\n        if (mode === 1) {\n          Utils.loggers.push(consoleLoggerFunction());\n        }\n      });\n    }\n\n    Utils.loggers.forEach((logger) => logger(args));\n  }\n\n  static callTrafficUsageCallback(callbackName: 'xmppDataRead' | 'xmppDataWrite', data: any): void {\n    if (typeof config.on[callbackName] === 'function') {\n      const getStringSize = (str: string): number => new Blob([str]).size;\n      const getDataSize = (data: any = {}): number => {\n        const { body: b, headers: h } = data;\n        let size = 0;\n        if (b) {\n          size += getStringSize(typeof b === 'string' ? b : JSON.stringify(b));\n        }\n        if (h) {\n          size += getStringSize(JSON.stringify(h));\n        }\n        return size;\n      };\n\n      config.on[callbackName](getDataSize(data), data);\n    }\n  }\n\n  static cloneObject<T>(obj: T = {} as T, escapeNull: boolean = false): T {\n    try {\n      const json = JSON.stringify(obj);\n      const jsonObject = escapeNull ? json.replace(/null/g, '\"\"') : json;\n\n      return JSON.parse(jsonObject);\n    } catch {\n      return obj;\n    }\n  }\n}\n","import type { Auth, Proxy } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport { fetchImpl, FormDataImpl } from '@platform';\nimport config from './config';\nimport Utils from './Utils';\n\nexport default class ProxyService {\n  public sdkInstance: Proxy.SDKInstance = {\n    config,\n    session: null,\n  };\n  public requestsNumber: number = 0;\n  public fetchImpl = fetchImpl;\n  private currentUserId: number | undefined;\n  private abortControllersMap: Proxy.AbortControllersMap = {};\n  public requestMethod: typeof ProxyMethod = ProxyMethod;\n  public responseType: typeof ProxyType = ProxyType;\n\n  public setSession(session: Partial<Auth.Session>): void {\n    this.sdkInstance.session = session;\n\n    if (session && session.user_id) {\n      this.setCurrentUserId(session.user_id);\n    }\n  }\n\n  public getSession(): Partial<Auth.Session> | null {\n    return this.sdkInstance.session;\n  }\n\n  public setCurrentUserId(userId?: number | null): void {\n    this.currentUserId = userId || undefined;\n  }\n\n  public getCurrentUserId(): number | undefined {\n    return this.currentUserId;\n  }\n\n  public logRequest(params: Proxy.Params, requestId: number): void {\n    Utils.DLog(`[Request][${requestId}]`, `${params.type || 'GET'} ${params.url}`, params);\n  }\n\n  public logResponse(response: any, requestId: number): void {\n    Utils.DLog(`[Response][${requestId}]`, response);\n  }\n\n  public buildRequestAndURL(params: Proxy.Params): [any, string] {\n    const isGetOrHeadType = !params.type || params.type === 'GET' || params.type === 'HEAD';\n    const isPostOrPutType = params.type ? params.type === 'POST' || params.type === 'PUT' : false;\n    const token = this.sdkInstance && this.sdkInstance.session && this.sdkInstance.session.token;\n    const isInternalRequest = params.url.indexOf('s3.amazonaws.com') === -1;\n    const isMultipartFormData = params.contentType === false;\n    const authKey = params.authKey;\n\n    let requestBody;\n    let requestURL = params.url;\n    const requestObject: any = {};\n\n    requestObject.method = params.type || 'GET';\n\n    if (params.data) {\n      requestBody = this.buildRequestBody(params, isMultipartFormData, isPostOrPutType);\n\n      if (isGetOrHeadType) {\n        requestURL += `?${requestBody}`;\n      } else {\n        requestObject.body = requestBody;\n      }\n    }\n\n    if (!isMultipartFormData) {\n      requestObject.headers = {\n        'Content-Type': isPostOrPutType\n          ? 'application/json;charset=utf-8'\n          : 'application/x-www-form-urlencoded; charset=UTF-8',\n      };\n    }\n\n    if (isInternalRequest) {\n      if (!requestObject.headers) {\n        requestObject.headers = {};\n      }\n\n      requestObject.headers['CB-SDK'] = `JS ${config.version} - Client`;\n\n      if (token) {\n        requestObject.headers['CB-Token'] = token;\n      } else if (authKey) {\n        requestObject.headers['CB-AuthKey'] = authKey;\n      }\n    }\n\n    if (config.timeout) {\n      requestObject.timeout = config.timeout;\n    }\n\n    return [requestObject, requestURL];\n  }\n\n  public buildRequestBody(\n    params: Proxy.Params,\n    isMultipartFormData: boolean,\n    isPostOrPutType: boolean\n  ): typeof FormDataImpl | string | any {\n    const data = params.data;\n    const useArrayQuery = params.useArrayQuery;\n\n    let dataObject: any;\n\n    if (isMultipartFormData) {\n      dataObject = new FormDataImpl();\n\n      Object.keys(data).forEach(function (item) {\n        if (params.fileToCustomObject && item === 'file') {\n          dataObject.append(item, data[item].data, data[item].name);\n        } else {\n          dataObject.append(item, params.data[item]);\n        }\n      });\n    } else if (isPostOrPutType) {\n      dataObject = JSON.stringify(data);\n    } else {\n      dataObject = this.serializeQueryParams(data, '', useArrayQuery, 0);\n    }\n\n    return dataObject;\n  }\n\n  public serializeQueryParams(obj: any, prefix: string, useArrayQuery: any, level = 0): string {\n    const parts: string[] = [];\n\n    for (let propName in obj) {\n      let propQueryName = this.encodeURIComponent(propName);\n      if (Utils.isArray(obj)) {\n        propQueryName = '';\n      }\n\n      const key = prefix ? prefix + `[${propQueryName}]` : propQueryName;\n      let value = obj[propName];\n\n      const isArrayVal = Utils.isArray(value);\n\n      if ((isArrayVal && (useArrayQuery || level === 0)) || Utils.isObject(value)) {\n        parts.push(this.serializeQueryParams(value, key, useArrayQuery, ++level));\n      } else {\n        value = isArrayVal ? value.sort().join(',') : value;\n        parts.push(`${key}=${this.encodeURIComponent(value)}`);\n      }\n    }\n\n    return parts.sort().join('&');\n  }\n\n  public encodeURIComponent(uriComponent: string | number | boolean): string {\n    return encodeURIComponent(uriComponent).replace(/[#$&+,/:;=?@\\[\\]]/g, (c) => `%${c.charCodeAt(0).toString(16)}`);\n  }\n\n  public abortRequest(abortId: string | number): void {\n    if (this.abortControllersMap[abortId]) {\n      const controllers = this.abortControllersMap[abortId].controllers || [];\n\n      controllers.forEach((controller) => {\n        controller.abort();\n      });\n    }\n  }\n\n  public processSuccessfulOrFailedRequest(abort_id?: string | number): void {\n    if (!abort_id || !this.abortControllersMap[abort_id]) {\n      return;\n    }\n\n    const controllers = this.abortControllersMap[abort_id].controllers || [];\n\n    if (!this.abortControllersMap[abort_id].doneRequestsCount) {\n      this.abortControllersMap[abort_id].doneRequestsCount = 1;\n    } else {\n      this.abortControllersMap[abort_id].doneRequestsCount += 1;\n    }\n\n    const doneRequestsCount = this.abortControllersMap[abort_id].doneRequestsCount;\n\n    if (doneRequestsCount === controllers.length) {\n      delete this.abortControllersMap[abort_id];\n    }\n  }\n\n  public async ajax<T>(params: Proxy.Params): Promise<T> {\n    const requestId = ++this.requestsNumber;\n\n    return new Promise((resolve, reject) => {\n      this.logRequest(params, requestId);\n\n      const [requestObject, requestURL] = this.buildRequestAndURL(params);\n      const abort_id = params.abort_id;\n\n      if (abort_id) {\n        let index = 0;\n\n        if (this.abortControllersMap[abort_id]) {\n          const controllers = this.abortControllersMap[abort_id].controllers || [];\n          this.abortControllersMap[abort_id].controllers.push(new AbortController());\n          index = controllers.length - 1;\n        } else {\n          this.abortControllersMap[abort_id] = {\n            controllers: [new AbortController()],\n          };\n        }\n        const signal = this.abortControllersMap[abort_id].controllers[index].signal;\n        Object.assign(requestObject, { signal });\n      }\n\n      let response: any;\n\n      // The Promise returned from fetch() wonโt reject on HTTP error\n      // status even if the response is an HTTP 404 or 500.\n      // Instead, it will resolve normally (with ok status set to false),\n      // and it will only reject on network failure or if anything prevented the request from completing.\n      fetchImpl(requestURL, requestObject)\n        .then((resp: any) => {\n          response = resp;\n          const dataType = params.dataType || ProxyType.JSON;\n          return dataType === ProxyType.TEXT ? response.text() : response.json();\n        })\n        .then((body: any) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          if (!response.ok) {\n            this.processAjaxError(response, body, null, reject, resolve, params, requestId);\n          } else {\n            this.processAjaxResponse(body, resolve, requestId);\n          }\n        })\n        .catch((error: any) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          this.processAjaxError(response, ' ', error, reject, resolve, params, requestId);\n        });\n    });\n  }\n\n  public processAjaxResponse(body: any, resolve: (value: any) => void, requestId: number): void {\n    const responseBody = body && body !== ' ' ? body : 'empty body';\n    this.logResponse(responseBody, requestId);\n\n    resolve(body);\n  }\n\n  public processAjaxError(\n    response: Response | null,\n    body: any,\n    error: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params,\n    requestId: number\n  ): void {\n    if (!response && error && !error.code) {\n      reject(error);\n      return;\n    }\n\n    const responseBody = body || error || body.errors;\n    const statusCode = response?.status;\n    const errorObject: Proxy.ErrorObject = {\n      code: (response && statusCode) || (error && error.code),\n      info: (body && typeof body === 'string' && body !== ' ' ? JSON.parse(body) : body) || (error && error.errno),\n    };\n\n    this.logResponse(responseBody, requestId);\n\n    if (response?.url.indexOf(config.urls.session) === -1) {\n      if (this.isExpiredSessionError(errorObject) && typeof config.on.sessionExpired === 'function') {\n        this.handleExpiredSessionResponse(errorObject, null, reject, resolve, params);\n      } else {\n        reject(errorObject);\n      }\n    } else {\n      reject(errorObject);\n    }\n  }\n\n  public handleExpiredSessionResponse(\n    error: any,\n    response: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params\n  ): void {\n    const handleResponse = () => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(response);\n      }\n    };\n\n    const retryCallback = (session: Partial<Auth.Session>) => {\n      if (session) {\n        this.setSession(session);\n        this.ajax(params).then(resolve).catch(reject);\n      }\n    };\n\n    if (typeof config.on.sessionExpired === 'function') {\n      config.on.sessionExpired(handleResponse, retryCallback);\n    }\n  }\n\n  private isExpiredSessionError(error: Proxy.ErrorObject): boolean {\n    try {\n      return error && error.code === 401 && error.info?.errors?.base?.[0] === 'Required session does not exist';\n    } catch {\n      return false;\n    }\n  }\n}\n","import type { AddressBook } from './types';\nimport { ProxyMethod } from './types/enums';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\n\nexport default class AddressBookService {\n  public proxy: ProxyService;\n  readonly route = config.urls.addressbook;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async uploadAddressBook(\n    list: AddressBook.Contact[] = [],\n    params: AddressBook.UploadParams = {}\n  ): Promise<AddressBook.UploadResponse> {\n    if (!Utils.isArray(list)) {\n      throw new Error('First parameter must be an Array.');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { contacts: list, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async get(udid?: string): Promise<AddressBook.Contact[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: udid ? { udid } : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRegisteredUsers(\n    params: AddressBook.GetRegisteredUsersParams = false\n  ): Promise<AddressBook.GetRegisteredUsersResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'registered_users'),\n      data: typeof params === 'boolean' ? { compact: params ? 1 : 0 } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type { Auth, Users, EmptyResponse } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\n\nexport default class AuthService {\n  public proxy: ProxyService;\n\n  readonly routes = {\n    session: config.urls.session,\n    login: config.urls.login,\n  };\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public setSession = (session: Partial<Auth.Session>): void => {\n    this.proxy.setSession(session);\n  };\n\n  public getSession = async (): Promise<Auth.Session> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.GET,\n        url: Utils.getUrl(this.routes.session),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public createSession = async (params: Auth.LoginParams | {} = {}): Promise<Auth.Session> => {\n    if (config.creds.appId === '' || config.creds.authKey === '') {\n      throw new Error('Cannot create a new session without \"appId\" and \"authKey\"');\n    }\n\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.session),\n        data: this.generateCreateSessionParams(params),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      this.proxy.setSession(response.session);\n      this.proxy.setCurrentUserId(response.session.user_id);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public destroySession = async (): Promise<EmptyResponse> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.DELETE,\n        url: Utils.getUrl(this.routes.session),\n        dataType: ProxyType.TEXT,\n      };\n      await this.proxy.ajax(ajaxParams);\n      this.proxy.setSession(null);\n      this.proxy.setCurrentUserId(null);\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public login = async (params: Auth.LoginParams): Promise<Users.User> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.login),\n        data: params,\n      };\n      const { user } = await this.proxy.ajax<Auth.LoginRawResponse>(ajaxParams);\n      this.proxy.setCurrentUserId(user.id);\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public logout = async (): Promise<EmptyResponse> => {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.routes.login),\n      dataType: ProxyType.TEXT,\n    };\n    this.proxy.setCurrentUserId(null);\n    return this.proxy.ajax(ajaxParams);\n  };\n\n  private generateCreateSessionParams(params: Auth.LoginParams | {} = {}): Auth.GeneratedSessionParams {\n    const message: Auth.GeneratedSessionParams = {\n      application_id: config.creds.appId,\n      auth_key: config.creds.authKey,\n    };\n\n    if ('guest' in params) {\n      message.user = params;\n    } else if ('login' in params && 'password' in params) {\n      message.user = { login: params.login, password: params.password };\n    } else if ('email' in params && 'password' in params) {\n      message.user = { email: params.email, password: params.password };\n    } else if ('provider' in params) {\n      message.provider = params.provider;\n      if ('keys' in params) {\n        message.keys = params.keys;\n      }\n      if ('firebase_phone' in params) {\n        message.firebase_phone = params.firebase_phone;\n      }\n      if ('firebase_email' in params) {\n        message.firebase_email = params.firebase_email;\n      }\n    }\n\n    return message;\n  }\n}\n","'use strict';\n\nconst escapeXMLTable = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&apos;\",\n};\n\nfunction escapeXMLReplace(match) {\n  return escapeXMLTable[match];\n}\n\nconst unescapeXMLTable = {\n  \"&amp;\": \"&\",\n  \"&lt;\": \"<\",\n  \"&gt;\": \">\",\n  \"&quot;\": '\"',\n  \"&apos;\": \"'\",\n};\n\nfunction unescapeXMLReplace(match) {\n  if (match[1] === \"#\") {\n    const num =\n      match[2] === \"x\"\n        ? parseInt(match.slice(3), 16)\n        : parseInt(match.slice(2), 10);\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (\n      num === 0x9 ||\n      num === 0xa ||\n      num === 0xd ||\n      (num >= 0x20 && num <= 0xd7ff) ||\n      (num >= 0xe000 && num <= 0xfffd) ||\n      (num >= 0x10000 && num <= 0x10ffff)\n    ) {\n      return String.fromCodePoint(num);\n    }\n    throw new Error(\"Illegal XML character 0x\" + num.toString(16));\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match;\n  }\n  throw new Error(\"Illegal XML entity \" + match);\n}\n\nfunction escapeXML(s) {\n  return s.replace(/[\"&'<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXML(s) {\n  let result = \"\";\n  let start = -1;\n  let end = -1;\n  let previous = 0;\n  while (\n    (start = s.indexOf(\"&\", previous)) !== -1 &&\n    (end = s.indexOf(\";\", start + 1)) !== -1\n  ) {\n    result =\n      result +\n      s.slice(previous, start) +\n      unescapeXMLReplace(s.slice(start, end + 1));\n    previous = end + 1;\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s;\n\n  // push the remaining characters\n  result = result + s.substring(previous);\n\n  return result;\n}\n\nfunction escapeXMLText(s) {\n  return s.replace(/[&<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXMLText(s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace);\n}\n\nexports.escapeXML = escapeXML;\nexports.escapeXMLText = escapeXMLText;\nexports.unescapeXML = unescapeXML;\nexports.unescapeXMLText = unescapeXMLText;\n","'use strict';\n\nvar escape = require('./escape.js');\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nclass Element {\n  constructor(name, attrs) {\n    this.name = name;\n    this.parent = null;\n    this.children = [];\n    this.attrs = {};\n    this.setAttrs(attrs);\n  }\n\n  /* Accessors */\n\n  /**\n   * if (element.is('message', 'jabber:client')) ...\n   **/\n  is(name, xmlns) {\n    return this.getName() === name && (!xmlns || this.getNS() === xmlns);\n  }\n\n  /* without prefix */\n  getName() {\n    const idx = this.name.indexOf(\":\");\n    return idx >= 0 ? this.name.slice(idx + 1) : this.name;\n  }\n\n  /**\n   * retrieves the namespace of the current element, upwards recursively\n   **/\n  getNS() {\n    const idx = this.name.indexOf(\":\");\n    if (idx >= 0) {\n      const prefix = this.name.slice(0, idx);\n      return this.findNS(prefix);\n    }\n    return this.findNS();\n  }\n\n  /**\n   * find the namespace to the given prefix, upwards recursively\n   **/\n  findNS(prefix) {\n    if (!prefix) {\n      /* default namespace */\n      if (this.attrs.xmlns) {\n        return this.attrs.xmlns;\n      } else if (this.parent) {\n        return this.parent.findNS();\n      }\n    } else {\n      /* prefixed namespace */\n      const attr = \"xmlns:\" + prefix;\n      if (this.attrs[attr]) {\n        return this.attrs[attr];\n      } else if (this.parent) {\n        return this.parent.findNS(prefix);\n      }\n    }\n  }\n\n  /**\n   * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n   **/\n  getXmlns() {\n    let namespaces = {};\n\n    if (this.parent) {\n      namespaces = this.parent.getXmlns();\n    }\n\n    for (const attr in this.attrs) {\n      const m = attr.match(\"xmlns:?(.*)\");\n      // eslint-disable-next-line  no-prototype-builtins\n      if (this.attrs.hasOwnProperty(attr) && m) {\n        namespaces[this.attrs[attr]] = m[1];\n      }\n    }\n    return namespaces;\n  }\n\n  setAttrs(attrs) {\n    if (typeof attrs === \"string\") {\n      this.attrs.xmlns = attrs;\n    } else if (attrs) {\n      Object.assign(this.attrs, attrs);\n    }\n  }\n\n  /**\n   * xmlns can be null, returns the matching attribute.\n   **/\n  getAttr(name, xmlns) {\n    if (!xmlns) {\n      return this.attrs[name];\n    }\n\n    const namespaces = this.getXmlns();\n\n    if (!namespaces[xmlns]) {\n      return null;\n    }\n\n    return this.attrs[[namespaces[xmlns], name].join(\":\")];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChild(name, xmlns) {\n    return this.getChildren(name, xmlns)[0];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChildren(name, xmlns) {\n    const result = [];\n    for (const child of this.children) {\n      if (\n        child.getName &&\n        child.getName() === name &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildByAttr(attr, val, xmlns, recursive) {\n    return this.getChildrenByAttr(attr, val, xmlns, recursive)[0];\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildrenByAttr(attr, val, xmlns, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (\n        child.attrs &&\n        child.attrs[attr] === val &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByAttr) {\n        result.push(child.getChildrenByAttr(attr, val, xmlns, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getChildrenByFilter(filter, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (filter(child)) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByFilter) {\n        result.push(child.getChildrenByFilter(filter, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getText() {\n    let text = \"\";\n    for (const child of this.children) {\n      if (typeof child === \"string\" || typeof child === \"number\") {\n        text += child;\n      }\n    }\n    return text;\n  }\n\n  getChildText(name, xmlns) {\n    const child = this.getChild(name, xmlns);\n    return child ? child.getText() : null;\n  }\n\n  /**\n   * Return all direct descendents that are Elements.\n   * This differs from `getChildren` in that it will exclude text nodes,\n   * processing instructions, etc.\n   */\n  getChildElements() {\n    return this.getChildrenByFilter((child) => {\n      return child instanceof Element;\n    });\n  }\n\n  /* Builder */\n\n  /** returns uppermost parent */\n  root() {\n    if (this.parent) {\n      return this.parent.root();\n    }\n    return this;\n  }\n\n  /** just parent or itself */\n  up() {\n    if (this.parent) {\n      return this.parent;\n    }\n    return this;\n  }\n\n  /** create child node and return it */\n  c(name, attrs) {\n    return this.cnode(new Element(name, attrs));\n  }\n\n  cnode(child) {\n    this.children.push(child);\n    if (typeof child === \"object\") {\n      child.parent = this;\n    }\n    return child;\n  }\n\n  append(...nodes) {\n    for (const node of nodes) {\n      this.children.push(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  prepend(...nodes) {\n    for (const node of nodes) {\n      this.children.unshift(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  /** add text node and return element */\n  t(text) {\n    this.children.push(text);\n    return this;\n  }\n\n  /* Manipulation */\n\n  /**\n   * Either:\n   *   el.remove(childEl)\n   *   el.remove('author', 'urn:...')\n   */\n  remove(el, xmlns) {\n    const filter =\n      typeof el === \"string\"\n        ? (child) => {\n            /* 1st parameter is tag name */\n            return !(child.is && child.is(el, xmlns));\n          }\n        : (child) => {\n            /* 1st parameter is element */\n            return child !== el;\n          };\n\n    this.children = this.children.filter(filter);\n\n    return this;\n  }\n\n  text(val) {\n    if (val && this.children.length === 1) {\n      this.children[0] = val;\n      return this;\n    }\n    return this.getText();\n  }\n\n  attr(attr, val) {\n    if (typeof val !== \"undefined\" || val === null) {\n      if (!this.attrs) {\n        this.attrs = {};\n      }\n      this.attrs[attr] = val;\n      return this;\n    }\n    return this.attrs[attr];\n  }\n\n  /* Serialization */\n\n  toString() {\n    let s = \"\";\n    this.write((c) => {\n      s += c;\n    });\n    return s;\n  }\n\n  _addChildren(writer) {\n    writer(\">\");\n    for (const child of this.children) {\n      /* Skip null/undefined */\n      if (child != null) {\n        if (child.write) {\n          child.write(writer);\n        } else if (typeof child === \"string\") {\n          writer(escape.escapeXMLText(child));\n        } else if (child.toString) {\n          writer(escape.escapeXMLText(child.toString(10)));\n        }\n      }\n    }\n    writer(\"</\");\n    writer(this.name);\n    writer(\">\");\n  }\n\n  write(writer) {\n    writer(\"<\");\n    writer(this.name);\n    for (const k in this.attrs) {\n      const v = this.attrs[k];\n      // === null || undefined\n      if (v != null) {\n        writer(\" \");\n        writer(k);\n        writer('=\"');\n        writer(escape.escapeXML(typeof v === \"string\" ? v : v.toString(10)));\n        writer('\"');\n      }\n    }\n    if (this.children.length === 0) {\n      writer(\"/>\");\n    } else {\n      this._addChildren(writer);\n    }\n  }\n}\n\nElement.prototype.tree = Element.prototype.root;\n\nmodule.exports = Element;\n","'use strict';\n\nvar Element = require('./Element.js');\n\nfunction append(el, child) {\n  if (Array.isArray(child)) {\n    for (const c of child) append(el, c);\n    return;\n  }\n\n  if (child === \"\" || child == null || child === true || child === false) {\n    return;\n  }\n\n  el.cnode(child);\n}\n\n/**\n * JSX compatible API, use this function as pragma\n * https://facebook.github.io/jsx/\n *\n * @param  {string} name  name of the element\n * @param  {object} attrs object of attribute key/value pairs\n * @return {Element}      Element\n */\nfunction createElement(name, attrs, ...children) {\n  if (typeof attrs === \"object\" && attrs !== null) {\n    // __self and __source are added by babel in development\n    // https://github.com/facebook/react/pull/4596\n    // https://babeljs.io/docs/en/babel-preset-react#development\n    // https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source\n    delete attrs.__source;\n    delete attrs.__self;\n\n    for (const [key, value] of Object.entries(attrs)) {\n      if (value == null) delete attrs[key];\n      else attrs[key] = value.toString(10);\n    }\n  }\n\n  const el = new Element(name, attrs);\n\n  for (const child of children) {\n    append(el, child);\n  }\n\n  return el;\n}\n\nmodule.exports = createElement;\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","'use strict';\n\nvar events = require('events');\nvar escape = require('../escape.js');\n\nconst STATE_TEXT = 0;\nconst STATE_IGNORE_COMMENT = 1;\nconst STATE_IGNORE_INSTRUCTION = 2;\nconst STATE_TAG_NAME = 3;\nconst STATE_TAG = 4;\nconst STATE_ATTR_NAME = 5;\nconst STATE_ATTR_EQ = 6;\nconst STATE_ATTR_QUOT = 7;\nconst STATE_ATTR_VALUE = 8;\nconst STATE_CDATA = 9;\nconst STATE_IGNORE_CDATA = 10;\n\nclass SaxLtx extends events.EventEmitter {\n  constructor() {\n    super();\n    let state = STATE_TEXT;\n    let remainder;\n    let parseRemainder;\n    let tagName;\n    let attrs;\n    let endTag;\n    let selfClosing;\n    let attrQuote;\n    let attrQuoteChar;\n    let recordStart = 0;\n    let attrName;\n\n    this._handleTagOpening = function _handleTagOpening(\n      endTag,\n      tagName,\n      attrs\n    ) {\n      if (!endTag) {\n        this.emit(\"startElement\", tagName, attrs);\n        if (selfClosing) {\n          this.emit(\"endElement\", tagName, true);\n        }\n      } else {\n        this.emit(\"endElement\", tagName, false);\n      }\n    };\n\n    this.write = function write(data) {\n      if (typeof data !== \"string\") {\n        data = data.toString();\n      }\n      let pos = 0;\n\n      /* Anything from previous write()? */\n      if (remainder) {\n        data = remainder + data;\n        pos += !parseRemainder ? remainder.length : 0;\n        parseRemainder = false;\n        remainder = null;\n      }\n\n      function endRecording() {\n        if (typeof recordStart === \"number\") {\n          const recorded = data.slice(recordStart, pos);\n          recordStart = undefined;\n          return recorded;\n        }\n      }\n\n      for (; pos < data.length; pos++) {\n        switch (state) {\n          case STATE_TEXT: {\n            // if we're looping through text, fast-forward using indexOf to\n            // the next '<' character\n            const lt = data.indexOf(\"<\", pos);\n            if (lt !== -1 && pos !== lt) {\n              pos = lt;\n            }\n\n            break;\n          }\n          case STATE_ATTR_VALUE: {\n            // if we're looping through an attribute, fast-forward using\n            // indexOf to the next end quote character\n            const quot = data.indexOf(attrQuoteChar, pos);\n            if (quot !== -1) {\n              pos = quot;\n            }\n\n            break;\n          }\n          case STATE_IGNORE_COMMENT: {\n            // if we're looping through a comment, fast-forward using\n            // indexOf to the first end-comment character\n            const endcomment = data.indexOf(\"-->\", pos);\n            if (endcomment !== -1) {\n              pos = endcomment + 2; // target the '>' character\n            }\n\n            break;\n          }\n          case STATE_IGNORE_CDATA: {\n            // if we're looping through a CDATA, fast-forward using\n            // indexOf to the first end-CDATA character ]]>\n            const endCDATA = data.indexOf(\"]]>\", pos);\n            if (endCDATA !== -1) {\n              pos = endCDATA + 2; // target the '>' character\n            }\n\n            break;\n          }\n          // No default\n        }\n\n        const c = data.charCodeAt(pos);\n        switch (state) {\n          case STATE_TEXT:\n            if (c === 60 /* < */) {\n              const text = endRecording();\n              if (text) {\n                this.emit(\"text\", escape.unescapeXML(text));\n              }\n              state = STATE_TAG_NAME;\n              recordStart = pos + 1;\n              attrs = {};\n            }\n            break;\n          case STATE_CDATA:\n            if (c === 93 /* ] */) {\n              if (data.substr(pos + 1, 2) === \"]>\") {\n                const cData = endRecording();\n                if (cData) {\n                  this.emit(\"text\", cData);\n                }\n                state = STATE_TEXT;\n              } else if (data.length < pos + 2) {\n                parseRemainder = true;\n                pos = data.length;\n              }\n            }\n            break;\n          case STATE_TAG_NAME:\n            if (c === 47 /* / */ && recordStart === pos) {\n              recordStart = pos + 1;\n              endTag = true;\n            } else if (c === 33 /* ! */) {\n              if (data.substr(pos + 1, 7) === \"[CDATA[\") {\n                recordStart = pos + 8;\n                state = STATE_CDATA;\n              } else if (\n                data.length < pos + 8 &&\n                \"[CDATA[\".startsWith(data.slice(pos + 1))\n              ) {\n                // We potentially have CDATA, but the chunk is ending; stop here and let the next write() decide\n                parseRemainder = true;\n                pos = data.length;\n              } else {\n                recordStart = undefined;\n                state = STATE_IGNORE_COMMENT;\n              }\n            } else if (c === 63 /* ? */) {\n              recordStart = undefined;\n              state = STATE_IGNORE_INSTRUCTION;\n            } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n              tagName = endRecording();\n              pos--;\n              state = STATE_TAG;\n            }\n            break;\n          case STATE_IGNORE_COMMENT:\n            if (c === 62 /* > */) {\n              const prevFirst = data.charCodeAt(pos - 1);\n              const prevSecond = data.charCodeAt(pos - 2);\n              if (\n                (prevFirst === 45 /* - */ && prevSecond === 45) /* - */ ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93) /* ] */\n              ) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_IGNORE_INSTRUCTION:\n            if (c === 62 /* > */) {\n              const prev = data.charCodeAt(pos - 1);\n              if (prev === 63 /* ? */) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_TAG:\n            if (c === 62 /* > */) {\n              this._handleTagOpening(endTag, tagName, attrs);\n              tagName = undefined;\n              attrs = undefined;\n              endTag = undefined;\n              selfClosing = undefined;\n              state = STATE_TEXT;\n              recordStart = pos + 1;\n            } else if (c === 47 /* / */) {\n              selfClosing = true;\n            } else if (c > 32) {\n              recordStart = pos;\n              state = STATE_ATTR_NAME;\n            }\n            break;\n          case STATE_ATTR_NAME:\n            if (c <= 32 || c === 61 /* = */) {\n              attrName = endRecording();\n              pos--;\n              state = STATE_ATTR_EQ;\n            }\n            break;\n          case STATE_ATTR_EQ:\n            if (c === 61 /* = */) {\n              state = STATE_ATTR_QUOT;\n            }\n            break;\n          case STATE_ATTR_QUOT:\n            if (c === 34 /* \" */ || c === 39 /* ' */) {\n              attrQuote = c;\n              attrQuoteChar = c === 34 ? '\"' : \"'\";\n              state = STATE_ATTR_VALUE;\n              recordStart = pos + 1;\n            }\n            break;\n          case STATE_ATTR_VALUE:\n            if (c === attrQuote) {\n              const value = escape.unescapeXML(endRecording());\n              attrs[attrName] = value;\n              attrName = undefined;\n              state = STATE_TAG;\n            }\n            break;\n        }\n      }\n\n      if (typeof recordStart === \"number\" && recordStart <= data.length) {\n        remainder = data.slice(recordStart);\n        recordStart = 0;\n      }\n    };\n  }\n\n  end(data) {\n    if (data) {\n      this.write(data);\n    }\n\n    /* Uh, yeah */\n    this.write = function write() {};\n  }\n}\n\nmodule.exports = SaxLtx;\n","export default class TimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"TimeoutError\";\n  }\n}\n","import TimeoutError from \"./TimeoutError.js\";\nimport delay from \"./delay.js\";\n\nexport default function timeout(promise, ms) {\n  const promiseDelay = delay(ms);\n\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout);\n  }\n\n  const error = new TimeoutError();\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw error;\n    }),\n  ]);\n}\n","export default function delay(ms) {\n  let timeout;\n  const promise = new Promise((resolve) => {\n    timeout = setTimeout(resolve, ms);\n  });\n  promise.timeout = timeout;\n  return promise;\n}\n","const map = new WeakMap();\n\nexport default function onoff(target) {\n  let m = map.get(target);\n\n  if (!m) {\n    const on = (target.addEventListener ?? target.addListener).bind(target);\n    const off = (target.removeEventListener ?? target.removeListener).bind(\n      target,\n    );\n    const once = (\n      target.once ??\n      ((event, handler) =>\n        target.addEventListener(event, handler, { once: true }))\n    ).bind(target);\n    m = { on, off, once };\n    map.set(target, m);\n  }\n\n  return m;\n}\n","import onoff from \"./onoff.js\";\nimport TimeoutError from \"./TimeoutError.js\";\n\nexport default function promise(target, event, rejectEvent = \"error\", timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId;\n\n    const { off, once } = onoff(target);\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      off(event, onEvent);\n      off(rejectEvent, onError);\n    };\n\n    function onError(reason) {\n      reject(reason);\n      cleanup();\n    }\n\n    function onEvent(value) {\n      resolve(value);\n      cleanup();\n    }\n\n    once(event, onEvent);\n    if (rejectEvent) {\n      once(rejectEvent, onError);\n    }\n\n    if (timeout) {\n      const error = new TimeoutError();\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(error);\n      }, timeout);\n    }\n  });\n}\n","export default function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n","export default function procedure(entity, stanza = null, handler) {\n  return new Promise((resolve, reject) => {\n    function onError(err) {\n      entity.removeListener(\"nonza\", listener);\n      reject(err);\n    }\n\n    function done(...args) {\n      entity.removeListener(\"nonza\", listener);\n      resolve(...args);\n    }\n\n    async function listener(element) {\n      try {\n        await handler(element, done);\n      } catch (err) {\n        onError(err);\n      }\n    }\n\n    stanza && entity.send(stanza).catch(onError);\n    entity.on(\"nonza\", listener);\n  });\n}\n","import onoff from \"./onoff.js\";\n\nexport default function listeners(events) {\n  return {\n    subscribe(target) {\n      const { on } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        on(event, handler);\n      }\n    },\n    unsubscribe(target) {\n      const { off } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        off(event, handler);\n      }\n    },\n  };\n}\n","export default class XMLError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = \"XMLError\";\n  }\n}\n","import LtxParser from \"ltx/lib/parsers/ltx.js\";\nimport Element from \"ltx/lib/Element.js\";\nimport { EventEmitter } from \"@xmpp/events\";\n\nimport XMLError from \"./XMLError.js\";\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super();\n    const parser = new LtxParser();\n    this.root = null;\n    this.cursor = null;\n\n    parser.on(\"startElement\", this.onStartElement.bind(this));\n    parser.on(\"endElement\", this.onEndElement.bind(this));\n    parser.on(\"text\", this.onText.bind(this));\n\n    this.parser = parser;\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { root, cursor } = this;\n\n    if (!root) {\n      this.root = element;\n      this.emit(\"start\", element);\n    } else if (cursor !== root) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { root, cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor === root) {\n      this.emit(\"end\", root);\n      return;\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root;\n      this.emit(\"element\", cursor);\n      this.cursor = root;\n      return;\n    }\n\n    this.cursor = cursor.parent;\n  }\n\n  onText(str) {\n    const { cursor } = this;\n    if (!cursor) {\n      this.emit(\"error\", new XMLError(`${str} must be a child.`));\n      return;\n    }\n\n    cursor.t(str);\n  }\n\n  write(data) {\n    this.parser.write(data);\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data);\n    }\n  }\n}\n\nParser.XMLError = XMLError;\n\nexport default Parser;\n","import Element from \"ltx/lib/Element.js\";\nimport createElement from \"ltx/lib/createElement.js\";\nimport {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} from \"ltx/lib/escape.js\";\n\nimport Parser from \"./lib/Parser.js\";\nimport XMLError from \"./lib/XMLError.js\";\n\nexport default function xml(...args) {\n  return createElement(...args);\n}\n\nObject.assign(xml, {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n});\n\nexport {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n};\n","export function detect(local) {\n  if (!local) {\n    return false;\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replaceAll(String.raw`\\20`, \"\")\n    .replaceAll(String.raw`\\22`, \"\")\n    .replaceAll(String.raw`\\26`, \"\")\n    .replaceAll(String.raw`\\27`, \"\")\n    .replaceAll(String.raw`\\2f`, \"\")\n    .replaceAll(String.raw`\\3a`, \"\")\n    .replaceAll(String.raw`\\3c`, \"\")\n    .replaceAll(String.raw`\\3e`, \"\")\n    .replaceAll(String.raw`\\40`, \"\")\n    .replaceAll(String.raw`\\5c`, \"\");\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/[ \"&'/:<>@\\\\]/g);\n  if (search === -1) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nexport function escape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(/^\\s+|\\s+$/g, \"\")\n    .replaceAll(\"\\\\\", String.raw`\\5c`)\n    .replaceAll(\" \", String.raw`\\20`)\n    .replaceAll('\"', String.raw`\\22`)\n    .replaceAll(\"&\", String.raw`\\26`)\n    .replaceAll(\"'\", String.raw`\\27`)\n    .replaceAll(\"/\", String.raw`\\2f`)\n    .replaceAll(\":\", String.raw`\\3a`)\n    .replaceAll(\"<\", String.raw`\\3c`)\n    .replaceAll(\">\", String.raw`\\3e`)\n    .replaceAll(\"@\", String.raw`\\40`);\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nexport function unescape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(String.raw`\\20`, \" \")\n    .replaceAll(String.raw`\\22`, '\"')\n    .replaceAll(String.raw`\\26`, \"&\")\n    .replaceAll(String.raw`\\27`, \"'\")\n    .replaceAll(String.raw`\\2f`, \"/\")\n    .replaceAll(String.raw`\\3a`, \":\")\n    .replaceAll(String.raw`\\3c`, \"<\")\n    .replaceAll(String.raw`\\3e`, \">\")\n    .replaceAll(String.raw`\\40`, \"@\")\n    .replaceAll(String.raw`\\5c`, \"\\\\\");\n}\n","import * as escaping from \"./escaping.js\";\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== \"string\" || !domain) {\n      throw new TypeError(`Invalid domain.`);\n    }\n\n    this.setDomain(domain);\n    this.setLocal(typeof local === \"string\" ? local : \"\");\n    this.setResource(typeof resource === \"string\" ? resource : \"\");\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === \"number\") {\n      return Number.NaN;\n    }\n\n    return this.toString();\n  }\n\n  toString(unescape) {\n    let s = this._domain;\n    if (this._local) {\n      s = this.getLocal(unescape) + \"@\" + s;\n    }\n\n    if (this._resource) {\n      s = s + \"/\" + this._resource;\n    }\n\n    return s;\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null);\n    }\n\n    return this;\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    );\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local);\n\n    if (escape) {\n      local = escaping.escape(local);\n    }\n\n    this._local = local && local.toLowerCase();\n    return this;\n  }\n\n  getLocal(unescape = false) {\n    let local = null;\n\n    local = unescape ? escaping.unescape(this._local) : this._local;\n\n    return local;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase();\n    return this;\n  }\n\n  getDomain() {\n    return this._domain;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource;\n    return this;\n  }\n\n  getResource() {\n    return this._resource;\n  }\n}\n\nObject.defineProperty(JID.prototype, \"local\", {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n});\n\nObject.defineProperty(JID.prototype, \"domain\", {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n});\n\nObject.defineProperty(JID.prototype, \"resource\", {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n});\n\nexport default JID;\n","import JID from \"./JID.js\";\n\nexport default function parse(s) {\n  let local;\n  let resource;\n\n  const resourceStart = s.indexOf(\"/\");\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1);\n    s = s.slice(0, resourceStart);\n  }\n\n  const atStart = s.indexOf(\"@\");\n  if (atStart !== -1) {\n    local = s.slice(0, atStart);\n    s = s.slice(atStart + 1);\n  }\n\n  return new JID(local, s, resource);\n}\n","import JID from \"./lib/JID.js\";\nimport { detect, escape, unescape } from \"./lib/escaping.js\";\nimport parse from \"./lib/parse.js\";\n\nexport function equal(a, b) {\n  return a.equals(b);\n}\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args);\n  }\n\n  return new JID(...args);\n}\n\nconst j = jid.bind();\nj.jid = jid;\nj.JID = JID;\nj.parse = parse;\nj.equal = equal;\nj.detectEscape = detect;\nj.escapeLocal = escape;\nj.unescapeLocal = unescape;\n\nexport default j;\n\nexport { jid, JID, parse };\n\nexport {\n  detect as detectEscape,\n  escape as escapeLocal,\n  unescape as unescapeLocal,\n};\n","// https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.9.2\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : \"\"));\n    this.name = \"XMPPError\";\n    this.condition = condition;\n    this.text = text;\n    this.application = application;\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.getChildElements();\n    let text;\n    let application;\n\n    if (second) {\n      if (second.is(\"text\")) {\n        text = second;\n      } else if (second) {\n        application = second;\n      }\n\n      if (third) application = third;\n    }\n\n    const error = new this(\n      condition.name,\n      text ? text.text() : \"\",\n      application,\n    );\n    error.element = element;\n    return error;\n  }\n}\n\nexport default XMPPError;\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"StreamError\";\n  }\n}\n\nexport default StreamError;\n","function parseURI(URI) {\n  let { port, hostname, protocol } = new URL(URI);\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === \"[::1]\") {\n    hostname = \"::1\";\n  }\n\n  return { port, hostname, protocol };\n}\n\nfunction parseHost(host) {\n  const { port, hostname } = parseURI(`http://${host}`);\n  return { port, hostname };\n}\n\nfunction parseService(service) {\n  return service.includes(\"://\") ? parseURI(service) : parseHost(service);\n}\n\nexport { parseURI, parseHost, parseService };\n","import { EventEmitter, promise, listeners } from \"@xmpp/events\";\nimport jid from \"@xmpp/jid\";\nimport xml from \"@xmpp/xml\";\n\nimport StreamError from \"./lib/StreamError.js\";\nimport { parseHost, parseService } from \"./lib/util.js\";\n\nconst NS_STREAM = \"urn:ietf:params:xml:ns:xmpp-streams\";\nconst NS_JABBER_STREAM = \"http://etherx.jabber.org/streams\";\n\nclass Connection extends EventEmitter {\n  #socketListeners = null;\n  #parserListeners = null;\n\n  constructor(options = {}) {\n    super();\n\n    if (typeof options === \"string\") {\n      options = { domain: options };\n    }\n\n    this.jid = null;\n    this.timeout = options.timeout || 2000;\n    this.options = options;\n    this.status = \"offline\";\n    this.socket = null;\n    this.parser = null;\n    this.root = null;\n  }\n\n  isSecure() {\n    return this.socket?.secure === true;\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ]),\n      );\n    } catch {}\n\n    return this.disconnect();\n  }\n\n  _onData(data) {\n    const str = data.toString(\"utf8\");\n    this.parser.write(str);\n  }\n\n  #onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError(\"bad-format\");\n    this._detachParser();\n    this.emit(\"error\", error);\n  }\n\n  #onSocketClosed(dirty, reason) {\n    this._detachSocket();\n    this._status(\"disconnect\", { clean: !dirty, reason });\n  }\n\n  #onStreamClosed(dirty, reason) {\n    this._detachParser();\n    this._status(\"close\", { clean: !dirty, reason });\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#socketListeners ??= listeners({\n      data: this._onData.bind(this),\n      close: this.#onSocketClosed.bind(this),\n      connect: () => this._status(\"connect\"),\n      error: (error) => this.emit(\"error\", error),\n    });\n    this.#socketListeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.socket && this.#socketListeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  _onElement(element) {\n    const isStreamError = element.is(\"error\", NS_JABBER_STREAM);\n\n    if (isStreamError) {\n      this._onStreamError(element);\n    }\n\n    this.emit(\"element\", element);\n    this.emit(this.isStanza(element) ? \"stanza\" : \"nonza\", element);\n\n    if (isStreamError) {\n      // \"Stream Errors Are Unrecoverable\"\n      // \"The entity that receives the stream error then SHALL close the stream\"\n      this.disconnect();\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element);\n\n    if (error.condition === \"see-other-host\") {\n      return this._onSeeOtherHost(error);\n    }\n\n    this.emit(\"error\", error);\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const { protocol } = parseService(this.options.service);\n\n    const host = error.element.getChildText(\"see-other-host\");\n    const { port } = parseHost(host);\n\n    let service;\n    service = port\n      ? `${protocol || \"xmpp:\"}//${host}`\n      : (protocol ? `${protocol}//` : \"\") + host;\n\n    try {\n      await promise(this, \"disconnect\");\n      const { domain, lang } = this.options;\n      await this.connect(service);\n      await this.open({ domain, lang });\n    } catch (err) {\n      this.emit(\"error\", err);\n    }\n  }\n\n  _attachParser(parser) {\n    this.parser = parser;\n    this.#parserListeners ??= listeners({\n      element: this._onElement.bind(this),\n      error: this.#onParserError.bind(this),\n      end: this.#onStreamClosed.bind(this),\n      start: (element) => this._status(\"open\", element),\n    });\n    this.#parserListeners.subscribe(this.parser);\n  }\n\n  _detachParser() {\n    this.parser && this.#parserListeners?.unsubscribe(this.parser);\n    this.parser = null;\n    this.root = null;\n  }\n\n  _jid(id) {\n    this.jid = jid(id);\n    return this.jid;\n  }\n\n  /*\n  [\n    \"offline\",\n    // \"disconnect\",\n    \"connecting\",\n    \"connected\",\n    \"opening\",\n    \"open\",\n    \"online\",\n    \"closing\",\n    \"close\",\n    \"disconnecting\",\n    \"disconnect\",\n    \"offline\",\n  ];\n  */\n  _status(status, ...args) {\n    if (this.status === status) return;\n    this.status = status;\n    this.emit(\"status\", status, ...args);\n    this.emit(status, ...args);\n  }\n\n  _ready(resumed = false) {\n    if (resumed) {\n      this.status = \"online\";\n    } else {\n      this._status(\"online\", this.jid);\n    }\n  }\n\n  async disconnect() {\n    let el;\n\n    try {\n      el = await this._closeStream();\n    } catch (err) {\n      this.#onStreamClosed(err);\n    }\n\n    try {\n      await this._closeSocket();\n    } catch (err) {\n      this.#onSocketClosed(true, err);\n    }\n\n    return el;\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== \"offline\") {\n      throw new Error(\"Connection is not offline\");\n    }\n\n    const { service, domain, lang } = this.options;\n\n    await this.connect(service);\n\n    const promiseOnline = promise(this, \"online\");\n\n    await this.open({ domain, lang });\n\n    return promiseOnline;\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status(\"connecting\", service);\n    const socket = new this.Socket();\n    this._attachSocket(socket);\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service));\n    return promise(socket, \"connect\");\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeSocket(timeout = this.timeout) {\n    this._status(\"disconnecting\");\n    this.socket.end();\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, \"close\", \"error\", timeout);\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status(\"opening\");\n\n    const { domain, lang } = options;\n\n    const headerElement = this.headerElement();\n    headerElement.attrs.to = domain;\n    headerElement.attrs[\"xml:lang\"] = lang;\n    this.root = headerElement;\n\n    this._attachParser(new this.Parser());\n\n    await this.write(this.header(headerElement));\n    return promise(this, \"open\", \"error\", this.timeout);\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this.disconnect();\n    this._status(\"offline\", el);\n    return el;\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeStream(timeout = this.timeout) {\n    await this.#runHooks(\"close\");\n\n    const fragment = this.footer(this.footerElement());\n\n    await this.write(fragment);\n    this._status(\"closing\");\n    return promise(this.parser, \"end\", \"error\", timeout);\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser();\n    const { domain, lang } = this.options;\n    return this.open({ domain, lang });\n  }\n\n  async send(element) {\n    element.parent = this.root;\n    await this.write(element.toString());\n    this.emit(\"send\", element);\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, \"element\", \"error\", timeout),\n    ]).then(([, el]) => el);\n  }\n\n  async write(string) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-close\n    // \"Refrain from sending any further data over its outbound stream to the other entity\"\n    if (this.status === \"closing\") {\n      throw new Error(\"Connection is closing\");\n    }\n\n    return new Promise((resolve, reject) => {\n      this.socket.write(string, (err) => (err ? reject(err) : resolve()));\n    });\n  }\n\n  isStanza(element) {\n    const { name } = element;\n    return name === \"iq\" || name === \"message\" || name === \"presence\";\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element);\n  }\n\n  // Override\n  header(el) {\n    return el.toString();\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element(\"\", {\n      version: \"1.0\",\n      xmlns: this.NS,\n    });\n  }\n\n  // Override\n  footer(el) {\n    return el.toString();\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n\n  /* Experimental hooks */\n  #hooks = new Map();\n  #hook_events = new Set([\"close\"]);\n  hook(event, handler /*priority = 0 TODO */) {\n    this.#assertHookEventName(event);\n\n    if (!this.#hooks.has(event)) {\n      this.#hooks.set(event, new Set());\n    }\n\n    this.#hooks.get(event).add([handler]);\n  }\n  #assertHookEventName(event) {\n    if (!this.#hook_events.has(event)) {\n      throw new Error(`Hook event name \"${event}\" is unknown.`);\n    }\n  }\n  unhook(event, handler) {\n    this.#assertHookEventName(event);\n    const handlers = this.#hooks.get(\"event\");\n    const item = [...handlers].find((item) => item.handler === handler);\n    handlers.remove(item);\n  }\n  async #runHooks(event, ...args) {\n    this.#assertHookEventName(event);\n\n    const hooks = this.#hooks.get(event);\n    if (!hooks) return;\n\n    // TODO run hooks by priority\n    // run hooks with the same priority in parallel\n\n    await Promise.all(\n      [...hooks].map(async ([handler]) => {\n        try {\n          await handler(...args);\n        } catch (err) {\n          this.emit(\"error\", err);\n        }\n      }),\n    );\n  }\n}\n\n// Override\nConnection.prototype.NS = \"\";\nConnection.prototype.Socket = null;\nConnection.prototype.Parser = null;\n\nexport default Connection;\n","import Connection from \"@xmpp/connection\";\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options);\n    this.transports = [];\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args);\n  }\n\n  sendMany(...args) {\n    return this.Transport.prototype.sendMany.call(this, ...args);\n  }\n\n  _findTransport(service) {\n    return this.transports.find((Transport) => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined;\n      } catch {\n        return false;\n      }\n    });\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service);\n\n    if (!Transport) {\n      throw new Error(\"No compatible connection method found.\");\n    }\n\n    this.Transport = Transport;\n    this.Socket = Transport.prototype.Socket;\n    this.Parser = Transport.prototype.Parser;\n\n    return super.connect(service);\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args);\n  }\n\n  header(headerElement, ...args) {\n    // if the client knows the XMPP identity then it SHOULD include the 'from' attribute\n    // after the confidentiality and integrity of the stream are protected via TLS\n    // or an equivalent security layer.\n    // https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.7.1\n    const from = this.isSecure() && this.jid?.bare().toString();\n    if (from) headerElement.attrs.from = from;\n    return this.Transport.prototype.header(headerElement, ...args);\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args);\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args);\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args);\n  }\n}\n\nClient.prototype.NS = \"jabber:client\";\n\nexport default Client;\n","import { EventEmitter } from \"@xmpp/events\";\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super();\n\n    this.delay = 1000;\n    this.entity = entity;\n    this._timeout = null;\n  }\n\n  #onDisconnect = () => {\n    this.scheduleReconnect();\n  };\n\n  scheduleReconnect() {\n    const { entity, delay, _timeout } = this;\n    clearTimeout(_timeout);\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== \"disconnect\") {\n        return;\n      }\n\n      try {\n        await this.reconnect();\n      } catch {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay);\n  }\n\n  async reconnect() {\n    const { entity } = this;\n    this.emit(\"reconnecting\");\n\n    const { service, domain, lang } = entity.options;\n    await entity.connect(service);\n    await entity.open({ domain, lang });\n\n    this.emit(\"reconnected\");\n  }\n\n  start() {\n    const { entity } = this;\n    entity.on(\"disconnect\", this.#onDisconnect);\n  }\n\n  stop() {\n    const { entity, _timeout } = this;\n    entity.removeListener(\"disconnect\", this.#onDisconnect);\n    clearTimeout(_timeout);\n  }\n}\n\nexport default function reconnect({ entity }) {\n  const r = new Reconnect(entity);\n  r.start();\n  return r;\n}\n","import { EventEmitter, listeners } from \"@xmpp/events\";\nimport { parseURI } from \"@xmpp/connection/lib/util.js\";\n\nconst CODE = \"ECONNERROR\";\n\nexport function isSecure(url) {\n  const uri = parseURI(url);\n  if (uri.protocol === \"wss:\") return true;\n  if ([\"localhost\", \"127.0.0.1\", \"::1\"].includes(uri.hostname)) return true;\n  return false;\n}\n\nexport default class Socket extends EventEmitter {\n  #listeners = null;\n  socket = null;\n  url = null;\n  secure = false;\n\n  connect(url) {\n    this.url = url;\n    this.secure = isSecure(url);\n    // eslint-disable-next-line n/no-unsupported-features/node-builtins\n    this._attachSocket(new WebSocket(url, [\"xmpp\"]));\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#listeners ??= listeners({\n      open: () => this.emit(\"connect\"),\n      message: ({ data }) => this.emit(\"data\", data),\n      error: (event) => {\n        const { url } = this;\n        // WS\n        let { error } = event;\n        // DOM\n        if (!error) {\n          error = new Error(event.message || `WebSocket ${CODE} ${url}`);\n          error.errno = CODE;\n          error.code = CODE;\n        }\n\n        error.event = event;\n        error.url = url;\n        this.emit(\"error\", error);\n      },\n      close: (event) => {\n        this._detachSocket();\n        this.emit(\"close\", !event.wasClean, event);\n      },\n    });\n    this.#listeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.url = null;\n    this.secure = false;\n    this.socket && this.#listeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  end() {\n    this.socket.close();\n  }\n\n  write(data, fn) {\n    function done(err) {\n      if (!fn) return;\n      // eslint-disable-next-line promise/catch-or-return, promise/no-promise-in-callback\n      Promise.resolve().then(() => fn(err));\n    }\n\n    try {\n      this.socket.send(data);\n    } catch (err) {\n      done(err);\n      return;\n    }\n    done();\n  }\n}\n","import Connection from \"@xmpp/connection\";\nimport xml from \"@xmpp/xml\";\n\nimport Socket from \"./Socket.js\";\nimport FramedParser from \"./FramedParser.js\";\n\nconst NS_FRAMING = \"urn:ietf:params:xml:ns:xmpp-framing\";\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    element.attrs.xmlns ??= this.NS;\n    return super.send(element, ...args);\n  }\n\n  async sendMany(elements) {\n    for (const element of elements) {\n      element.attrs.xmlns ??= this.NS;\n      element.parent = this.root;\n      this.socket.write(element.toString());\n      this.emit(\"send\", element);\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element(\"close\", {\n      xmlns: NS_FRAMING,\n    });\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement();\n    el.name = \"open\";\n    el.attrs.xmlns = NS_FRAMING;\n    return el;\n  }\n\n  socketParameters(service) {\n    return /^wss?:\\/\\//.test(service) ? service : undefined;\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket;\nConnectionWebSocket.prototype.NS = \"jabber:client\";\nConnectionWebSocket.prototype.Parser = FramedParser;\n\nexport default ConnectionWebSocket;\n","import { Parser, Element, XMLError } from \"@xmpp/xml\";\n\nexport default class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { cursor } = this;\n\n    if (cursor) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent;\n      return;\n    }\n\n    if (cursor.is(\"open\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"start\", cursor);\n    } else if (cursor.is(\"close\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"end\", cursor);\n    } else {\n      this.emit(\"element\", cursor);\n    }\n\n    this.cursor = null;\n  }\n}\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","export default class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza;\n    this.entity = entity;\n\n    const { name, attrs } = stanza;\n    const { type, id } = attrs;\n\n    this.name = name;\n    this.id = id || \"\";\n\n    if (name === \"message\") {\n      this.type = type || \"normal\";\n    } else if (name === \"presence\") {\n      this.type = type || \"available\";\n    } else {\n      this.type = type || \"\";\n    }\n\n    this.from = null;\n    this.to = null;\n    this.local = \"\";\n    this.domain = \"\";\n    this.resource = \"\";\n  }\n}\n","import JID from \"@xmpp/jid\";\n\nimport Context from \"./Context.js\";\n\nexport default class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const to = stanza.attrs.to || jid?.toString();\n    const from = stanza.attrs.from || domain;\n\n    if (to) this.to = new JID(to);\n\n    if (from) {\n      this.from = new JID(from);\n      this.local = this.from.local;\n      this.domain = this.from.domain;\n      this.resource = this.from.resource;\n    }\n  }\n}\n","import JID from \"@xmpp/jid\";\n\nimport Context from \"./Context.js\";\n\nexport default class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const from = stanza.attrs.from || jid?.toString();\n    const to = stanza.attrs.to || domain;\n\n    if (from) this.from = new JID(from);\n\n    if (to) {\n      this.to = new JID(to);\n      this.local = this.to.local;\n      this.domain = this.to.domain;\n      this.resource = this.to.resource;\n    }\n  }\n}\n","import compose from \"koa-compose\";\n\nimport IncomingContext from \"./lib/IncomingContext.js\";\nimport OutgoingContext from \"./lib/OutgoingContext.js\";\n\nfunction listener(entity, middleware, Context) {\n  return (stanza) => {\n    const ctx = new Context(entity, stanza);\n    return compose(middleware)(ctx);\n  };\n}\n\nfunction errorHandler(entity) {\n  return (ctx, next) => {\n    next()\n      .then((reply) => reply && entity.send(reply))\n      .catch((err) => entity.emit(\"error\", err));\n  };\n}\n\nexport default function middleware({ entity }) {\n  const incoming = [errorHandler(entity)];\n  const outgoing = [];\n\n  const incomingListener = listener(entity, incoming, IncomingContext);\n  const outgoingListener = listener(entity, outgoing, OutgoingContext);\n\n  entity.on(\"element\", incomingListener);\n  entity.on(\"send\", outgoingListener);\n\n  return {\n    use(fn) {\n      incoming.push(fn);\n      return fn;\n    },\n    filter(fn) {\n      outgoing.push(fn);\n      return fn;\n    },\n  };\n}\n","import XMPPError from \"@xmpp/error\";\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application);\n    this.type = type;\n    this.name = \"StanzaError\";\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element);\n    error.type = element.attrs.type;\n    return error;\n  }\n}\n\nexport default StanzaError;\n","import xid from \"@xmpp/id\";\nimport StanzaError from \"@xmpp/middleware/lib/StanzaError.js\";\nimport { Deferred, timeout as timeoutPromise } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\n\nfunction isReply({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type !== \"error\" && type !== \"result\") return false;\n  return true;\n}\n\nclass IQCaller {\n  constructor({ entity, middleware }) {\n    this.handlers = new Map();\n    this.entity = entity;\n    this.middleware = middleware;\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this));\n  }\n\n  _route({ type, name, id, stanza }, next) {\n    if (!isReply({ name, type })) return next();\n\n    const deferred = this.handlers.get(id);\n\n    if (!deferred) {\n      return next();\n    }\n\n    if (type === \"error\") {\n      deferred.reject(StanzaError.fromElement(stanza.getChild(\"error\")));\n    } else {\n      deferred.resolve(stanza);\n    }\n\n    this.handlers.delete(id);\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid();\n    }\n\n    const deferred = new Deferred();\n    this.handlers.set(stanza.attrs.id, deferred);\n\n    try {\n      await this.entity.send(stanza);\n      await timeoutPromise(deferred.promise, timeout);\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id);\n      throw err;\n    }\n\n    return deferred.promise;\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {\n      name,\n      attrs: { xmlns },\n    } = element;\n    return this.request(xml(\"iq\", { type, to }, element), ...args).then(\n      (stanza) => stanza.getChild(name, xmlns),\n    );\n  }\n\n  async get(...args) {\n    return this._childRequest(\"get\", ...args);\n  }\n\n  async set(...args) {\n    return this._childRequest(\"set\", ...args);\n  }\n}\n\nexport default function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args);\n  iqCaller.start();\n  return iqCaller;\n}\n","export default function id() {\n  let i;\n  while (!i) {\n    i = Math.random().toString(36).slice(2, 12);\n  }\n\n  return i;\n}\n","import xml from \"@xmpp/xml\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst NS_STANZA = \"urn:ietf:params:xml:ns:xmpp-stanzas\";\n\nfunction isQuery({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type === \"error\" || type === \"result\") return false;\n  return true;\n}\n\nfunction isValidQuery({ type }, children, child) {\n  if (type !== \"get\" && type !== \"set\") return false;\n  if (children.length !== 1) return false;\n  if (!child) return false;\n  return true;\n}\n\nfunction buildReply({ stanza }) {\n  return xml(\"iq\", {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  });\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"result\";\n  if (child) {\n    reply.append(child);\n  }\n\n  return reply;\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"error\";\n  if (child) {\n    reply.append(child);\n  }\n\n  reply.append(error);\n  return reply;\n}\n\nfunction buildError(type, condition) {\n  return xml(\"error\", { type }, xml(condition, NS_STANZA));\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next();\n\n    const { stanza } = ctx;\n    const children = stanza.getChildElements();\n    const [child] = children;\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError(\"modify\", \"bad-request\"), child);\n    }\n\n    ctx.element = child;\n\n    let reply;\n    try {\n      reply = await next();\n    } catch (err) {\n      entity.emit(\"error\", err);\n      reply = buildError(\"cancel\", \"internal-server-error\");\n    }\n\n    if (!reply) {\n      reply = buildError(\"cancel\", \"service-unavailable\");\n    }\n\n    if (reply instanceof xml.Element && reply.is(\"error\")) {\n      return buildReplyError(ctx, reply, child);\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined,\n    );\n  };\n}\n\nfunction route(type, ns, name, handler) {\n  return (ctx, next) => {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next();\n    return handler(ctx, next);\n  };\n}\n\nexport default function iqCallee({ middleware, entity }) {\n  middleware.use(iqHandler(entity));\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route(\"get\", ns, name, handler));\n    },\n    set(ns, name, handler) {\n      middleware.use(route(\"set\", ns, name, handler));\n    },\n  };\n}\n","export function encode(string) {\n  return globalThis.btoa(string);\n}\n\nexport function decode(string) {\n  return globalThis.atob(string);\n}\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"SASLError\";\n  }\n}\n\nexport default SASLError;\n","import { encode, decode } from \"@xmpp/base64\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\n\nimport SASLError from \"./lib/SASLError.js\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-sasl\";\n\nexport function getAvailableMechanisms(element, NS, saslFactory) {\n  const offered = new Set(\n    element.getChildren(\"mechanism\", NS).map((m) => m.text()),\n  );\n  const supported = saslFactory._mechs.map(({ name }) => name);\n  return supported.filter((mech) => offered.has(mech));\n}\n\nasync function authenticate({ saslFactory, entity, mechanism, credentials }) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    mech.clientFirst &&\n      xml(\n        \"auth\",\n        { xmlns: NS, mechanism: mech.name },\n        encode(await mech.response(creds)),\n      ),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"success\") {\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl({ streamFeatures, saslFactory }, onAuthenticate) {\n  streamFeatures.use(\"mechanisms\", NS, async ({ entity }, _next, element) => {\n    const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n    if (mechanisms.length === 0) {\n      throw new SASLError(\"SASL: No compatible mechanism available.\");\n    }\n\n    async function done(credentials, mechanism) {\n      await authenticate({\n        saslFactory,\n        entity,\n        mechanism,\n        credentials,\n      });\n    }\n\n    await onAuthenticate(done, mechanisms, null, entity);\n\n    await entity.restart();\n  });\n}\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\n\n// https://xmpp.org/extensions/xep-0388.html\n\nconst NS = \"urn:xmpp:sasl:2\";\n\nasync function authenticate({\n  saslFactory,\n  entity,\n  mechanism,\n  credentials,\n  userAgent,\n  streamFeatures,\n  features,\n}) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    xml(\"authenticate\", { xmlns: NS, mechanism: mech.name }, [\n      mech.clientFirst &&\n        xml(\"initial-response\", {}, encode(await mech.response(creds))),\n      userAgent,\n      ...streamFeatures,\n    ]),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"continue\") {\n        throw new Error(\"SASL continue is not supported yet\");\n      }\n\n      if (element.name === \"success\") {\n        const additionalData = element.getChild(\"additional-data\")?.text();\n        if (additionalData && mech.final) {\n          await mech.final(decode(additionalData));\n        }\n\n        // https://xmpp.org/extensions/xep-0388.html#success\n        // this is a bare JID, unless resource binding or stream resumption has occurred, in which case it is a full JID.\n        const aid = element.getChildText(\"authorization-identifier\");\n        if (aid) {\n          entity._jid(aid);\n        }\n\n        for (const child of element.getChildElements()) {\n          const feature = features.get(child.getNS());\n          feature?.[1]?.(child);\n        }\n\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl2({ streamFeatures, saslFactory }, onAuthenticate) {\n  const features = new Map();\n  let fast;\n\n  streamFeatures.use(\n    \"authentication\",\n    NS,\n    async ({ entity }, _next, element) => {\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const streamFeatures = await getStreamFeatures({ element, features });\n      const fast_available = !!fast?.mechanism;\n\n      if (mechanisms.length === 0 && !fast_available) {\n        throw new SASLError(\"SASL: No compatible mechanism available.\");\n      }\n\n      await onAuthenticate(\n        done,\n        mechanisms,\n        fast_available ? fast : null,\n        entity,\n      );\n\n      async function done(credentials, mechanism, userAgent) {\n        // Try fast\n        const success = await fast.auth({\n          authenticate,\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          credentials,\n        });\n        if (success) return;\n\n        // fast.auth may mutate streamFeatures to request a token\n\n        // If fast authentication fails, continue and try without\n        await authenticate({\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          saslFactory,\n          mechanism,\n          credentials,\n        });\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n    setup({ fast: _fast }) {\n      fast = _fast;\n    },\n  };\n}\n\nasync function getStreamFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.getNS();\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","import xml from \"@xmpp/xml\";\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-bind\";\n\nfunction makeBindElement(resource) {\n  return xml(\"bind\", { xmlns: NS }, resource && xml(\"resource\", {}, resource));\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource));\n  const jid = result.getChildText(\"jid\");\n  entity._jid(jid);\n  entity._ready(false);\n  return jid;\n}\n\nfunction route({ iqCaller }, resource) {\n  return async ({ entity }, next) => {\n    resource = typeof resource === \"function\" ? await resource() : resource;\n    await bind(entity, iqCaller, resource);\n    next();\n  };\n}\n\nexport default function resourceBinding(\n  { streamFeatures, iqCaller },\n  resource,\n) {\n  streamFeatures.use(\"bind\", NS, route({ iqCaller }, resource));\n}\n","import xml from \"@xmpp/xml\";\n\nconst NS = \"urn:xmpp:bind:0\";\n\nexport default function bind2({ sasl2, entity }, tag) {\n  const features = new Map();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"bind\", NS)) return;\n\n      tag = typeof tag === \"function\" ? await tag() : tag;\n\n      const sessionFeatures = await getSessionFeatures({ element, features });\n\n      return xml(\n        \"bind\",\n        { xmlns: \"urn:xmpp:bind:0\" },\n        tag && xml(\"tag\", null, tag),\n        ...sessionFeatures,\n      );\n    },\n    (element) => {\n      if (!element.is(\"bound\")) return;\n      entity._ready(false);\n      for (const child of element.getChildElements()) {\n        const feature = features.get(child.getNS());\n        feature?.[1]?.(child);\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n  };\n}\n\nfunction getSessionFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.attrs.var;\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","import { EventEmitter } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport SASLFactory from \"saslmechanisms\";\n\nconst NS = \"urn:xmpp:fast:0\";\n\nexport default function fast({ sasl2, entity }) {\n  const saslFactory = new SASLFactory();\n\n  let token;\n\n  const fast = new EventEmitter();\n  Object.assign(fast, {\n    mechanism: null,\n    mechanisms: [],\n    async saveToken(t) {\n      token = t;\n    },\n    async fetchToken() {\n      return token;\n    },\n    async deleteToken() {\n      token = null;\n    },\n    async save(token) {\n      try {\n        await this.saveToken(token);\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async fetch() {\n      try {\n        return this.fetchToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async delete() {\n      try {\n        await this.deleteToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    saslFactory,\n    async auth({\n      authenticate,\n      entity,\n      userAgent,\n      credentials,\n      streamFeatures,\n      features,\n    }) {\n      // Unavailable\n      if (!fast.mechanism) {\n        return false;\n      }\n\n      const { token } = credentials;\n      if (!isTokenValid(token, fast.mechanisms)) {\n        return onInvalidToken();\n      }\n\n      try {\n        await authenticate({\n          saslFactory: fast.saslFactory,\n          mechanism: token.mechanism,\n          credentials: {\n            ...credentials,\n            password: token.token,\n          },\n          streamFeatures: [\n            ...streamFeatures,\n            xml(\"fast\", {\n              xmlns: NS,\n            }),\n          ],\n          entity,\n          userAgent,\n          features,\n        });\n        return true;\n      } catch (err) {\n        if (\n          err instanceof SASLError &&\n          [\"not-authorized\", \"credentials-expired\"].includes(err.condition)\n        ) {\n          return onInvalidToken();\n        }\n        entity.emit(\"error\", err);\n        return false;\n      }\n\n      async function onInvalidToken() {\n        await fast.delete();\n        requestToken(streamFeatures);\n        return false;\n      }\n    },\n  });\n\n  function requestToken(streamFeatures) {\n    streamFeatures.push(\n      xml(\"request-token\", {\n        xmlns: NS,\n        mechanism: fast.mechanism,\n      }),\n    );\n  }\n\n  function reset() {\n    fast.mechanism = null;\n    fast.mechanisms = [];\n  }\n  reset();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"fast\", NS)) return reset();\n\n      fast.available = true;\n\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const mechanism = mechanisms[0];\n\n      if (!mechanism) return reset();\n      fast.mechanisms = mechanisms;\n      fast.mechanism = mechanism;\n\n      // The rest is handled by @xmpp/sasl2\n    },\n    async (element) => {\n      if (element.is(\"token\", NS)) {\n        await fast.save({\n          // The token is bound by the mechanism\n          // > Servers MUST bind tokens to the mechanism selected by the client in its original request, and reject attempts to use them with other mechanisms.\n          mechanism: fast.mechanism,\n          token: element.attrs.token,\n          expiry: element.attrs.expiry,\n        });\n      }\n    },\n  );\n\n  return fast;\n}\n\nexport function isTokenValid(token, mechanisms) {\n  if (!token) return false;\n\n  // Avoid an error round trip if the server does not support the token mechanism anymore\n  if (!mechanisms.includes(token.mechanism)) {\n    return false;\n  }\n\n  // Avoid an error round trip if the token is already expired\n  if (new Date(token.expiry) <= new Date()) {\n    return false;\n  }\n\n  return true;\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-plain\";\n\nexport default function saslPlain(sasl) {\n  sasl.use(mech);\n}\n","import type { Chat } from '../../types';\nimport type XMPPChatService from '.';\nimport { ChatProtocol, ChatType } from '../../types/enums';\nimport config from '../../config';\nimport ChatUtils from './ChatUtils';\nimport Utils from '../../Utils';\n\nenum NonzaName {\n  ENABLE = 'enable',\n  ENABLED = 'enabled',\n  REQUEST = 'r',\n  ANSWER = 'a',\n}\n\nexport default class StreamManagement {\n  readonly xmlns = 'urn:xmpp:sm:3';\n\n  private enabled: boolean = false;\n  private clientHandledCounter: number = 0;\n  private serverHandledCounter: number = 0;\n  private messagesQueue: Set<Chat.MessageParams> = new Set();\n  private messagesQueueClearTimer?: NodeJS.Timeout | number;\n\n  constructor(private chat: XMPPChatService) {}\n\n  public get supported(): boolean {\n    return config.chatProtocol.active === ChatProtocol.WS && config.chat.streamManagement?.enable;\n  }\n\n  public start(): void {\n    this.enabled = false;\n\n    if (this.supported) {\n      this.removeElementHandler();\n      this.addElementHandler();\n      this.sendNonza(NonzaName.ENABLE);\n    }\n  }\n\n  public stop(): void {\n    this.enabled = false;\n\n    if (this.supported) {\n      this.removeElementHandler();\n      this.markMessagesQueueAsLost();\n    }\n  }\n\n  public async sendAndCount(stanza: Chat.XmlElement, message: Chat.MessageParams): Promise<void> {\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const attachments = ChatUtils.getAllElements(stanza, 'attachment');\n    const isMessage = stanza.name === 'message';\n    const isChat = type === ChatType.CHAT || type === ChatType.GROUPCHAT;\n    const isContent = Boolean(body || attachments.length);\n\n    try {\n      await this.chat.xmppClient.sendOnline(stanza);\n\n      if (this.enabled && isMessage && isChat && isContent) {\n        this.messagesQueue.add(message);\n        this.sendNonza(NonzaName.REQUEST);\n      }\n    } catch {\n      this.markMessageAsLost(message);\n    }\n  }\n\n  private elementHandler = (stanza: Chat.XmlElement): void => {\n    const [name, xmlns] = [stanza.name, ChatUtils.getAttr(stanza, 'xmlns')];\n\n    if (xmlns === this.xmlns && name === NonzaName.ENABLED) {\n      this.clientHandledCounter = 0;\n      this.serverHandledCounter = 0;\n      this.enabled = true;\n      return;\n    }\n\n    if (xmlns !== this.xmlns) this.clientHandledCounter++;\n\n    if (name === NonzaName.REQUEST) {\n      this.sendNonza(NonzaName.ANSWER);\n      return;\n    }\n\n    if (name === NonzaName.ANSWER) {\n      const nextHandledCounter = parseInt(ChatUtils.getAttr(stanza, 'h'), 10);\n      const currHandledCounter = Number.isNaN(nextHandledCounter) ? this.serverHandledCounter : nextHandledCounter;\n      const diffHandledCounter = currHandledCounter - this.serverHandledCounter;\n\n      this.serverHandledCounter = currHandledCounter;\n      this.markMessagesQueueAsSent(diffHandledCounter);\n      this.markMessagesQueueAsLostByTimeout();\n    }\n  };\n\n  private markMessageAsSent(message: Chat.MessageParams): void {\n    Utils.safeCallbackCall(this.chat.onSentMessageCallback)(null, message);\n    this.messagesQueue.delete(message);\n  }\n\n  private markMessageAsLost(message: Chat.MessageParams, clear: boolean = true): void {\n    Utils.safeCallbackCall(this.chat.onSentMessageCallback)(message, null);\n    if (clear) this.messagesQueue.delete(message);\n  }\n\n  private markMessagesQueueAsSent(iterations: number = 0): void {\n    const iterator = this.messagesQueue.values();\n\n    for (let i = 0; i < iterations; i++) {\n      const { done, value } = iterator.next();\n      if (done) break;\n      this.markMessageAsSent(value);\n    }\n  }\n\n  private markMessagesQueueAsLost(): void {\n    clearTimeout(this.messagesQueueClearTimer);\n    this.messagesQueueClearTimer = undefined;\n\n    if (this.messagesQueue.size > 0) {\n      this.messagesQueue.forEach((message) => {\n        this.markMessageAsLost(message, false);\n      });\n      this.messagesQueue.clear();\n    }\n  }\n\n  private markMessagesQueueAsLostByTimeout(): void {\n    const ackTimeout = (config.chat.streamManagement?.acknowledgementTimeout ?? 30) * 1000;\n\n    clearTimeout(this.messagesQueueClearTimer);\n    this.messagesQueueClearTimer = setTimeout(() => {\n      this.markMessagesQueueAsLost();\n    }, ackTimeout);\n  }\n\n  private sendNonza(name: string): Promise<void> {\n    const attrs = { xmlns: this.xmlns, ...(name === NonzaName.ANSWER && { h: this.clientHandledCounter }) };\n    const nonza = ChatUtils.createNonza(name, attrs);\n\n    return this.chat.xmppClient.sendOnline(nonza);\n  }\n\n  private removeElementHandler(): void {\n    this.chat.xmppClient.removeListener('element', this.elementHandler);\n  }\n\n  private addElementHandler(): void {\n    this.chat.xmppClient.on('element', this.elementHandler);\n  }\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-anonymous\";\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nexport default function saslAnonymous(sasl) {\n  sasl.use(mech);\n}\n","/* eslint-disable n/no-unsupported-features/node-builtins */\n\n// https://datatracker.ietf.org/doc/draft-schmaus-kitten-sasl-ht/\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n\nexport function Mechanism() {}\n\nMechanism.prototype.Mechanism = Mechanism;\nMechanism.prototype.name = \"HT-SHA-256-NONE\";\nMechanism.prototype.clientFirst = true;\n\nMechanism.prototype.response = async function response({ username, password }) {\n  this.key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(password),\n    // https://developer.mozilla.org/en-US/docs/Web/API/HmacImportParams\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false, // extractable\n    [\"sign\", \"verify\"],\n  );\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    this.key,\n    new TextEncoder().encode(\"Initiator\"),\n  );\n  return `${username}\\0${String.fromCodePoint(...new Uint8Array(signature))}`;\n};\n\nMechanism.prototype.final = async function final(data) {\n  const signature = Uint8Array.from(data, (c) => c.codePointAt(0));\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/verify\n  const result = await crypto.subtle.verify(\n    \"HMAC\",\n    this.key,\n    signature,\n    new TextEncoder().encode(\"Responder\"),\n  );\n  if (result !== true) {\n    throw new Error(\"Responder message from server was wrong\");\n  }\n};\n\nexport default function saslHashedToken(sasl) {\n  sasl.use(Mechanism);\n}\n","import type { XMPPClient, XMPPCredentials, XMPPCredentialsAuth, XMPPOptions, XMPPUserAgent } from '@xmppClient';\nimport type { FAST } from '@xmpp/client-core/src/fast/fast.js';\n\nexport function createOnAuthenticate(credentials: XMPPCredentials, userAgent: XMPPUserAgent) {\n  return async function onAuthenticate(...args) {\n    const [authenticate, mechanisms, fast, entity] = args as [XMPPCredentialsAuth, string[], FAST, XMPPClient];\n\n    if (typeof credentials === 'function') {\n      const mechanism = getMechanism(mechanisms, entity);\n\n      await credentials(authenticate, mechanism);\n    } else {\n      credentials.token ??= await fast?.fetch();\n\n      const mechanism = getMechanism(mechanisms, entity, credentials);\n\n      await authenticate(credentials, mechanism, userAgent);\n    }\n  };\n}\n\nexport function getMechanism(mechanisms: string[], entity: XMPPClient, options?: XMPPOptions): string {\n  const username = options?.username || entity.options?.username;\n  const password = options?.password || entity.options?.password;\n  const token = options?.token || entity.options?.token;\n\n  if (!username && !password && !token && mechanisms.includes('ANONYMOUS')) {\n    return 'ANONYMOUS';\n  }\n\n  if (entity.isSecure()) return mechanisms[0];\n\n  return mechanisms.find((mechanism) => mechanism !== 'PLAIN');\n}\n\nexport function getDomain(service: string): string {\n  const domain = service.split('://')[1] || service;\n\n  return domain.split(':')[0].split('/')[0];\n}\n\nexport function setupIfAvailable(module?: any, ...args): any {\n  if (typeof module !== 'function') {\n    return undefined;\n  }\n\n  return module(...args);\n}\n","import config from '../../config';\nimport { xml } from './xmpp';\nimport type { Chat } from '../../types/index';\n\nexport default class ChatUtils {\n  static buildUserJid(params: Chat.UserJIDParams = {}): string | void {\n    const { userId, resource, jid } = params;\n    const appId = config.creds.appId;\n    const url = config.endpoints.chat;\n\n    return userId ? `${userId}-${appId}@${url}${resource ? `/${resource}` : ''}` : jid;\n  }\n\n  static buildUserJidLocalPart(userId: string | number): string {\n    return `${userId}-${config.creds.appId}`;\n  }\n\n  static createMessageStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('message', attrs);\n  }\n\n  static createIqStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('iq', attrs);\n  }\n\n  static createPresenceStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('presence', attrs);\n  }\n\n  static createNonza(name: string, attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml(name, attrs);\n  }\n\n  static getAttr(element: Chat.XmlElement, name: string): any {\n    return element?.getAttr(name) || element?.attrs[name] || null;\n  }\n\n  static getElement(element: Chat.XmlElement, name: string): Chat.XmlElement | undefined {\n    return element?.getChild(name);\n  }\n\n  static getName(element: Chat.XmlElement): string | null {\n    return element?.getName() || null;\n  }\n\n  static getText(element: Chat.XmlElement): string | null {\n    return element?.getText() || null;\n  }\n\n  static getChildElements(element: Chat.XmlElement): Chat.XmlElement[] {\n    return element?.getChildElements() || [];\n  }\n\n  static isErrorStanza(element: Chat.XmlElement): boolean {\n    return !!element?.getChild('error');\n  }\n\n  static getAllElements(element: Chat.XmlElement, name: string): Chat.XmlElement[] {\n    return element?.getChildren(name) || [];\n  }\n\n  static getElementText(element: Chat.XmlElement, name: string): string | null {\n    return element?.getChildText(name) || null;\n  }\n\n  static getElementTreePath(element: Chat.XmlElement, elementsPath: string[]): Chat.XmlElement | undefined {\n    return elementsPath.reduce<Chat.XmlElement | undefined>(\n      (prevElement: Chat.XmlElement | undefined, name: string) =>\n        prevElement ? ChatUtils.getElement(prevElement, name) : undefined,\n      element as Chat.XmlElement\n    );\n  }\n\n  static assignObjectToXml(element: Chat.XmlElement, obj: { [key: string]: any }, name: string): Chat.XmlElement {\n    element = element.c(name);\n\n    Object.keys(obj).forEach((key: string) => {\n      if (typeof obj[key] === 'object') {\n        ChatUtils.assignObjectToXml(element, obj[key], key);\n      } else {\n        element = element.c(key).t(obj[key]).up();\n      }\n    });\n\n    element = element.up();\n\n    return element;\n  }\n\n  static assignExtraParamsToXml(element: Chat.XmlElement, extension: { [key: string]: any }): Chat.XmlElement {\n    let extraParams = ChatUtils.getElement(element, 'extraParams');\n\n    Object.keys(extension).forEach((key) => {\n      if (key === 'attachments') {\n        (extension[key] as any[]).forEach((attachment: any) => {\n          extraParams!.c('attachment', attachment).up();\n        });\n      } else if (typeof extension[key] === 'object') {\n        ChatUtils.assignObjectToXml(extraParams!, extension[key], key);\n      } else {\n        extraParams!.c(key).t(extension[key]).up();\n      }\n    });\n\n    element.up();\n\n    return element;\n  }\n\n  static assignXmlToObject(element: Chat.XmlElement, obj: any): any {\n    const { children, name } = element;\n    const item: { [key: string]: any } = { [name]: {} };\n\n    children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        item[name] = node;\n      } else if (node.children.length > 0) {\n        ChatUtils.assignXmlToObject(node, item[name]);\n      } else {\n        item[name][node.name] = ChatUtils.getText(node);\n      }\n    });\n\n    return Object.assign(obj, item);\n  }\n\n  static parseExtraParams(element: Chat.XmlElement): { extension: any; dialogId: string | null } | null {\n    if (!element) {\n      return null;\n    }\n\n    const extension: any = { attachments: [] };\n    let dialogId: string | null = null;\n\n    element.children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        return;\n      }\n\n      if (node.name === 'attachment') {\n        const attachment: any = {};\n\n        Object.keys(node.attrs).forEach((key: string) => {\n          attachment[key] = key === 'size' ? parseInt(node.attrs.size) : node.attrs[key];\n        });\n\n        extension.attachments.push(attachment);\n      } else if (node.name === 'dialog_id') {\n        dialogId = ChatUtils.getElementText(element, 'dialog_id');\n        extension.dialog_id = dialogId;\n      }\n\n      if (node.children.length) {\n        ChatUtils.assignXmlToObject(node, extension);\n      }\n    });\n\n    if (extension.attachments.length === 0) {\n      delete extension.attachments;\n    }\n    if (extension.moduleIdentifier) {\n      delete extension.moduleIdentifier;\n    }\n\n    return { extension, dialogId };\n  }\n\n  static buildErrorFromXMPPErrorStanza(errorStanza: Chat.XmlElement): { code: number; info: string | null } {\n    const errorElement = ChatUtils.getElement(errorStanza, 'error');\n    const code = errorElement ? parseInt(ChatUtils.getAttr(errorElement, 'code')) : 0;\n    const info = errorElement ? ChatUtils.getElementText(errorElement, 'text') : null;\n    return { code: code, info: info };\n  }\n\n  static getUniqueId(suffix?: any): string {\n    const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c == 'x' ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n\n    if (typeof suffix === 'string' || typeof suffix === 'number') {\n      return `${uuid}:${suffix}`;\n    } else {\n      return uuid;\n    }\n  }\n\n  static parseReactions(element: Chat.XmlElement): { add: string; remove: string } {\n    const reactions = ChatUtils.getChildElements(element).map((node: Chat.XmlElement) => ({\n      add: ChatUtils.getAttr(node, 'add') === 'true',\n      remove: ChatUtils.getAttr(node, 'remove') === 'true',\n      reaction: ChatUtils.getAttr(node, 'type'),\n    }));\n\n    return reactions.reduce(\n      (items, { add, remove, reaction }) => {\n        if (add) {\n          items['add'] = reaction;\n        } else if (remove) {\n          items['remove'] = reaction;\n        }\n        return items;\n      },\n      {} as { add: string; remove: string }\n    );\n  }\n}\n","import type { Element } from '@xmpp/xml';\nimport type { Options } from '@xmpp/connection';\nimport type { Reconnect } from '@xmpp/reconnect';\nimport type { Middleware } from '@xmpp/middleware';\nimport type { StreamFeatures } from '@xmpp/stream-features';\nimport type { IQCaller } from '@xmpp/iq/caller.js';\nimport type { IQCallee } from '@xmpp/iq/callee.js';\nimport type { SASL2 } from '@xmpp/sasl2';\nimport type { SASL } from '@xmpp/sasl';\nimport type { Resource } from '@xmpp/resource-binding';\nimport type { Bind2 } from '@xmpp/client-core/src/bind2/bind2.js';\nimport type { Token, FAST } from '@xmpp/client-core/src/fast/fast.js';\n\nimport { jid, xml, Client } from '@xmpp/client-core';\nimport _reconnect from '@xmpp/reconnect';\nimport _websocket from '@xmpp/websocket';\nimport _middleware from '@xmpp/middleware';\nimport _streamFeatures from '@xmpp/stream-features';\nimport _iqCaller from '@xmpp/iq/caller.js';\nimport _iqCallee from '@xmpp/iq/callee.js';\nimport _sasl2 from '@xmpp/sasl2';\nimport _sasl from '@xmpp/sasl';\nimport _resourceBinding from '@xmpp/resource-binding';\nimport _bind2 from '@xmpp/client-core/src/bind2/bind2.js';\nimport _fast from '@xmpp/client-core/src/fast/fast.js';\nimport SASLFactory from 'saslmechanisms';\nimport plain from '@xmpp/sasl-plain';\nimport anonymous from '@xmpp/sasl-anonymous';\nimport htsha256none from '@xmpp/sasl-ht-sha-256-none';\nimport { createOnAuthenticate, getDomain } from './xmpp.utils';\nimport ChatUtils from './ChatUtils';\nimport Utils from '../../Utils';\n\nexport type XMPPResource = Resource | string | (() => Promise<string>) | undefined;\nexport type XMPPCredentialsProp = string | undefined;\nexport type XMPPCredentialsAuth = (\n  credentials: Partial<XMPPCredentialsObj>,\n  mechanism: string,\n  userAgent?: XMPPUserAgent\n) => Promise<void>;\nexport type XMPPCredentials =\n  | Partial<XMPPCredentialsObj>\n  | ((callback: XMPPCredentialsAuth, mechanism: string) => Promise<void>)\n  | undefined;\nexport type XMPPUserAgent = Element | undefined;\n\nexport interface XMPPCredentialsObj {\n  username: XMPPCredentialsProp;\n  password: XMPPCredentialsProp;\n  token: Token;\n}\n\nexport interface XMPPOptions extends Options, Partial<XMPPCredentialsObj> {\n  resource?: XMPPResource;\n  credentials?: XMPPCredentials;\n  userAgent?: XMPPUserAgent;\n}\n\nexport interface XMPPClient extends Client {\n  entity: Client;\n  reconnect: Reconnect<Client>;\n  websocket: ReturnType<typeof _websocket>;\n  middleware: Middleware<Client>;\n  streamFeatures: StreamFeatures<Client>;\n  iqCaller: IQCaller<Client>;\n  iqCallee: IQCallee<Client>;\n  saslFactory: SASLFactory;\n  sasl2: SASL2;\n  sasl: SASL;\n  resourceBinding: ReturnType<typeof _resourceBinding>;\n  mechanisms: { [x: string]: any }[];\n  bind2: Bind2;\n  fast: FAST;\n  options: XMPPOptions;\n  sendOnline: (element: Element, ...args: unknown[]) => Promise<void>;\n}\n\nfunction xmppClient(options: XMPPOptions): XMPPClient {\n  let { resource, credentials, username, password, userAgent, ...params } = options;\n\n  const { domain, service } = params;\n\n  if (!domain && service) {\n    params.domain = getDomain(service);\n  }\n\n  const entity = new Client(params);\n\n  if (username && params.domain) {\n    entity.jid = jid(username, params.domain);\n  }\n\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n\n  // SASL mechanisms - order matters and define priority\n  const saslFactory = new SASLFactory();\n  const mechanisms = Object.entries({ plain, anonymous }).map(([k, v]) => ({ [k]: v(saslFactory) }));\n\n  userAgent ??= xml('user-agent', { id: ChatUtils.getUniqueId() });\n\n  // Stream features - order matters and define priority\n  const sasl2 = _sasl2(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent)\n  );\n  const fast = _fast({ sasl2, entity });\n\n  sasl2.setup({ fast });\n\n  // SASL2 inline features\n  const bind2 = _bind2({ sasl2, entity }, resource as string | (() => Promise<string>));\n\n  // FAST mechanisms - order matters and define priority\n  htsha256none(fast.saslFactory);\n\n  // Stream features - order matters and define priority\n  const sasl = _sasl(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent)\n  );\n  const resourceBinding = _resourceBinding({ iqCaller, streamFeatures }, resource as Resource | undefined);\n\n  iqCallee?.get('urn:xmpp:ping', 'ping', () => ({}));\n\n  const sendOnline = function (element: Element, ...args: unknown[]): Promise<void> {\n    if (entity.status === 'online') {\n      return entity.send.call(entity, element, ...args);\n    } else {\n      const message = \"You are not connected to chat. Please call 'connect' function first\";\n\n      Utils.DLog('[Chat][Error]', message);\n\n      return Promise.reject(new Error(message));\n    }\n  };\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    websocket,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    saslFactory,\n    sasl2,\n    sasl,\n    resourceBinding,\n    mechanisms,\n    bind2,\n    fast,\n    sendOnline,\n  });\n}\n\nexport { jid, xml, xmppClient };\n","import ConnectionWebSocket from \"./lib/Connection.js\";\n\nexport default function websocket({ entity }) {\n  entity.transports.push(ConnectionWebSocket);\n}\n","/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nexport default function streamFeatures({ middleware }) {\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const { stanza } = ctx;\n      if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n        return next();\n      const feature = stanza.getChild(name, xmlns);\n      if (!feature) return next();\n      return handler(ctx, next, feature);\n    });\n  }\n\n  return {\n    use,\n  };\n}\n","import Utils from '../../Utils';\nimport config from '../../config';\nimport ChatUtils from './ChatUtils';\n\nexport default class ChatHelpers {\n  public xmppJID: string = '';\n\n  public get userCurrentJid(): string | '' {\n    return this.xmppJID;\n  }\n\n  public set userCurrentJid(jid: string | null) {\n    this.xmppJID = jid || '';\n  }\n\n  public getUniqueId = ChatUtils.getUniqueId;\n\n  public isNumeric(value: string): boolean {\n    return /^-?\\d+$/.test(value) || /^\\d+\\.\\d+$/.test(value);\n  }\n\n  public jidOrUserId(jidOrUserId: string | number): string {\n    if (typeof jidOrUserId === 'string') {\n      return this.isNumeric(jidOrUserId)\n        ? this.getUserJid(jidOrUserId)\n        : jidOrUserId.includes('@')\n          ? jidOrUserId\n          : this.getRoomJidFromDialogId(jidOrUserId);\n    }\n\n    return this.getUserJid(jidOrUserId);\n  }\n\n  public typeChat(jidOrUserId: string | number): 'chat' | 'groupchat' {\n    switch (typeof jidOrUserId) {\n      case 'string':\n        return this.isNumeric(jidOrUserId)\n          ? 'chat'\n          : jidOrUserId.includes('@')\n            ? jidOrUserId.includes('muc')\n              ? 'groupchat'\n              : 'chat'\n            : 'groupchat';\n      case 'number':\n        return 'chat';\n      default:\n        throw new Error('Unsupported chat type');\n    }\n  }\n\n  public getUserJid(userId: string | number): string {\n    return `${userId}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  public getUserNickWithMucDomain(userId: string | number): string {\n    return `${config.endpoints.muc}/${userId}`;\n  }\n\n  public getUserIdFromJID(jid: string = this.userCurrentJid): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  public getDialogIdFromJID(jid: string): string | null {\n    return jid?.includes('@') ? jid.split('@')[0].split('_')[1] : null;\n  }\n\n  public getRoomJidFromDialogId(dialogId: string): string {\n    return `${config.creds.appId}_${dialogId}@${config.endpoints.muc}`;\n  }\n\n  public getRoomJid(jid: string): string {\n    return `${jid}/${this.getUserIdFromJID(this.userCurrentJid)}`;\n  }\n\n  public getIdFromResource(jid: string): number | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parseInt(parts.slice(1).join('/')) : null;\n  }\n\n  public getRoomJidFromRoomFullJid(jid: string): string | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parts[0] : null;\n  }\n\n  public getBsonObjectId = Utils.getBsonObjectId;\n\n  public getUserIdFromRoomJid(roomJid: string): number | null {\n    const parts = roomJid.split('/');\n    return parts.length > 1 ? parseInt(parts[parts.length - 1]) : null;\n  }\n\n  getDialogJid(identifier: string): string {\n    return identifier.indexOf('@') > 0 ? identifier : this.getRoomJidFromDialogId(identifier);\n  }\n}\n","import type { XMPPClient } from '@xmppClient';\nimport type { Chat } from '../../types';\nimport { PrivacyListAction } from '../../types/enums';\nimport ChatUtils from './ChatUtils';\nimport ChatHelpers from './Helpers';\n\nexport default class PrivacyList {\n  readonly xmlns = 'jabber:iq:privacy';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async create(list: Chat.PrivacyList): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const privacyList = list.items.reduce(\n        (acc, { user_id, action, mutualBlock }) => {\n          acc[user_id] = { action, mutualBlock };\n          return acc;\n        },\n        {} as Record<string, Partial<Chat.PrivacyListItem>>\n      );\n\n      const privacyListKeys = Object.keys(privacyList);\n      const iqParams = {\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: ChatUtils.getUniqueId('edit'),\n      };\n\n      let iq = ChatUtils.createIqStanza(iqParams);\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: list.name });\n\n      for (let index = 0, j = 0, len = privacyListKeys.length; index < len; index++, j = j + 2) {\n        const userId = privacyListKeys[index];\n        const { action, mutualBlock } = privacyList[userId];\n        const isMutual = (mutualBlock && action === 'deny') ?? false;\n        const userJid = this.helpers.jidOrUserId(parseInt(userId, 10));\n        const userMuc = this.helpers.getUserNickWithMucDomain(userId);\n\n        this.assignPrivacyItem(iq, { order: j + 1, value: userJid, action, isMutual });\n        this.assignPrivacyItem(iq, { order: j + 2, value: userMuc, action, isMutual });\n      }\n\n      this.stanzasCallbacks[iqParams.id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async getList(name: string): Promise<Chat.PrivacyList> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('getlist');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement): void => {\n        const query = ChatUtils.getElement(stanza, 'query');\n        const list = ChatUtils.getElement(query, 'list');\n        const privacyList: Chat.PrivacyList = {\n          name: ChatUtils.getAttr(list, 'name'),\n          items: ChatUtils.getChildElements(list)\n            .map((item, index) => {\n              if (index % 2 === 0) {\n                const { action, value } = item.attrs;\n                return {\n                  user_id: this.helpers.getUserIdFromJID(value),\n                  action: action,\n                } as Chat.PrivacyListItem;\n              }\n              return null;\n            })\n            .filter((item) => item !== null),\n        };\n\n        resolve(privacyList);\n\n        delete this.stanzasCallbacks[id];\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async update(list: Chat.PrivacyList): Promise<void> {\n    try {\n      const currentList = await this.getList(list.name);\n      const map = new Map(currentList.items.map((currentListItem) => [currentListItem.user_id, currentListItem]));\n\n      for (const item of list.items) {\n        if (item.action === PrivacyListAction.ALLOW) {\n          map.delete(item.user_id);\n        } else {\n          const updatedItem = Object.assign({}, map.get(item.user_id), item);\n          map.set(item.user_id, updatedItem);\n        }\n      }\n\n      const updatedListItems = Array.from(map.values());\n      const updatedList = { name: list.name, items: updatedListItems };\n\n      await this.create(updatedList);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getNames(): Promise<Chat.PrivacyListNames> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('getNames');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (!ChatUtils.isErrorStanza(stanza)) {\n          const query = ChatUtils.getElement(stanza, 'query');\n          const defaultElement = ChatUtils.getElement(query, 'default');\n          const activeElement = ChatUtils.getElement(query, 'active');\n          const defaultName = ChatUtils.getAttr(defaultElement, 'name');\n          const activeName = ChatUtils.getAttr(activeElement, 'name');\n          const allNames = ChatUtils.getChildElements(query).map((list) => ChatUtils.getAttr(list, 'name'));\n\n          const namesList = {\n            default: defaultName,\n            active: activeName,\n            names: allNames,\n          };\n\n          resolve(namesList);\n        } else {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        }\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async delete(name: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('remove');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: name ? name : '' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async setAsDefault(name: string | null): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('default');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('default', name ? { name: name } : {});\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  private assignPrivacyItem(iq: Chat.XmlElement, params: Chat.PrivacyListItemParams): void {\n    const { value, action, order, isMutual } = params;\n    const query = ChatUtils.getElement(iq, 'query');\n    const list = ChatUtils.getElement(query, 'list');\n    const item = list.c('item', { type: 'jid', value, action, order });\n\n    if (isMutual) {\n      item.up();\n\n      if (order % 2 === 0) {\n        iq.up().up();\n      }\n    } else {\n      item.c('message', {}).up().c('presence-in', {}).up().c('presence-out', {}).up().c('iq', {}).up().up();\n    }\n  }\n}\n","import type { XMPPClient } from '@xmppClient';\nimport type { Chat } from '../../types';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\n\nexport default class MultiUserChat {\n  readonly xmlns = 'http://jabber.org/protocol/muc';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n  public joinedRooms: { [jid: string]: boolean } = {};\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async join(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('join');\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        id: id,\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      presenceStanza.c('x', { xmlns: this.xmlns }).c('history', { maxstanzas: 0 });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const x = ChatUtils.getElement(stanza, 'x');\n        const status = ChatUtils.getElement(x, 'status');\n        const code = ChatUtils.getAttr(status, 'code');\n\n        if (status && code == '110') {\n          this.joinedRooms[dialogJid] = true;\n          resolve();\n        } else {\n          const isJoin = ChatUtils.getAttr(x, 'xmlns') === this.xmlns && id.endsWith(':join');\n          const isError = ChatUtils.getAttr(stanza, 'type') === 'error';\n\n          if (isJoin && isError) {\n            const errorElement = ChatUtils.getElement(stanza, 'error');\n            const errorResponse = {\n              code: ChatUtils.getAttr(errorElement, 'code'),\n              message: ChatUtils.getElementText(errorElement, 'text') || 'Unknown issue',\n            };\n\n            reject(errorResponse);\n          }\n        }\n      };\n\n      this.xmppClient.sendOnline(presenceStanza);\n    });\n  }\n\n  public async leave(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        type: 'unavailable',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      delete this.joinedRooms[dialogJid];\n\n      this.stanzasCallbacks['muc:leave'] = (_stanza: Chat.XmlElement) => {\n        resolve();\n      };\n\n      this.xmppClient.sendOnline(presenceStanza);\n    });\n  }\n\n  public async listOnlineUsers(dialogIdOrJid: string): Promise<number[]> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('muc_disco_items');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        to: this.helpers.getDialogJid(dialogIdOrJid),\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iqStanza.c('query', { xmlns: 'http://jabber.org/protocol/disco#items' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n        if (this.stanzasCallbacks[stanzaId]) {\n          const query = ChatUtils.getAttr(stanza, 'query');\n          const users = ChatUtils.getChildElements(query)\n            .map((item: Chat.XmlElement): number | null => {\n              const roomJid = ChatUtils.getAttr(item, 'jid');\n              return this.helpers.getUserIdFromRoomJid(roomJid);\n            })\n            .filter((userId: number | null) => userId !== null);\n\n          resolve(users);\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n}\n","import type { Dialogs, EmptyResponse, ForceParams } from '../../types';\nimport { ProxyMethod, ProxyType } from '../../types/enums';\nimport ProxyService from '../../Proxy';\nimport Utils from '../../Utils';\nimport config from '../../config';\n\nexport default class DialogsService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Dialog`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Dialogs.ListParams = {}): Promise<Dialogs.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Dialogs.CreateParams): Promise<Dialogs.Dialog> {\n    const data = Utils.cloneObject(params);\n\n    if (Utils.isArray(data?.occupants_ids)) {\n      data.occupants_ids = data.occupants_ids.join(', ');\n    }\n\n    if (Utils.isArray(data?.admins_ids)) {\n      data.admins_ids = data.admins_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Dialogs.UpdateParams = {}): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    idOrIds: string | string[],\n    params: ForceParams = {}\n  ): Promise<Dialogs.DeleteResponse | EmptyResponse> {\n    const idsToDelete = typeof idOrIds === 'string' ? idOrIds.split(',').map((id) => id.trim()) : idOrIds;\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, idsToDelete.toString()),\n      dataType: idsToDelete.length === 1 ? ProxyType.TEXT : ProxyType.JSON,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { push_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async removeAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { pull_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async subscribe(id: string): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public subscribeToPublic = this.subscribe;\n\n  public async unsubscribe(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public unsubscribeFromPublic = this.unsubscribe;\n\n  public async updateNotificationsSettings(\n    id: string,\n    enabled: number | boolean\n  ): Promise<Dialogs.UpdateNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n      data: { enabled: enabled ? 1 : 0 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getNotificationsSettings(id: string): Promise<Dialogs.GetNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getPublicOccupants(\n    id: string,\n    params: Dialogs.GetPublicOccupantsParams = {}\n  ): Promise<Dialogs.GetPublicOccupantsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'occupants'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async clearHistory(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, 'clearHistory', id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type { EmptyResponse, ForceParams, Messages } from '../../types';\nimport { ProxyMethod, ProxyType } from '../../types/enums';\nimport ProxyService from '../../Proxy';\nimport Utils from '../../Utils';\nimport config from '../../config';\n\nexport default class MessagesService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Message`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Messages.ListParams = {}): Promise<Messages.ListResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Messages.CreateParams = {}): Promise<Messages.Message> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      type: ProxyMethod.POST,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Messages.UpdateParams = {}): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(ids: string | string[], params?: ForceParams): Promise<Messages.DeleteResponse> {\n    const res = Utils.isArray(ids) ? ids.join(',') : ids;\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, res),\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createSystem(params: Messages.CreateSystemParams): Promise<Messages.CreateSystemResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'system'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async unreadCount(params: Messages.UnreadCountParams = {}): Promise<Messages.UnreadCountResponse> {\n    const data = Utils.cloneObject(params);\n\n    if (data && data.chat_dialog_ids && Utils.isArray(data.chat_dialog_ids)) {\n      data.chat_dialog_ids = data.chat_dialog_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, 'unread'),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async listReactions(id: string = '_'): Promise<Messages.ListReactionsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      dataType: ProxyType.JSON,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, reaction);\n  }\n\n  public async removeReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, undefined, reaction);\n  }\n\n  public async updateReaction(id: string, add?: string, remove?: string): Promise<EmptyResponse> {\n    return this.putReaction(id, { add, remove });\n  }\n\n  private async putReaction(id: string, params: Messages.PutReactionParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type WebRTCClient from './WebRTCClient';\nimport type { Calls } from '../types';\nimport { CallSignalingType } from '../types/enums';\n\nexport default class WebRTCSignalingProcessor {\n  public delegate: WebRTCClient;\n\n  constructor(delegate: WebRTCClient) {\n    this.delegate = delegate;\n  }\n\n  public onMessage = (userID: number, extension: Calls.ExtensionParams): void => {\n    const sessionId = extension?.sessionID ?? '';\n    const signalType = extension?.signalType;\n    /** cleanup */\n    delete extension?.moduleIdentifier;\n    delete extension?.sessionID;\n    delete extension?.signalType;\n\n    switch (signalType) {\n      case CallSignalingType.CALL:\n        this.delegate.onCallHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.ACCEPT:\n        this.delegate.onAcceptHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.REJECT:\n        this.delegate.onRejectHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.STOP:\n        this.delegate.onStopHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.CANDIDATE:\n        this.delegate.onIceCandidatesHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.RESTART:\n        this.delegate.onIceRestartHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.RESTART_ACCEPT:\n        this.delegate.onIceRestartAcceptHandler(userID, sessionId, extension);\n        break;\n    }\n  };\n}\n","import config from '../config';\nimport Utils from '../Utils';\nimport ProxyService from '../Proxy';\nimport DialogsService from './xmpp/Dialogs';\nimport MessagesService from './xmpp/Messages';\nimport WebRTCSignalingProcessor from '../videocalling/WebRTCSignalingProcessor';\nimport type { Chat } from '../types';\nimport { ChatEvent, ProxyMethod } from '../types/enums';\n\nexport default abstract class AbstractChatService {\n  public proxy: ProxyService;\n  public dialog: DialogsService;\n  public message: MessagesService;\n  public webrtcSignalingProcessor!: WebRTCSignalingProcessor;\n\n  public isConnected: boolean = false;\n  protected isConnecting: boolean = false;\n  protected isLogout: boolean = false;\n  protected isReconnect: boolean = false;\n\n  public onChatStatusListener!: Chat.OnChatStatusListener;\n  public onConnectionErrorListener!: Chat.OnChatConnectionErrorListener;\n  public onDisconnectedListener!: Chat.OnChatDisconnectedListener;\n  public onReconnectListener!: Chat.OnChatReconnectedListener;\n  public onMessageListener!: Chat.OnMessageListener;\n  public onSystemMessageListener!: Chat.OnMessageSystemListener;\n  public onMessageTypingListener!: Chat.OnMessageTypingListener;\n  public onMessageUpdateListener!: Chat.OnMessageUpdateListener;\n  public onMessageDeleteListener!: Chat.OnMessageDeleteListener;\n  public onMessageReactionsListener!: Chat.OnMessageReactionsListener;\n  public onReadStatusListener!: Chat.OnMessageReadListener;\n  public onLastUserActivityListener!: Chat.OnLastUserActivityListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.dialog = new DialogsService(proxy);\n    this.message = new MessagesService(proxy);\n  }\n\n  public async search(params: Chat.SearchParams): Promise<Chat.SearchResult> {\n    const query = Object.assign({}, params);\n\n    if (query.start_date) {\n      query.start_date = new Date(query.start_date).toISOString();\n    }\n    if (query.end_date) {\n      query.end_date = new Date(query.end_date).toISOString();\n    }\n    if (Utils.isArray(query.chat_dialog_ids)) {\n      query.chat_dialog_ids = (query.chat_dialog_ids as string[]).join(',');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(`${config.urls.chat}/search`),\n      data: query,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public abstract ping(): Promise<void>\n\n  public async pingWithTimeout(timeout: number = 5000): Promise<unknown> {\n    return new Promise(async (resolve, reject) => {\n      const error = `Failed to ping chat server ${config.chatProtocol.websocket}. Timed out after ${timeout}ms`;\n      const timer = setTimeout(() => {\n        Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n        reject(error);\n      }, timeout);\n\n      try {\n        const result = await this.ping();\n        clearTimeout(timer);\n        resolve(result);\n      } catch {\n        clearTimeout(timer);\n        reject(error);\n      }\n    });\n  }\n\n  protected getListenerByName(name: ChatEvent): Chat.ListenerName | null {\n    switch (name) {\n      case ChatEvent.STATUS:\n        return 'onChatStatusListener';\n      case ChatEvent.ERROR:\n        return 'onConnectionErrorListener';\n      case ChatEvent.DISCONNECTED:\n        return 'onDisconnectedListener';\n      case ChatEvent.RECONNECTED:\n        return 'onReconnectListener';\n      case ChatEvent.MESSAGE:\n        return 'onMessageListener';\n      case ChatEvent.SYSTEM_MESSAGE:\n        return 'onSystemMessageListener';\n      case ChatEvent.ERROR_MESSAGE:\n        return 'onMessageErrorListener';\n      case ChatEvent.TYPING_MESSAGE:\n        return 'onMessageTypingListener';\n      case ChatEvent.UPDATE_MESSAGE:\n        return 'onMessageUpdateListener';\n      case ChatEvent.DELETE_MESSAGE:\n        return 'onMessageDeleteListener';\n      case ChatEvent.REACTIONS_MESSAGE:\n        return 'onMessageReactionsListener';\n      case ChatEvent.DELIVERED_MESSAGE:\n        return 'onDeliveredStatusListener';\n      case ChatEvent.READ_MESSAGE:\n        return 'onReadStatusListener';\n      case ChatEvent.SENT_MESSAGE:\n        return 'onSentMessageCallback';\n      case ChatEvent.USER_LAST_ACTIVITY:\n        return 'onLastUserActivityListener';\n      case ChatEvent.JOIN:\n        return 'onJoinOccupant';\n      case ChatEvent.LEAVE:\n        return 'onLeaveOccupant';\n      case ChatEvent.KICK:\n        return 'onKickOccupant';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ChatEvent, listener: Chat.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Chat.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ChatEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Chat.Listeners | undefined) = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key: string) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Chat.ListenerName] === 'function') {\n        (this[key as Chat.ListenerName] as Chat.Listeners | undefined) = undefined;\n      }\n    });\n  }\n}\n","import type { XMPPClient } from '@xmppClient';\nimport type { Calls, Chat } from '../../types';\nimport type { IChatRealTimeService } from '../../types/chat';\nimport { ChatEvent, CallType, CallSignalingModuleIdentifier } from '../../types/enums';\nimport { xmppClient } from '@xmppClient';\nimport config from '../../config';\nimport Utils from '../../Utils';\nimport ProxyService from '../../Proxy';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\nimport StreamManagement from './StreamManagement';\nimport PrivacyList from './PrivacyList';\nimport MultiUserChat from './MultiUserChat';\nimport AbstractChatService from '../AbstractChatService';\n\nexport default class XMPPChatService extends AbstractChatService implements IChatRealTimeService {\n  public onMessageErrorListener!: Chat.OnMessageErrorListener;\n  public onSentMessageCallback!: Chat.OnMessageSentListener;\n  public onDeliveredStatusListener!: Chat.OnMessageDeliveredListener;\n  public onJoinOccupant: Chat.OnDialogJoinListener;\n  public onLeaveOccupant: Chat.OnDialogLeaveListener;\n  public onKickOccupant: Chat.OnDialogKickListener;\n\n  public xmppClient: XMPPClient;\n  public helpers: ChatHelpers;\n  public privacylist: PrivacyList;\n  public muc: MultiUserChat;\n  public streamManagement: StreamManagement;\n\n  public stanzasCallbacks: Chat.StanzasCallbacks = {};\n  private xmppClientListeners: Chat.XMPPClientListeners = new Map<Chat.XMPPClientEvent, Chat.XMPPClientListener>();\n  private connectPromise: Promise<boolean> | null = null;\n  private earlyIncomingMessagesQueue: Chat.XmlElement[] = [];\n\n  constructor(proxy: ProxyService) {\n    super(proxy);\n    this.helpers = new ChatHelpers();\n\n    this.xmppClient = xmppClient({\n      service: config.chatProtocol.websocket,\n      credentials: (auth, mechanism) =>\n        auth(\n          {\n            username: this.xmppClient?.options?.username,\n            password: this.xmppClient?.options?.password,\n          },\n          mechanism\n        ),\n    });\n\n    if (config.chat.reconnect.enable) {\n      this.xmppClient.reconnect.delay = config.chat.reconnect.timeInterval * 1000;\n    }\n\n    const options = {\n      xmppClient: this.xmppClient,\n      helpers: this.helpers,\n      stanzasCallbacks: this.stanzasCallbacks,\n    };\n\n    this.muc = new MultiUserChat(options);\n    this.privacylist = new PrivacyList(options);\n    this.streamManagement = new StreamManagement(this);\n  }\n\n  public get connectionStatus() {\n    return this.xmppClient.status;\n  }\n\n  public get currentUserId(): Chat.UserId {\n    const userJID = this.xmppClient.jid?.toString() ?? '';\n    const userID = this.helpers.getUserIdFromJID(userJID) ?? 0;\n    return userID;\n  }\n\n  public async connect(params: Chat.ConnectionParams): Promise<boolean> {\n    this.connectPromise = new Promise((resolve, reject) => {\n      Utils.DLog('[Chat]', 'Connect with parameter:', params);\n\n      if (this.isConnecting) {\n        Utils.DLog('[Chat]', 'Warning! Already in CONNECTING state');\n        resolve(false);\n        return;\n      }\n\n      if (this.isConnected) {\n        Utils.DLog('[Chat]', 'Warning! Chat is already connected!');\n        resolve(false);\n        return;\n      }\n\n      this.isConnecting = true;\n      this.isLogout = false;\n\n      this.removeAllXMPPClientListeners();\n\n      this.addXMPPClientListener('connect', () => {\n        Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTING' : 'CONNECTING');\n      });\n\n      this.addXMPPClientListener('online', () => {\n        Utils.DLog('[Chat]', 'ONLINE');\n        this.postConnectActions();\n        resolve(true);\n        this.connectPromise = null;\n      });\n\n      this.addXMPPClientListener('offline', () => {\n        Utils.DLog('[Chat]', 'OFFLINE');\n      });\n\n      this.addXMPPClientListener('disconnect', () => {\n        Utils.DLog('[Chat]', 'DISCONNECTED');\n\n        Utils.safeCallbackCall(this.onDisconnectedListener)();\n\n        if (config.chat.reconnect.enable) {\n          this.isConnected = false;\n          this.isConnecting = false;\n        } else {\n          this.disconnect();\n        }\n      });\n\n      this.addXMPPClientListener('status', (status: Chat.ConnectionStatus, value: any) => {\n        Utils.DLog('[Chat]', `status - ${String(status)}`, typeof value === 'object' ? JSON.stringify(value) : '');\n        Utils.safeCallbackCall(this.onChatStatusListener)(status);\n      });\n\n      this.addXMPPClientListener('stanza', (stanza: Chat.XmlElement) => {\n        // it can be a case,\n        // when message came after xmpp auth but before resource binding,\n        // and it can cause some crashes, e.g.\n        // https://github.com/ConnectyCube/connectycube-js-sdk-releases/issues/28\n        if (stanza.is('message') && !this.isConnected) {\n          this.earlyIncomingMessagesQueue.push(stanza);\n          Utils.DLog('[Chat]', \"on 'stanza': enqueue incoming stanza (isConnected=false)\");\n          return;\n        }\n\n        // after 'input' and 'element' (only if stanza, not nonza)\n        if (stanza.is('presence')) {\n          this.onPresence(stanza);\n        } else if (stanza.is('iq')) {\n          this.onIQ(stanza);\n        } else if (stanza.is('message')) {\n          if (stanza.attrs.type === 'headline') {\n            this.onSystemMessage(stanza);\n          } else if (stanza.attrs.type === 'error') {\n            this.onMessageError(stanza);\n          } else {\n            this.onMessage(stanza);\n          }\n        }\n      });\n\n      this.addXMPPClientListener('error', (error) => {\n        Utils.DLog('[Chat]', 'ERROR:', error, {\n          isReconnect: this.isReconnect,\n          connectPromise: !!this.connectPromise,\n        });\n\n        if (this.connectPromise) {\n          if (!this.isReconnect) {\n            reject(error.name == 'SASLError' ? error.condition : error);\n            this.connectPromise = null;\n          }\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n        }\n      });\n\n      this.addXMPPClientListener('output', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataWrite', { body: str });\n        Utils.DLog('[Chat]', 'SENT:', str);\n      });\n\n      this.addXMPPClientListener('input', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataRead', { body: str });\n        Utils.DLog('[Chat]', 'RECV:', str);\n      });\n\n      // save user connection data so they will be used when authenticate (above)\n      this.xmppClient.options.username = ChatUtils.buildUserJidLocalPart(params.userId);\n      this.xmppClient.options.password = params.password;\n      // start connect\n      this.xmppClient.start().catch((error) => {\n        console.error('[Chat] xmppClient.start error', error);\n        if (this.connectPromise) {\n          reject(error);\n          this.connectPromise = null;\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n        }\n      });\n    });\n\n    return this.connectPromise;\n  }\n\n  public async ping(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('ping');\n      const iqStanza = ChatUtils.createIqStanza({ id, type: 'get', to: config.endpoints.chat });\n\n      iqStanza.c('ping', { xmlns: 'urn:xmpp:ping' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const error = ChatUtils.getElement(stanza, 'error');\n        if (error) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(error));\n        } else {\n          resolve();\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n\n  public send(dialogId: Chat.DialogId | Chat.UserId, message: Chat.MessageParams = {}): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(dialogId),\n      type: message.type ?? this.helpers.typeChat(dialogId),\n      id: messageId,\n    });\n\n    if (!message.id) {\n      message.id = messageId;\n    }\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' });\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    if (this.streamManagement.supported) {\n      this.streamManagement.sendAndCount(messageStanza, message);\n    } else {\n      this.xmppClient.sendOnline(messageStanza);\n    }\n\n    return messageId;\n  }\n\n  public sendSystemMessage(userId: Chat.UserId, message: Chat.SystemMessageParams): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'headline',\n      id: messageId,\n      to: this.helpers.jidOrUserId(userId),\n    });\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('moduleIdentifier').t('SystemNotifications').up();\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    this.xmppClient.sendOnline(messageStanza);\n\n    return messageId;\n  }\n\n  public sendWebRTCSignalingMessage(userId: Chat.UserId, message: Chat.SystemMessageParams): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n\n    let messageStanza = ChatUtils.createMessageStanza({\n      to: this.helpers.jidOrUserId(userId),\n      type: 'headline',\n      id: messageId,\n    }).c('extraParams', { xmlns: 'jabber:client' });\n\n    Object.keys(message.extension).forEach((name) => {\n      const item = message.extension[name];\n\n      if (name === 'iceCandidates') {\n        messageStanza = messageStanza.c('iceCandidates');\n        item.forEach((candidate: RTCIceCandidateInit) => {\n          messageStanza = messageStanza.c('iceCandidate');\n          Object.keys(candidate).forEach((key: string) => {\n            messageStanza = messageStanza.c(key).t(candidate[key]).up();\n          });\n          messageStanza = messageStanza.up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (name === 'opponentsIDs') {\n        messageStanza = messageStanza.c('opponentsIDs');\n        item.forEach((opponentId: string) => {\n          messageStanza = messageStanza.c('opponentID').t(opponentId).up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (typeof item === 'object') {\n        ChatUtils.assignObjectToXml(messageStanza, item, name);\n      } else {\n        messageStanza = messageStanza.c(name).t(item).up();\n      }\n    });\n\n    messageStanza = messageStanza.up();\n\n    this.xmppClient.sendOnline(messageStanza);\n\n    return messageId;\n  }\n\n  public sendIsTypingStatus(dialogId: Chat.DialogId | Chat.UserId): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(dialogId),\n      type: this.helpers.typeChat(dialogId),\n    });\n\n    messageStanza.c('composing', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendIsStopTypingStatus(dialogId: Chat.DialogId): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(dialogId),\n      type: this.helpers.typeChat(dialogId),\n    });\n\n    messageStanza.c('paused', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendDeliveredStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      id: Utils.getBsonObjectId(),\n      to: this.helpers.jidOrUserId(params.userId),\n    });\n\n    messageStanza.c('received', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendReadStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.userId),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('displayed', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public editMessage(params: Chat.EditMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('body').t(params.body).up();\n    messageStanza\n      .c('replace', {\n        xmlns: 'urn:xmpp:message-correct:0',\n        id: params.originMessageId,\n        last: params.last ? 'true' : 'false',\n      })\n      .up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    if (params.extension) {\n      ChatUtils.assignExtraParamsToXml(messageStanza, params.extension);\n    }\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public deleteMessage(params: Chat.DeleteMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('remove', { xmlns: 'urn:xmpp:message-delete:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public getLastUserActivity(userId: Chat.UserId): Promise<Chat.LastActivity> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('lastActivity');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.jidOrUserId(userId),\n        id: id,\n      });\n\n      iqStanza.c('query', { xmlns: 'jabber:iq:last' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (ChatUtils.getElement(stanza, 'error')) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        } else {\n          resolve(this.onLastActivityStanza(stanza));\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n\n  private onLastActivityStanza(stanza: Chat.XmlElement): Chat.LastActivity {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const query = ChatUtils.getElement(stanza, 'query');\n    const seconds = query ? parseInt(ChatUtils.getAttr(query, 'seconds')) : 0;\n\n    Utils.safeCallbackCall(this.onLastUserActivityListener)(userId, seconds);\n\n    return { userId, seconds };\n  }\n\n  public markActive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'false',\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  public markInactive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'true',\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  public async disconnect(): Promise<boolean> {\n    Utils.DLog('[Chat]', 'disconnect');\n\n    if (this.isLogout) {\n      Utils.DLog('[Chat]', 'Warning! Chat is already disconnected!');\n      return true;\n    }\n\n    this.isLogout = true;\n    this.isReconnect = false;\n    this.isConnected = false;\n    this.isConnecting = false;\n    this.muc.joinedRooms = {};\n    this.helpers.userCurrentJid = '';\n    this.streamManagement.stop();\n\n    try {\n      await this.xmppClient.stop();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  public terminate(): void {\n    Utils.DLog('[Chat]', 'terminated');\n\n    this.isConnected = false;\n    this.isConnecting = false;\n    this.streamManagement.stop();\n    this.xmppClient.socket.end();\n  }\n\n  private onMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const invite = ChatUtils.getElement(stanza, 'invite');\n    const resource = this.xmppClient.jid?.getResource() || '';\n    const isChat = type === 'chat';\n\n    // ignore private message from the same resource or invite messages from MUC\n    if ((isChat && from.includes(resource)) || invite) {\n      return;\n    }\n\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const delivered = ChatUtils.getElement(stanza, 'received');\n    const read = ChatUtils.getElement(stanza, 'displayed');\n    const replaceSubElement = ChatUtils.getElement(stanza, 'replace');\n    const reactionsSubElement = ChatUtils.getElement(stanza, 'reactions');\n    const removeSubElement = ChatUtils.getElement(stanza, 'remove');\n    const composing = Boolean(ChatUtils.getElement(stanza, 'composing'));\n    const paused = ChatUtils.getElement(stanza, 'paused');\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const isForwarded = Boolean(forwardedStanza);\n    const isGroup = type === 'groupchat';\n    const recipient = isChat ? ChatUtils.getAttr(stanza, 'to') : null;\n    const recipientId = recipient ? this.helpers.getUserIdFromJID(recipient) : null;\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n    const dialogId = isGroup ? this.helpers.getDialogIdFromJID(from) : (ext?.dialogId ?? null);\n    const userId = isGroup ? this.helpers.getIdFromResource(from) : this.helpers.getUserIdFromJID(from);\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = currentUserJid ? this.helpers.getUserIdFromJID(currentUserJid) : 0;\n\n    // typing statuses\n    if (composing || paused) {\n      if (isChat || isGroup || !delay) {\n        Utils.safeCallbackCall(this.onMessageTypingListener)(composing, userId, dialogId);\n      }\n\n      return;\n    }\n\n    // edit message\n    if (replaceSubElement) {\n      Utils.safeCallbackCall(this.onMessageUpdateListener)(\n        ChatUtils.getAttr(replaceSubElement, 'id'),\n        ChatUtils.getAttr(replaceSubElement, 'last') === 'true',\n        body,\n        dialogId,\n        userId,\n        extension\n      );\n\n      return;\n    }\n\n    // reactions\n    if (reactionsSubElement) {\n      if (isForwarded && isGroup) {\n        return;\n      }\n\n      const messageId = ChatUtils.getAttr(reactionsSubElement, 'message_id');\n      const userId = parseInt(ChatUtils.getAttr(reactionsSubElement, 'user_id'));\n      const { add, remove } = ChatUtils.parseReactions(reactionsSubElement);\n\n      Utils.safeCallbackCall(this.onMessageReactionsListener)(messageId, userId, dialogId, add, remove);\n\n      return;\n    }\n\n    // delete message\n    if (removeSubElement) {\n      const messageId = ChatUtils.getAttr(removeSubElement, 'id');\n\n      Utils.safeCallbackCall(this.onMessageDeleteListener)(messageId, dialogId, userId);\n\n      return;\n    }\n\n    // delivered / read statuses\n    if (delivered || read) {\n      if (delivered && isChat) {\n        const id = ChatUtils.getAttr(delivered, 'id');\n        Utils.safeCallbackCall(this.onDeliveredStatusListener)(id, dialogId, userId);\n      }\n      if (read && isChat) {\n        const id = ChatUtils.getAttr(read, 'id');\n        Utils.safeCallbackCall(this.onReadStatusListener)(id, dialogId, userId);\n      }\n\n      return;\n    }\n\n    // auto-send 'received' status (ignore messages from yourself)\n    if (dialogId && userId && userId !== currentUserId) {\n      this.sendDeliveredStatus({ messageId, dialogId, userId });\n    }\n\n    const message: Chat.Message = {\n      id: messageId,\n      dialog_id: dialogId,\n      recipient_id: recipientId,\n      is_forwarded: isForwarded,\n      type,\n      body,\n      extension,\n      delay,\n    };\n\n    if (isChat || isGroup) {\n      Utils.safeCallbackCall(this.onMessageListener)(userId, message);\n    }\n  }\n\n  private onPresence(stanza: Chat.XmlElement): void {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const id = ChatUtils.getAttr(stanza, 'id');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = this.helpers.getUserIdFromJID(currentUserJid);\n    const x = ChatUtils.getElement(stanza, 'x');\n    const xmlns = x ? ChatUtils.getAttr(x, 'xmlns') : null;\n    const status = x ? ChatUtils.getElement(x, 'xmlns') : null;\n    // const statusCode = status ? ChatUtils.getElement(status, 'code') : null;\n    const statusCode = status ? ChatUtils.getElementText(status, 'code') : null;\n\n    // MUC presences\n    if (xmlns && xmlns.startsWith('http://jabber.org/protocol/muc')) {\n      // Error\n      if (type === 'error') {\n        // JOIN to dialog error\n        if (id.endsWith(':join')) {\n          Utils.safeCallbackCall(this.stanzasCallbacks[id])(stanza);\n        }\n        return;\n      }\n\n      const dialogId = this.helpers.getDialogIdFromJID(from);\n      const mucUserId = this.helpers.getUserIdFromRoomJid(from);\n\n      // self presence\n      if (status) {\n        // KICK from dialog event\n        if (statusCode === '301') {\n          const item = ChatUtils.getElement(stanza, 'item');\n          const actorElement = item ? ChatUtils.getElement(item, 'actor') : null;\n          const initiatorUserJid = actorElement ? ChatUtils.getAttr(actorElement, 'jid') : null;\n          const initiatorId = this.helpers.getUserIdFromJID(initiatorUserJid);\n          const roomJid = this.helpers.getRoomJidFromRoomFullJid(from);\n\n          Utils.safeCallbackCall(this.onKickOccupant)(dialogId, initiatorId);\n\n          if (roomJid) {\n            delete this.muc.joinedRooms[roomJid];\n          }\n\n          return;\n        } else {\n          if (type === 'unavailable') {\n            // LEAVE response\n            if (status && statusCode === '110') {\n              Utils.safeCallbackCall(this.stanzasCallbacks['muc:leave'])(null);\n            }\n            return;\n          }\n          // JOIN response\n          if (id.endsWith(':join') && status && statusCode === '110') {\n            this.stanzasCallbacks[id]?.(stanza);\n            return;\n          }\n        }\n        // Occupants JOIN/LEAVE events\n      } else if (mucUserId != currentUserId) {\n        const listenerName = type === 'unavailable' ? 'onLeaveOccupant' : 'onJoinOccupant';\n\n        Utils.safeCallbackCall(this[listenerName])(dialogId, mucUserId);\n\n        return;\n      }\n    }\n  }\n\n  private onIQ(stanza: Chat.XmlElement): void {\n    const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n    if (this.stanzasCallbacks[stanzaId]) {\n      Utils.safeCallbackCall(this.stanzasCallbacks[stanzaId])(stanza);\n      delete this.stanzasCallbacks[stanzaId];\n    } else {\n      const from = ChatUtils.getAttr(stanza, 'from');\n      const query = ChatUtils.getElement(stanza, 'query');\n      if (from && query) {\n        this.onLastActivityStanza(stanza);\n      }\n    }\n  }\n\n  private onSystemMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const moduleIdentifier = extraParams ? ChatUtils.getElementText(extraParams, 'moduleIdentifier') : null;\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n\n    switch (moduleIdentifier) {\n      case 'SystemNotifications':\n        Utils.safeCallbackCall(this.onSystemMessageListener)({ id: messageId, userId, body, extension });\n        break;\n      case CallSignalingModuleIdentifier:\n        if (!delay) {\n          this.onWebRTCSignalingMessage(userId, extraParams);\n        }\n\n        if (this.webrtcSignalingProcessor && !delay) {\n          Utils.safeCallbackCall(this.webrtcSignalingProcessor.onMessage)(userId, extraParams);\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  private onWebRTCSignalingMessage(userId: Chat.UserId, extensionElem: Chat.XmlElement): void {\n    if (!this.webrtcSignalingProcessor) {\n      return;\n    }\n\n    const extraParams = this.getCallExtension(extensionElem);\n\n    Utils.safeCallbackCall(this.webrtcSignalingProcessor.onMessage)(userId, extraParams);\n  }\n\n  private getCallExtension(extraParams?: Chat.XmlElement): Calls.ExtensionParams {\n    if (!extraParams) {\n      return {};\n    }\n\n    const extension: Calls.ExtensionParams = { iceCandidates: [], opponentsIDs: [] };\n    const elements = ChatUtils.getChildElements(extraParams);\n\n    elements.forEach((element: Chat.XmlElement) => {\n      const items = ChatUtils.getChildElements(element);\n      const key = ChatUtils.getName(element) ?? '';\n\n      switch (key) {\n        case 'callerID':\n          extension[key] = parseInt(ChatUtils.getText(element) || '0');\n          break;\n\n        case 'callType':\n          const type = ChatUtils.getText(element);\n          extension[key] = type === '1' ? CallType.VIDEO : type === '2' ? CallType.AUDIO : undefined;\n          break;\n\n        case 'iceCandidates':\n          items.forEach((item) => {\n            const candidate = {};\n            ChatUtils.getChildElements(item).forEach((child) => {\n              const childName = ChatUtils.getName(child) || '';\n              const childText = ChatUtils.getText(child);\n              candidate[childName] = childName === 'sdpMLineIndex' ? parseInt(childText || '0') : childText;\n            });\n            extension.iceCandidates?.push(candidate);\n          });\n          break;\n\n        case 'opponentsIDs':\n          items.forEach((item) => {\n            extension.opponentsIDs?.push(parseInt(ChatUtils.getText(item) || '0'));\n          });\n          break;\n\n        default:\n          if (items.length > 1) {\n            if ((ChatUtils.getText(element) || '').length > 4096) {\n              extension[key] = items.reduce((acc, item) => acc + ChatUtils.getText(item), '');\n            } else {\n              ChatUtils.assignXmlToObject(element, extension);\n            }\n          } else {\n            if (key === 'userInfo') {\n              ChatUtils.assignXmlToObject(element, extension);\n            } else {\n              extension[key] = ChatUtils.getText(element);\n            }\n          }\n          break;\n      }\n    });\n\n    if (extension.iceCandidates?.length === 0) {\n      delete extension.iceCandidates;\n    }\n\n    if (extension.opponentsIDs?.length === 0) {\n      delete extension.opponentsIDs;\n    }\n\n    return extension;\n  }\n\n  private onMessageError(stanza: Chat.XmlElement): void {\n    // <error code=\"503\" type=\"cancel\">\n    //   <service-unavailable xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"/>\n    //   <text xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\" xml:lang=\"en\">Service not available.</text>\n    // </error>\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const error = ChatUtils.buildErrorFromXMPPErrorStanza(stanza);\n\n    Utils.safeCallbackCall(this.onMessageErrorListener)(messageId, error);\n  }\n\n  private postConnectActions(): void {\n    Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTED' : 'CONNECTED');\n\n    const presence = ChatUtils.createPresenceStanza();\n\n    this.streamManagement.start();\n    this.helpers.userCurrentJid = this.xmppClient.jid?.toString() ?? null;\n    this.isConnected = true;\n    this.isConnecting = false;\n    this.enableCarbons();\n    this.xmppClient.sendOnline(presence); // initial presence\n\n    if (this.isReconnect) {\n      // reconnect\n      Utils.safeCallbackCall(this.onReconnectListener)();\n    } else {\n      this.isReconnect = true;\n    }\n\n    if (this.earlyIncomingMessagesQueue.length > 0) {\n      Utils.DLog('[Chat]', `Flush 'earlyIncomingMessagesQueue' (length=${this.earlyIncomingMessagesQueue.length})`);\n\n      const stanzasCallback = this.xmppClientListeners.get('stanza');\n\n      this.earlyIncomingMessagesQueue.forEach((stanza) => {\n        stanzasCallback?.(stanza);\n      });\n      this.earlyIncomingMessagesQueue = [];\n    }\n  }\n\n  private enableCarbons(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      type: 'set',\n      from: this.helpers.userCurrentJid,\n      id: ChatUtils.getUniqueId('enableCarbons'),\n    });\n\n    iqStanza.c('enable', { xmlns: 'urn:xmpp:carbons:2' });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  private setSubscriptionToUserLastActivity(userId: Chat.UserId, enable: boolean): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('statusStreaming'),\n      type: 'set',\n    });\n\n    iqStanza.c('subscribe', {\n      xmlns: 'https://connectycube.com/protocol/status_streaming',\n      user_jid: this.helpers.jidOrUserId(userId),\n      enable,\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  subscribeToUserLastActivityStatus(userId: Chat.UserId) {\n    this.setSubscriptionToUserLastActivity(userId, true);\n  }\n\n  unsubscribeFromUserLastActivityStatus(userId: Chat.UserId) {\n    this.setSubscriptionToUserLastActivity(userId, false);\n  }\n\n  protected getListenerByName(name: ChatEvent): Chat.ListenerName | null {\n    switch (name) {\n      case ChatEvent.ERROR_MESSAGE:\n        return 'onMessageErrorListener';\n      case ChatEvent.DELIVERED_MESSAGE:\n        return 'onDeliveredStatusListener';\n      case ChatEvent.SENT_MESSAGE:\n        return 'onSentMessageCallback';\n      case ChatEvent.JOIN:\n        return 'onJoinOccupant';\n      case ChatEvent.LEAVE:\n        return 'onLeaveOccupant';\n      case ChatEvent.KICK:\n        return 'onKickOccupant';\n      default:\n        return super.getListenerByName(name);\n    }\n  }\n\n  private addXMPPClientListener(name: Chat.XMPPClientEvent, listener: Chat.XMPPClientListener): void {\n    switch (name) {\n      case 'output':\n        this.xmppClient.middleware.filter(async (context, next) => {\n          listener(context.stanza?.toString());\n          await next();\n        });\n        break;\n\n      case 'input':\n        const _listener = (stanza: Chat.XmlElement) => {\n          listener(stanza.toString());\n        };\n        this.xmppClient.on('element', _listener);\n        this.xmppClientListeners.set(name, _listener);\n        break;\n\n      default:\n        this.xmppClient.on(name, listener);\n        this.xmppClientListeners.set(name, listener);\n        break;\n    }\n  }\n\n  private removeXMPPClientListener(name: Chat.XMPPClientEvent): void {\n    const listener = this.xmppClientListeners.get(name);\n    if (listener) {\n      this.xmppClient.removeListener(name, listener);\n    }\n    this.xmppClientListeners.delete(name);\n  }\n\n  private removeAllXMPPClientListeners(): void {\n    this.xmppClientListeners.forEach((_, name) => this.removeXMPPClientListener(name));\n  }\n}\n","var P = Object.defineProperty;\nvar I = (c, e, t) => e in c ? P(c, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : c[e] = t;\nvar r = (c, e, t) => I(c, typeof e != \"symbol\" ? e + \"\" : e, t);\nimport C from \"ws\";\nfunction D(c) {\n  const e = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (t) => {\n    const n = Math.random() * 16 | 0;\n    return (t === \"x\" ? n : n & 3 | 8).toString(16);\n  });\n  return c !== void 0 ? `${e}:${c}` : e;\n}\nconst U = globalThis.WebSocket ?? C;\nclass M {\n  constructor(e) {\n    r(this, \"socket\");\n    r(this, \"config\");\n    r(this, \"currentUserId\");\n    r(this, \"responsesPromises\", {});\n    r(this, \"deviceId\");\n    r(this, \"onMessageListener\");\n    r(this, \"onMessageStatusListener\");\n    r(this, \"onMessageEditListener\");\n    r(this, \"onMessageDeleteListener\");\n    r(this, \"onMessageReactionsListener\");\n    r(this, \"onUserActivityListener\");\n    r(this, \"onUserTypingListener\");\n    r(this, \"onConversationCreateListener\");\n    r(this, \"onConversationUpdateListener\");\n    r(this, \"onConversationDeleteListener\");\n    r(this, \"onConnectEvent\");\n    r(this, \"onMessageEvent\");\n    r(this, \"onSystemMessageEvent\");\n    r(this, \"onDisconnectEvent\");\n    this.config = e;\n  }\n  async connect() {\n    return new Promise((e, t) => {\n      this.socket = new U(this.config.endpoint.ws), this.socket.onopen = () => {\n        var n;\n        console.log(\"[socket.open]\"), (n = this.onConnectEvent) == null || n.call(this), e();\n      }, this.socket.onmessage = (n) => {\n        var a, g, u, _, p, v, f, k, b, q, R, x, w, S;\n        const s = JSON.parse(n.data);\n        if (console.log(\"[socket.message]\", s), s.typing) {\n          (a = this.onUserTypingListener) == null || a.call(this, s.typing);\n          return;\n        }\n        if (s.system_message || (g = s.message) != null && g.system_message) {\n          const o = s.system_message ?? ((u = s.message) == null ? void 0 : u.system_message), { conversation_created: l, conversation_updated: m, conversation_kicked: d } = (o == null ? void 0 : o.x) ?? {};\n          if (l) {\n            (_ = this.onConversationCreateListener) == null || _.call(this, l);\n            return;\n          }\n          if (m) {\n            (p = this.onConversationUpdateListener) == null || p.call(this, m);\n            return;\n          }\n          if (d) {\n            (v = this.onConversationDeleteListener) == null || v.call(this, d);\n            return;\n          }\n          (f = this.onSystemMessageEvent) == null || f.call(this, o);\n          return;\n        }\n        if (s.last_activity) {\n          (k = this.onUserActivityListener) == null || k.call(this, s.last_activity);\n          return;\n        }\n        if (s.message_read) {\n          (b = this.onMessageStatusListener) == null || b.call(this, s.message_read);\n          return;\n        }\n        if (s.message_edit) {\n          (q = this.onMessageEditListener) == null || q.call(this, s.message_edit);\n          return;\n        }\n        if (s.message_delete) {\n          (R = this.onMessageDeleteListener) == null || R.call(this, s.message_delete);\n          return;\n        }\n        if (s.message_reactions_update) {\n          (x = this.onMessageReactionsListener) == null || x.call(this, s.message_reactions_update);\n          return;\n        }\n        if (s.message) {\n          if (s.message.error) {\n            this.responsesPromises[Object.keys(this.responsesPromises).slice(-1)[0]].reject(s.message.error);\n            return;\n          }\n          (w = this.onMessageListener) == null || w.call(this, s.message), s.message.from.toString() !== this.currentUserId && ((S = this.onMessageEvent) == null || S.call(this, s.message));\n          return;\n        }\n        if (s.ask) {\n          const o = s.ask.mid;\n          this.responsesPromises[o].resolve(s.ask), delete this.responsesPromises[o];\n          return;\n        }\n        const i = s.response;\n        if (i) {\n          const o = i.id;\n          if (!o) {\n            console.error(i.error);\n            return;\n          }\n          const { resolve: l, reject: m, resObjKey: d } = this.responsesPromises[o];\n          if (i.error)\n            i.error.status === 403 ? this.responsesPromises[o].reject(i.error) : m(i.error);\n          else if (Array.isArray(d)) {\n            const L = d.reduce((h, y) => (i[y] !== void 0 && (h[y] = i[y]), h), {});\n            d.every((h) => h in L) ? l(L) : m({ message: \"Server error.\" });\n          } else d ? i[d] ? l(i[d]) : m({ message: \"Server error.\" }) : l(i);\n          delete this.responsesPromises[o];\n        }\n      }, this.socket.onerror = (n) => {\n        console.log(\"[socket.error]\", n), t(n);\n      }, this.socket.onclose = () => {\n        var n;\n        console.log(\"[socket.close]\"), (n = this.onDisconnectEvent) == null || n.call(this), this.config.disableAutoReconnect || this.reconnect();\n      };\n    });\n  }\n  reconnect() {\n    const e = () => {\n      navigator.onLine && document.visibilityState === \"visible\" && (this.connect(), window.removeEventListener(\"online\", e), document.removeEventListener(\"visibilitychange\", e));\n    };\n    navigator.onLine && document.visibilityState === \"visible\" ? this.connect() : (window.addEventListener(\"online\", e), document.addEventListener(\"visibilitychange\", e));\n  }\n  async disconnect() {\n    var e;\n    return (e = this.socket) == null ? void 0 : e.close();\n  }\n  async sendRequest(e, t = {}, n = \"success\") {\n    const s = {\n      request: {\n        [e]: t,\n        id: D(e)\n      }\n    };\n    return this.sendPromise(s, n);\n  }\n  async sendPromise(e, t) {\n    return new Promise((n, s) => {\n      if (!this.socket) {\n        s(\"Socket is not connected.\");\n        return;\n      }\n      this.socket.send(JSON.stringify(e)), console.log(\"[socket.send]\", e), this.responsesPromises[e.request.id] = { resolve: n, reject: s, resObjKey: t };\n    });\n  }\n  async sendHttpPromise(e, t, n) {\n    console.log(\"[http.request]\", { request: n });\n    const s = { \"Content-Type\": \"application/json\" }, i = localStorage.getItem(\"sessionId\");\n    i && (s.Authorization = `Bearer ${i}`);\n    const a = {\n      method: e,\n      credentials: \"include\",\n      headers: s\n    };\n    n && (a.body = JSON.stringify(n));\n    const g = await fetch(`${this.config.endpoint.http}/${t}`, a), u = await g.text();\n    if (!g.ok)\n      throw console.error(\"[http.error]\", u), u || g.statusText;\n    const _ = u ? JSON.parse(u) : {};\n    return console.log(\"[http.response]\", { response: _ }), _;\n  }\n  async connectSocket(e) {\n    return this.sendRequest(\"connect\", { token: e.token, device_id: e.deviceId ?? this.deviceId });\n  }\n  async socketLogin(e) {\n    return this.sendRequest(\"user_login\", { organization_id: this.config.organization_id, ...e.user, device_id: e.deviceId ?? this.deviceId, token: e.token }, \"user\");\n  }\n  async disconnectSocket() {\n    return this.sendRequest(\"user_logout\");\n  }\n  async userCreate(e) {\n    return this.sendRequest(\"user_create\", { organization_id: this.config.organization_id, login: e.login, email: e.email, password: e.password }, \"user\");\n  }\n  async userEdit(e) {\n    return this.sendRequest(\"user_edit\", e, \"user\");\n  }\n  async userLogin(e) {\n    const { login: t, password: n } = e || {}, s = Date.now();\n    parseInt(localStorage.getItem(\"sessionExpiredAt\") || `${s}`, 10) - s <= 0 && localStorage.removeItem(\"sessionId\");\n    const a = { organization_id: this.config.organization_id, device_id: this.deviceId };\n    return t && n && (a.login = t, a.password = n), await this.sendHttpPromise(\"POST\", \"login\", a);\n  }\n  async userLogout() {\n    return await this.sendHttpPromise(\"POST\", \"logout\", null);\n  }\n  async userSendOTPToken(e) {\n    const t = { organization_id: this.config.organization_id, device_id: this.deviceId, email: e.email };\n    return this.sendRequest(\"user_send_otp\", t);\n  }\n  async userResetPassword(e) {\n    const t = { organization_id: this.config.organization_id, device_id: this.deviceId, email: e.email, token: e.token, new_password: e.new_password };\n    return this.sendRequest(\"user_reset_password\", t);\n  }\n  async userDelete() {\n    return localStorage.removeItem(\"sessionId\"), this.sendRequest(\"user_delete\");\n  }\n  async userSearch(e) {\n    const t = {\n      keyword: e.keyword,\n      ignore_ids: e.ignore_ids || [],\n      ...e.limit && { limit: e.limit },\n      ...e.updated_at && { updated_at: e.updated_at }\n    };\n    return this.sendRequest(\"user_search\", t, \"users\");\n  }\n  async getUsersByIds(e) {\n    return this.sendRequest(\"get_users_by_ids\", { ids: e.ids }, \"users\");\n  }\n  async getParticipantsByCids(e) {\n    return this.sendRequest(\"get_participants_by_cids\", { cids: e.cids }, [\"users\", \"conversations\"]);\n  }\n  async createUploadUrlForFiles(e) {\n    return this.sendRequest(\"create_files\", e.files, \"files\");\n  }\n  async getDownloadUrlForFiles(e) {\n    return this.sendRequest(\"get_file_urls\", { file_ids: e.file_ids }, \"file_urls\");\n  }\n  async messageCreate(e) {\n    return new Promise((t, n) => {\n      var i;\n      const s = {\n        message: {\n          id: e.mid,\n          body: e.body,\n          cid: e.cid,\n          x: e.x,\n          attachments: e.attachments,\n          replied_message_id: e.replied_message_id,\n          forwarded_message_id: e.forwarded_message_id\n        }\n      };\n      this.responsesPromises[s.message.id] = { resolve: t, reject: n }, (i = this.socket) == null || i.send(JSON.stringify(s)), console.log(\"[socket.send]\", s);\n    });\n  }\n  async messageSystem(e) {\n    return new Promise((t, n) => {\n      var i;\n      const s = {\n        system_message: {\n          id: e.mid,\n          uids: e.uids,\n          cid: e.cid,\n          x: e.x\n        }\n      };\n      this.responsesPromises[s.system_message.id] = { resolve: t, reject: n }, (i = this.socket) == null || i.send(JSON.stringify(s)), console.log(\"[socket.send]\", s);\n    });\n  }\n  async messageList(e) {\n    const t = {\n      cid: e.cid,\n      ...e.ids && { ids: e.ids },\n      ...e.limit && { limit: e.limit },\n      ...e.updated_at && { updated_at: e.updated_at }\n    };\n    return this.sendRequest(\"message_list\", t, \"messages\");\n  }\n  async messageSummary(e) {\n    return this.sendRequest(\"message_summary\", { cid: e.cid, filter: e.filter }, \"message\");\n  }\n  async messageTone(e) {\n    return this.sendRequest(\"message_tone\", { body: e.body, tone: e.tone }, \"message\");\n  }\n  async markConversationAsRead(e) {\n    return this.sendRequest(\"message_read\", { cid: e.cid, ids: e.mids });\n  }\n  async messageEdit(e) {\n    return this.sendRequest(\"message_edit\", { id: e.mid, body: e.body });\n  }\n  async messageDelete(e) {\n    return this.sendRequest(\"message_delete\", { cid: e.cid, ids: e.mids, type: e.type ?? \"myself\" });\n  }\n  async getUserActivity(e) {\n    return this.sendRequest(\"user_last_activity\", { ids: e }, \"last_activity\");\n  }\n  async subscribeToUserActivity(e) {\n    return this.sendRequest(\"user_last_activity_subscribe\", { id: e }, \"last_activity\");\n  }\n  async unsubscribeFromUserActivity() {\n    return this.sendRequest(\"user_last_activity_unsubscribe\");\n  }\n  async sendTypingStatus(e) {\n    return new Promise((t, n) => {\n      var i;\n      const s = { typing: { cid: e.cid, status: e.status } };\n      (i = this.socket) == null || i.send(JSON.stringify(s)), console.log(\"[socket.send]\", s), t();\n    });\n  }\n  async conversationCreate(e) {\n    return this.sendRequest(\"conversation_create\", e, \"conversation\");\n  }\n  async conversationUpdate(e) {\n    var t, n;\n    return this.sendRequest(\"conversation_update\", {\n      id: e.cid,\n      name: e.name,\n      description: e.description,\n      participants: {\n        add: (t = e.participants) == null ? void 0 : t.add,\n        remove: (n = e.participants) == null ? void 0 : n.remove\n      },\n      image_object: e.image_object\n    }, \"conversation\");\n  }\n  async conversationList(e) {\n    const t = {\n      ...e.limit && { limit: e.limit },\n      ...e.updated_at && { updated_at: { gt: e.updated_at.gt, lt: e.updated_at.lt } }\n    };\n    return this.sendRequest(\"conversation_list\", t, \"conversations\");\n  }\n  async conversationDelete(e) {\n    return this.sendRequest(\"conversation_delete\", { id: e.cid });\n  }\n  async conversationSearch(e) {\n    return this.sendRequest(\"conversation_search\", { name: e.name }, \"conversations\");\n  }\n  async conversationHandlerCreate(e) {\n    return this.sendRequest(\"conversation_handler_create\", { cid: e.cid, content: e.content });\n  }\n  async getConversationHandler(e) {\n    return this.sendRequest(\"get_conversation_handler\", { cid: e.cid }, \"conversation_handler\");\n  }\n  async conversationHandlerDelete(e) {\n    return this.sendRequest(\"conversation_handler_delete\", { cid: e.cid });\n  }\n  async pushSubscriptionCreate(e) {\n    return this.sendRequest(\"push_subscription_create\", {\n      platform: \"web\",\n      web_endpoint: e.web_endpoint,\n      web_key_auth: e.web_key_auth,\n      web_key_p256dh: e.web_key_p256dh,\n      device_udid: this.deviceId\n    }, \"subscription\");\n  }\n  async pushSubscriptionDelete() {\n    return this.sendRequest(\"push_subscription_delete\", { device_udid: this.deviceId });\n  }\n  async ping() {\n    return this.sendRequest(\"ping\", {}, \"pong\");\n  }\n  async setActivityStatus(e) {\n    return this.sendRequest(\"activity_status\", { isInactive: !!e }, \"success\");\n  }\n  async blockList() {\n    return this.sendRequest(\"list_blocked_users\", {}, \"users\");\n  }\n  async blockUsers(e) {\n    return this.sendRequest(\"block_user\", { ids: e }, \"success\");\n  }\n  async unblockUsers(e) {\n    return this.sendRequest(\"unblock_user\", { ids: e }, \"success\");\n  }\n  async reactionsUpdate(e, t, n) {\n    return this.sendRequest(\"message_reactions_update\", { mid: e, add: t, remove: n }, \"success\");\n  }\n  async reactionsList(e) {\n    return this.sendRequest(\"message_reactions_list\", { mid: e }, \"reactions\");\n  }\n}\nexport {\n  M as SAMAClient\n};\n//# sourceMappingURL=@sama-communications.sdk.mjs.map\n","import { SAMAClient } from '@sama-communications/sdk';\nimport type { Chat } from '../../types';\n\nexport default class BlockList {\n  private samaClient: SAMAClient;\n\n  constructor(samaClient: SAMAClient) {\n    this.samaClient = samaClient;\n  }\n\n  public async block(userId: Chat.UserId): Promise<void>;\n  public async block(userIds: Chat.UserId[]): Promise<void>;\n  public async block(userIds: Chat.UserId | Chat.UserId[]): Promise<void> {\n    if (!Array.isArray(userIds)) {\n      userIds = [userIds];\n    }\n\n    await this.samaClient.blockUsers(userIds);\n  }\n\n  public async unblock(userId: Chat.UserId): Promise<void>;\n  public async unblock(userIds: Chat.UserId[]): Promise<void>;\n  public async unblock(userIds: Chat.UserId | Chat.UserId[]): Promise<void> {\n    if (!Array.isArray(userIds)) {\n      userIds = [userIds];\n    }\n\n    await this.samaClient.unblockUsers(userIds);\n  }\n\n  public async list(): Promise<Chat.UserId[]> {\n    const usersIds = await this.samaClient.blockList();\n    return usersIds;\n  }\n}\n","import config from '../../config';\nimport Utils from '../../Utils';\nimport { SAMAClient } from '@sama-communications/sdk';\nimport ProxyService from '../../Proxy';\nimport AbstractChatService from '../AbstractChatService';\nimport BlockList from './BlockList';\nimport type { ConnectyCubeChat as Chat, IChatRealTimeService } from '../../types/chat';\nimport { CallSignalingModuleIdentifier, CallType } from '../../types/enums';\n\nexport default class SAMAChatService extends AbstractChatService implements IChatRealTimeService {\n  public samaClient: SAMAClient;\n  public blockList: BlockList;\n  public currentUserNativeId: Chat.UserId;\n\n  constructor(proxy: ProxyService) {\n    super(proxy);\n\n    this.samaClient = new SAMAClient({\n      endpoint: {\n        ws: config.chatProtocol.websocket,\n        http: `https://${config.endpoints.api}`,\n      },\n      organization_id: `${config.creds.appId}`,\n      disableAutoReconnect: true,\n    });\n\n    this.blockList = new BlockList(this.samaClient);\n  }\n\n  public get connectionStatus(): string {\n    return '';\n  }\n\n  public get currentUserId(): Chat.UserId {\n    return this.currentUserNativeId;\n  }\n\n  public async connect(params: Chat.ConnectionParams): Promise<boolean> {\n    Utils.DLog('[Chat]', 'Connect with parameter:', params);\n\n    this.samaClient.deviceId = params.deviceId ?? Utils.getBsonObjectId();\n\n    this.removeAllSamaListeners();\n    this.addAllSamaListeners();\n\n    if (!this.isConnected) {\n      await this.samaClient.connect();\n\n      this.isConnected = true;\n    }\n\n    const authorizedUser = await this.samaClient.socketLogin({\n      user: { userId: params.userId, password: params.password },\n    });\n    this.currentUserNativeId = authorizedUser['native_id'];\n\n    this.isLogout = false;\n\n    return true;\n  }\n\n  public async disconnect(): Promise<boolean> {\n    Utils.DLog('[Chat]', 'disconnect');\n\n    this.isConnected = false;\n\n    try {\n      await this.samaClient.disconnectSocket();\n      await this.samaClient.disconnect();\n      this.currentUserNativeId = void 0;\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  public terminate(): void {\n    Utils.DLog('[Chat]', 'terminated');\n\n    this.isConnected = false;\n    this.currentUserNativeId = void 0;\n\n    this.samaClient.disconnect();\n  }\n\n  private onSamaConnectedListener(): void {\n    Utils.DLog('[Chat]', this.samaClient.deviceId, '[connected]');\n\n    this.isConnected = true;\n\n    Utils.safeCallbackCall(this.onChatStatusListener)('connect');\n  }\n\n  private onSamaDisconnectListener(): void {\n    Utils.DLog('[Chat]', this.samaClient.deviceId, '[disconnect]');\n\n    this.isConnected = false;\n    this.isLogout = true;\n\n    Utils.safeCallbackCall(this.onChatStatusListener)('disconnect');\n    Utils.safeCallbackCall(this.onDisconnectedListener)();\n  }\n\n  private onSamaMessageEventListener(message: any): void {\n    Utils.DLog('[Chat]', '[packet]', this.samaClient.deviceId, message);\n  }\n\n  private onSamaMessageListener(message: any): void {\n    Utils.DLog('[Chat]', '[onMessage]', this.samaClient.deviceId, message);\n\n    const { _id, cid, c_type, from, body, t, x, attachments, created_at } = message;\n\n    const messageParams: Chat.Message = {\n      id: _id,\n      dialog_id: cid,\n      body: body,\n      extension: Object.assign({ date_sent: t, attachments }, x),\n    };\n\n    Utils.safeCallbackCall(this.onMessageListener)(from, messageParams);\n  }\n\n  private onSamaSystemMessageListener(message: any): void {\n    Utils.DLog('[Chat]', '[onSystem]', this.samaClient.deviceId, message);\n\n    const { _id, from, t, x } = message;\n\n    const systemMessage: Chat.SystemMessage = {\n      id: _id,\n      body: null,\n      userId: from,\n      extension: Object.assign({ date_sent: t }, x),\n    };\n\n    if (systemMessage.extension['moduleIdentifier'] === CallSignalingModuleIdentifier) {\n      return this.onWebRTCSignalingSystemMessage(systemMessage);\n    }\n\n    Utils.safeCallbackCall(this.onSystemMessageListener)(systemMessage);\n  }\n\n  private onWebRTCSignalingSystemMessage(systemMessage: Chat.SystemMessage): void {\n    const extension = systemMessage.extension;\n\n    Object.keys(extension).forEach((key) => {\n      switch (key) {\n        case 'callerID':\n          extension[key] = parseInt(extension[key] || '0');\n          break;\n\n        case 'callType':\n          const type = extension[key];\n          extension[key] = type === '1' ? CallType.VIDEO : type === '2' ? CallType.AUDIO : undefined;\n          break;\n\n        case 'opponentsIDs':\n          extension[key].map((opponentID) => +opponentID);\n          break;\n\n        case 'iceCandidates':\n          extension[key].forEach((iceCandidate) => {\n            Object.keys(iceCandidate).forEach((iceObjectKey) => {\n              if (iceObjectKey === 'sdpMLineIndex') {\n                iceCandidate[iceObjectKey] = parseInt(iceCandidate[iceObjectKey] || '0');\n              }\n            });\n          });\n          break;\n\n        default:\n          break;\n      }\n    });\n\n    return Utils.safeCallbackCall(this.webrtcSignalingProcessor.onMessage)(\n      systemMessage.userId,\n      systemMessage.extension\n    );\n  }\n\n  private onSamaMessageStatusListener(message: any): void {\n    Utils.DLog('[Chat]', '[onStatus]', this.samaClient.deviceId, message);\n\n    const { ids, cid, from } = message;\n\n    for (const messageId of ids) {\n      Utils.safeCallbackCall(this.onReadStatusListener)(messageId, cid, from);\n    }\n  }\n\n  private onSamaUserLastActivityListener(message: any): void {\n    Utils.DLog('[Chat]', '[onLastActivity]', this.samaClient.deviceId, message);\n\n    Object.entries(message).forEach(([userId, lastActivityTs]) => {\n      Utils.safeCallbackCall(this.onLastUserActivityListener)(+userId, +lastActivityTs);\n    });\n  }\n\n  private onSamaTypingListener(message: any): void {\n    Utils.DLog('[Chat]', '[onTyping]', this.samaClient.deviceId, message);\n\n    const { cid, from, status } = message;\n    const isTyping = status === 'start';\n\n    Utils.safeCallbackCall(this.onMessageTypingListener)(isTyping, from, cid);\n  }\n\n  private onSamaMessageEditListener(message: any): void {\n    Utils.DLog('[Chat]', '[onEdit]', this.samaClient.deviceId, message);\n\n    const { id, cid, from, body } = message;\n\n    const messageEditParams = {\n      messageId: id,\n      isLast: false,\n      updatedBody: body,\n      dialogId: cid,\n      userId: from,\n      extraParams: {},\n    };\n\n    Utils.safeCallbackCall(this.onMessageUpdateListener)(\n      messageEditParams.messageId,\n      messageEditParams.isLast,\n      messageEditParams.updatedBody,\n      messageEditParams.dialogId,\n      messageEditParams.userId,\n      messageEditParams.extraParams\n    );\n  }\n\n  private onSamaDeleteListener(message: any): void {\n    Utils.DLog('[Chat]', '[onDelete]', this.samaClient.deviceId, message);\n\n    const { ids, cid, from } = message;\n\n    for (const messageId of ids) {\n      Utils.safeCallbackCall(this.onMessageDeleteListener)(messageId, cid, from);\n    }\n  }\n\n  private onSamaMessageReactionListener(messageReaction: any): void {\n    Utils.DLog('[Chat]', '[onReaction]', this.samaClient.deviceId, messageReaction);\n\n    const { mid, cid, from, add, remove } = messageReaction;\n\n    Utils.safeCallbackCall(this.onMessageReactionsListener)(mid, from, cid, add, remove);\n  }\n\n  public async ping(): Promise<void> {\n    const pong = await this.samaClient.ping();\n  }\n\n  public async sendIsTypingStatus(dialogId: Chat.DialogId): Promise<void> {\n    const requestParams = {\n      cid: dialogId,\n      status: 'start',\n    };\n\n    await this.samaClient.sendTypingStatus(requestParams);\n  }\n\n  public async sendIsStopTypingStatus(dialogId: Chat.DialogId): Promise<void> {\n    const requestParams = {\n      cid: dialogId,\n      status: 'stop',\n    };\n\n    await this.samaClient.sendTypingStatus(requestParams);\n  }\n\n  public async send(dialogId: Chat.DialogId, message: Chat.MessageParams): Promise<string> {\n    const mid = message.id ?? Utils.getBsonObjectId();\n    const x = message.extension ?? {};\n    const attachments = x?.['attachments'];\n    delete x?.['attachments'];\n\n    const requestParams = {\n      mid,\n      body: message.body,\n      x,\n      attachments,\n      cid: dialogId,\n    };\n\n    const ack = await this.samaClient.messageCreate(requestParams);\n\n    return ack?.server_mid ?? mid;\n  }\n\n  public sendSystemMessage(userId: Chat.UserId, message: Chat.SystemMessageParams): Promise<string>;\n  public sendSystemMessage(userIds: Array<Chat.UserId>, message: Chat.SystemMessageParams): Promise<string>;\n  public sendSystemMessage(dialogId: Chat.DialogId, message: Chat.SystemMessageParams): Promise<string>;\n  public async sendSystemMessage(\n    userIdsOrDialogId: Chat.UserId | Array<Chat.UserId> | Chat.DialogId,\n    message: Chat.SystemMessageParams\n  ): Promise<string> {\n    const mid = message.id ?? Utils.getBsonObjectId();\n\n    const destinationParams = Array.isArray(userIdsOrDialogId)\n      ? { uids: userIdsOrDialogId }\n      : typeof userIdsOrDialogId === 'number'\n        ? { uids: [userIdsOrDialogId] }\n        : { cid: userIdsOrDialogId };\n\n    const requestParams = {\n      mid,\n      x: message.extension ?? {},\n      ...destinationParams,\n    };\n\n    this.samaClient.messageSystem(requestParams);\n\n    return mid;\n  }\n\n  public async sendWebRTCSignalingMessage(userId: number, message: Chat.SystemMessageParams): Promise<string> {\n    return await this.sendSystemMessage(userId, message);\n  }\n\n  public async sendDeliveredStatus(params: Chat.MessageStatusParams): Promise<void> {}\n\n  public async sendReadStatus(params: Chat.MessageStatusParams): Promise<void> {\n    const requestParams = {\n      cid: params.dialogId,\n      mids: [params.messageId],\n    };\n\n    await this.samaClient.markConversationAsRead(requestParams);\n  }\n\n  public async markDialogAsRead(params: Chat.DialogReadParams): Promise<void> {\n    const requestParams = {\n      cid: params.dialogId,\n    };\n\n    await this.samaClient.markConversationAsRead(requestParams);\n  }\n\n  public async updateReaction(messageId: string, addReaction: string, removeReaction: string): Promise<void> {\n    await this.samaClient.reactionsUpdate(messageId, addReaction, removeReaction);\n  }\n\n  public async editMessage(params: Chat.EditMessageParams): Promise<void> {\n    const requestParams = {\n      mid: params.originMessageId,\n      body: params.body,\n    };\n\n    await this.samaClient.messageEdit(requestParams);\n  }\n\n  public async deleteMessage(params: Chat.DeleteMessageParams): Promise<void> {\n    const requestParams = {\n      cid: params.dialogId,\n      mids: [params.messageId],\n      type: 'all',\n    };\n\n    await this.samaClient.messageDelete(requestParams);\n  }\n\n  public async getLastUserActivity(userId: Chat.UserId): Promise<Chat.LastActivity> {\n    const result = await this.samaClient.getUserActivity([userId]);\n\n    if (!(userId in result)) {\n      throw new Error('User not found');\n    }\n\n    const activityDate = result[userId];\n\n    if (activityDate === 0) {\n      return { userId, seconds: activityDate };\n    }\n\n    return { userId, seconds: !activityDate ? activityDate : Math.ceil(+new Date() / 1000) - activityDate };\n  }\n\n  public async subscribeToUserLastActivityStatus(userId: Chat.UserId): Promise<void> {\n    return await this.samaClient.subscribeToUserActivity(userId);\n  }\n\n  public async unsubscribeFromUserLastActivityStatus(userId: Chat.UserId): Promise<void> {\n    return await this.samaClient.unsubscribeFromUserActivity();\n  }\n\n  public async markActive(): Promise<void> {\n    return await this.samaClient.setActivityStatus(false);\n  }\n\n  public async markInactive(): Promise<void> {\n    return await this.samaClient.setActivityStatus(true);\n  }\n\n  private addAllSamaListeners() {\n    this.samaClient.onConnectEvent = this.onSamaConnectedListener.bind(this);\n    this.samaClient.onDisconnectEvent = this.onSamaDisconnectListener.bind(this);\n\n    this.samaClient.onMessageListener = this.onSamaMessageEventListener.bind(this);\n    this.samaClient.onMessageEvent = this.onSamaMessageListener.bind(this);\n    this.samaClient.onSystemMessageEvent = this.onSamaSystemMessageListener.bind(this);\n\n    this.samaClient.onMessageStatusListener = this.onSamaMessageStatusListener.bind(this);\n    this.samaClient.onMessageReactionsListener = this.onSamaMessageReactionListener.bind(this);\n\n    this.samaClient.onMessageEditListener = this.onSamaMessageEditListener.bind(this);\n    this.samaClient.onMessageDeleteListener = this.onSamaDeleteListener.bind(this);\n\n    this.samaClient.onUserActivityListener = this.onSamaUserLastActivityListener.bind(this);\n    this.samaClient.onUserTypingListener = this.onSamaTypingListener.bind(this);\n  }\n\n  private removeAllSamaListeners() {\n    this.samaClient.onConnectEvent = void 0;\n    this.samaClient.onDisconnectEvent = void 0;\n\n    this.samaClient.onMessageListener = void 0;\n    this.samaClient.onMessageEvent = void 0;\n    this.samaClient.onSystemMessageEvent = void 0;\n\n    this.samaClient.onMessageStatusListener = void 0;\n    this.samaClient.onMessageReactionsListener = void 0;\n\n    this.samaClient.onMessageEditListener = void 0;\n    this.samaClient.onMessageDeleteListener = void 0;\n\n    this.samaClient.onUserActivityListener = void 0;\n    this.samaClient.onUserTypingListener = void 0;\n  }\n}\n","const {\n  adapter,\n  navigator,\n  MediaStream,\n  MediaStreamTrack,\n  RTCPeerConnection,\n  RTCRtpReceiver,\n  RTCRtpSender,\n  isReactNative\n} = require('@platform');\n\n('use strict');\n/*\n  The MIT License (MIT)\n\n  Copyright (c) 2016 Meetecho\n\n  Permission is hereby granted, free of charge, to any person obtaining\n  a copy of this software and associated documentation files (the \"Software\"),\n  to deal in the Software without restriction, including without limitation\n  the rights to use, copy, modify, merge, publish, distribute, sublicense,\n  and/or sell copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included\n  in all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n  ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n */\n\n// List of sessions\nJanus.sessions = {};\n\nJanus.mobile = isReactNative;\n\nJanus.isExtensionEnabled = function () {\n  if (Janus.mobile) {\n    return false;\n  }\n  if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n    // No need for the extension, getDisplayMedia is supported\n    return true;\n  }\n  if (window.navigator.userAgent.match('Chrome')) {\n    let chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n    let maxver = 33;\n    if (window.navigator.userAgent.match('Linux')) maxver = 35; // \"known\" crash in chrome 34 and 35 on linux\n    if (chromever >= 26 && chromever <= maxver) {\n      // Older versions of Chrome don't support this extension-based approach, so lie\n      return true;\n    }\n    return Janus.extension.isInstalled();\n  } else {\n    // Firefox and others, no need for the extension (but this doesn't mean it will work)\n    return true;\n  }\n};\n\nconst defaultExtension = {\n  // Screensharing Chrome Extension ID\n  extensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n  isInstalled: function () {\n    if (Janus.mobile) {\n      return false;\n    } else {\n      return document.querySelector('#janus-extension-installed') !== null;\n    }\n  },\n  getScreen: function (callback) {\n    if (Janus.mobile) {\n      callback();\n    } else {\n      let pending = window.setTimeout(function () {\n        let error = new Error('NavigatorUserMediaError');\n        error.name =\n          'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n        return callback(error);\n      }, 1000);\n      this.cache[pending] = callback;\n      window.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n    }\n  },\n  init: function () {\n    let cache = {};\n    this.cache = cache;\n    // Wait for events from the Chrome Extension\n    if (!Janus.mobile) {\n      window.addEventListener('message', function (event) {\n        if (event.origin != window.location.origin) return;\n        if (event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n          let callback = cache[event.data.id];\n          delete cache[event.data.id];\n          if (event.data.sourceId === '') {\n            // user canceled\n            let error = new Error('NavigatorUserMediaError');\n            error.name = 'You cancelled the request for permission, giving up...';\n            callback(error);\n          } else {\n            callback(null, event.data.sourceId);\n          }\n        } else if (event.data.type == 'janusGetScreenPending') {\n          window.clearTimeout(event.data.id);\n        }\n      });\n    }\n  },\n};\n\nJanus.useDefaultDependencies = function (deps) {\n  let f = (deps && deps.fetch) || fetch;\n  let p = (deps && deps.Promise) || Promise;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    isArray: function (arr) {\n      return Array.isArray(arr);\n    },\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let fetchOptions = {\n        method: options.verb,\n        headers: {\n          Accept: 'application/json, text/plain, */*',\n        },\n        cache: 'no-cache',\n      };\n      if (options.verb === 'POST') {\n        fetchOptions.headers['Content-Type'] = 'application/json';\n      }\n      if (typeof options.withCredentials !== 'undefined') {\n        fetchOptions.credentials =\n          options.withCredentials === true ? 'include' : options.withCredentials ? options.withCredentials : 'omit';\n      }\n      if (options.body) {\n        fetchOptions.body = JSON.stringify(options.body);\n      }\n\n      let fetching = f(url, fetchOptions).catch(function (error) {\n        return p.reject({\n          message: 'Probably a network error, is the server down?',\n          error: error,\n        });\n      });\n\n      /*\n       * fetch() does not natively support timeouts.\n       * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n       */\n\n      if (options.timeout) {\n        let timeout = new p(function (resolve, reject) {\n          let timerId = setTimeout(function () {\n            clearTimeout(timerId);\n            return reject({\n              message: 'Request timed out',\n              timeout: options.timeout,\n            });\n          }, options.timeout);\n        });\n        fetching = p.race([fetching, timeout]);\n      }\n\n      fetching\n        .then(function (response) {\n          if (response.ok) {\n            if (typeof options.success === typeof Janus.noop) {\n              return response.json().then(\n                function (parsed) {\n                  try {\n                    options.success(parsed);\n                  } catch (error) {\n                    Janus.error('Unhandled httpAPICall success callback error', error);\n                  }\n                },\n                function (error) {\n                  return p.reject({\n                    message: 'Failed to parse response body',\n                    error: error,\n                    response: response,\n                  });\n                }\n              );\n            }\n          } else {\n            return p.reject({ message: 'API call failed', response: response });\n          }\n        })\n        .catch(function (error) {\n          if (typeof options.error === typeof Janus.noop) {\n            options.error(error.message || '<< internal error >>', error);\n          }\n        });\n\n      return fetching;\n    },\n  };\n};\n\nJanus.useOldDependencies = function (deps) {\n  let jq = (deps && deps.jQuery) || jQuery;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    isArray: function (arr) {\n      return jq.isArray(arr);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let payload =\n        typeof options.body !== 'undefined'\n          ? {\n            contentType: 'application/json',\n            data: JSON.stringify(options.body),\n          }\n          : {};\n      let credentials =\n        typeof options.withCredentials !== 'undefined'\n          ? { xhrFields: { withCredentials: options.withCredentials } }\n          : {};\n\n      return jq.ajax(\n        jq.extend(payload, credentials, {\n          url: url,\n          type: options.verb,\n          cache: false,\n          dataType: 'json',\n          async: options.async,\n          timeout: options.timeout,\n          success: function (result) {\n            if (typeof options.success === typeof Janus.noop) {\n              options.success(result);\n            }\n          },\n          error: function (xhr, status, err) {\n            if (typeof options.error === typeof Janus.noop) {\n              options.error(status, err);\n            }\n          },\n        })\n      );\n    },\n  };\n};\n\n// Helper function to convert a deprecated media object to a tracks array\nJanus.mediaToTracks = function (media) {\n  let tracks = [];\n  if (!media) {\n    // Default is bidirectional audio and video, using default devices\n    tracks.push({ type: 'audio', capture: true, recv: true });\n    tracks.push({ type: 'video', capture: true, recv: true });\n  } else {\n    if (\n      !media.keepAudio &&\n      media.audio !== false &&\n      (typeof media.audio === 'undefined' ||\n        media.audio ||\n        media.audioSend ||\n        media.audioRecv ||\n        media.addAudio ||\n        media.replaceAudio ||\n        media.removeAudio)\n    ) {\n      // We may need an audio track\n      let track = { type: 'audio' };\n      if (media.removeAudio) {\n        track.remove = true;\n      } else {\n        if (media.addAudio) track.add = true;\n        else if (media.replaceAudio) track.replace = true;\n        // Check if we need to capture an audio device\n        if (media.audioSend !== false) track.capture = media.audio || true;\n        // Check if we need to receive audio\n        if (media.audioRecv !== false) track.recv = true;\n      }\n      // Add an audio track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (\n      !media.keepVideo &&\n      media.video !== false &&\n      (typeof media.video === 'undefined' ||\n        media.video ||\n        media.videoSend ||\n        media.videoRecv ||\n        media.addVideo ||\n        media.replaceVideo ||\n        media.removeVideo)\n    ) {\n      // We may need a video track\n      let track = { type: 'video' };\n      if (media.removeVideo) {\n        track.remove = true;\n      } else {\n        if (media.addVideo) track.add = true;\n        else if (media.replaceVideo) track.replace = true;\n        // Check if we need to capture a video device\n        if (media.videoSend !== false) {\n          track.capture = media.video || true;\n          if (['screen', 'window', 'desktop'].includes(track.capture)) {\n            // Change the type to 'screen'\n            track.type = 'screen';\n            track.capture = { video: {} };\n            // Check if there's constraints\n            if (media.screenshareFrameRate) track.capture.frameRate = media.screenshareFrameRate;\n            if (media.screenshareHeight) track.capture.height = media.screenshareHeight;\n            if (media.screenshareWidth) track.capture.width = media.screenshareWidth;\n          }\n        }\n        // Check if we need to receive video\n        if (media.videoRecv !== false) track.recv = true;\n      }\n      // Add a video track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (media.data) {\n      // We need a data channel\n      tracks.push({ type: 'data' });\n    }\n  }\n  // Done\n  return tracks;\n};\n\n// Helper function to convert a track object to a set of constraints\nJanus.trackConstraints = function (track) {\n  let constraints = {};\n  if (!track || !track.capture) return constraints;\n  if (track.type === 'audio') {\n    // Just put the capture part in the constraints\n    constraints.audio = track.capture;\n  } else if (track.type === 'video') {\n    // Check if one of the keywords was passed\n    if ((track.simulcast || track.svc) && track.capture === true) track.capture = 'hires';\n    if (track.capture === true || typeof track.capture === 'object') {\n      // Use the provided capture object as video constraint\n      constraints.video = track.capture;\n    } else {\n      let width = 0;\n      let height = 0;\n      if (track.capture === 'lowres') {\n        // Small resolution, 4:3\n        width = 320;\n        height = 240;\n      } else if (track.capture === 'lowres-16:9') {\n        // Small resolution, 16:9\n        width = 320;\n        height = 180;\n      } else if (track.capture === 'hires' || track.capture === 'hires-16:9' || track.capture === 'hdres') {\n        // High(HD) resolution is only 16:9\n        width = 1280;\n        height = 720;\n      } else if (track.capture === 'fhdres') {\n        // Full HD resolution is only 16:9\n        width = 1920;\n        height = 1080;\n      } else if (track.capture === '4kres') {\n        // 4K resolution is only 16:9\n        width = 3840;\n        height = 2160;\n      } else if (track.capture === 'stdres') {\n        // Normal resolution, 4:3\n        width = 640;\n        height = 480;\n      } else if (track.capture === 'stdres-16:9') {\n        // Normal resolution, 16:9\n        width = 640;\n        height = 360;\n      } else {\n        Janus.log('Default video setting is stdres 4:3');\n        width = 640;\n        height = 480;\n      }\n      constraints.video = {\n        width: { ideal: width },\n        height: { ideal: height },\n      };\n    }\n  } else if (track.type === 'screen') {\n    // Use the provided capture object as video constraint\n    constraints.video = track.capture;\n  }\n  return constraints;\n};\n\nJanus.noop = function () { };\n\nJanus.dataChanDefaultLabel = 'JanusDataChannel';\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Stop all tracks from a given stream\nJanus.stopAllTracks = function (stream) {\n  try {\n    // Try a MediaStreamTrack.stop() for each track\n    let tracks = stream.getTracks();\n    for (let mst of tracks) {\n      Janus.log(mst);\n      if (mst && mst.dontStop !== true) {\n        mst.stop();\n      }\n    }\n  } catch (e) {\n    // Do nothing if this fails\n  }\n};\n\n// Initialization\nJanus.init = function (options) {\n  options = options || {};\n  options.callback = typeof options.callback == 'function' ? options.callback : Janus.noop;\n  if (Janus.initDone) {\n    // Already initialized\n    options.callback();\n  } else {\n    if (typeof console.log == 'undefined') {\n      console.log = function () { };\n    }\n    // Console logging (all debugging disabled by default)\n    Janus.trace = Janus.noop;\n    Janus.debug = Janus.noop;\n    Janus.vdebug = Janus.noop;\n    Janus.log = Janus.noop;\n    Janus.warn = Janus.noop;\n    Janus.error = Janus.noop;\n    if (options.debug === true || options.debug === 'all') {\n      // Enable all debugging levels\n      Janus.trace = console.trace.bind(console);\n      Janus.debug = console.debug.bind(console);\n      Janus.vdebug = console.debug.bind(console);\n      Janus.log = console.log.bind(console);\n      Janus.warn = console.warn.bind(console);\n      Janus.error = console.error.bind(console);\n    } else if (Array.isArray(options.debug)) {\n      for (let d of options.debug) {\n        switch (d) {\n          case 'trace':\n            Janus.trace = console.trace.bind(console);\n            break;\n          case 'debug':\n            Janus.debug = console.debug.bind(console);\n            break;\n          case 'vdebug':\n            Janus.vdebug = console.debug.bind(console);\n            break;\n          case 'log':\n            Janus.log = console.log.bind(console);\n            break;\n          case 'warn':\n            Janus.warn = console.warn.bind(console);\n            break;\n          case 'error':\n            Janus.error = console.error.bind(console);\n            break;\n          default:\n            console.error(\n              \"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\"\n            );\n            break;\n        }\n      }\n    }\n    Janus.log('Initializing library');\n\n    let usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n    Janus.isArray = usedDependencies.isArray;\n    Janus.webRTCAdapter = usedDependencies.webRTCAdapter;\n    Janus.httpAPICall = usedDependencies.httpAPICall;\n    Janus.newWebSocket = usedDependencies.newWebSocket;\n    Janus.extension = usedDependencies.extension;\n    Janus.extension.init();\n\n    // Helper method to enumerate devices\n    Janus.listDevices = function (callback, config) {\n      callback = typeof callback == 'function' ? callback : Janus.noop;\n      if (!config) config = { audio: true, video: true };\n      if (Janus.isGetUserMediaAvailable()) {\n        navigator.mediaDevices\n          .getUserMedia(config)\n          .then(function (stream) {\n            navigator.mediaDevices.enumerateDevices().then(function (devices) {\n              Janus.debug(devices);\n              callback(devices);\n              // Get rid of the now useless stream\n              Janus.stopAllTracks(stream);\n            });\n          })\n          .catch(function (err) {\n            Janus.error(err);\n            callback([]);\n          });\n      } else {\n        Janus.warn('navigator.mediaDevices unavailable');\n        callback([]);\n      }\n    };\n    // Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n    // Janus.attachMediaStream = function(element, stream) {\n    // \ttry {\n    // \t\telement.srcObject = stream;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\telement.src = URL.createObjectURL(stream);\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error attaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Janus.reattachMediaStream = function(to, from) {\n    // \ttry {\n    // \t\tto.srcObject = from.srcObject;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\tto.src = from.src;\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error reattaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Detect tab close: make sure we don't loose existing onbeforeunload handlers\n    // (note: for iOS we need to subscribe to a different event, 'pagehide', see\n    // https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n    // let iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n    // let eventName = iOS ? 'pagehide' : 'beforeunload';\n    // let oldOBF = window[\"on\" + eventName];\n    // window.addEventListener(eventName, function() {\n    // \tJanus.log(\"Closing window\");\n    // \tfor(let s in Janus.sessions) {\n    // \t\tif(Janus.sessions[s] && Janus.sessions[s].destroyOnUnload) {\n    // \t\t\tJanus.log(\"Destroying session \" + s);\n    // \t\t\tJanus.sessions[s].destroy({unload: true, notifyDestroyed: false});\n    // \t\t}\n    // \t}\n    // \tif(oldOBF && typeof oldOBF == \"function\") {\n    // \t\toldOBF();\n    // \t}\n    // });\n    // If this is a Safari Technology Preview, check if VP8 is supported\n    Janus.safariVp8 = false;\n    if (Janus.webRTCAdapter.browserDetails.browser === 'safari' && Janus.webRTCAdapter.browserDetails.version >= 605) {\n      // Let's see if RTCRtpSender.getCapabilities() is there\n      if (\n        RTCRtpSender &&\n        RTCRtpSender.getCapabilities &&\n        RTCRtpSender.getCapabilities('video') &&\n        RTCRtpSender.getCapabilities('video').codecs &&\n        RTCRtpSender.getCapabilities('video').codecs.length\n      ) {\n        for (let codec of RTCRtpSender.getCapabilities('video').codecs) {\n          if (codec && codec.mimeType && codec.mimeType.toLowerCase() === 'video/vp8') {\n            Janus.safariVp8 = true;\n            break;\n          }\n        }\n        if (Janus.safariVp8) {\n          Janus.log('This version of Safari supports VP8');\n        } else {\n          Janus.warn(\n            \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n            \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n          );\n        }\n      } else {\n        // We do it in a very ugly way, as there's no alternative...\n        // We create a PeerConnection to see if VP8 is in an offer\n        let testpc = new RTCPeerConnection({});\n        testpc.createOffer({ offerToReceiveVideo: true }).then(function (offer) {\n          Janus.safariVp8 = offer.sdp.indexOf('VP8') !== -1;\n          if (Janus.safariVp8) {\n            Janus.log('This version of Safari supports VP8');\n          } else {\n            Janus.warn(\n              \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n              \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n            );\n          }\n          testpc.close();\n          testpc = null;\n        });\n      }\n    }\n    Janus.initDone = true;\n    options.callback();\n  }\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function () {\n  return !!RTCPeerConnection;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function () {\n  return navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function (len) {\n  let charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let randomString = '';\n  for (let i = 0; i < len; i++) {\n    let randomPoz = Math.floor(Math.random() * charSet.length);\n    randomString += charSet.charAt(randomPoz);\n  }\n  return randomString;\n};\n\nfunction Janus(gatewayCallbacks) {\n  gatewayCallbacks = gatewayCallbacks || {};\n  gatewayCallbacks.success = typeof gatewayCallbacks.success == 'function' ? gatewayCallbacks.success : Janus.noop;\n  gatewayCallbacks.error = typeof gatewayCallbacks.error == 'function' ? gatewayCallbacks.error : Janus.noop;\n  gatewayCallbacks.destroyed =\n    typeof gatewayCallbacks.destroyed == 'function' ? gatewayCallbacks.destroyed : Janus.noop;\n  if (!Janus.initDone) {\n    gatewayCallbacks.error('Library not initialized');\n    return {};\n  }\n  if (!Janus.isWebrtcSupported()) {\n    gatewayCallbacks.error('WebRTC not supported by this browser');\n    return {};\n  }\n  Janus.log('Library initialized: ' + Janus.initDone);\n  if (!gatewayCallbacks.server) {\n    gatewayCallbacks.error('Invalid server url');\n    return {};\n  }\n  let websockets = false;\n  let ws = null;\n  let wsHandlers = {};\n  let wsKeepaliveTimeoutId = null;\n  let servers = null;\n  let serversIndex = 0;\n  let server = gatewayCallbacks.server;\n  if (Janus.isArray(server)) {\n    Janus.log('Multiple servers provided (' + server.length + '), will use the first that works');\n    server = null;\n    servers = gatewayCallbacks.server;\n    Janus.debug(servers);\n  } else {\n    if (server.indexOf('ws') === 0) {\n      websockets = true;\n      Janus.log('Using WebSockets to contact Janus: ' + server);\n    } else {\n      websockets = false;\n      Janus.log('Using REST API to contact Janus: ' + server);\n    }\n  }\n  let iceServers = gatewayCallbacks.iceServers || [{ urls: 'stun:stun.l.google.com:19302' }];\n  let iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n  let bundlePolicy = gatewayCallbacks.bundlePolicy;\n  // Whether we should enable the withCredentials flag for XHR requests\n  let withCredentials = false;\n  if (typeof gatewayCallbacks.withCredentials !== 'undefined' && gatewayCallbacks.withCredentials !== null)\n    withCredentials = gatewayCallbacks.withCredentials === true;\n  // Optional max events\n  let maxev = 10;\n  if (typeof gatewayCallbacks.max_poll_events !== 'undefined' && gatewayCallbacks.max_poll_events !== null)\n    maxev = gatewayCallbacks.max_poll_events;\n  if (maxev < 1) maxev = 1;\n  // Token to use (only if the token based authentication mechanism is enabled)\n  let token = null;\n  if (typeof gatewayCallbacks.token !== 'undefined' && gatewayCallbacks.token !== null) token = gatewayCallbacks.token;\n  // API secret to use (only if the shared API secret is enabled)\n  let apisecret = null;\n  if (typeof gatewayCallbacks.apisecret !== 'undefined' && gatewayCallbacks.apisecret !== null)\n    apisecret = gatewayCallbacks.apisecret;\n  // Whether we should destroy this session when onbeforeunload is called\n  this.destroyOnUnload = true;\n  if (typeof gatewayCallbacks.destroyOnUnload !== 'undefined' && gatewayCallbacks.destroyOnUnload !== null)\n    this.destroyOnUnload = gatewayCallbacks.destroyOnUnload === true;\n  // Some timeout-related values\n  let keepAlivePeriod = 25000;\n  if (typeof gatewayCallbacks.keepAlivePeriod !== 'undefined' && gatewayCallbacks.keepAlivePeriod !== null)\n    keepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n  if (isNaN(keepAlivePeriod)) keepAlivePeriod = 25000;\n  let longPollTimeout = 60000;\n  if (typeof gatewayCallbacks.longPollTimeout !== 'undefined' && gatewayCallbacks.longPollTimeout !== null)\n    longPollTimeout = gatewayCallbacks.longPollTimeout;\n  if (isNaN(longPollTimeout)) longPollTimeout = 60000;\n\n  // overrides for default maxBitrate values for simulcasting\n  function getMaxBitrates(simulcastMaxBitrates) {\n    let maxBitrates = {\n      high: 900000,\n      medium: 300000,\n      low: 100000,\n    };\n\n    if (typeof simulcastMaxBitrates !== 'undefined' && simulcastMaxBitrates !== null) {\n      if (simulcastMaxBitrates.high) maxBitrates.high = simulcastMaxBitrates.high;\n      if (simulcastMaxBitrates.medium) maxBitrates.medium = simulcastMaxBitrates.medium;\n      if (simulcastMaxBitrates.low) maxBitrates.low = simulcastMaxBitrates.low;\n    }\n\n    return maxBitrates;\n  }\n\n  let connected = false;\n  let sessionId = null;\n  let pluginHandles = {};\n  let that = this;\n  let retries = 0;\n  let transactions = {};\n  createSession(gatewayCallbacks);\n\n  // Public methods\n  this.getServer = function () {\n    return server;\n  };\n  this.isConnected = function () {\n    return connected;\n  };\n  this.reconnect = function (callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks['reconnect'] = true;\n    createSession(callbacks);\n  };\n  this.getSessionId = function () {\n    return sessionId;\n  };\n  this.getInfo = function (callbacks) {\n    getInfo(callbacks);\n  };\n  this.destroy = function (callbacks) {\n    destroySession(callbacks);\n  };\n  this.attach = function (callbacks) {\n    createHandle(callbacks);\n  };\n\n  function eventHandler() {\n    if (sessionId == null) return;\n    Janus.debug('Long poll...');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let longpoll = server + '/' + sessionId + '?rid=' + new Date().getTime();\n    if (maxev) longpoll = longpoll + '&maxev=' + maxev;\n    if (token) longpoll = longpoll + '&token=' + encodeURIComponent(token);\n    if (apisecret) longpoll = longpoll + '&apisecret=' + encodeURIComponent(apisecret);\n    Janus.httpAPICall(longpoll, {\n      verb: 'GET',\n      withCredentials: withCredentials,\n      success: handleEvent,\n      timeout: longPollTimeout,\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown);\n        retries++;\n        if (retries > 3) {\n          // Did we just lose the server? :-(\n          connected = false;\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n          return;\n        }\n        eventHandler();\n      },\n    });\n  }\n\n  // Private event handler: this will trigger plugin callbacks, if set\n  function handleEvent(json, skipTimeout) {\n    retries = 0;\n    if (!websockets && typeof sessionId !== 'undefined' && sessionId !== null && skipTimeout !== true) eventHandler();\n    if (!websockets && Janus.isArray(json)) {\n      // We got an array: it means we passed a maxev > 1, iterate on all objects\n      for (let i = 0; i < json.length; i++) {\n        handleEvent(json[i], true);\n      }\n      return;\n    }\n    if (json['janus'] === 'keepalive') {\n      // Nothing happened\n      Janus.vdebug('Got a keepalive on session ' + sessionId);\n      return;\n    } else if (json['janus'] === 'server_info') {\n      // Just info on the Janus instance\n      Janus.debug('Got info on the Janus instance');\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'ack') {\n      // Just an ack, we can probably ignore\n      Janus.debug('Got an ack on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'success') {\n      // Success!\n      Janus.debug('Got a success on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'trickle') {\n      // We got a trickle candidate from Janus\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      let candidate = json['candidate'];\n      Janus.debug('Got a trickled candidate on session ' + sessionId);\n      Janus.debug(candidate);\n      let config = pluginHandle.webrtcStuff;\n      if (config.pc && config.remoteSdp) {\n        // Add candidate right now\n        Janus.debug('Adding remote candidate:', candidate);\n        if (!candidate || candidate.completed === true) {\n          // end-of-candidates\n          config.pc.addIceCandidate(Janus.endOfCandidates);\n        } else {\n          // New candidate\n          config.pc.addIceCandidate(candidate);\n        }\n      } else {\n        // We didn't do setRemoteDescription (trickle got here before the offer?)\n        Janus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n        if (!config.candidates) config.candidates = [];\n        config.candidates.push(candidate);\n        Janus.debug(config.candidates);\n      }\n    } else if (json['janus'] === 'webrtcup') {\n      // The PeerConnection with the server is up! Notify this\n      Janus.debug('Got a webrtcup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(true);\n      return;\n    } else if (json['janus'] === 'hangup') {\n      // A plugin asked the core to hangup a PeerConnection on one of our handles\n      Janus.debug('Got a hangup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(false, json['reason']);\n      pluginHandle.hangup();\n    } else if (json['janus'] === 'detached') {\n      // A plugin asked the core to detach one of our handles\n      Janus.debug('Got a detached event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        // Don't warn here because destroyHandle causes this situation.\n        return;\n      }\n      pluginHandle.ondetached();\n      pluginHandle.detach();\n    } else if (json['janus'] === 'media') {\n      // Media started/stopped flowing\n      Janus.debug('Got a media event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.mediaState(json['type'], json['receiving'], json['mid']);\n    } else if (json['janus'] === 'slowlink') {\n      Janus.debug('Got a slowlink event on session ' + sessionId);\n      Janus.debug(json);\n      // Trouble uplink or downlink\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.slowLink(json['uplink'], json['lost'], json['mid']);\n    } else if (json['janus'] === 'error') {\n      // Oops, something wrong happened\n      Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n      Janus.debug(json);\n      let transaction = json['transaction'];\n      if (transaction) {\n        let reportSuccess = transactions[transaction];\n        if (reportSuccess) {\n          reportSuccess(json);\n        }\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'event') {\n      Janus.debug('Got a plugin event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      let plugindata = json['plugindata'];\n      if (!plugindata) {\n        Janus.warn('Missing plugindata...');\n        return;\n      }\n      Janus.debug('  -- Event is coming from ' + sender + ' (' + plugindata['plugin'] + ')');\n      let data = plugindata['data'];\n      Janus.debug(data);\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.warn('This handle is not attached to this session');\n        return;\n      }\n      let jsep = json['jsep'];\n      if (jsep) {\n        Janus.debug('Handling SDP as well...');\n        Janus.debug(jsep);\n      }\n      let callback = pluginHandle.onmessage;\n      if (callback) {\n        Janus.debug('Notifying application...');\n        // Send to callback specified when attaching plugin handle\n        callback(data, jsep);\n      } else {\n        // Send to generic callback (?)\n        Janus.debug('No provided notification callback');\n      }\n    } else if (json['janus'] === 'timeout') {\n      Janus.error('Timeout on session ' + sessionId);\n      Janus.debug(json);\n      if (websockets) {\n        ws.close(3504, 'Gateway timeout');\n      }\n      return;\n    } else {\n      Janus.warn(\"Unknown message/event  '\" + json['janus'] + \"' on session \" + sessionId);\n      Janus.debug(json);\n    }\n  }\n\n  // Private helper to send keep-alive messages on WebSockets\n  function keepAlive() {\n    if (!server || !websockets || !connected) return;\n    wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n    let request = {\n      janus: 'keepalive',\n      session_id: sessionId,\n      transaction: Janus.randomString(12),\n    };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    ws.send(JSON.stringify(request));\n  }\n\n  // Private method to create a session\n  function createSession(callbacks) {\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'create', transaction: transaction };\n    if (callbacks['reconnect']) {\n      // We're reconnecting, claim the session\n      connected = false;\n      request['janus'] = 'claim';\n      request['session_id'] = sessionId;\n      // If we were using websockets, ignore the old connection\n      if (ws) {\n        ws.onopen = null;\n        ws.onerror = null;\n        ws.onclose = null;\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n          wsKeepaliveTimeoutId = null;\n        }\n      }\n    }\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (!server && Janus.isArray(servers)) {\n      // We still need to find a working server from the list we were given\n      server = servers[serversIndex];\n      if (server.indexOf('ws') === 0) {\n        websockets = true;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying WebSockets to contact Janus (' + server + ')');\n      } else {\n        websockets = false;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying REST API to contact Janus (' + server + ')');\n      }\n    }\n    if (websockets) {\n      ws = Janus.newWebSocket(server, 'janus-protocol');\n      wsHandlers = {\n        error: function () {\n          Janus.error('Error connecting to the Janus WebSockets server... ' + server);\n          if (Janus.isArray(servers) && !callbacks['reconnect']) {\n            serversIndex++;\n            if (serversIndex === servers.length) {\n              // We tried all the servers the user gave us and they all failed\n              callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n              return;\n            }\n            // Let's try the next server\n            server = null;\n            setTimeout(function () {\n              createSession(callbacks);\n            }, 200);\n            return;\n          }\n          callbacks.error('Error connecting to the Janus WebSockets server: Is the server down?');\n        },\n\n        open: function () {\n          // We need to be notified about the success\n          transactions[transaction] = function (json) {\n            Janus.debug(json);\n            if (json['janus'] !== 'success') {\n              Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n              callbacks.error(json['error'].reason);\n              return;\n            }\n            wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n            connected = true;\n            sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n            if (callbacks['reconnect']) {\n              Janus.log('Claimed session: ' + sessionId);\n            } else {\n              Janus.log('Created session: ' + sessionId);\n            }\n            Janus.sessions[sessionId] = that;\n            callbacks.success();\n          };\n          ws.send(JSON.stringify(request));\n        },\n\n        message: function (event) {\n          handleEvent(JSON.parse(event.data));\n        },\n\n        close: function () {\n          if (!server || !connected) {\n            return;\n          }\n          connected = false;\n          // FIXME What if this is called when the page is closed?\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n        },\n      };\n\n      for (let eventName in wsHandlers) {\n        ws.addEventListener(eventName, wsHandlers[eventName]);\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error(json['error'].reason);\n          return;\n        }\n        connected = true;\n        sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n        if (callbacks['reconnect']) {\n          Janus.log('Claimed session: ' + sessionId);\n        } else {\n          Janus.log('Created session: ' + sessionId);\n        }\n        Janus.sessions[sessionId] = that;\n        eventHandler();\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (Janus.isArray(servers) && !callbacks['reconnect']) {\n          serversIndex++;\n          if (serversIndex === servers.length) {\n            // We tried all the servers the user gave us and they all failed\n            callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n            return;\n          }\n          // Let's try the next server\n          server = null;\n          setTimeout(function () {\n            createSession(callbacks);\n          }, 200);\n          return;\n        }\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else if (errorThrown && errorThrown.error) callbacks.error(textStatus + ': ' + errorThrown.error.message);\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to get info on the server\n  function getInfo(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    Janus.log('Getting info on Janus instance');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    // We just need to send an \"info\" request\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'info', transaction: transaction };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to destroy a session\n  function destroySession(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let unload = callbacks.unload === true;\n    let notifyDestroyed = true;\n    if (typeof callbacks.notifyDestroyed !== 'undefined' && callbacks.notifyDestroyed !== null)\n      notifyDestroyed = callbacks.notifyDestroyed === true;\n    let cleanupHandles = callbacks.cleanupHandles === true;\n    Janus.log('Destroying session ' + sessionId + ' (unload=' + unload + ')');\n    if (!sessionId) {\n      Janus.warn('No session to destroy');\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (cleanupHandles) {\n      for (let handleId in pluginHandles) destroyHandle(handleId, { noRequest: true });\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      sessionId = null;\n      callbacks.success();\n      return;\n    }\n    // No need to destroy all handles first, Janus will do that itself\n    let request = { janus: 'destroy', transaction: Janus.randomString(12) };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (unload) {\n      // We're unloading the page: use sendBeacon for HTTP instead,\n      // or just close the WebSocket connection if we're using that\n      if (websockets) {\n        ws.onclose = null;\n        ws.close();\n        ws = null;\n      } else {\n        navigator.sendBeacon(server + '/' + sessionId, JSON.stringify(request));\n      }\n      Janus.log('Destroyed session:');\n      sessionId = null;\n      connected = false;\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (websockets) {\n      request['session_id'] = sessionId;\n\n      let unbindWebSocket = function () {\n        for (let eventName in wsHandlers) {\n          ws.removeEventListener(eventName, wsHandlers[eventName]);\n        }\n        ws.removeEventListener('message', onUnbindMessage);\n        ws.removeEventListener('error', onUnbindError);\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n        }\n        ws.close();\n      };\n\n      let onUnbindMessage = function (event) {\n        let data = JSON.parse(event.data);\n        if (data.session_id == request.session_id && data.transaction == request.transaction) {\n          unbindWebSocket();\n          callbacks.success();\n          if (notifyDestroyed) gatewayCallbacks.destroyed();\n        }\n      };\n      let onUnbindError = function () {\n        unbindWebSocket();\n        callbacks.error('Failed to destroy the server: Is the server down?');\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      };\n\n      ws.addEventListener('message', onUnbindMessage);\n      ws.addEventListener('error', onUnbindError);\n\n      if (ws.readyState === 1) {\n        ws.send(JSON.stringify(request));\n      } else {\n        onUnbindError();\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed session:');\n        Janus.debug(json);\n        sessionId = null;\n        connected = false;\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // Reset everything anyway\n        sessionId = null;\n        connected = false;\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n    });\n  }\n\n  // Private method to create a plugin handle\n  function createHandle(callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks.dataChannelOptions = callbacks.dataChannelOptions || {\n      ordered: true,\n    };\n    callbacks.consentDialog = typeof callbacks.consentDialog == 'function' ? callbacks.consentDialog : Janus.noop;\n    callbacks.iceState = typeof callbacks.iceState == 'function' ? callbacks.iceState : Janus.noop;\n    callbacks.mediaState = typeof callbacks.mediaState == 'function' ? callbacks.mediaState : Janus.noop;\n    callbacks.webrtcState = typeof callbacks.webrtcState == 'function' ? callbacks.webrtcState : Janus.noop;\n    callbacks.slowLink = typeof callbacks.slowLink == 'function' ? callbacks.slowLink : Janus.noop;\n    callbacks.onmessage = typeof callbacks.onmessage == 'function' ? callbacks.onmessage : Janus.noop;\n    callbacks.onlocaltrack = typeof callbacks.onlocaltrack == 'function' ? callbacks.onlocaltrack : Janus.noop;\n    callbacks.onremotetrack = typeof callbacks.onremotetrack == 'function' ? callbacks.onremotetrack : Janus.noop;\n    callbacks.ondata = typeof callbacks.ondata == 'function' ? callbacks.ondata : Janus.noop;\n    callbacks.ondataopen = typeof callbacks.ondataopen == 'function' ? callbacks.ondataopen : Janus.noop;\n    callbacks.oncleanup = typeof callbacks.oncleanup == 'function' ? callbacks.oncleanup : Janus.noop;\n    callbacks.ondetached = typeof callbacks.ondetached == 'function' ? callbacks.ondetached : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let plugin = callbacks.plugin;\n    if (!plugin) {\n      Janus.error('Invalid plugin');\n      callbacks.error('Invalid plugin');\n      return;\n    }\n    let opaqueId = callbacks.opaqueId;\n    let loopIndex = callbacks.loopIndex;\n    let handleToken = callbacks.token ? callbacks.token : token;\n    let transaction = Janus.randomString(12);\n    let request = {\n      janus: 'attach',\n      plugin: plugin,\n      opaque_id: opaqueId,\n      loop_index: loopIndex,\n      transaction: transaction,\n    };\n    if (handleToken) request['token'] = handleToken;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      };\n      request['session_id'] = sessionId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a message\n  function sendMessage(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let message = callbacks.message;\n    let jsep = callbacks.jsep;\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'message', body: message, transaction: transaction };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (jsep) {\n      request.jsep = {\n        type: jsep.type,\n        sdp: jsep.sdp,\n      };\n      if (jsep.e2ee) request.jsep.e2ee = true;\n      if (jsep.rid_order === 'hml' || jsep.rid_order === 'lmh') request.jsep.rid_order = jsep.rid_order;\n      if (jsep.force_relay) request.jsep.force_relay = true;\n    }\n    Janus.debug('Sending message to plugin (handle=' + handleId + '):');\n    Janus.debug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      transactions[transaction] = function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a trickle candidate\n  function sendTrickleCandidate(handleId, candidate) {\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let request = {\n      janus: 'trickle',\n      candidate: candidate,\n      transaction: Janus.randomString(12),\n    };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    Janus.vdebug('Sending trickle candidate (handle=' + handleId + '):');\n    Janus.vdebug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.vdebug('Candidate sent!');\n        Janus.vdebug(json);\n        if (json['janus'] !== 'ack') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          return;\n        }\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n      },\n    });\n  }\n\n  // Private method to create a data channel\n  function createDataChannel(handleId, dclabel, dcprotocol, incoming, pendingData) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let onDataChannelMessage = function (event) {\n      Janus.log('Received message on data channel:', event);\n      let label = event.target.label;\n      pluginHandle.ondata(event.data, label);\n    };\n    let onDataChannelStateChange = function (event) {\n      Janus.log('Received state change on data channel:', event);\n      let label = event.target.label;\n      let protocol = event.target.protocol;\n      let dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : 'null';\n      Janus.log('State change on <' + label + '> data channel: ' + dcState);\n      if (dcState === 'open') {\n        // Any pending messages to send?\n        if (config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n          Janus.log('Sending pending messages on <' + label + '>:', config.dataChannel[label].pending.length);\n          for (let data of config.dataChannel[label].pending) {\n            Janus.log('Sending data on data channel <' + label + '>');\n            Janus.debug(data);\n            config.dataChannel[label].send(data);\n          }\n          config.dataChannel[label].pending = [];\n        }\n        // Notify the open data channel\n        pluginHandle.ondataopen(label, protocol);\n      }\n    };\n    let onDataChannelError = function (error) {\n      Janus.error('Got error on data channel:', error);\n      // TODO\n    };\n    if (!incoming) {\n      // FIXME Add options (ordered, maxRetransmits, etc.)\n      let dcoptions = config.dataChannelOptions;\n      if (dcprotocol) dcoptions.protocol = dcprotocol;\n      config.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, dcoptions);\n    } else {\n      // The channel was created by Janus\n      config.dataChannel[dclabel] = incoming;\n    }\n    config.dataChannel[dclabel].onmessage = onDataChannelMessage;\n    config.dataChannel[dclabel].onopen = onDataChannelStateChange;\n    config.dataChannel[dclabel].onclose = onDataChannelStateChange;\n    config.dataChannel[dclabel].onerror = onDataChannelError;\n    config.dataChannel[dclabel].pending = [];\n    if (pendingData) config.dataChannel[dclabel].pending.push(pendingData);\n  }\n\n  // Private method to send a data channel message\n  function sendData(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    let data = callbacks.text || callbacks.data;\n    if (!data) {\n      Janus.warn('Invalid data');\n      callbacks.error('Invalid data');\n      return;\n    }\n    let label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n    if (!config.dataChannel[label]) {\n      // Create new data channel and wait for it to open\n      createDataChannel(handleId, label, callbacks.protocol, false, data, callbacks.protocol);\n      callbacks.success();\n      return;\n    }\n    if (config.dataChannel[label].readyState !== 'open') {\n      config.dataChannel[label].pending.push(data);\n      callbacks.success();\n      return;\n    }\n    Janus.log('Sending data on data channel <' + label + '>');\n    Janus.debug(data);\n    config.dataChannel[label].send(data);\n    callbacks.success();\n  }\n\n  // Private method to send a DTMF tone\n  function sendDtmf(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.dtmfSender) {\n      // Create the DTMF sender the proper way, if possible\n      if (config.pc) {\n        let senders = config.pc.getSenders();\n        let audioSender = senders.find(function (sender) {\n          return sender.track && sender.track.kind === 'audio';\n        });\n        if (!audioSender) {\n          Janus.warn('Invalid DTMF configuration (no audio track)');\n          callbacks.error('Invalid DTMF configuration (no audio track)');\n          return;\n        }\n        config.dtmfSender = audioSender.dtmf;\n        if (config.dtmfSender) {\n          Janus.log('Created DTMF Sender');\n          config.dtmfSender.ontonechange = function (tone) {\n            Janus.debug('Sent DTMF tone: ' + tone.tone);\n          };\n        }\n      }\n      if (!config.dtmfSender) {\n        Janus.warn('Invalid DTMF configuration');\n        callbacks.error('Invalid DTMF configuration');\n        return;\n      }\n    }\n    let dtmf = callbacks.dtmf;\n    if (!dtmf) {\n      Janus.warn('Invalid DTMF parameters');\n      callbacks.error('Invalid DTMF parameters');\n      return;\n    }\n    let tones = dtmf.tones;\n    if (!tones) {\n      Janus.warn('Invalid DTMF string');\n      callbacks.error('Invalid DTMF string');\n      return;\n    }\n    let duration = typeof dtmf.duration === 'number' ? dtmf.duration : 500; // We choose 500ms as the default duration for a tone\n    let gap = typeof dtmf.gap === 'number' ? dtmf.gap : 50; // We choose 50ms as the default gap between tones\n    Janus.debug('Sending DTMF string ' + tones + ' (duration ' + duration + 'ms, gap ' + gap + 'ms)');\n    config.dtmfSender.insertDTMF(tones, duration, gap);\n    callbacks.success();\n  }\n\n  // Private method to destroy a plugin handle\n  function destroyHandle(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let noRequest = callbacks.noRequest === true;\n    Janus.log('Destroying handle ' + handleId + ' (only-locally=' + noRequest + ')');\n    cleanupWebrtc(handleId);\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || pluginHandle.detached) {\n      // Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    pluginHandle.detached = true;\n    if (noRequest) {\n      // We're only removing the handle locally\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let request = { janus: 'detach', transaction: Janus.randomString(12) };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed handle:');\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // We cleanup anyway\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n    });\n  }\n\n  // WebRTC stuff\n  // Helper function to create a new PeerConnection, if we need one\n  function createPeerconnectionIfNeeded(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config.pc) {\n      // Nothing to do, we have a PeerConnection already\n      return;\n    }\n    let pc_config = {\n      iceServers: iceServers,\n      iceTransportPolicy: iceTransportPolicy,\n      bundlePolicy: bundlePolicy,\n    };\n    pc_config.sdpSemantics = 'unified-plan';\n    // Check if a sender or receiver transform has been provided\n    let insertableStreams = false;\n    if (callbacks.tracks) {\n      for (let track of callbacks.tracks) {\n        if (track.transforms && (track.transforms.sender || track.transforms.receiver)) {\n          insertableStreams = true;\n          break;\n        }\n      }\n    }\n    if (\n      RTCRtpSender &&\n      (RTCRtpSender.prototype.createEncodedStreams ||\n        (RTCRtpSender.prototype.createEncodedAudioStreams && RTCRtpSender.prototype.createEncodedVideoStreams)) &&\n      insertableStreams\n    ) {\n      config.insertableStreams = true;\n      pc_config.forceEncodedAudioInsertableStreams = true;\n      pc_config.forceEncodedVideoInsertableStreams = true;\n      pc_config.encodedInsertableStreams = true;\n    }\n    Janus.log('Creating PeerConnection');\n    config.pc = new RTCPeerConnection(pc_config);\n    Janus.debug(config.pc);\n    if (config.pc.getStats) {\n      // FIXME\n      config.volume = {};\n      config.bitrate.value = '0 kbits/sec';\n    }\n    Janus.log('Preparing local SDP and gathering candidates (trickle=' + config.trickle + ')');\n    config.pc.oniceconnectionstatechange = function () {\n      if (config.pc) pluginHandle.iceState(config.pc.iceConnectionState);\n    };\n    config.pc.onicecandidate = function (event) {\n      if (!event.candidate || (event.candidate.candidate && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n        Janus.log('End of candidates.');\n        config.iceDone = true;\n        if (config.trickle === true) {\n          // Notify end of candidates\n          sendTrickleCandidate(handleId, { completed: true });\n        } else {\n          // No trickle, time to send the complete SDP (including all candidates)\n          sendSDP(handleId, callbacks);\n        }\n      } else {\n        // JSON.stringify doesn't work on some WebRTC objects anymore\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\n        let candidate = {\n          candidate: event.candidate.candidate,\n          sdpMid: event.candidate.sdpMid,\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\n        };\n        if (config.trickle === true) {\n          // Send candidate\n          sendTrickleCandidate(handleId, candidate);\n        }\n      }\n    };\n    config.pc.ontrack = function (event) {\n      Janus.log('Handling Remote Track', event);\n      if (!event.streams) return;\n      if (!event.track) return;\n      // Notify about the new track event\n      let mid = event.transceiver ? event.transceiver.mid || event.transceiver._mid : event.track.id;\n      try {\n        pluginHandle.onremotetrack(event.track, mid, true, {\n          reason: 'created',\n        });\n      } catch (e) {\n        Janus.error('Error calling onremotetrack', e);\n      }\n      if (event.track.onended) return;\n      let trackMutedTimeoutId = null;\n      Janus.log('Adding onended callback to track:', event.track);\n      event.track.onended = function (ev) {\n        Janus.log('Remote track removed:', ev);\n        clearTimeout(trackMutedTimeoutId);\n        // Notify the application\n        let transceivers = config.pc ? config.pc.getTransceivers() : null;\n        let transceiver = transceivers\n          ? transceivers.find((transceiver) => {\n            const receiver = transceiver.receiver || transceiver._receiver;\n            const track = receiver.track || receiver._track;\n            return track === ev.target;\n          })\n          : null;\n        let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n        try {\n          pluginHandle.onremotetrack(ev.target, mid, false, {\n            reason: 'ended',\n          });\n        } catch (e) {\n          Janus.error('Error calling onremotetrack on removal', e);\n        }\n      };\n      event.track.onmute = function (ev) {\n        Janus.log('Remote track muted:', ev);\n        if (!trackMutedTimeoutId) {\n          const target = ev.target;\n          trackMutedTimeoutId = setTimeout(function () {\n            Janus.log('Removing remote track');\n            // Notify the application the track is gone\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : target.id;\n            try {\n              pluginHandle.onremotetrack(target, mid, false, {\n                reason: 'mute',\n              });\n            } catch (e) {\n              Janus.error('Error calling onremotetrack on mute', e);\n            }\n            trackMutedTimeoutId = null;\n            // Chrome seems to raise mute events only at multiples of 834ms;\n            // we set the timeout to three times this value (rounded to 840ms);\n          }, 3 * 840);\n        }\n      };\n      event.track.onunmute = function (ev) {\n        Janus.log('Remote track flowing again:', ev);\n        if (trackMutedTimeoutId != null) {\n          clearTimeout(trackMutedTimeoutId);\n          trackMutedTimeoutId = null;\n        } else {\n          try {\n            // Notify the application the track is back\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === ev.target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n            pluginHandle.onremotetrack(ev.target, mid, true, {\n              reason: 'unmute',\n            });\n          } catch (e) {\n            Janus.error('Error calling onremotetrack on unmute', e);\n          }\n        }\n      };\n    };\n  }\n\n  // Helper function used when creating either an offer or answer: it\n  // prepares what needs to be prepared, including creating a new\n  // PeerConnection (if needed) and updating the tracks configuration,\n  // before invoking the function to actually generate the offer/answer\n  async function prepareWebrtc(handleId, offer, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    let jsep = callbacks.jsep;\n    if (offer && jsep) {\n      Janus.error('Provided a JSEP to a createOffer');\n      callbacks.error('Provided a JSEP to a createOffer');\n      return;\n    } else if (!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n      Janus.error('A valid JSEP is required for createAnswer');\n      callbacks.error('A valid JSEP is required for createAnswer');\n      return;\n    }\n    // If the deprecated media was provided instead of tracks, translate it\n    if (callbacks.media && !callbacks.tracks) {\n      callbacks.tracks = Janus.mediaToTracks(callbacks.media);\n      if (callbacks.simulcast === true || callbacks.simulcast2 === true || callbacks.svc) {\n        // Find the video track and add simulcast/SVC info there\n        for (let track of callbacks.tracks) {\n          if (track.type === 'video') {\n            if (callbacks.simulcast === true || callbacks.simulcast2 === true) track.simulcast = true;\n            else if (callbacks.svc) track.svc = callbacks.svc;\n            break;\n          }\n        }\n      }\n      Janus.warn('Deprecated media object passed, use tracks instead. Automatically translated to:', callbacks.tracks);\n    }\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Get the plugin handle\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    config.trickle = isTrickleEnabled(callbacks.trickle);\n    try {\n      // Create a PeerConnection, if needed\n      createPeerconnectionIfNeeded(handleId, callbacks);\n      if (offer) {\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n      }\n      // Create offer or answer now (depending on the context)\n      if (!jsep) {\n        let offer = await createOffer(handleId, callbacks);\n        callbacks.success(offer);\n      } else {\n        await config.pc.setRemoteDescription(jsep);\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n        // Create the answer now\n        let answer = await createAnswer(handleId, callbacks);\n        callbacks.success(answer);\n      }\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  function prepareWebrtcPeer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let jsep = callbacks.jsep;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (jsep) {\n      if (!config.pc) {\n        Janus.warn('Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep');\n        callbacks.error('No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep');\n        return;\n      }\n      callbacks.customizeSdp(jsep);\n      config.pc.setRemoteDescription(jsep).then(function () {\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Done\n        callbacks.success();\n      }, callbacks.error);\n    } else {\n      callbacks.error('Invalid JSEP');\n    }\n  }\n\n  async function createOffer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating offer (iceDone=' + config.iceDone + ')');\n    // https://code.google.com/p/webrtc/issues/detail?id=3508\n    let mediaConstraints = {};\n    let iceRestart = callbacks.iceRestart === true;\n    // If we need an ICE restart, set the related constraint\n    if (iceRestart) mediaConstraints.iceRestart = true;\n    Janus.debug(mediaConstraints);\n    let offer = await config.pc.createOffer(mediaConstraints);\n    Janus.debug(offer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    offer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    await config.pc.setLocalDescription(offer);\n    config.mediaConstraints = mediaConstraints;\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) offer.e2ee = true;\n    return offer;\n  }\n\n  async function createAnswer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating answer (iceDone=' + config.iceDone + ')');\n    let answer = await config.pc.createAnswer();\n    Janus.debug(answer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    answer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    await config.pc.setLocalDescription(answer);\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) answer.e2ee = true;\n    return answer;\n  }\n\n  function sendSDP(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Sending offer/answer SDP...');\n    if (!config.mySdp) {\n      Janus.warn('Local SDP instance is invalid, not sending anything...');\n      return;\n    }\n    config.mySdp = {\n      type: config.pc.localDescription.type,\n      sdp: config.pc.localDescription.sdp,\n    };\n    if (config.trickle === false) config.mySdp['trickle'] = false;\n    Janus.debug(callbacks);\n    config.sdpSent = true;\n    callbacks.success(config.mySdp);\n  }\n\n  async function replaceTracks(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Add the replace:true if it's missing\n    for (let track of callbacks.tracks) {\n      if (track.add || (!track.replace && !track.remove)) track.replace = true;\n    }\n    try {\n      await captureDevices(handleId, callbacks);\n      callbacks.success();\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  async function captureDevices(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      throw 'Invalid PeerConnection';\n    }\n    let tracks = callbacks.tracks;\n    if (!tracks || !Array.isArray(tracks) || tracks.length === 0) {\n      // Nothing to do\n      return;\n    }\n    let openedConsentDialog = false;\n    // Check if we can/should group getUserMedia calls\n    let groups = {};\n    for (let track of tracks) {\n      delete track.gumGroup;\n      if (!track.type || !['audio', 'video'].includes(track.type)) continue;\n      if (!track.capture || track.capture instanceof MediaStreamTrack) continue;\n      let group = track.group ? track.group : 'default';\n      if (!groups[group]) groups[group] = {};\n      if (groups[group][track.type]) continue;\n      track.gumGroup = group;\n      groups[group][track.type] = track;\n    }\n    let keys = Object.keys(groups);\n    for (let key of keys) {\n      let group = groups[key];\n      if (!group.audio || !group.video) {\n        if (group.audio) delete group.audio.gumGroup;\n        if (group.video) delete group.video.gumGroup;\n        delete groups[key];\n      }\n    }\n    let answer = callbacks.jsep ? true : false;\n    for (let track of tracks) {\n      if (!track.type) {\n        Janus.warn('Missing track type:', track);\n        continue;\n      }\n      if (track.type === 'data') {\n        // Easy enough: create a datachannel if we don't have one already\n        if (config.pc.ondatachannel) {\n          Janus.warn('Data channel exists already, not creating another one');\n          continue;\n        }\n        Janus.log('Creating default data channel');\n        createDataChannel(handleId, Janus.dataChanDefaultLabel, null, false);\n        config.pc.ondatachannel = function (event) {\n          Janus.log('Data channel created by Janus:', event);\n          createDataChannel(handleId, event.channel.label, event.channel.protocol, event.channel);\n        };\n        continue;\n      }\n      if (\n        typeof track.add === 'undefined' &&\n        track.add === null &&\n        typeof track.remove === 'undefined' &&\n        track.remove === null &&\n        typeof track.replace === 'undefined' &&\n        track.replace === null\n      ) {\n        // Let's default to 'add'\n        track.add = true;\n      }\n      if ((track.add && track.remove) || (track.add && track.remove && track.replace)) {\n        Janus.warn('Conflicting actions for track, ignoring:', track);\n        continue;\n      }\n      if (track.add && track.replace) {\n        Janus.warn('Both add and replace provided, falling back to replace:', track);\n        delete track.add;\n      } else if (track.remove && track.replace) {\n        Janus.warn('Both remove and replace provided, falling back to remove:', track);\n        delete track.replace;\n      }\n      let kind = track.type;\n      if (track.type === 'screen') kind = 'video'; // FIXME\n      let transceiver = null,\n        sender = null;\n      if (track.mid) {\n        // Search by mid\n        transceiver = config.pc.getTransceivers().find((t) => t.mid === track.mid && t.receiver.track.kind === kind);\n      } else {\n        // Find the first track of this type\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n      }\n      if (track.replace || track.remove) {\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n        if (!transceiver.sender) {\n          Janus.warn('No sender in the transceiver for track:', track);\n          continue;\n        }\n        sender = transceiver.sender;\n      }\n      if (answer && !transceiver) {\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n      }\n      // Capture the new track, if we need to\n      let nt = null,\n        trackId = null;\n      if (track.remove) {\n        Janus.log('Removing track from PeerConnection', track);\n        trackId = sender.track ? sender.track.id : null;\n        await sender.replaceTrack(null);\n      } else if (track.capture) {\n        if (track.gumGroup && groups[track.gumGroup] && groups[track.gumGroup].stream) {\n          // We did a getUserMedia before already\n          let stream = groups[track.gumGroup].stream;\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n          delete groups[track.gumGroup].stream;\n          delete groups[track.gumGroup];\n          delete track.gumGroup;\n        } else if (track.capture instanceof MediaStreamTrack) {\n          // An external track was provided, use that\n          nt = track.capture;\n        } else {\n          if (!openedConsentDialog) {\n            openedConsentDialog = true;\n            pluginHandle.consentDialog(true);\n          }\n          let constraints = Janus.trackConstraints(track),\n            stream = null;\n          if (track.type === 'audio' || track.type === 'video') {\n            // Use getUserMedia: check if we need to group audio and video together\n            if (track.gumGroup) {\n              let otherType = track.type === 'audio' ? 'video' : 'audio';\n              if (groups[track.gumGroup] && groups[track.gumGroup][otherType]) {\n                let otherTrack = groups[track.gumGroup][otherType];\n                let otherConstraints = Janus.trackConstraints(otherTrack);\n                constraints[otherType] = otherConstraints[otherType];\n              }\n            }\n            stream = await navigator.mediaDevices.getUserMedia(constraints);\n            if (track.gumGroup && constraints.audio && constraints.video) {\n              // We just performed a grouped getUserMedia, keep track of the\n              // stream so that we can immediately assign the track later\n              groups[track.gumGroup].stream = stream;\n              delete track.gumGroup;\n            }\n          } else {\n            // Use getDisplayMedia\n            stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n          }\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n        }\n        if (track.replace) {\n          // Replace the track\n          await sender.replaceTrack(nt);\n          // Update the transceiver direction\n          let newDirection = 'sendrecv';\n          if (track.recv === false || transceiver.direction === 'inactive' || transceiver.direction === 'sendonly')\n            newDirection = 'sendonly';\n          if (transceiver.setDirection) transceiver.setDirection(newDirection);\n          else transceiver.direction = newDirection;\n        } else {\n          // FIXME Add as a new track\n          if (!config.myStream) config.myStream = new MediaStream();\n          if (kind === 'audio' || (!track.simulcast && !track.svc)) {\n            sender = config.pc.addTrack(nt, config.myStream);\n            transceiver = config.pc.getTransceivers().find((t) => t.sender === sender);\n          } else if (track.simulcast) {\n            if (Janus.webRTCAdapter.browserDetails.browser !== 'firefox') {\n              // Standard RID\n              Janus.log('Enabling rid-based simulcasting:', nt);\n              let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n                sendEncodings: track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ],\n              });\n            } else {\n              // Firefox-based RID, based on https://gist.github.com/voluntas/088bc3cc62094730647b\n              Janus.log('Enabling Simulcasting for Firefox (RID)');\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n              });\n              sender = transceiver ? transceiver.sender : null;\n              if (sender) {\n                let parameters = sender.getParameters();\n                if (!parameters) parameters = {};\n                let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n                parameters.encodings = track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ];\n                sender.setParameters(parameters);\n              }\n            }\n          } else {\n            Janus.log('Enabling SVC (' + track.svc + '):', nt);\n            transceiver = config.pc.addTransceiver(nt, {\n              direction: 'sendrecv',\n              streams: [config.myStream],\n              sendEncodings: [{ scalabilityMode: track.svc }],\n            });\n          }\n          if (!sender) sender = transceiver ? transceiver.sender : null;\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else if (transceiver) {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          if (track.bitrate) {\n            // Override maximum bitrate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring bitrate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.bitrate) || track.bitrate < 0) {\n              Janus.warn('Ignoring invalid bitrate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring bitrate for track:', track);\n              } else {\n                params.encodings[0].maxBitrate = track.bitrate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          if (kind === 'video' && track.framerate) {\n            // Override maximum framerate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring framerate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.framerate) || track.framerate < 0) {\n              Janus.warn('Ignoring invalid framerate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring framerate for track:', track);\n              } else {\n                params.encodings[0].maxFramerate = track.framerate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (track.transforms) {\n            if (sender && track.transforms.sender) {\n              // There's a sender transform, set it on the transceiver sender\n              let senderStreams = null;\n              if (RTCRtpSender.prototype.createEncodedStreams) {\n                senderStreams = sender.createEncodedStreams();\n              } else if (\n                RTCRtpSender.prototype.createAudioEncodedStreams ||\n                RTCRtpSender.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  senderStreams = sender.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  senderStreams = sender.createEncodedVideoStreams();\n                }\n              }\n              if (senderStreams) {\n                Janus.log('Insertable Streams sender transform:', senderStreams);\n                if (senderStreams.readableStream && senderStreams.writableStream) {\n                  senderStreams.readableStream\n                    .pipeThrough(track.transforms.sender)\n                    .pipeTo(senderStreams.writableStream);\n                } else if (senderStreams.readable && senderStreams.writable) {\n                  senderStreams.readable.pipeThrough(track.transforms.sender).pipeTo(senderStreams.writable);\n                }\n              }\n            }\n            if (transceiver && transceiver.receiver && track.transforms.receiver) {\n              // There's a receiver transform, set it on the transceiver receiver\n              let receiverStreams = null;\n              if (RTCRtpReceiver.prototype.createEncodedStreams) {\n                receiverStreams = transceiver.receiver.createEncodedStreams();\n              } else if (\n                RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n                RTCRtpReceiver.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n                }\n              }\n              if (receiverStreams) {\n                Janus.log('Insertable Streams receiver transform:', receiverStreams);\n                if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                  receiverStreams.readableStream\n                    .pipeThrough(track.transforms.receiver)\n                    .pipeTo(receiverStreams.writableStream);\n                } else if (receiverStreams.readable && receiverStreams.writable) {\n                  receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n                }\n              }\n            }\n          }\n        }\n        if (nt && track.dontStop === true) nt.dontStop = true;\n      } else if (track.recv && !transceiver) {\n        // Maybe a new recvonly track\n        transceiver = config.pc.addTransceiver(kind);\n        if (transceiver) {\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (transceiver.receiver && track.transforms && track.transforms.receiver) {\n            // There's a receiver transform, set it on the transceiver receiver\n            let receiverStreams = null;\n            if (RTCRtpReceiver.prototype.createEncodedStreams) {\n              receiverStreams = transceiver.receiver.createEncodedStreams();\n            } else if (\n              RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n              RTCRtpReceiver.prototype.createEncodedVideoStreams\n            ) {\n              if (kind === 'audio') {\n                receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n              } else if (kind === 'video') {\n                receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n              }\n            }\n            if (receiverStreams) {\n              Janus.log('Insertable Streams receiver transform:', receiverStreams);\n              if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                receiverStreams.readableStream\n                  .pipeThrough(track.transforms.receiver)\n                  .pipeTo(receiverStreams.writableStream);\n              } else if (receiverStreams.readable && receiverStreams.writable) {\n                receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n              }\n            }\n          }\n        }\n      }\n      // Get rid of the old track\n      // FIXME We should probably do this *before* capturing the new\n      // track, since this prevents, for instance, just changing the\n      // resolution of the same webcam we're capturing already (the\n      // existing resolution would be returned, or an overconstrained\n      // error). On the other end, closing the track before we capture\n      // the new device means we'd end up with a period of time where\n      // no video is sent (changing device takes some time), and\n      // media would be stopped entirely in case capturing the new\n      // device results in an error. To keep things simpler, we're\n      // doing it after: we can make this configurable in the future.\n      if (trackId && config.myStream) {\n        let rt = null;\n        if (kind === 'audio' && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n          for (let t of config.myStream.getAudioTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing audio track:', rt);\n            }\n          }\n        } else if (kind === 'video' && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n          for (let t of config.myStream.getVideoTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing video track:', rt);\n            }\n          }\n        }\n        if (rt) {\n          // Remove the track and notify the application\n          try {\n            config.myStream.removeTrack(rt);\n            pluginHandle.onlocaltrack(rt, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack on removal for renegotiation', e);\n          }\n          // Close the old track (unless we've been asked not to)\n          if (rt.dontStop !== true) {\n            try {\n              rt.stop();\n            } catch (e) { }\n          }\n        }\n      }\n      if (nt) {\n        // FIXME Add the new track locally\n        config.myStream.addTrack(nt);\n        // Notify the application about the new local track, if any\n        nt.onended = function (ev) {\n          Janus.log('Local track removed:', ev);\n          try {\n            pluginHandle.onlocaltrack(ev.target, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack following end', e);\n          }\n        };\n        try {\n          pluginHandle.onlocaltrack(nt, true);\n        } catch (e) {\n          Janus.error('Error calling onlocaltrack for track add', e);\n        }\n      }\n      // Update the direction of the transceiver\n      if (transceiver) {\n        let curdir = transceiver.direction,\n          newdir = null;\n        let send = nt && transceiver.sender.track,\n          recv = track.recv !== false && transceiver.receiver.track;\n        if (send && recv) newdir = 'sendrecv';\n        else if (send && !recv) newdir = 'sendonly';\n        else if (!send && recv) newdir = 'recvonly';\n        else if (!send && !recv) newdir = 'inactive';\n        if (newdir && newdir !== curdir) {\n          Janus.warn('Changing direction of transceiver to ' + newdir + ' (was ' + curdir + ')', track);\n          if (transceiver.setDirection) transceiver.setDirection(newdir);\n          else transceiver.direction = newdir;\n        }\n      }\n    }\n    if (openedConsentDialog) pluginHandle.consentDialog(false);\n  }\n\n  function getLocalTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.sender && tr.sender.track) {\n        track = { mid: tr.mid };\n        track.type = tr.sender.track.kind;\n        track.id = tr.sender.track.id;\n        track.label = tr.sender.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getRemoteTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.receiver && tr.receiver.track) {\n        track = { mid: tr.mid };\n        track.type = tr.receiver.track.kind;\n        track.id = tr.receiver.track.id;\n        track.label = tr.receiver.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getVolume(handleId, mid, remote, result) {\n    result = typeof result == 'function' ? result : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      result(0);\n      return;\n    }\n    let stream = remote ? 'remote' : 'local';\n    let config = pluginHandle.webrtcStuff;\n    if (!config.volume[stream]) config.volume[stream] = { value: 0 };\n    // Start getting the volume, if audioLevel in getStats is supported (apparently\n    // they're only available in Chrome/Safari right now: https://webrtc-stats.callstats.io/)\n    if (\n      config.pc &&\n      config.pc.getStats &&\n      (Janus.webRTCAdapter.browserDetails.browser === 'chrome' ||\n        Janus.webRTCAdapter.browserDetails.browser === 'safari')\n    ) {\n      // Are we interested in a mid in particular?\n      let query = config.pc;\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          result(0);\n          return;\n        }\n        if (remote && !transceiver.receiver) {\n          Janus.warn('Remote transceiver track unavailable');\n          result(0);\n          return;\n        } else if (!remote && !transceiver.sender) {\n          Janus.warn('Local transceiver track unavailable');\n          result(0);\n          return;\n        }\n        query = remote ? transceiver.receiver : transceiver.sender;\n      }\n      query.getStats().then(function (stats) {\n        stats.forEach(function (res) {\n          if (!res || res.kind !== 'audio') return;\n          if ((remote && !res.remoteSource) || (!remote && res.type !== 'media-source')) return;\n          result(res.audioLevel ? res.audioLevel : 0);\n        });\n      });\n      return config.volume[stream].value;\n    } else {\n      // audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n      // seems to be available on Chrome and Firefox, but they don't seem to work\n      Janus.warn('Getting the ' + stream + ' volume unsupported by browser');\n      result(0);\n      return;\n    }\n  }\n\n  function isMuted(handleId, mid, video) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return true;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return true;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return true;\n    }\n    if (video) {\n      // Check video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getVideoTracks()[0].enabled;\n      }\n    } else {\n      // Check audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getAudioTracks()[0].enabled;\n      }\n    }\n  }\n\n  function mute(handleId, mid, video, mute) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return false;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return false;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return false;\n    }\n    if (video) {\n      // Mute/unmute video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const videostream of config.myStream.getVideoTracks()) {\n          videostream.enabled = !mute;\n        }\n      }\n    } else {\n      // Mute/unmute audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const audiostream of config.myStream.getAudioTracks()) {\n          audiostream.enabled = !mute;\n        }\n      }\n    }\n    return true;\n  }\n\n  function getBitrate(handleId, mid) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) return 'Invalid PeerConnection';\n    // Start getting the bitrate, if getStats is supported\n    if (config.pc.getStats) {\n      let query = config.pc;\n      let target = mid ? mid : 'default';\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return 'No video transceiver with mid ' + mid;\n        }\n        if (!transceiver.receiver) {\n          Janus.warn('No video receiver with mid ' + mid);\n          return 'No video receiver with mid ' + mid;\n        }\n        query = transceiver.receiver;\n      }\n      if (!config.bitrate[target]) {\n        config.bitrate[target] = {\n          timer: null,\n          bsnow: null,\n          bsbefore: null,\n          tsnow: null,\n          tsbefore: null,\n          value: '0 kbits/sec',\n        };\n      }\n      if (!config.bitrate[target].timer) {\n        Janus.log('Starting bitrate timer' + (mid ? ' for mid ' + mid : '') + ' (via getStats)');\n        config.bitrate[target].timer = setInterval(function () {\n          query.getStats().then(function (stats) {\n            stats.forEach(function (res) {\n              if (!res) return;\n              let inStats = false;\n              // Check if these are statistics on incoming media\n              if (\n                (res.mediaType === 'video' || res.id.toLowerCase().indexOf('video') > -1) &&\n                res.type === 'inbound-rtp' &&\n                res.id.indexOf('rtcp') < 0\n              ) {\n                // New stats\n                inStats = true;\n              } else if (\n                res.type == 'ssrc' &&\n                res.bytesReceived &&\n                (res.googCodecName === 'VP8' || res.googCodecName === '')\n              ) {\n                // Older Chromer versions\n                inStats = true;\n              }\n              // Parse stats now\n              if (inStats) {\n                config.bitrate[target].bsnow = res.bytesReceived;\n                config.bitrate[target].tsnow = res.timestamp;\n                if (config.bitrate[target].bsbefore === null || config.bitrate[target].tsbefore === null) {\n                  // Skip this round\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                } else {\n                  // Calculate bitrate\n                  let timePassed = config.bitrate[target].tsnow - config.bitrate[target].tsbefore;\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') timePassed = timePassed / 1000; // Apparently the timestamp is in microseconds, in Safari\n                  let bitRate = Math.round(\n                    ((config.bitrate[target].bsnow - config.bitrate[target].bsbefore) * 8) / timePassed\n                  );\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') bitRate = parseInt(bitRate / 1000);\n                  config.bitrate[target].value = bitRate + ' kbits/sec';\n                  //~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                }\n              }\n            });\n          });\n        }, 1000);\n        return '0 kbits/sec'; // We don't have a bitrate value yet\n      }\n      return config.bitrate[target].value;\n    } else {\n      Janus.warn('Getting the video bitrate unsupported by browser');\n      return 'Feature unsupported by browser';\n    }\n  }\n\n  function setBitrate(handleId, mid, bitrate) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid);\n    if (!transceiver) {\n      Janus.warn('No transceiver with mid', mid);\n      return;\n    }\n    if (!transceiver.sender) {\n      Janus.warn('No sender for transceiver with mid', mid);\n      return;\n    }\n    let params = transceiver.sender.getParameters();\n    if (!params || !params.encodings || params.encodings.length === 0) {\n      Janus.warn('No parameters encodings');\n    } else if (params.encodings.length > 1) {\n      Janus.warn('Ignoring bitrate for simulcast track, use sendEncodings for that');\n    } else if (isNaN(bitrate) || bitrate < 0) {\n      Janus.warn('Invalid bitrate (must be a positive integer)');\n    } else {\n      params.encodings[0].maxBitrate = bitrate;\n      transceiver.sender.setParameters(params);\n    }\n  }\n\n  function webrtcError(error) {\n    Janus.error('WebRTC error:', error);\n  }\n\n  function cleanupWebrtc(handleId, hangupRequest) {\n    Janus.log('Cleaning WebRTC stuff');\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle) {\n      // Nothing to clean\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config) {\n      if (hangupRequest === true) {\n        // Send a hangup request (we don't really care about the response)\n        let request = { janus: 'hangup', transaction: Janus.randomString(12) };\n        if (pluginHandle.token) request['token'] = pluginHandle.token;\n        if (apisecret) request['apisecret'] = apisecret;\n        Janus.debug('Sending hangup request (handle=' + handleId + '):');\n        Janus.debug(request);\n        if (websockets) {\n          request['session_id'] = sessionId;\n          request['handle_id'] = handleId;\n          ws.send(JSON.stringify(request));\n        } else {\n          Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n            verb: 'POST',\n            withCredentials: withCredentials,\n            body: request,\n          });\n        }\n      }\n      // Cleanup stack\n      if (config.volume) {\n        if (config.volume['local'] && config.volume['local'].timer) clearInterval(config.volume['local'].timer);\n        if (config.volume['remote'] && config.volume['remote'].timer) clearInterval(config.volume['remote'].timer);\n      }\n      for (let i in config.bitrate) {\n        if (config.bitrate[i].timer) clearInterval(config.bitrate[i].timer);\n      }\n      config.bitrate = {};\n      if (!config.streamExternal && config.myStream) {\n        Janus.log('Stopping local stream tracks');\n        Janus.stopAllTracks(config.myStream);\n      }\n      config.streamExternal = false;\n      config.myStream = null;\n      // Close PeerConnection\n      try {\n        config.pc.close();\n      } catch (e) {\n        // Do nothing\n      }\n      config.pc = null;\n      config.candidates = null;\n      config.mySdp = null;\n      config.remoteSdp = null;\n      config.iceDone = false;\n      config.dataChannel = {};\n      config.dtmfSender = null;\n      config.insertableStreams = false;\n    }\n    pluginHandle.oncleanup();\n  }\n\n  function isTrickleEnabled(trickle) {\n    Janus.debug('isTrickleEnabled:', trickle);\n    return trickle === false ? false : true;\n  }\n}\n\nmodule.exports = Janus;\n","import type { Config, Janus } from '../types';\nimport { JanusDebugMode, JanusEvent, JanusMediaTrackReason } from '../types/enums';\nimport { adapter, MediaStream } from '@platform';\nimport EventEmitter from 'eventemitter3';\nimport config from '../config';\nimport JanusEngine from './janus.js';\nimport Utils from '../Utils';\n\nexport default class JanusClient {\n  public token: Config.Credentials['token'];\n  public server: Config.Conference['server'];\n  public debug: Config.JanusDebug;\n  public engine!: JanusEngine;\n  public videoRoomPlugin: any = null;\n  public isOnlyAudio: boolean = false;\n  public currentRoomId: string | null = null;\n  public currentUserId: number | string | null = null;\n  public remoteFeeds: { [userId: number | string]: any } = {};\n  public remoteJseps: { [userId: number | string]: any } = {};\n  public remoteFeedsAttachingInProgress: { [userId: number | string]: any } = {};\n  public bitrateTimers: { [userId: number | string]: NodeJS.Timeout | number | null } = {};\n  public emitter: EventEmitter = new EventEmitter();\n\n  constructor(token: Config.Credentials['token']) {\n    if (!Utils.env.isReactNative && !adapter) {\n      throw 'Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter';\n    }\n\n    this.token = token;\n    this.server = config.conference.server;\n    this.debug = config.conference.debug ?? JanusDebugMode.ALL;\n\n    if (!this.server) {\n      throw \"'server' parameter is mandatory\";\n    } else if (this.server.includes('http')) {\n      this.server += '/janus';\n    }\n  }\n\n  public createSession({\n    success = () => {},\n    error = () => {},\n    destroyed = () => {},\n    timeoutSessionCallback = () => {},\n  }: Janus.InitCallbacks): void {\n    JanusEngine.init({\n      debug: this.debug,\n      callback: () => {\n        if (!JanusEngine.isWebrtcSupported()) {\n          Utils.safeCallbackCall(error)(`Your browser does not support WebRTC, so you can't use this functionality.`);\n          return;\n        }\n\n        this.engine = new JanusEngine({\n          server: this.server,\n          iceServers: config.videochat.iceServers,\n          token: this.token,\n          success: () => Utils.safeCallbackCall(success)(),\n          error: (err) => Utils.safeCallbackCall(error)(err),\n          destroyed: () => Utils.safeCallbackCall(destroyed)(),\n          timeoutSessionCallback: () => Utils.safeCallbackCall(timeoutSessionCallback)(),\n        });\n      },\n    });\n  }\n\n  public getSessionId(): string | null {\n    return this.engine?.getSessionId() ?? null;\n  }\n\n  public destroySession({ success = () => {}, error = () => {} }: Janus.SuccessErrorCallbacks): void {\n    this.engine.destroy({\n      success: () => Utils.safeCallbackCall(success)(),\n      error: (err) => Utils.safeCallbackCall(error)(err),\n    });\n  }\n\n  public attachVideoConferencingPlugin(\n    isRemote: boolean,\n    userId: number,\n    skipMedia: boolean,\n    callbacks: Janus.PluginCallbacks\n  ): void {\n    let remoteFeed: any = null;\n\n    const localStream = callbacks.localStream;\n    delete callbacks.localStream;\n\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.engine.attach({\n      plugin: 'janus.plugin.videoroom',\n      success: (pluginHandle) => {\n        if (isRemote) {\n          remoteFeed = pluginHandle;\n          remoteFeed.userId = userId;\n          this.remoteFeedsAttachingInProgress[userId] = remoteFeed;\n\n          const listen = {\n            request: 'join',\n            room: this.currentRoomId,\n            ptype: 'listener',\n            feed: userId,\n            display: displayName,\n          };\n\n          remoteFeed?.send({ message: listen });\n        } else {\n          this.videoRoomPlugin = pluginHandle;\n        }\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n      consentDialog: (on) => {\n        Utils.safeCallbackCall(callbacks.consentDialog)(on);\n      },\n      mediaState: (medium, on) => {\n        Utils.safeCallbackCall(callbacks.mediaState)(medium, on);\n      },\n      webrtcState: (on) => {\n        Utils.safeCallbackCall(callbacks.webrtcState)(on);\n      },\n      slowLink: (uplink, nacks) => {\n        Utils.safeCallbackCall(callbacks.slowLink)(uplink, nacks);\n      },\n      iceState: (iceConnectionState) => {\n        Utils.safeCallbackCall(callbacks.iceState)(iceConnectionState);\n      },\n      onmessage: (msg, jsep) => {\n        const event = msg['videoroom'];\n\n        if (isRemote) {\n          if (event) {\n            // Remote feed attached\n            if (event === 'attached') {\n              const feedId = msg['id'];\n              this.remoteFeeds[feedId] = this.remoteFeedsAttachingInProgress[feedId];\n              this.remoteFeedsAttachingInProgress[feedId] = null;\n            } else if (msg['error']) {\n              Utils.safeCallbackCall(callbacks.error)(msg['error']);\n            }\n          }\n\n          if (jsep) {\n            const feedId = msg['id'];\n\n            // ICE restart case\n            if (!feedId) {\n            }\n\n            this.remoteJseps[feedId] = jsep;\n\n            this.createAnswer(\n              {\n                remoteFeed: this.remoteFeeds[feedId],\n                jsep,\n              },\n              localStream as MediaStream,\n              {\n                success: () => {},\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              }\n            );\n          }\n\n          // local feed\n        } else {\n          if (event) {\n            // We JOINED\n            if (event === 'joined') {\n              const media = skipMedia ? { audio: false, video: false } : { audio: true, video: true };\n              const existedStream = skipMedia ? undefined : localStream;\n              const offerParams = { media, stream: existedStream };\n              this.createOffer(offerParams, {\n                success: () => {\n                  if (msg['publishers']) {\n                    const publishers = msg['publishers'];\n                    for (const f in publishers) {\n                      const userId = publishers[f]['id'];\n                      const userDisplayName = publishers[f]['display'];\n                      this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, true);\n                    }\n                  }\n                },\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              });\n\n              // We JOINED and now receiving who is online\n            } else if (event === 'event') {\n              // Any new feed to attach to?\n              if (msg['publishers']) {\n                const publishers = msg['publishers'];\n\n                for (const f in publishers) {\n                  const userId = publishers[f]['id'];\n                  const userDisplayName = publishers[f]['display'];\n\n                  this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, false);\n                }\n\n                // Someone is LEAVING\n              } else if (msg['leaving']) {\n                // One of the publishers has gone away?\n                const feedId = msg['leaving'];\n                const success = this.detachRemoteFeed(feedId);\n                if (success) {\n                  this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                }\n              } else if (msg['unpublished']) {\n                // One of the publishers has gone away?\n                const feedId = msg['unpublished'];\n                if (feedId != 'ok') {\n                  const success = this.detachRemoteFeed(feedId);\n                  if (success) {\n                    this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                  }\n                }\n              } else if (msg['error']) {\n                Utils.DLog('[janus error message]', msg['error']);\n                // #define VIDEOROOM_ERROR_ID_EXISTS\t\t\t436\n                // #define VIDEOROOM_ERROR_UNAUTHORIZED\t\t433\n                //\n                this.emitter.emit(JanusEvent.ERROR, msg);\n                Utils.safeCallbackCall(callbacks.error)(msg['error']);\n              }\n            }\n          }\n\n          if (jsep) {\n            this.videoRoomPlugin.handleRemoteJsep({ jsep: jsep });\n\n            // TODO:\n            // handle wrong or unsupported codecs here...\n            // const video = msg['video_codec']\n            // if(mystream && mystream.getVideoTracks() && mystream.getVideoTracks().length > 0 && !video) {\n            // \t\t'Our video stream has been rejected, viewers won't see us'\n            // }\n          }\n        }\n      },\n      onlocaltrack: (track, on) => {\n        Utils.DLog('[onlocaltrack]', track, on);\n        this.onLocalTrack(track, on);\n      },\n      onremotetrack: (track, mid, on, metadata) => {\n        Utils.DLog('[onremotetrack]', track, mid, on, metadata);\n        this.onRemoteTrack(remoteFeed, track, mid, on, metadata);\n      },\n      ondataopen: (channelLabel) => {\n        Utils.DLog('[ondataopen]', channelLabel);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_OPEN, channelLabel);\n      },\n      ondata: (data, channelLabel) => {\n        Utils.DLog('[ondata]', channelLabel, data);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_MESSAGE, channelLabel, data);\n      },\n      oncleanup: () => {\n        Utils.safeCallbackCall(callbacks.oncleanup)();\n      },\n      detached: () => {},\n    });\n  }\n\n  public onLocalTrack(track: MediaStreamTrack, on: any): void {\n    // this.emitter.emit(JanusEvent.LOCAL_STREAM, track);\n  }\n\n  public onRemoteTrack(remoteFeed: any, track: MediaStreamTrack, mid: any, on: any, metadata: any): void {\n    const eventType = metadata && metadata.reason;\n\n    if (eventType === JanusMediaTrackReason.CREATED) {\n      const isStreamNoExistedBefore = !remoteFeed.stream || !remoteFeed.tracks;\n      if (isStreamNoExistedBefore) {\n        remoteFeed.tracks = { [mid]: track };\n        remoteFeed.stream = new MediaStream([track]);\n      } else {\n        remoteFeed.tracks[mid] = track;\n        remoteFeed.stream.addTrack(track);\n      }\n      if (isStreamNoExistedBefore) {\n        this.emitter.emit(JanusEvent.REMOTE_STREAM, remoteFeed.userId, remoteFeed.stream);\n      }\n    } else if (eventType === JanusMediaTrackReason.ENDED) {\n      delete remoteFeed.tracks[mid];\n\n      const trackToRemove = remoteFeed.stream.getTracks().find((streamTrack) => streamTrack.kind === track.kind);\n      remoteFeed.stream.removeTrack(trackToRemove);\n    }\n\n    this.emitter.emit(JanusEvent.REMOTE_TRACKS_UPDATED, remoteFeed.userId, track, eventType);\n  }\n\n  public getPluginId(): string | null {\n    return this.videoRoomPlugin?.getId() ?? null;\n  }\n\n  public detachVideoConferencingPlugin(callbacks: Janus.SuccessErrorCallbacks): void {\n    const clean = () => {\n      this.videoRoomPlugin = null;\n\n      // detach all remote feeds\n      Object.keys(this.remoteFeeds).forEach((userId) => {\n        this.detachRemoteFeed(Number(userId));\n      });\n\n      this.remoteFeeds = {};\n      this.remoteJseps = {};\n      /*\n       * Deprecated\n      this.currentMediaDeviceId = null\n       */\n    };\n\n    this.videoRoomPlugin.detach({\n      success: () => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public join(roomId: string, userId: number, isOnlyAudio: boolean, callbacks: Janus.RequestCallbacks): void {\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.isOnlyAudio = isOnlyAudio;\n\n    Utils.DLog('isOnlyAudio: ' + this.isOnlyAudio);\n\n    const joinEvent = {\n      request: 'join',\n      room: roomId,\n      ptype: 'publisher',\n      id: userId,\n      display: displayName,\n    };\n\n    this.videoRoomPlugin.send({\n      message: joinEvent,\n      success: (resp) => {\n        this.currentRoomId = roomId;\n        this.currentUserId = userId;\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public leave(callbacks: Janus.RequestCallbacks): void {\n    Utils.DLog('leave');\n\n    if (!this.engine.isConnected()) {\n      Utils.safeCallbackCall(callbacks.success)();\n      return;\n    }\n\n    const leaveEvent = {\n      request: 'leave',\n      room: this.currentRoomId,\n      id: this.currentUserId,\n    };\n\n    if (this.videoRoomPlugin) {\n      this.videoRoomPlugin.send({ message: leaveEvent });\n    }\n    this.currentRoomId = null;\n    this.currentUserId = null;\n\n    Utils.safeCallbackCall(callbacks.success)();\n  }\n\n  public listOnlineParticipants(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const listRequest = { request: 'listparticipants', room: roomId };\n\n    this.videoRoomPlugin.send({\n      message: listRequest,\n      success: (data) => {\n        const participants = data ? data.participants : [];\n        Utils.safeCallbackCall(callbacks.success)(participants);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public toggleAudioMute(): boolean {\n    const muted = this.videoRoomPlugin.isAudioMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteAudio();\n    } else {\n      this.videoRoomPlugin.muteAudio();\n    }\n    return this.videoRoomPlugin.isAudioMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    try {\n      return this.videoRoomPlugin.isAudioMuted();\n    } catch (e) {\n      throw 'Unknown audio mute/unmute state. Join the room to manage these settings';\n    }\n  }\n\n  public toggleRemoteAudioMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      for (let i = 0; i < audioTracks.length; ++i) {\n        audioTracks[i].enabled = !audioTracks[i].enabled;\n      }\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteAudioMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public toggleVideoMute(): boolean {\n    const muted = this.videoRoomPlugin.isVideoMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteVideo();\n    } else {\n      this.videoRoomPlugin.muteVideo();\n    }\n    return this.videoRoomPlugin.isVideoMuted();\n  }\n\n  public isVideoMuted(): boolean {\n    try {\n      return this.videoRoomPlugin.isVideoMuted();\n    } catch (e) {\n      throw 'Unknown video mute/unmute state. Join the room to manage these settings';\n    }\n  }\n\n  public toggleRemoteVideoMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      for (let i = 0; i < videoTracks.length; ++i) {\n        videoTracks[i].enabled = !videoTracks[i].enabled;\n      }\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteVideoMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public sendKeyframeRequest(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const configureRequest = {\n      request: 'configure',\n      room: roomId,\n      keyframe: true,\n    };\n\n    this.videoRoomPlugin.send({\n      message: configureRequest,\n      success: (response) => {\n        Utils.safeCallbackCall(callbacks.success)(response);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public getTracksFromStream(stream: MediaStream): { type: string; capture: MediaStreamTrack; recv: boolean }[] {\n    const tracks: { type: string; capture: MediaStreamTrack; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', capture: audioTrack, recv: false });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', capture: videoTrack, recv: false });\n    }\n\n    return tracks;\n  }\n\n  public createOffer(\n    mediaParams: { stream?: MediaStream; media: { audio: boolean; video: boolean }; replace?: boolean },\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createOffer]', mediaParams);\n\n    const { stream: existedStream, media, replace } = mediaParams;\n\n    const createOfferParams: any = { tracks: [{ type: 'data' }] };\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksFromStream(existedStream);\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromStream);\n    } else if (media) {\n      const tracksFromParams: { type: string; capture: boolean; recv: boolean; replace: boolean }[] = [];\n      if (media.audio) {\n        tracksFromParams.push({\n          type: 'audio',\n          capture: media.audio,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      if (media.video) {\n        tracksFromParams.push({\n          type: 'video',\n          capture: media.video,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromParams);\n    } else {\n      createOfferParams.tracks = createOfferParams.tracks.concat([\n        { type: 'audio', capture: true, recv: false, replace: !!replace },\n        { type: 'video', capture: true, recv: false, replace: !!replace },\n      ]);\n    }\n\n    Utils.DLog('[JanusWrapper][createOffer][params]', createOfferParams);\n\n    createOfferParams.customizeSdp = (jsep) => {};\n\n    createOfferParams.success = (jsep) => {\n      const publish = {\n        request: 'configure',\n        audio: !!media.audio,\n        video: !!media.video,\n      };\n      Utils.DLog('[JanusWrapper][createOffer][success]', publish);\n\n      this.videoRoomPlugin.send({ message: publish, jsep: jsep });\n\n      Utils.safeCallbackCall(callbacks.success)();\n    };\n\n    createOfferParams.error = (error) => {\n      Utils.DLog('[JanusWrapper][createOffer][error]', error);\n      if (media.audio) {\n        this.createOffer({ media: { video: false, audio: false } }, callbacks);\n      } else {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      }\n    };\n\n    this.videoRoomPlugin.createOffer(createOfferParams);\n  }\n\n  public getTracksMidsFromStream(stream: MediaStream): { type: string; mid: string; recv: boolean }[] {\n    const tracks: { type: string; mid: string; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', mid: audioTrack.id, recv: true });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', mid: videoTrack.id, recv: true });\n    }\n\n    return tracks;\n  }\n\n  public createAnswer(\n    { remoteFeed, jsep }: any,\n    existedStream: MediaStream,\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createAnswer]', jsep, existedStream);\n    let tracks: any = [{ type: 'data' }];\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksMidsFromStream(existedStream);\n      tracks = tracks.concat(tracksFromStream);\n    }\n\n    Utils.DLog('[JanusWrapper][createAnswer][tracks]', tracks);\n\n    remoteFeed.createAnswer({\n      jsep: jsep,\n      tracks: tracks,\n      success: (jsep) => {\n        const body = { request: 'start', room: this.currentRoomId };\n        Utils.DLog('[JanusWrapper][createAnswer][success]', body);\n\n        remoteFeed.send({ message: body, jsep: jsep });\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.DLog('[JanusWrapper][createAnswer][error]', error);\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public detachRemoteFeed(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (remoteFeed) {\n      remoteFeed.detach();\n      this.remoteFeeds[userId] = null;\n      this.remoteJseps[userId] = null;\n      return true;\n    }\n    return false;\n  }\n\n  public getUserBitrate(userId: number): any {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getBitrate();\n  }\n\n  public getVolume(resultCallback: (value: any) => void): void {\n    return this.videoRoomPlugin.getLocalVolume(null, resultCallback);\n  }\n\n  public getUserVolume(userId: number, resultCallback: (value: any) => void): void {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getRemoteVolume(null, resultCallback);\n  }\n\n  public showBitrate(userId: number, element: any): void {\n    const remoteFeed = this.remoteFeeds[userId];\n\n    if (\n      !Utils.env.isReactNative &&\n      (adapter.browserDetails.browser === 'chrome' || adapter.browserDetails.browser === 'firefox')\n    ) {\n      this.bitrateTimers[userId] = setInterval(() => {\n        const bitrate = remoteFeed.getBitrate();\n        element.text(bitrate);\n      }, 1000);\n    }\n  }\n\n  public hideBitrate(userId: number, element: any): void {\n    if (this.bitrateTimers[userId]) {\n      clearInterval(this.bitrateTimers[userId]);\n    }\n    this.bitrateTimers[userId] = null;\n    element.text = null;\n  }\n\n  public on(eventType: JanusEvent, listener: (...args: any[]) => void): EventEmitter {\n    return this.emitter.addListener(eventType, listener);\n  }\n\n  public removeAllListeners(eventType?: JanusEvent): EventEmitter {\n    return this.emitter.removeAllListeners(eventType);\n  }\n}\n","import type { Auth, Janus, Media } from '../types';\nimport { JanusCallType, JanusEvent } from '../types/enums';\nimport { mediaDevices } from '@platform';\nimport Utils from '../Utils';\nimport JanusClient from './JanusClient';\n\nexport default class ConferenceSession {\n  private client: JanusClient;\n  public id: string = `${Math.random()}`;\n  public currentUserDisplayName?: string;\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public onParticipantJoinedListener!: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener!: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener!: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener!: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener!: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener!: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener!: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener!: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener!: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener!: Janus.OnErrorListener;\n\n  constructor(token: Auth.Session['token']) {\n    this.client = new JanusClient(token);\n    this.client.on(JanusEvent.PARTICIPANT_JOINED, this.onParticipantJoined);\n    this.client.on(JanusEvent.PARTICIPANT_LEFT, this.onParticipantLeft);\n    this.client.on(JanusEvent.REMOTE_STREAM, this.onRemoteStream);\n    this.client.on(JanusEvent.REMOTE_TRACKS_UPDATED, this.onRemoteTracksUpdated);\n    this.client.on(JanusEvent.DATA_CHANNEL_OPEN, this.onDataChannelOpen);\n    this.client.on(JanusEvent.DATA_CHANNEL_MESSAGE, this.onDataChannelMessage);\n    this.client.on(JanusEvent.ERROR, this.onError);\n  }\n\n  get currentRoomId(): string | null {\n    return this.client.currentRoomId;\n  }\n\n  set currentRoomId(roomId: string | null) {\n    this.client.currentRoomId = roomId;\n  }\n\n  get currentPublisherPC() {\n    return this.client.videoRoomPlugin.webrtcStuff.pc;\n  }\n\n  private async createSession(): Promise<void> {\n    let isResolved = false;\n\n    return new Promise((resolve, reject) => {\n      this.client.createSession({\n        success: () => {\n          isResolved = true;\n          resolve(void 0);\n        },\n        error: (error) => {\n          if (isResolved) {\n            this.onError(error);\n          } else {\n            reject(error);\n          }\n        },\n      });\n    });\n  }\n\n  // joinAsPublisher+Listener\n  public async join(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, false);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async joinAsListener(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, true);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async sendKeyframeRequest(roomId: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.sendKeyframeRequest(roomId, {\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  private async createHandler(user_id: number, isRemote: boolean, skipMedia: boolean = false): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.attachVideoConferencingPlugin(isRemote, user_id, skipMedia, {\n        success: resolve,\n        error: reject,\n        iceState: isRemote\n          ? (iceState) => this.onRemoteIceStateChanged(user_id, iceState)\n          : (iceState) => this.onLocalIceStateChanged(iceState),\n        slowLink: isRemote\n          ? (uplink, nacks) => this.onSlowLink(user_id, uplink, nacks)\n          : (uplink, nacks) => this.onSlowLink(null, uplink, nacks),\n        localStream: this.localStream,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private async joinInternal(roomId: string, user_id: number): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.join(roomId, user_id, false, {\n        success: resolve,\n        error: reject,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private onParticipantJoined = (user_id: number, userDisplayName: string, isExistingParticipant: boolean): void => {\n    Utils.DLog('[onParticipantJoined]', user_id, userDisplayName, isExistingParticipant);\n    this.createHandler(user_id, true, false);\n    Utils.safeCallbackCall(this.onParticipantJoinedListener)(this, user_id, userDisplayName, isExistingParticipant);\n  };\n\n  private onParticipantLeft = (user_id: number, userDisplayName: string): void => {\n    Utils.DLog('[onParticipantLeft]', user_id, userDisplayName);\n    Utils.safeCallbackCall(this.onParticipantLeftListener)(this, user_id, userDisplayName);\n  };\n\n  private onError = (error: any): void => {\n    Utils.DLog('[onError]', JSON.stringify(error));\n    Utils.safeCallbackCall(this.onErrorListener)(this, error);\n  };\n\n  private onDataChannelOpen = (label: any): void => {\n    Utils.DLog('[onDataChannelOpen]', label);\n    Utils.safeCallbackCall(this.onDataChannelOpenedListener)(this, label);\n  };\n\n  private onDataChannelMessage = (user_id: number, data: any): void => {\n    Utils.DLog('[onDataChannelMessage]', user_id, data);\n    Utils.safeCallbackCall(this.onDataChannelMessageListener)(this, user_id, data);\n  };\n\n  private onLocalIceStateChanged = (iceState: any): void => {\n    Utils.DLog('[onLocalIceStateChanged]', iceState);\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, iceState);\n  };\n\n  private onRemoteIceStateChanged = (user_id: number, iceState: any): void => {\n    Utils.DLog('[onRemoteIceStateChanged]', user_id, iceState);\n    Utils.safeCallbackCall(this.onRemoteConnectionStateChangedListener)(this, user_id, iceState);\n  };\n\n  private onRemoteStream = (user_id: number, stream: MediaStream): void => {\n    Utils.DLog('[onRemoteStream]', user_id, stream);\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, user_id, stream);\n  };\n\n  private onRemoteTracksUpdated = (user_id: number, track: MediaStreamTrack, eventType: any): void => {\n    Utils.DLog('[onRemoteTracksUpdated]', user_id, track, eventType);\n    Utils.safeCallbackCall(this.onRemoteTracksUpdatedListener)(this, user_id, track, eventType);\n  };\n\n  private onSlowLink = (user_id: number | null, uplink: any, nacks: any): void => {\n    Utils.DLog('[onSlowLink]', user_id, uplink, nacks);\n    Utils.safeCallbackCall(this.onSlowLinkListener)(this, user_id, uplink, nacks);\n  };\n\n  public async listOfOnlineParticipants(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      if (this.currentRoomId) {\n        this.client.listOnlineParticipants(this.currentRoomId, {\n          success: resolve,\n          error: reject,\n        });\n      } else {\n        reject('Room ID is not set');\n      }\n    });\n  }\n\n  public async leave(): Promise<void> {\n    this.currentRoomId = null;\n    this.currentUserDisplayName = undefined;\n    await this.leaveGroup();\n    await this.detachVideoConferencingPlugin();\n    await this.destroy();\n\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public async leaveGroup(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.leave({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async destroy(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.destroySession({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async detachVideoConferencingPlugin(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.detachVideoConferencingPlugin({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(\n    stream: MediaStream,\n    elementId: string | null = null,\n    options: Media.ElementOptions = {}\n  ): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    this.localStream.getTracks().forEach((track) => {\n      const type = track.kind;\n      const deviceId = track.getSettings().deviceId;\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] === 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === JanusCallType.AUDIO && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      const pcSenders = this.currentPublisherPC.getSenders();\n      const sender = pcSenders.find(({ track }) => newTrack.kind === track.kind);\n\n      if (newTrack.kind === JanusCallType.AUDIO) {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (sender) {\n        sender.replaceTrack(newTrack);\n        this.localStream?.addTrack(newTrack);\n      } else {\n        console.warn(`No sender found for track kind: ${newTrack.kind}`);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds): Promise<MediaStream> {\n    [JanusCallType.AUDIO, JanusCallType.VIDEO].forEach((type) => {\n      const device = type === JanusCallType.AUDIO ? options.audio : type === JanusCallType.VIDEO ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : (device?.deviceId ?? null);\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] === 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const mediaParams = {\n        audio: this.mediaParams?.audio ?? false,\n        video: this.mediaParams?.video ?? false,\n      };\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      return this.replaceTracks(stream);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public muteVideo(): void {\n    if (!this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public unmuteVideo(): void {\n    if (this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public muteAudio(): void {\n    if (!this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public unmuteAudio(): void {\n    if (this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public isVideoMuted(): boolean {\n    return this.client.isVideoMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    return this.client.isAudioMuted();\n  }\n\n  public async getUserVolume(): Promise<any> {\n    return new Promise((resolve, _reject) => {\n      return this.client.getVolume(resolve);\n    });\n  }\n\n  public getRemoteUserBitrate(userId: number): any {\n    return this.client.getUserBitrate(userId);\n  }\n\n  public async getRemoteUserVolume(userId: number): Promise<any> {\n    return new Promise((resolve, reject) => {\n      return this.client.getUserVolume(userId, resolve);\n    });\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = async (_event: Event) => {\n        try {\n          await mediaElement.play();\n        } catch (error) {\n          console.error('[VideoChatConference]:', error);\n        }\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions) {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async sendData(data: any, label: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.videoRoomPlugin.data({\n        data,\n        label,\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n}\n","import type { Janus } from '../types';\nimport { JanusCallType, ConferenceEvent, DeviceInputType } from '../types/enums';\nimport { mediaDevices } from '@platform';\nimport ConferenceSession from './ConferenceSession';\nimport ProxyService from '../Proxy';\n\nexport default class ConferenceClient {\n  public proxy: ProxyService;\n  public DeviceInputType: typeof DeviceInputType = DeviceInputType;\n  public JanusCallType: typeof JanusCallType = JanusCallType;\n  public sessionsStore: { [id: ConferenceSession['id']]: ConferenceSession } = {};\n  public onParticipantJoinedListener!: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener!: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener!: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener!: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener!: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener!: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener!: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener!: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener!: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener!: Janus.OnErrorListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  createNewSession() {\n    const session = new ConferenceSession(this.getCurrentSessionToken());\n\n    this.sessionsStore[session.id] = session;\n    session.onParticipantJoinedListener = this.onParticipantJoinedListener;\n    session.onParticipantLeftListener = this.onParticipantLeftListener;\n    session.onSlowLinkListener = this.onSlowLinkListener;\n    session.onRemoteStreamListener = this.onRemoteStreamListener;\n    session.onRemoteTracksUpdatedListener = this.onRemoteTracksUpdatedListener;\n    session.onRemoteConnectionStateChangedListener = this.onRemoteConnectionStateChangedListener;\n    session.onDataChannelOpenedListener = this.onDataChannelOpenedListener;\n    session.onDataChannelMessageListener = this.onDataChannelMessageListener;\n    session.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    session.onErrorListener = this.onErrorListener;\n\n    return session;\n  }\n\n  public async getMediaDevices(kind?: DeviceInputType): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public clearSession(session_id: ConferenceSession['id']): void {\n    delete this.sessionsStore[session_id];\n  }\n\n  public getCurrentSessionToken(): string {\n    const currentSession = this.proxy.getSession();\n\n    if (currentSession?.token) {\n      return currentSession.token;\n    } else {\n      throw new Error('Session does not exist');\n    }\n  }\n\n  private getListenerByName(name: ConferenceEvent): Janus.ListenerName | null {\n    switch (name) {\n      case ConferenceEvent.JOIN:\n        return 'onParticipantJoinedListener';\n      case ConferenceEvent.LEFT:\n        return 'onParticipantLeftListener';\n      case ConferenceEvent.SLOW_LINK:\n        return 'onSlowLinkListener';\n      case ConferenceEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case ConferenceEvent.REMOTE_TRACKS_UPDATED:\n        return 'onRemoteTracksUpdatedListener';\n      case ConferenceEvent.REMOTE_CONNECTION_STATE:\n        return 'onRemoteConnectionStateChangedListener';\n      case ConferenceEvent.DATA_CHANNEL_OPENED:\n        return 'onDataChannelOpenedListener';\n      case ConferenceEvent.DATA_CHANNEL_MESSAGE:\n        return 'onDataChannelMessageListener';\n      case ConferenceEvent.SESSION_CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case ConferenceEvent.ERROR:\n        return 'onErrorListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ConferenceEvent, listener: Janus.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Janus.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ConferenceEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Janus.Listeners | undefined) = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Janus.ListenerName] === 'function') {\n        (this[key as Janus.ListenerName] as Janus.Listeners | undefined) = undefined;\n      }\n    });\n  }\n}\n","import type { Data, EmptyResponse, SearchCondition } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\n\nexport default class DataService {\n  public proxy: ProxyService;\n  readonly route = config.urls.data;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(className: string, params: Data.CreateParams = {}): Promise<Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const multi = isMany ? 'multi' : undefined;\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, className, multi),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(className: string, params: Data.ListParams = {}): Promise<Data.ListResponse> {\n    const ext = typeof params === 'string' ? params : Utils.isArray(params) ? params.toString() : undefined;\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, ext),\n      data: ext ? undefined : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async readPermissions(className: string, id: string): Promise<Data.ReadPermissionsResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, id),\n      data: { permissions: 1 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(\n    className: string,\n    params: Data.UpdateOptions | Data.UpdateOptions[] = {}\n  ): Promise<Data.UpdateResponse | Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const isSearch = !isMany && params.search_criteria;\n    const ext = isMany ? 'multi' : isSearch ? 'by_criteria' : params.id || params._id;\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    className: string,\n    params: string | string[] | SearchCondition<any>\n  ): Promise<Data.DeleteResponse | EmptyResponse> {\n    const isCriteria = Utils.isObject(params);\n    const isOne = typeof params === 'string' || (Utils.isArray(params) && params.length === 1);\n    const ext = isCriteria ? 'by_criteria' : params.toString();\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isCriteria ? params : undefined,\n      dataType: isOne ? ProxyType.TEXT : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  private createRecord(params: Data.CreateRecord[] = []): object {\n    return params.reduce((items, item, index) => {\n      const key = index + 1;\n      const id = item.id || item._id;\n      const record = id ? { ...item, id } : item;\n\n      return { ...items, [key]: record };\n    }, {});\n  }\n}\n","import type { EmptyResponse, Meetings } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\n\nexport default class MeetingsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.meetings;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async get(params: Meetings.GetParams = {}): Promise<Meetings.Meeting | Meetings.Meeting[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Meetings.CreateParams = {}): Promise<Meetings.Meeting> {\n    const MINUTE = 60;\n    const startTimestamp = Math.ceil(Date.now() / 1000);\n    const endTimestamp = startTimestamp + 60 * MINUTE;\n    const defaultName = new Date(startTimestamp).toLocaleString('en', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    });\n    const defaultParams = {\n      name: defaultName,\n      start_date: startTimestamp,\n      end_date: endTimestamp,\n      attendees: [],\n      record: false,\n      chat: false,\n    };\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { ...defaultParams, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string | number, params: Meetings.MeetingParams): Promise<Meetings.Meeting> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRecordings(id: string | number): Promise<Meetings.Recording[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'recordings', id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type { EmptyResponse, PushNotifications } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport { base64Encode } from '@platform';\nimport config from './config';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\n\nexport default class PushNotificationsService {\n  public proxy: ProxyService;\n  public subscriptions: SubscriptionsService;\n  public events: EventsService;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.subscriptions = new SubscriptionsService(proxy);\n    this.events = new EventsService(proxy);\n  }\n\n  public base64Encode = base64Encode;\n}\n\nclass SubscriptionsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.subscriptions;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(params: PushNotifications.SubscriptionsCreateParams): Promise<PushNotifications.Subscription> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(): Promise<PushNotifications.Subscription[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n\nclass EventsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.events;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(event: PushNotifications.EventsCreateParams): Promise<PushNotifications.Event[]> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { event },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type { EmptyResponse, Proxy, Storage } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\n\nexport default class StorageService {\n  public proxy: ProxyService;\n  readonly route = config.urls.blobs;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Storage.ListParams = {}): Promise<Storage.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params?: Storage.CreateParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { blob: params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: number | string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createAndUpload(params: Storage.CreateAndUploadParams): Promise<Storage.Blob> {\n    const { name, file, size, abort_id, type: content_type, public: isPublic = true } = params;\n    const createParams = { name, content_type, public: isPublic };\n\n    let blob: Storage.Blob;\n\n    return this.create(createParams)\n      .then(({ blob: blobObject }) => {\n        blob = blobObject;\n        const uri = this.parseUri(blob.blob_object_access?.params);\n        const uploadUrl = `${uri.protocol}://${uri.authority}${uri.path}`;\n        const uploadParams: Proxy.Params = { url: uploadUrl, data: {} };\n\n        if (abort_id) {\n          uploadParams.abort_id = abort_id;\n        }\n\n        Object.keys(uri.queryKey).forEach((key) => {\n          uploadParams.data[key] = decodeURIComponent(uri.queryKey[key]);\n        });\n\n        uploadParams.data.file = file;\n\n        return this.upload(uploadParams).then(() => blob);\n      })\n      .then((blob) => this.markUploaded({ id: blob.id, size }).then(() => blob))\n      .then((blob) => ({ ...blob, size }));\n  }\n\n  public async upload(params: Proxy.Params): Promise<any> {\n    const ajaxParams = {\n      ...params,\n      type: ProxyMethod.POST,\n      dataType: ProxyType.TEXT,\n      contentType: false,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async markUploaded(params: Storage.MarkUploadedParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, params.id, 'complete'),\n      data: {\n        size: params.size,\n      },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getInfo(id: number | string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFile(uid: string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, uid),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFileObject(uid: string, params: Storage.GetFileObjectParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, uid, 'object'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(params: Storage.UpdateParams): Promise<Storage.BlobResponse> {\n    const data = { blob: {} as any };\n\n    if (typeof params.name !== 'undefined') {\n      data.blob.name = params.name;\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, params.id),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public privateUrl(fileUID: string = ''): string {\n    return `${config.endpoints.api_url ?? `https://${config.endpoints.api}`}/blobs/${fileUID}?token=${this.proxy.getSession()?.token}`;\n  }\n\n  public publicUrl(fileUID: string = ''): string {\n    return `${config.endpoints.api_url ?? `https://${config.endpoints.api}`}/blobs/${fileUID}`;\n  }\n\n  // parseUri 1.2.2\n  // (c) Steven Levithan <stevenlevithan.com>\n  // MIT License\n  // http://blog.stevenlevithan.com/archives/parseuri\n  private parseUri(str: string = ''): any {\n    const options = {\n      strictMode: false,\n      key: [\n        'source',\n        'protocol',\n        'authority',\n        'userInfo',\n        'user',\n        'password',\n        'host',\n        'port',\n        'relative',\n        'path',\n        'directory',\n        'file',\n        'query',\n        'anchor',\n      ],\n      q: {\n        name: 'queryKey',\n        parser: /(?:^|&)([^&=]*)=?([^&]*)/g,\n      },\n      parser: {\n        strict:\n          /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n        loose:\n          /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      },\n    };\n    const m = options.parser[options.strictMode ? 'strict' : 'loose'].exec(str) ?? {};\n\n    const uri = {};\n    let i = 14;\n\n    while (i--) {\n      uri[options.key[i]] = m[i] || '';\n    }\n\n    uri[options.q.name] = {};\n    uri[options.key[12]].replace(options.q.parser, ($0, $1, $2) => {\n      if ($1) {\n        uri[options.q.name][$1] = $2;\n      }\n    });\n\n    return uri;\n  }\n}\n","import type { EmptyResponse, Users } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport config from './config';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\n\nexport default class UsersService {\n  public proxy: ProxyService;\n  readonly route = config.urls.users;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async getV2(params: Users.GetV2Params): Promise<Users.GetV2Response> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'v2'),\n      useArrayQuery: true,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async signup(user: Users.SignUpParams, auth_key?: string): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      authKey: auth_key ?? config.creds.authKey,\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(user: Users.UpdateParams = {}): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async resetPassword(email: string = ''): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'password', 'reset'),\n      data: { email },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async listOnline(params: Users.ListOnlineParams = {}): Promise<Users.UsersResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'online'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getOnlineCount(): Promise<Users.OnlineCountResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'online'),\n      data: { count: true },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /**\n   * @deprecated Use `getV2(params)` instead.\n   */\n  public async get(params: any): Promise<Users.OldGetResponse | Users.UserResponse> {\n    let data = Utils.cloneObject(params);\n    let url: string | number = '';\n\n    const filters: string[] = [];\n    const dateFields = ['created_at', 'updated_at', 'last_request_at'];\n    const numberFields = ['id', 'external_user_id'];\n    const extensions: any = {\n      login: 'by_login',\n      full_name: 'by_full_name',\n      facebook_id: 'by_facebook_id',\n      twitter_id: 'by_twitter_id',\n      phone: 'phone',\n      email: 'by_email',\n      tags: 'by_tags',\n      external: 'external',\n    };\n\n    function generateFilter(filter: any): string {\n      const obj = Utils.cloneObject(filter);\n      let type = dateFields.includes(obj.field) ? 'date' : typeof obj.value;\n\n      if (Utils.isArray(obj.value)) {\n        if (type === 'object') {\n          type = typeof obj.value[0];\n        }\n        obj.value = obj.value.toString();\n      }\n\n      return [type, obj.field, obj.param, obj.value].join(' ');\n    }\n\n    if (data.order) {\n      const type = data.order.field in dateFields ? 'date' : data.order.field in numberFields ? 'number' : 'string';\n      data.order = [data.order.sort, type, data.order.field].join(' ');\n    }\n\n    if (data && data.filter) {\n      if (Utils.isArray(data.filter)) {\n        data.filter.forEach((filter: any) => {\n          filters.push(generateFilter(filter));\n        });\n      } else {\n        filters.push(generateFilter(data.filter));\n      }\n      data.filter = filters;\n    }\n\n    if (typeof data === 'number') {\n      url = data;\n      data = undefined;\n    } else {\n      for (const key in extensions) {\n        if (data[key]) {\n          url = extensions[key];\n\n          if (key === extensions.external) {\n            url += `/${data[extensions.external]}`;\n            data = undefined;\n          }\n\n          break;\n        }\n      }\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, url),\n      data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import { navigator } from '@platform';\nimport config from '../config';\n\nexport default class WebRTCHelpers {\n  static getUserJid(id: string | number): string {\n    return `${id}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  static getUserIdFromJID(jid: string): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  static trace(text: string): void {\n    if (config.debug) {\n      console.log('[VideoChat]:', text);\n    }\n  }\n\n  static traceWarning(text: string): void {\n    if (config.debug) {\n      console.warn('[VideoChat]:', text);\n    }\n  }\n\n  static traceError(text: string): void {\n    if (config.debug) {\n      console.error('[VideoChat]:', text);\n    }\n  }\n\n  static get getVersionFirefox(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const ffInfo = ua.match(/(?:firefox)[ \\/](\\d+)/i) || [];\n      version = ffInfo[1] ? +ffInfo[1] : 0;\n    }\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n\n  static get getVersionSafari(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const sInfo = ua.match(/(?:safari)[ \\/](\\d+)/i) || [];\n      if (sInfo.length) {\n        const sVer = ua.match(/(?:version)[ \\/](\\d+)/i) || [];\n        if (sVer) {\n          version = sVer[1] ? +sVer[1] : 0;\n        }\n      }\n    }\n\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n}\n","import type { Calls, Config } from '../types';\nimport type WebRTCSession from './WebRTCSession';\nimport { CallSessionConnectionState, CallType, MediaType, PeerConnectionState } from '../types/enums';\nimport { RTCPeerConnection, RTCSessionDescription, MediaStream } from '@platform';\nimport config from '../config';\nimport WebRTCHelpers from './WebRTCHelpers';\n\nexport default class WebRTCPeerConnection {\n  public original!: RTCPeerConnection;\n  public session!: WebRTCSession;\n  public userID!: number;\n  public type!: RTCSdpType;\n  public remoteSDP: string | null = null;\n  public state: PeerConnectionState = PeerConnectionState.NEW;\n  public iceCandidates: RTCIceCandidateInit[] = [];\n  public remoteStream: MediaStream = new MediaStream();\n  public answerTimeInterval: number = 0;\n  public onStatusClosedChecker: NodeJS.Timeout | number | null = null;\n  public dialingTimer: NodeJS.Timeout | number | null = null;\n  public statsReportTimer: NodeJS.Timeout | number | null = null;\n  public waitingReconnectTimeoutCallback: NodeJS.Timeout | number | null = null;\n  public released: boolean = false;\n\n  constructor(session: WebRTCSession, userID: number, type: RTCSdpType) {\n    this.create();\n    this.setup(session, userID, type);\n  }\n\n  private create() {\n    const rtcConfiguration: RTCConfiguration = {\n      iceTransportPolicy: (config.videochat.alwaysRelayCalls ? 'relay' : 'all') as RTCIceTransportPolicy,\n      iceServers: config.videochat.iceServers.map(\n        (item: Config.VideochatIceServer): RTCIceServer => ({\n          urls: item.urls ?? item.url,\n          username: item.username,\n          credential: item.credential,\n        })\n      ) as RTCIceServer[],\n    };\n\n    this.original = RTCPeerConnection ? new RTCPeerConnection(rtcConfiguration) : ({} as RTCPeerConnection);\n\n    WebRTCHelpers.trace(`new RTCPeerConnection(${JSON.stringify(rtcConfiguration, null, 2)})`);\n  }\n\n  private setup(session: WebRTCSession, userID: number, type: RTCSdpType): void {\n    this.type = type;\n    this.userID = userID;\n    this.session = session;\n    this.session.startCallTime = Date.now();\n\n    this.original.addEventListener('track', this.onMediaTrackHandler);\n    this.original.addEventListener('icecandidate', this.onIceCandidateHandler);\n    this.original.addEventListener('signalingstatechange', this.onSignalingStateHandler);\n    this.original.addEventListener('iceconnectionstatechange', this.onIceConnectionStateHandler);\n\n    WebRTCHelpers.trace(`RTCPeerConnection init. ${this.toString()}`);\n  }\n\n  private onMediaTrackHandler = (event: RTCTrackEvent): void => {\n    this.remoteStream.addTrack(event.track);\n\n    if (\n      (this.session.callType == CallType.VIDEO && this.remoteStream.getVideoTracks().length) ||\n      (this.session.callType == CallType.AUDIO && this.remoteStream.getAudioTracks().length)\n    ) {\n      this.session.onRemoteStream(this.userID, this.remoteStream);\n    }\n\n    this.getWrappedStats();\n  };\n\n  private onIceCandidateHandler = (event: RTCPeerConnectionIceEvent): void => {\n    if (event.candidate) {\n      const { sdpMLineIndex, sdpMid, candidate } = event.candidate;\n      const iceCandidate: RTCIceCandidateInit = { sdpMLineIndex, sdpMid, candidate };\n\n      if (this.signalingState === 'stable' && this.original.canTrickleIceCandidates) {\n        this.session.processIceCandidates(this.userID, [iceCandidate]);\n      } else {\n        this.iceCandidates.push(iceCandidate);\n      }\n    }\n  };\n\n  private onSignalingStateHandler = async (): Promise<void> => {\n    WebRTCHelpers.trace(`onSignalingStateHandler: ${this.signalingState}`);\n\n    if (this.signalingState === 'stable' && this.iceCandidates.length > 0) {\n      this.session.processIceCandidates(this.userID, this.iceCandidates);\n      this.iceCandidates.length = 0;\n    }\n  };\n\n  /** handler of remote media stream */\n  private onIceConnectionStateHandler = (): void => {\n    WebRTCHelpers.trace(`onIceConnectionStateHandler: ${this.iceConnectionState}`);\n\n    if (this.onStatusClosedChecker && WebRTCHelpers.getVersionSafari >= 11) {\n      clearTimeout(this.onStatusClosedChecker);\n    }\n\n    switch (this.iceConnectionState) {\n      case 'checking':\n        this.state = PeerConnectionState.CHECKING;\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CONNECTING);\n        break;\n      case 'connected':\n        this.state = PeerConnectionState.CONNECTED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CONNECTED);\n        break;\n      case 'completed':\n        this.state = PeerConnectionState.COMPLETED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.COMPLETED);\n        break;\n      case 'failed':\n        this.state = PeerConnectionState.FAILED;\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.FAILED);\n        break;\n      case 'disconnected':\n        this.state = PeerConnectionState.DISCONNECTED;\n        this.startWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.DISCONNECTED);\n        if (WebRTCHelpers.getVersionSafari >= 11) {\n          this.onStatusClosedChecker = setTimeout(() => {\n            this.onIceConnectionStateHandler(); // repeat to get status \"closed\"\n          }, 500);\n        }\n        break;\n      case 'closed': // TODO: this state doesn't fires on Safari 11\n        this.state = PeerConnectionState.CLOSED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CLOSED);\n        break;\n      default:\n        break;\n    }\n  };\n\n  private clearWaitingReconnectTimer(): void {\n    if (this.waitingReconnectTimeoutCallback) {\n      WebRTCHelpers.trace('clearWaitingReconnectTimer');\n      clearTimeout(this.waitingReconnectTimeoutCallback);\n      this.waitingReconnectTimeoutCallback = null;\n    }\n  }\n\n  private startWaitingReconnectTimer(): void {\n    const timeout = config.videochat.disconnectTimeInterval * 1000;\n    WebRTCHelpers.trace(`startWaitingReconnectTimer, timeout: ${timeout}`);\n\n    this.waitingReconnectTimeoutCallback = setTimeout(() => {\n      WebRTCHelpers.trace('waitingReconnectTimeoutCallback');\n      if (this.waitingReconnectTimeoutCallback) {\n        clearTimeout(this.waitingReconnectTimeoutCallback);\n      }\n      this.release();\n      this.session.closeSessionIfAllConnectionsClosed();\n    }, timeout);\n  }\n\n  private clearStatsReportTimer(): void {\n    if (this.statsReportTimer) {\n      clearInterval(this.statsReportTimer);\n      this.statsReportTimer = null;\n    }\n  }\n\n  public async addCandidates(iceCandidates: RTCIceCandidateInit[]): Promise<void> {\n    for (const iceCandidate of iceCandidates) {\n      if (iceCandidate?.candidate) {\n        try {\n          await this.addIceCandidate(iceCandidate);\n          WebRTCHelpers.trace(`'addIceCandidate' success: ${this.signalingState}`);\n        } catch (error) {\n          WebRTCHelpers.traceError(`'addIceCandidate' error: ${error}`);\n        }\n      }\n    }\n  }\n\n  public release(): void {\n    this.clearDialingTimer();\n    this.clearStatsReportTimer();\n    this.close();\n    if (WebRTCHelpers.getVersionSafari >= 11) {\n      this.onIceConnectionStateHandler(); // TODO: 'closed' state doesn't fires on Safari 11 (do it manually)\n    }\n    this.original.removeEventListener('track', this.onMediaTrackHandler);\n    this.original.removeEventListener('icecandidate', this.onIceCandidateHandler);\n    this.original.removeEventListener('signalingstatechange', this.onSignalingStateHandler);\n    this.original.removeEventListener('iceconnectionstatechange', this.onIceConnectionStateHandler);\n    this.released = true;\n    WebRTCHelpers.trace(`RTCPeerConnection closed. ${this.toString()}`);\n  }\n\n  public clearDialingTimer(): void {\n    if (this.dialingTimer) {\n      WebRTCHelpers.trace('clearDialingTimer');\n      clearInterval(this.dialingTimer);\n      this.dialingTimer = null;\n      this.answerTimeInterval = 0;\n    }\n  }\n\n  public async getAndSetLocalSessionDescription(\n    maxBandwidth: number,\n    iceRestart: boolean = false\n  ): Promise<RTCSessionDescriptionInit> {\n    this.state = PeerConnectionState.CONNECTING;\n\n    try {\n      const offerOptions = iceRestart ? { iceRestart } : undefined;\n      const sessionDescription =\n        this.type === 'offer' ? await this.createOffer(offerOptions) : await this.createAnswer();\n\n      await this.setLocalDescription(sessionDescription);\n      this.setRTCRtpSenderMaxBandwidth(maxBandwidth);\n\n      return sessionDescription;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public setRTCRtpSenderMaxBandwidth(maxBandwidth: number): void {\n    const senders = this.getSenders() || [];\n    const maxBitrate = maxBandwidth ? Math.round(maxBandwidth * 1000) : 0;\n\n    senders.forEach((sender: RTCRtpSender) => {\n      if (sender.track?.kind === MediaType.VIDEO) {\n        const params = sender.getParameters();\n\n        params.encodings ??= [{}];\n        params.encodings.forEach((encoding) => {\n          if (maxBitrate > 0) {\n            encoding.maxBitrate = maxBitrate;\n          } else {\n            delete encoding.maxBitrate;\n          }\n        });\n\n        sender\n          .setParameters(params)\n          .then(() => {\n            WebRTCHelpers.trace(\n              `Set 'maxBandwidth' for ${this.userID}: ${maxBandwidth > 0 ? `${maxBandwidth} kbps` : 'unlimited'}`\n            );\n          })\n          .catch((error) => {\n            WebRTCHelpers.traceWarning(`Set 'maxBandwidth' for ${this.userID}: ${error}`);\n          });\n      }\n    });\n  }\n\n  public startDialingTimer(extension: Calls.ExtensionParams, withOnNotAnswerCallback: boolean): void {\n    const dialingTimeInterval = config.videochat.dialingTimeInterval * 1000;\n\n    WebRTCHelpers.trace(`startDialingTimer, dialingTimeInterval: ${JSON.stringify(dialingTimeInterval)}`);\n\n    const dialingCallback = (extension, withOnNotAnswerCallback, skipIncrement) => {\n      if (!skipIncrement) {\n        this.answerTimeInterval += config.videochat.dialingTimeInterval * 1000;\n      }\n\n      WebRTCHelpers.trace(`dialingCallback, extension: ${JSON.stringify(extension)}`);\n\n      if (this.answerTimeInterval >= config.videochat.answerTimeInterval * 1000) {\n        this.clearDialingTimer();\n\n        if (withOnNotAnswerCallback) {\n          this.session.processOnNotAnswer(this);\n        }\n      } else {\n        this.session.processCall(this, extension);\n      }\n    };\n\n    this.dialingTimer = setInterval(dialingCallback, dialingTimeInterval, extension, withOnNotAnswerCallback, false);\n\n    dialingCallback(extension, withOnNotAnswerCallback, true); // call for the 1st time\n  }\n\n  public async setRemoteSessionDescription(type: RTCSdpType, sdp: string): Promise<void> {\n    const desc = new RTCSessionDescription!({ sdp, type });\n    return this.setRemoteDescription(desc);\n  }\n\n  private getWrappedStats(): void {\n    if (config.videochat.statsReportTimeInterval) {\n      let lastResult: RTCStatsReport;\n\n      WebRTCHelpers.trace('Stats tracker has been started');\n\n      this.statsReportTimer = setInterval(() => {\n        this.getStatsCustom(\n          lastResult,\n          (results, lastResults) => {\n            lastResult = lastResults;\n            this.session.onCallStatsReport(this.userID, results);\n          },\n          (err) => {\n            WebRTCHelpers.traceError(`Get stats error. ${err.name}: ${err.message}`);\n            this.session.onCallStatsReport(this.userID, null, err);\n          }\n        );\n      }, config.videochat.statsReportTimeInterval * 1000);\n    }\n  }\n\n  set sdpRemote(sdp: string) {\n    if (sdp) {\n      this.remoteSDP = sdp;\n    }\n  }\n\n  get sdpRemote(): string | null {\n    return this.remoteSDP;\n  }\n\n  toString(): string {\n    return `sessionID: ${this.session.ID}, userID: ${this.userID}, type: ${this.type}, state: ${this.state}`;\n  }\n\n  private getStatsCustom(\n    lastResults: RTCStatsReport,\n    onSuccess: (results: any, lastResults: any) => void,\n    onFail: (err: Error) => void\n  ) {\n    const obj = { audio: {} as any, video: {} as any, candidate: {} as any };\n    const statistic = { local: Object.assign({}, obj), remote: Object.assign({}, obj) };\n\n    if (WebRTCHelpers.getVersionFirefox) {\n      const localStream = this.session.localStream;\n      const localVideoSettings = localStream?.getVideoTracks()[0].getSettings();\n\n      if (localVideoSettings) {\n        statistic.local.video.frameHeight = localVideoSettings.height;\n        statistic.local.video.frameWidth = localVideoSettings.width;\n      }\n    }\n\n    this.getStats().then((results: RTCStatsReport) => {\n      results.forEach((result) => {\n        let item;\n\n        if (result.bytesReceived && result.type === 'inbound-rtp') {\n          item = statistic.remote[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, false);\n          item.bytesReceived = result.bytesReceived;\n          item.packetsReceived = result.packetsReceived;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === MediaType.VIDEO && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.bytesSent && result.type === 'outbound-rtp') {\n          item = statistic.local[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, true);\n          item.bytesSent = result.bytesSent;\n          item.packetsSent = result.packetsSent;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === MediaType.VIDEO && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.type === 'local-candidate') {\n          item = statistic.local.candidate;\n          if (result.candidateType === 'host' && result.mozLocalTransport === 'udp' && result.transport === 'udp') {\n            item.protocol = result.transport;\n            item.ip = result.ipAddress;\n            item.port = result.portNumber;\n          } else if (!WebRTCHelpers.getVersionFirefox) {\n            item.protocol = result.protocol;\n            item.ip = result.ip;\n            item.port = result.port;\n          }\n        } else if (result.type === 'remote-candidate') {\n          item = statistic.remote.candidate;\n          item.protocol = result.protocol || result.transport;\n          item.ip = result.ip || result.ipAddress;\n          item.port = result.port || result.portNumber;\n        } else if (result.type === 'track' && result.kind === MediaType.VIDEO && !WebRTCHelpers.getVersionFirefox) {\n          if (result.remoteSource) {\n            item = statistic.remote.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, false);\n          } else {\n            item = statistic.local.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, true);\n          }\n        }\n      });\n      onSuccess(statistic, results);\n    }, onFail);\n  }\n\n  private getBitratePerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const kilo = 1024;\n    const bit = 8;\n    const bitrate = !lastResult\n      ? 0\n      : isLocal\n        ? (bit * (result.bytesSent - lastResult.bytesSent)) / (kilo * seconds)\n        : (bit * (result.bytesReceived - lastResult.bytesReceived)) / (kilo * seconds);\n\n    return Math.round(bitrate);\n  }\n\n  private getFramesPerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults && lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const framesPerSecond = !lastResult\n      ? 0\n      : isLocal\n        ? (result.framesSent - lastResult.framesSent) / seconds\n        : (result.framesReceived - lastResult.framesReceived) / seconds;\n\n    return Math.round(framesPerSecond * 10) / 10;\n  }\n\n  // original RTCPeerConnection methods\n  close(): void {\n    this.original.close?.();\n  }\n  addTrack(track: MediaStreamTrack, stream: MediaStream): RTCRtpSender {\n    return this.original.addTrack?.(track, stream) ?? null;\n  }\n  getSenders(): RTCRtpSender[] {\n    return this.original.getSenders?.() ?? null;\n  }\n  async createOffer(options?: RTCOfferOptions): Promise<RTCSessionDescriptionInit> {\n    return (await this.original.createOffer?.(options)) ?? null;\n  }\n  async createAnswer(options?: RTCOfferOptions): Promise<RTCSessionDescriptionInit> {\n    return (await this.original.createAnswer?.(options)) ?? null;\n  }\n  async getStats(selector?: MediaStreamTrack | null): Promise<RTCStatsReport> {\n    return (await this.original.getStats?.(selector)) ?? null;\n  }\n  async addIceCandidate(candidate?: RTCIceCandidateInit): Promise<void> {\n    await this.original.addIceCandidate?.(candidate);\n  }\n  async setRemoteDescription(description: RTCSessionDescriptionInit): Promise<void> {\n    await this.original.setRemoteDescription?.(description);\n  }\n  async setLocalDescription(description?: RTCSessionDescriptionInit): Promise<void> {\n    await this.original.setLocalDescription?.(description);\n  }\n  get localDescription(): RTCSessionDescription {\n    return this.original.localDescription ?? null;\n  }\n  get signalingState(): RTCSignalingState {\n    return this.original.signalingState ?? 'closed';\n  }\n  get iceConnectionState(): RTCIceConnectionState {\n    return this.original.iceConnectionState ?? 'closed';\n  }\n}\n","import type { Calls, Chat } from '../types';\nimport type { IChatRealTimeService } from '../types/chat';\nimport { CallSignalingModuleIdentifier, CallSignalingType } from '../types/enums';\nimport Utils from '../Utils';\n\nexport default class WebRTCSignalingProvider {\n  public chatService: IChatRealTimeService;\n\n  constructor(chatService: IChatRealTimeService) {\n    this.chatService = chatService;\n  }\n\n  public sendCandidate(\n    userID: Chat.UserId,\n    iceCandidates: RTCIceCandidateInit[],\n    ext: Calls.ExtensionParams = {}\n  ): void {\n    const extension = Object.assign({}, ext, { iceCandidates });\n\n    this.sendMessage(userID, extension, CallSignalingType.CANDIDATE);\n  }\n\n  public sendMessage(userID: Chat.UserId, ext: Calls.ExtensionParams, signalingType: CallSignalingType): void {\n    const extension = Object.assign({}, ext);\n    /** basic parameters */\n    extension.moduleIdentifier = CallSignalingModuleIdentifier;\n    extension.signalType = signalingType;\n    /** extension.sessionID */\n    /** extension.callType */\n    extension.platform = Utils.env.isBrowser ? 'web' : Utils.env.isReactNative || Utils.env.isExpo ? 'mobile' : 'node';\n    /** extension.callerID */\n    /** extension.opponentsIDs */\n    /** extension.sdp */\n\n    if (extension.userInfo) {\n      if (!Object.keys(extension.userInfo).length) {\n        delete extension.userInfo;\n      } else if (extension.userInfo.maxBandwidth === 0) {\n        delete extension.userInfo.maxBandwidth;\n      }\n    }\n\n    const systemCallMessage: Chat.SystemMessageParams = {\n      id: Utils.getBsonObjectId(),\n      extension: extension,\n    };\n\n    this.chatService.sendWebRTCSignalingMessage(userID, systemCallMessage);\n  }\n}\n","import type { Calls, Media } from '../types';\nimport {\n  CallSessionConnectionState,\n  CallSessionState,\n  CallSignalingType,\n  CallType,\n  MediaType,\n  PeerConnectionState,\n} from '../types/enums';\nimport { mediaDevices } from '@platform';\nimport config from '../config';\nimport WebRTCPeerConnection from './WebRTCPeerConnection';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport Utils from '../Utils';\n\nexport default class WebRTCSession {\n  public ID: string | null = null;\n  public state: CallSessionState = CallSessionState.NEW;\n  public callType!: CallType;\n  public initiatorID!: number;\n  public currentUserID!: number;\n  public opponentsIDs: number[] = [];\n  public maxBandwidth: number = 0;\n  public peerConnections: { [userID: number]: WebRTCPeerConnection } = {};\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public signalingProvider!: WebRTCSignalingProvider;\n  public answerTimer: NodeJS.Timeout | number | null = null;\n  public waitingOfferOrAnswerTimer: NodeJS.Timeout | number | null = null;\n  public startCallTime: number = 0;\n  public acceptCallTime: number = 0;\n  public onUserNotAnswerListener!: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener!: Calls.OnRemoteStreamListener;\n  public onSessionCloseListener!: Calls.OnSessionCloseListener;\n  public onCallStatsReportListener!: Calls.OnCallStatsReportListener;\n  public onSessionConnectionStateChangedListener!: Calls.OnSessionConnectionStateChangedListener;\n\n  constructor(params: Calls.SessionParams) {\n    Object.assign(this, params, { ID: params.ID ?? generateUUID() });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(stream: MediaStream, elementId?: string, options?: Media.ElementOptions): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    this.localStream.getTracks().forEach((track) => {\n      const type = track.kind;\n      const deviceId = track.getSettings().deviceId;\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] === 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === MediaType.AUDIO && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      if (newTrack.kind === MediaType.AUDIO) {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (newTrack) {\n        Object.values(this.peerConnections).forEach((pc) => {\n          pc.getSenders()\n            .find(({ track }) => newTrack.kind === track?.kind)\n            ?.replaceTrack(newTrack);\n        });\n        this.localStream?.addTrack(newTrack);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async setMaxBandwidth(maxBandwidth: number): Promise<void[]> {\n    const peers = this.peerConnections;\n    const peersKeys = Object.keys(peers);\n\n    if (peersKeys.length < 1) {\n      WebRTCHelpers.trace(\"No 'RTCPeerConnection' to set 'maxBandwidth'\");\n      return;\n    }\n\n    return Promise.all(peersKeys.map((userID) => peers[Number(userID)].setRTCRtpSenderMaxBandwidth(maxBandwidth)));\n  }\n\n  public connectionStateForUser(userID: number): PeerConnectionState | null {\n    const peerConnection = this.peerConnections[userID];\n    return peerConnection ? peerConnection.state : null;\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = async (_event: Event) => {\n        try {\n          await mediaElement.play();\n        } catch (error) {\n          console.error('[VideoChat]:', error);\n        }\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds = {}): Promise<MediaStream> {\n    Utils.DLog('switchMediaTracks:', options);\n\n    [MediaType.AUDIO, MediaType.VIDEO].forEach((type) => {\n      const device = type === MediaType.AUDIO ? options.audio : type === MediaType.VIDEO ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : (device?.deviceId ?? null);\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] !== 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const constrains = { audio: this.mediaParams.audio || false, video: this.mediaParams.video || false };\n      const stream = await mediaDevices.getUserMedia(constrains);\n      const localStream = this.replaceTracks(stream);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public call(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Call, extension: ${JSON.stringify(ext)}`);\n\n    this.state = CallSessionState.ACTIVE;\n    this.maxBandwidth = Number(ext.userInfo?.maxBandwidth ?? 0);\n    this.opponentsIDs.forEach((userID) => {\n      this.callInternal(userID, ext, true);\n    });\n  }\n\n  private async callInternal(\n    userID: number,\n    extension: Calls.ExtensionParams,\n    withOnNotAnswerCallback: boolean\n  ): Promise<void> {\n    const pc = new WebRTCPeerConnection(this, userID, 'offer');\n\n    this.localStream?.getTracks().forEach((track) => {\n      pc.addTrack(track, this.localStream);\n    });\n\n    this.peerConnections[userID] = pc;\n\n    try {\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      WebRTCHelpers.trace('getAndSetLocalSessionDescription success');\n      pc.startDialingTimer(extension, withOnNotAnswerCallback); // call requests to user\n    } catch (error) {\n      WebRTCHelpers.traceError(`getAndSetLocalSessionDescription error: ${error}`);\n    }\n  }\n\n  public accept(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Accept, extension: ${JSON.stringify(ext)}`);\n\n    if (this.state === CallSessionState.ACTIVE) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already active, return\");\n      return;\n    }\n\n    if (this.state === CallSessionState.CLOSED) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already closed, return\");\n      this.stop({});\n      return;\n    }\n\n    this.state = CallSessionState.ACTIVE;\n    this.acceptCallTime = Date.now();\n    this.clearAnswerTimer();\n    this.acceptInternal(this.initiatorID, ext);\n\n    // group call\n    const opponentsIDs = this.opponentsIDs.filter((userID) => userID !== this.currentUserID);\n\n    if (opponentsIDs.length > 0) {\n      this.startWaitingOfferOrAnswerTimer();\n      opponentsIDs.forEach((opponentID) => {\n        if (this.currentUserID > opponentID) {\n          this.callInternal(opponentID, ext, true);\n        }\n      });\n    }\n  }\n\n  private async acceptInternal(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc || !pc.sdpRemote) {\n      WebRTCHelpers.traceError(\"Can't accept the call, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    this.localStream?.getTracks().forEach((track) => {\n      pc.addTrack(track, this.localStream);\n    });\n\n    try {\n      await pc.setRemoteSessionDescription('offer', pc.sdpRemote);\n      WebRTCHelpers.trace('setRemoteSessionDescription - success');\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      WebRTCHelpers.trace('getAndSetLocalSessionDescription - success');\n\n      const ext = Object.assign({}, extension, {\n        sessionID: this.ID,\n        callType: this.callType,\n        callerID: this.initiatorID,\n        opponentsIDs: this.opponentsIDs,\n        sdp: pc.localDescription.sdp,\n      });\n\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.ACCEPT);\n    } catch (error) {\n      WebRTCHelpers.traceError(`[acceptInternal] Error: ${error}`);\n    }\n  }\n\n  public reject(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Reject, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = CallSessionState.REJECTED;\n    this.clearAnswerTimer();\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, CallSignalingType.REJECT);\n    });\n\n    this.close();\n  }\n\n  public stop(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Stop, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = CallSessionState.STOPPED;\n\n    if (this.answerTimer) {\n      this.clearAnswerTimer();\n    }\n\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, CallSignalingType.STOP);\n    });\n\n    this.close();\n  }\n\n  public canInitiateIceRestart(userID: number): boolean {\n    return this.peerConnections[userID]?.type === 'offer';\n  }\n\n  public async iceRestart(userID: number): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceError(\"Can't restart ice, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    try {\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth, true);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.RESTART);\n      WebRTCHelpers.trace('[iceRestart] OK');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[iceRestart] Error: ${error}`);\n    }\n  }\n\n  public processOnCall(callerID: number, extension: Calls.ExtensionParams): void {\n    const opponentsIDs = [this.initiatorID, ...this.opponentsIDs.filter((userID) => userID !== this.currentUserID)];\n\n    opponentsIDs.forEach((opponentID) => {\n      const pc = this.peerConnections[opponentID];\n\n      if (pc) {\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          /** The group call logic starts here */\n          if (callerID !== this.initiatorID && this.state === CallSessionState.ACTIVE) {\n            this.acceptInternal(callerID, extension);\n          }\n        }\n      } else {\n        /** create peer connections for each opponent */\n        const rtcSdpType = opponentID !== callerID && this.currentUserID > opponentID ? 'offer' : 'answer';\n        const pc = new WebRTCPeerConnection(this, opponentID, rtcSdpType);\n\n        this.peerConnections[opponentID] = pc;\n\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          this.startAnswerTimer();\n        }\n      }\n    });\n  }\n\n  public async processOnAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnAccept', there is no information about peer connection by some reason\");\n    }\n\n    try {\n      pc.clearDialingTimer();\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace(\"'setRemoteSessionDescription' success\");\n    } catch (error) {\n      WebRTCHelpers.traceError(`'setRemoteSessionDescription' error: ${error}`);\n    }\n  }\n\n  public processOnReject(userID: number): void {\n    const pc = this.peerConnections[userID];\n\n    this.clearWaitingOfferOrAnswerTimer();\n\n    if (pc) {\n      pc.release();\n    } else {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnReject', there is no information about peer connection by some reason\");\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public processOnStop(userID: number): void {\n    this.clearAnswerTimer();\n\n    /** drop the call if the initiator did it */\n    if (userID === this.initiatorID) {\n      const pcKeys = Object.keys(this.peerConnections);\n      if (pcKeys.length > 0) {\n        pcKeys.forEach((key: string) => {\n          this.peerConnections[Number(key)].release();\n        });\n      } else {\n        WebRTCHelpers.traceWarning(\"Ignore 'OnStop', there is no information about peer connections by some reason\");\n      }\n    } else {\n      const pc = this.peerConnections[userID];\n      if (pc) {\n        pc.release();\n      } else {\n        WebRTCHelpers.traceWarning('Ignore \"OnStop\", there is no information about peer connection by some reason');\n      }\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public async processOnIceCandidates(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceCandidates\", there is no information about peer connection by some reason'\n      );\n    }\n\n    if (extension.iceCandidates) {\n      await pc.addCandidates(extension.iceCandidates);\n    }\n  }\n\n  public async processOnIceRestart(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning('Ignore \"OnIceRestart\", there is no information about peer connection by some reason');\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('offer', extension.sdp);\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.RESTART_ACCEPT);\n      WebRTCHelpers.trace('[processOnIceRestart] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestart] Error: ${error}`);\n    }\n  }\n\n  public async processOnIceRestartAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceRestartAccept\", there is no information about peer connection by some reason'\n      );\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace('[processOnIceRestartAccept] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestartAccept] Error: ${error}`);\n    }\n  }\n\n  public processCall(peerConnection: WebRTCPeerConnection, extension: Calls.ExtensionParams = {}): void {\n    const ext = Object.assign({ userInfo: {} }, extension, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n      sdp: peerConnection.localDescription.sdp,\n    });\n\n    this.signalingProvider.sendMessage(peerConnection.userID, ext, CallSignalingType.CALL);\n  }\n\n  public processIceCandidates(userID: number, iceCandidates: RTCIceCandidateInit[]): void {\n    const extension = {\n      sessionID: this.ID ?? '',\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    };\n\n    this.signalingProvider.sendCandidate(userID, iceCandidates, extension);\n  }\n\n  public processOnNotAnswer(peerConnection: WebRTCPeerConnection): void {\n    WebRTCHelpers.trace(`Answer timeout callback for session ${this.ID} for user ${peerConnection.userID}`);\n\n    this.clearWaitingOfferOrAnswerTimer();\n    peerConnection.release();\n    Utils.safeCallbackCall(this.onUserNotAnswerListener)(this, peerConnection.userID);\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public onRemoteStream(userID: number, stream: MediaStream): void {\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, userID, stream);\n  }\n\n  public onCallStatsReport(userID: number, stats: any, error?: Error): void {\n    Utils.safeCallbackCall(this.onCallStatsReportListener)(this, userID, stats, error);\n  }\n\n  public onSessionConnectionStateChanged(userID: number, connectionState: CallSessionConnectionState): void {\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, userID, connectionState);\n  }\n\n  private close(): void {\n    Object.values(this.peerConnections).forEach((pc) => {\n      try {\n        pc.release();\n      } catch (e) {\n        Utils.DLog(`Peer close error: ${e}`);\n      }\n    });\n\n    this.closeLocalMediaStream();\n    this.state = CallSessionState.CLOSED;\n    Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n  }\n\n  public closeSessionIfAllConnectionsClosed(): void {\n    const isAllClosed = Object.values(this.peerConnections).every((pc) => {\n      try {\n        /*\n         * TODO:\n         * Uses RTCPeerConnection.signalingState instead RTCPeerConnection.iceConnectionState,\n         * because state 'closed' comes after few time from Safari, but signaling state comes instantly\n         */\n        return pc.iceConnectionState === 'closed' || pc.signalingState === 'closed' || pc.released;\n      } catch (err) {\n        WebRTCHelpers.traceError(err);\n        // need to set peerState to 'closed' on error. FF will crashed without this part.\n        return true;\n      }\n    });\n\n    WebRTCHelpers.trace(`All peer connections closed: ${isAllClosed}`);\n\n    if (isAllClosed) {\n      this.closeLocalMediaStream();\n      Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n      this.state = CallSessionState.CLOSED;\n    }\n  }\n\n  private closeLocalMediaStream(): void {\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public mute(type: MediaType): void {\n    this.muteStream(false, type);\n  }\n\n  public unmute(type: MediaType): void {\n    this.muteStream(true, type);\n  }\n\n  private muteStream(enabled: boolean, type: MediaType = MediaType.NONE): void {\n    const tracks =\n      type === MediaType.AUDIO\n        ? this.localStream?.getAudioTracks()\n        : type === MediaType.VIDEO\n          ? this.localStream?.getVideoTracks()\n          : [];\n\n    tracks?.forEach((track) => {\n      track.enabled = enabled;\n    });\n  }\n\n  private clearAnswerTimer(): void {\n    if (this.answerTimer) {\n      WebRTCHelpers.trace('clearAnswerTimer');\n      clearTimeout(this.answerTimer);\n      this.answerTimer = null;\n    }\n  }\n\n  private startAnswerTimer(): void {\n    WebRTCHelpers.trace('startAnswerTimer');\n\n    this.answerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('answerTimeoutCallback');\n      this.close();\n      this.answerTimer = null;\n    }, config.videochat.answerTimeInterval * 1000);\n  }\n\n  private clearWaitingOfferOrAnswerTimer(): void {\n    if (this.waitingOfferOrAnswerTimer) {\n      WebRTCHelpers.trace('clearWaitingOfferOrAnswerTimer');\n      clearTimeout(this.waitingOfferOrAnswerTimer);\n      this.waitingOfferOrAnswerTimer = null;\n    }\n  }\n\n  private startWaitingOfferOrAnswerTimer(): void {\n    const timeWait = (this.acceptCallTime - this.startCallTime) / 1000;\n    const timeDiff = Math.min(timeWait, config.videochat.answerTimeInterval / 2);\n    const timeout = Math.max(config.videochat.answerTimeInterval - timeDiff, 1);\n\n    WebRTCHelpers.trace(`startWaitingOfferOrAnswerTimer, timeout: ${timeout}`);\n\n    this.waitingOfferOrAnswerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('waitingOfferOrAnswerTimeoutCallback');\n\n      Object.values(this.peerConnections).forEach((pc) => {\n        if (pc.state === PeerConnectionState.CONNECTING || pc.state === PeerConnectionState.NEW) {\n          this.processOnNotAnswer(pc);\n        }\n      });\n\n      this.waitingOfferOrAnswerTimer = null;\n    }, timeout * 1000);\n  }\n\n  public toString(): string {\n    return `ID: ${this.ID}, initiatorID: ${this.initiatorID}, opponentsIDs: ${this.opponentsIDs}, state: ${this.state}, callType: ${this.callType}`;\n  }\n}\n\nfunction generateUUID(): string {\n  let d = Date.now();\n  const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = ((d + Math.random() * 16) % 16) | 0;\n    d = Math.floor(d / 16);\n    return (c == 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n  return uuid;\n}\n\nfunction prepareExtension(extension: Calls.UserInfo = {}): Calls.ExtensionParams {\n  const ext = { userInfo: extension };\n\n  try {\n    if (Utils.isObject(extension)) {\n      ext.userInfo = Utils.cloneObject(extension, true);\n    } else {\n      WebRTCHelpers.traceWarning('Ignore \"prepareExtension\", must be an object');\n    }\n  } catch (err) {\n    WebRTCHelpers.traceWarning(err.message);\n  }\n\n  return ext;\n}\n","import { mediaDevices } from '@platform';\nimport config from '../config';\nimport ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport WebRTCSession from './WebRTCSession';\nimport WebRTCSignalingProcessor from './WebRTCSignalingProcessor';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport type { Calls, EmptyResponse } from '../types';\nimport type { IChatRealTimeService } from '../types/chat';\nimport {\n  CallEvent,\n  CallSessionConnectionState,\n  CallSessionState,\n  CallType,\n  PeerConnectionState,\n  ProxyMethod,\n} from '../types/enums';\n\nexport default class WebRTCClient {\n  public chatService: IChatRealTimeService;\n  public proxy: ProxyService;\n  public signalingProcessor: WebRTCSignalingProcessor;\n  public signalingProvider: WebRTCSignalingProvider;\n  public SessionConnectionState: typeof CallSessionConnectionState = CallSessionConnectionState;\n  public PeerConnectionState: typeof PeerConnectionState = PeerConnectionState;\n  public CallType: typeof CallType = CallType;\n  public sessions: { [key: string]: WebRTCSession } = {};\n  public onCallListener!: Calls.OnCallListener;\n  public onAcceptCallListener!: Calls.OnAcceptCallListener;\n  public onRejectCallListener!: Calls.OnRejectCallListener;\n  public onStopCallListener!: Calls.OnStopCallListener;\n  public onInvalidEventsListener!: Calls.OnInvalidEventsListener;\n  public onUserNotAnswerListener!: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener!: Calls.OnRemoteStreamListener;\n  public onSessionConnectionStateChangedListener!: Calls.OnSessionConnectionStateChangedListener;\n  public onSessionCloseListener!: Calls.OnSessionCloseListener;\n  public onCallStatsReport!: Calls.OnCallStatsReportListener;\n  public onDevicesChangeListener: Calls.OnDevicesChangeListener = () => {};\n\n  constructor(chatService: IChatRealTimeService, proxy: ProxyService) {\n    this.chatService = chatService;\n    this.proxy = proxy;\n\n    this.signalingProcessor = new WebRTCSignalingProcessor(this);\n    this.signalingProvider = new WebRTCSignalingProvider(this.chatService);\n\n    if (mediaDevices) {\n      mediaDevices.ondevicechange = Utils.safeCallbackCall(this.onDevicesChangeListener);\n    }\n  }\n\n  private get currentUserID(): number {\n    return this.chatService.currentUserId;\n  }\n\n  public async getMediaDevices(kind?: MediaDeviceKind): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public createNewSession(\n    opponentsIDs: number[],\n    callType: number,\n    options?: { maxBandwidth?: number; bandwidth?: number }\n  ): WebRTCSession {\n    const maxBandwidth = (options?.maxBandwidth || options?.bandwidth) ?? 0;\n\n    if (!opponentsIDs) {\n      throw new Error(\"Can't create a session without opponentsIDs\");\n    }\n\n    return this.createAndStoreSession(null, this.currentUserID, opponentsIDs, callType, maxBandwidth);\n  }\n\n  private createAndStoreSession(\n    sessionID: string | null,\n    initiatorID: number,\n    opponentsIDs: number[],\n    callType: CallType,\n    maxBandwidth: number = 0\n  ): WebRTCSession {\n    const webRTCSession = new WebRTCSession({\n      ID: sessionID,\n      initiatorID,\n      opponentsIDs,\n      callType,\n      signalingProvider: this.signalingProvider,\n      currentUserID: this.currentUserID,\n      maxBandwidth,\n    });\n\n    webRTCSession.onUserNotAnswerListener = this.onUserNotAnswerListener;\n    webRTCSession.onRemoteStreamListener = this.onRemoteStreamListener;\n    webRTCSession.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    webRTCSession.onSessionCloseListener = this.onSessionCloseListener;\n    webRTCSession.onCallStatsReportListener = this.onCallStatsReport;\n\n    if (webRTCSession?.ID) {\n      this.sessions[webRTCSession.ID] = webRTCSession;\n    }\n\n    return webRTCSession;\n  }\n\n  public clearSession(sessionId: string): void {\n    delete this.sessions[sessionId];\n  }\n\n  /// Reject call by http request\n  public callRejectRequest(params: {\n    sessionID: string;\n    recipientId: number;\n    platform: 'web' | 'android' | 'ios';\n    userInfo?: Calls.UserInfo;\n  }): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(config.urls.calls, 'reject'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /// DELEGATE (signaling)\n\n  public onCallHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const userInfo = extension.userInfo || {};\n    const maxBandwidth = Number(userInfo.maxBandwidth ?? 0);\n\n    let session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(`onCall. userID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    if (!session) {\n      session = this.createAndStoreSession(\n        sessionID,\n        extension.callerID || 0,\n        extension.opponentsIDs || [],\n        extension.callType || CallType.VIDEO,\n        maxBandwidth\n      );\n\n      Utils.safeCallbackCall(this.onCallListener)(session, userInfo);\n    }\n\n    session.processOnCall(userID, extension);\n  }\n\n  public onAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    WebRTCHelpers.trace(\n      `onAccept. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session && (session.state === CallSessionState.ACTIVE || session.state === CallSessionState.NEW)) {\n      Utils.safeCallbackCall(this.onAcceptCallListener)(session, userID, userInfo);\n      session.processOnAccept(userID, extension);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onRejectHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onReject. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      const userInfo = extension.userInfo || {};\n\n      Utils.safeCallbackCall(this.onRejectCallListener)(session, userID, userInfo);\n      session.processOnReject(userID);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onReject', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onStopHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    WebRTCHelpers.trace(`onStop. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    if (session && (session.state === CallSessionState.ACTIVE || session.state === CallSessionState.NEW)) {\n      session.processOnStop(userID);\n      Utils.safeCallbackCall(this.onStopCallListener)(session, userID, userInfo);\n    } else {\n      Utils.safeCallbackCall(this.onInvalidEventsListener)(session, userID, userInfo);\n      WebRTCHelpers.traceWarning(`Ignore 'onStop', there is no information about session ${sessionID} by some reason`);\n    }\n  }\n\n  public onIceCandidatesHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceCandidates. UserID: ${userID}. SessionID: ${sessionID}. ICE candidates count: ${\n        extension.iceCandidates?.length ?? 0\n      }`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceCandidates(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', the session ( ${sessionID} ) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestart. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceRestart(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestartAccept. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceRestartAccept(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  private getListenerByName(name: CallEvent): Calls.ListenerName | null {\n    switch (name) {\n      case CallEvent.CALL:\n        return 'onCallListener';\n      case CallEvent.ACCEPT:\n        return 'onAcceptCallListener';\n      case CallEvent.REJECT:\n        return 'onRejectCallListener';\n      case CallEvent.STOP:\n        return 'onStopCallListener';\n      case CallEvent.INVALID:\n        return 'onInvalidEventsListener';\n      case CallEvent.NOT_ANSWER:\n        return 'onUserNotAnswerListener';\n      case CallEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case CallEvent.CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case CallEvent.CLOSE:\n        return 'onSessionCloseListener';\n      case CallEvent.STATS_REPORT:\n        return 'onCallStatsReport';\n      case CallEvent.DEVICES:\n        return 'onDevicesChangeListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: CallEvent, listener: Calls.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Calls.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: CallEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Calls.Listeners | undefined) = name === CallEvent.DEVICES ? () => {} : undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Calls.ListenerName] === 'function') {\n        (this[key as Calls.ListenerName] as Calls.Listeners | undefined) =\n          key === 'onDevicesChangeListener' ? () => {} : undefined;\n      }\n    });\n  }\n}\n","import type { EmptyResponse, Whiteboard } from './types';\nimport { ProxyMethod, ProxyType } from './types/enums';\nimport ProxyService from './Proxy';\nimport config from './config';\nimport Utils from './Utils';\n\nexport default class WhiteboardService {\n  public proxy: ProxyService;\n  readonly route = config.urls.whiteboards;\n  readonly server = config.whiteboard.server;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public getURL({ id, title, username }: Whiteboard.GetUrlParams): string {\n    return `${this.server}?whiteboardid=${id}&username=${username}&title=${title}`;\n  }\n\n  public async get(paramsOrId: Whiteboard.GetParams): Promise<Whiteboard.Item[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: typeof paramsOrId === 'string' ? { chat_dialog_id: paramsOrId } : paramsOrId,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Whiteboard.CreateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Whiteboard.UpdateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import type { LinkPreview, LinkPreviewCache } from './types';\nimport { ProxyMethod } from './types/enums';\nimport ProxyService from './Proxy';\nimport config from './config';\n\nexport default class LinkPreviewService {\n  public proxy: ProxyService;\n  public cache: LinkPreviewCache = new Map();\n\n  readonly route = config.urls.unfurl;\n  readonly server = config.linkpreview.server;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async get(url: string): Promise<LinkPreview> {\n    if (!this.cache.has(url)) {\n      let linkPreview: LinkPreview;\n\n      try {\n        const ajaxParams = {\n          type: ProxyMethod.POST,\n          url: `${this.server}/${this.route}`,\n          data: { url },\n        };\n\n        linkPreview = (await this.proxy.ajax(ajaxParams)) as LinkPreview;\n      } catch (error) {\n        const title = this.getHostFromUrl(url);\n\n        linkPreview = { url, title, description: '', images: [] };\n      } finally {\n        this.cache.set(url, linkPreview);\n      }\n    }\n\n    return this.cache.get(url);\n  }\n\n  private getHostFromUrl(url: string): string {\n    if (typeof URL === 'function') {\n      return new URL(url).hostname;\n    }\n\n    const match = url.match(/^(?:https?:\\/\\/)?([^\\/]+)/);\n    return match ? match[1] : url;\n  }\n}\n","import type { Config, Chat } from './types';\nimport { ChatAPIs } from './types/enums';\nimport { isWebRTCAvailable, sdkVersion } from '@platform';\nimport config from './config';\nimport AddressBookService from './AddressBook';\nimport AuthService from './Auth';\nimport XMPPChatService from './messaging/xmpp';\nimport SAMAChatService from './messaging/sama';\nimport ConferenceClient from './videocalling_conference/ConferenceClient';\nimport DataService from './Data';\nimport MeetingsService from './Meetings';\nimport ProxyService from './Proxy';\nimport PushNotificationsService from './PushNotifications';\nimport StorageService from './Storage';\nimport UsersService from './Users';\nimport Utils from './Utils';\nimport WebRTCClient from './videocalling/WebRTCClient';\nimport WhiteboardService from './Whiteboard';\nimport LinkPreviewService from './LinkPreview';\n\nexport default class ConnectyCube<ChatService extends SAMAChatService | XMPPChatService> {\n  public ConnectyCube!: typeof ConnectyCube;\n\n  readonly version: string = sdkVersion;\n  readonly isWebRTCAvailable: boolean = isWebRTCAvailable;\n\n  public utils!: Utils;\n  public service!: ProxyService;\n  public auth!: AuthService;\n  public users!: UsersService;\n  public storage!: StorageService;\n  public pushnotifications!: PushNotificationsService;\n  public data!: DataService;\n  public addressbook!: AddressBookService;\n  public chat!: ChatService;\n  public meeting!: MeetingsService;\n  public whiteboard!: WhiteboardService;\n  public linkpreview!: LinkPreviewService;\n  public videochat!: WebRTCClient;\n  public videochatconference!: ConferenceClient;\n  public setSession!: AuthService['setSession'];\n  public getSession!: AuthService['getSession'];\n  public createSession!: AuthService['createSession'];\n  public destroySession!: AuthService['destroySession'];\n  /**\n   * @deprecated ConnectyCube.login(user) is deprecated. Use `ConnectyCube.createSession(user)` or `ConnectyCube.auth.login(user)` instead.\n   */\n  public login!: AuthService['login'];\n  /**\n   * @deprecated ConnectyCube.logout() is deprecated. Use `ConnectyCube.destroySession()` or `ConnectyCube.auth.logout()` instead.\n   */\n  public logout!: AuthService['logout'];\n\n  public init(credentials: Config.Credentials, configMap: Config.Options = {}): void {\n    if (configMap && typeof configMap === 'object') {\n      config.set(configMap);\n    }\n\n    this.utils = Utils;\n    this.service = new ProxyService();\n    this.auth = new AuthService(this.service);\n    this.users = new UsersService(this.service);\n    this.storage = new StorageService(this.service);\n    this.pushnotifications = new PushNotificationsService(this.service);\n    this.data = new DataService(this.service);\n    this.addressbook = new AddressBookService(this.service);\n    this.chat = (\n      config.chat.apiImp === ChatAPIs.SAMA ? new SAMAChatService(this.service) : new XMPPChatService(this.service)\n    ) as ChatService;\n    this.meeting = new MeetingsService(this.service);\n    this.whiteboard = new WhiteboardService(this.service);\n    this.linkpreview = new LinkPreviewService(this.service);\n\n    if (isWebRTCAvailable) {\n      this.videochat = new WebRTCClient(this.chat, this.service);\n      this.chat.webrtcSignalingProcessor = this.videochat.signalingProcessor;\n      this.videochatconference = new ConferenceClient(this.service);\n    }\n\n    if (credentials.token) {\n      config.creds.appId = credentials.appId;\n      this.service.setSession({ token: credentials.token });\n    } else {\n      config.creds.appId = credentials.appId;\n      config.creds.authKey = credentials.authKey;\n    }\n\n    this.setSession = this.auth.setSession;\n    this.getSession = this.auth.getSession;\n    this.createSession = this.auth.createSession;\n    this.destroySession = this.auth.destroySession;\n    this.login = this.auth.login;\n    this.logout = this.auth.logout;\n  }\n}\n\nexport { type XMPPChatService as XMPPChat, type SAMAChatService as SAMAChat };\n","import type { SAMAChat, XMPPChat } from './ConnectyCube';\n\nexport type { SAMAChat, XMPPChat };\nexport type * from './types';\n\nimport * as enums from './types/enums';\nimport ConnectyCube from './ConnectyCube';\n\nexport default Object.assign(new ConnectyCube<XMPPChat>(), { ConnectyCube, ...enums });\n"],"names":["AddressBookUserDataType","LoginProviderNames","CallSignalingModuleIdentifier","CallSignalingType","CallSessionConnectionState","CallSessionState","CallType","CallEvent","PeerConnectionState","ChatType","ChatEvent","PrivacyListAction","ChatProtocol","JanusDebugMode","ChatAPIs","DataPermission","DataPermissionAccess","DialogType","LastMessageMessageStatus","DialogDateProp","DeviceInputType","JanusEvent","JanusCallType","JanusMediaTrackReason","ConferenceEvent","MediaType","MeetingDateMetric","ProxyMethod","ProxyType","NotificationChannel","DevicePlatform","PushEnvironment","_hasBuffer","Buffer","TextDecoder","_TE","TextEncoder","undefined","b64chs","Array","prototype","slice","call","a","tab","forEach","c","i","_fromCC","String","fromCharCode","bind","Uint8Array","from","_btoa","btoa","bin","toString","u32","c0","c1","c2","asc","pad","length","charCodeAt","TypeError","substring","_fromUint8Array","u8a","strs","l","push","apply","subarray","join","cb_utob","cc","re_utob","_encode","s","encode","replace","src","urlsafe","m0","_mkUriSafe","sdkVersion","isBrowser","window","document","isNodeJS","process","versions","Boolean","node","isReactNative","isExpo","fetchImpl","fetch","FormDataImpl","FormData","adapter","navigator","mediaDevices","MediaStream","MediaStreamTrack","RTCIceCandidate","RTCPeerConnection","RTCRtpReceiver","RTCRtpSender","RTCSessionDescription","isWebRTCAvailable","console","warn","Config","static","version","creds","appId","authKey","endpoints","api","chat","muc","chatProtocol","bosh","websocket","active","streamManagement","enable","reconnect","timeInterval","apiImp","XMPP","videochat","alwaysRelayCalls","answerTimeInterval","dialingTimeInterval","disconnectTimeInterval","statsReportTimeInterval","iceServers","urls","username","credential","conference","server","debug","ALL","whiteboard","linkpreview","session","login","users","blobs","subscriptions","events","data","addressbook","meetings","whiteboards","unfurl","calls","type","on","sessionExpired","xmppDataWrite","xmppDataRead","timeout","mode","constructor","getInstance","instance","set","options","this","api_url","chat_url","Object","keys","key","hasOwnProperty","optionValue","nextKey","config","Utils","safeCallbackCall","cb","args","err","error","getUrl","base","res","ext","resource","extension","isArray","arg","isObject","obj","getBsonObjectId","ObjectId","machine","Math","floor","random","pid","increment","timestamp","Date","now","parseInt","padStart","DLog","loggers","logger","log","callTrafficUsageCallback","callbackName","getStringSize","str","Blob","size","getDataSize","body","b","headers","h","JSON","stringify","cloneObject","escapeNull","json","jsonObject","parse","ProxyService","sdkInstance","requestsNumber","currentUserId","abortControllersMap","requestMethod","responseType","setSession","user_id","setCurrentUserId","getSession","userId","getCurrentUserId","logRequest","params","requestId","url","logResponse","response","buildRequestAndURL","isGetOrHeadType","isPostOrPutType","token","isInternalRequest","indexOf","isMultipartFormData","contentType","requestBody","requestURL","requestObject","method","buildRequestBody","useArrayQuery","dataObject","item","fileToCustomObject","append","name","serializeQueryParams","prefix","level","parts","propName","propQueryName","encodeURIComponent","value","isArrayVal","sort","uriComponent","abortRequest","abortId","controllers","controller","abort","processSuccessfulOrFailedRequest","abort_id","doneRequestsCount","ajax","Promise","resolve","reject","index","AbortController","signal","assign","then","resp","dataType","TEXT","text","ok","processAjaxResponse","processAjaxError","catch","responseBody","code","errors","statusCode","status","errorObject","info","errno","isExpiredSessionError","handleExpiredSessionResponse","handleResponse","retryCallback","AddressBookService","proxy","route","uploadAddressBook","list","Error","ajaxParams","POST","contacts","get","udid","GET","getRegisteredUsers","compact","AuthService","routes","async","createSession","generateCreateSessionParams","destroySession","DELETE","user","id","logout","message","application_id","auth_key","password","email","provider","firebase_phone","firebase_email","escapeXMLTable","escapeXMLReplace","match","unescapeXMLTable","unescapeXMLReplace","num","fromCodePoint","_escape","escapeXML","escapeXMLText","unescapeXML","result","start","end","previous","unescapeXMLText","escape","require$$0","Element","attrs","parent","children","setAttrs","is","xmlns","getName","getNS","idx","findNS","attr","getXmlns","namespaces","m","getAttr","getChild","getChildren","child","getChildByAttr","val","recursive","getChildrenByAttr","flat","getChildrenByFilter","filter","getText","getChildText","getChildElements","root","up","cnode","nodes","prepend","unshift","t","remove","el","write","_addChildren","writer","k","v","tree","Element_1","createElement_1","__source","__self","entries","has","Events","EE","fn","context","once","addListener","emitter","event","listener","evt","_events","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","names","getOwnPropertySymbols","concat","listeners","handlers","ee","listenerCount","emit","a1","a2","a3","a4","a5","len","arguments","removeListener","j","removeAllListeners","off","prefixed","module","require$$1","SaxLtx","super","remainder","parseRemainder","tagName","endTag","selfClosing","attrQuote","attrQuoteChar","attrName","state","recordStart","_handleTagOpening","pos","endRecording","recorded","lt","quot","endcomment","endCDATA","substr","cData","startsWith","prevFirst","prevSecond","ltx","TimeoutError","promise","ms","promiseDelay","setTimeout","delay","race","finally","clearTimeout","map","WeakMap","onoff","target","addEventListener","removeEventListener","handler","rejectEvent","timeoutId","cleanup","onEvent","onError","reason","Deferred","procedure","entity","stanza","done","element","send","subscribe","unsubscribe","XMLError","Parser","parser","LtxParser","cursor","onStartElement","onEndElement","onText","xml","createElement","detect","local","replaceAll","raw","search","unescape","JID","domain","setDomain","setLocal","setResource","Symbol","toPrimitive","hint","Number","NaN","_domain","_local","getLocal","_resource","bare","equals","other","escaping.detect","escaping.escape","toLowerCase","escaping.unescape","getDomain","getResource","resourceStart","atStart","jid","defineProperty","equal","detectEscape","escapeLocal","unescapeLocal","XMPPError","condition","application","fromElement","second","third","StreamError","parseURI","URI","port","hostname","protocol","URL","parseHost","host","Connection","socketListeners","parserListeners","socket","isSecure","secure","_streamError","disconnect","_onData","onParserError","_detachParser","onSocketClosed","dirty","_detachSocket","_status","clean","onStreamClosed","_attachSocket","close","connect","_onElement","isStreamError","_onStreamError","isStanza","_onSeeOtherHost","service","includes","parseService","lang","open","_attachParser","_jid","_ready","resumed","_closeStream","_closeSocket","promiseOnline","Socket","socketParameters","headerElement","to","header","stop","runHooks","fragment","footer","footerElement","restart","sendReceive","all","string","isNonza","NS","hooks","Map","hook_events","Set","hook","assertHookEventName","add","unhook","find","Client","transports","Transport","sendMany","_findTransport","Reconnect","_timeout","onDisconnect","scheduleReconnect","CODE","NS_FRAMING","ConnectionWebSocket","elements","test","uri","WebSocket","wasClean","koaCompose","middleware","next","dispatch","Context","IncomingContext","OutgoingContext","ctx","compose","errorHandler","reply","StanzaError","IQCaller","use","_route","isReply","deferred","delete","request","xid","timeoutPromise","_childRequest","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","ns","globalThis","decode","atob","SASLError","getAvailableMechanisms","saslFactory","offered","_mechs","mech","sasl","streamFeatures","onAuthenticate","_next","mechanisms","credentials","mechanism","realm","serviceType","serviceName","clientFirst","challenge","authenticate","userAgent","features","additionalData","final","aid","feature","sasl2","fast","promises","inline","getStreamFeatures","fast_available","auth","req","setup","_fast","iqCaller","makeBindElement","resourceBinding","bind2","tag","sessionFeatures","var","getSessionFeatures","exports","Factory","factory","mechs","jlen","entry","SASLFactory","reset","saveToken","deleteToken","save","fetchToken","expiry","isTokenValid","onInvalidToken","requestToken","available","Mechanism","cred","authzid","chal","saslPlain","NonzaName","trace","saslAnonymous","createOnAuthenticate","getMechanism","crypto","subtle","importKey","hash","signature","sign","codePointAt","verify","ChatUtils","buildUserJid","buildUserJidLocalPart","createMessageStanza","createIqStanza","createPresenceStanza","createNonza","getElement","isErrorStanza","getAllElements","getElementText","getElementTreePath","elementsPath","reduce","prevElement","assignObjectToXml","assignExtraParamsToXml","extraParams","attachment","assignXmlToObject","parseExtraParams","attachments","dialogId","dialog_id","moduleIdentifier","buildErrorFromXMPPErrorStanza","errorStanza","errorElement","getUniqueId","suffix","uuid","r","parseReactions","reaction","items","xmppClient","split","_reconnect","_websocket","incoming","outgoing","incomingListener","outgoingListener","_middleware","_streamFeatures","_iqCaller","iqCallee","_iqCallee","plain","anonymous","_sasl2","_bind2","htsha256none","_sasl","_resourceBinding","sendOnline","ChatHelpers","xmppJID","userCurrentJid","isNumeric","jidOrUserId","getUserJid","getRoomJidFromDialogId","typeChat","getUserNickWithMucDomain","getUserIdFromJID","getDialogIdFromJID","getRoomJid","getIdFromResource","getRoomJidFromRoomFullJid","getUserIdFromRoomJid","roomJid","getDialogJid","identifier","StreamManagement","enabled","clientHandledCounter","serverHandledCounter","messagesQueue","messagesQueueClearTimer","supported","WS","removeElementHandler","addElementHandler","sendNonza","ENABLE","markMessagesQueueAsLost","sendAndCount","isMessage","isChat","CHAT","GROUPCHAT","isContent","REQUEST","markMessageAsLost","elementHandler","ENABLED","ANSWER","nextHandledCounter","currHandledCounter","isNaN","diffHandledCounter","markMessagesQueueAsSent","markMessagesQueueAsLostByTimeout","markMessageAsSent","onSentMessageCallback","clear","iterations","iterator","values","ackTimeout","acknowledgementTimeout","nonza","PrivacyList","helpers","stanzasCallbacks","privacyList","acc","action","mutualBlock","privacyListKeys","iqParams","iq","isMutual","userJid","userMuc","assignPrivacyItem","order","getList","_reject","query","update","currentList","currentListItem","ALLOW","updatedItem","updatedListItems","updatedList","getNames","defaultElement","activeElement","defaultName","activeName","allNames","default","setAsDefault","MultiUserChat","joinedRooms","dialogIdOrJid","dialogJid","presenceStanza","maxstanzas","x","isJoin","endsWith","isError","errorResponse","leave","_stanza","listOnlineUsers","iqStanza","stanzaId","DialogsService","occupants_ids","admins_ids","PUT","idOrIds","idsToDelete","trim","addAdmins","push_all","removeAdmins","pull_all","subscribeToPublic","unsubscribeFromPublic","updateNotificationsSettings","getNotificationsSettings","getPublicOccupants","clearHistory","MessagesService","ids","createSystem","unreadCount","chat_dialog_ids","listReactions","addReaction","updateReaction","removeReaction","putReaction","WebRTCSignalingProcessor","delegate","onMessage","userID","sessionId","sessionID","signalType","CALL","onCallHandler","ACCEPT","onAcceptHandler","REJECT","onRejectHandler","STOP","onStopHandler","CANDIDATE","onIceCandidatesHandler","RESTART","onIceRestartHandler","RESTART_ACCEPT","onIceRestartAcceptHandler","AbstractChatService","dialog","webrtcSignalingProcessor","isConnected","isConnecting","isLogout","isReconnect","onChatStatusListener","onConnectionErrorListener","onDisconnectedListener","onReconnectListener","onMessageListener","onSystemMessageListener","onMessageTypingListener","onMessageUpdateListener","onMessageDeleteListener","onMessageReactionsListener","onReadStatusListener","onLastUserActivityListener","start_date","toISOString","end_date","pingWithTimeout","timer","ping","getListenerByName","STATUS","ERROR","DISCONNECTED","RECONNECTED","MESSAGE","SYSTEM_MESSAGE","ERROR_MESSAGE","TYPING_MESSAGE","UPDATE_MESSAGE","DELETE_MESSAGE","REACTIONS_MESSAGE","DELIVERED_MESSAGE","READ_MESSAGE","SENT_MESSAGE","USER_LAST_ACTIVITY","JOIN","LEAVE","KICK","listenerName","XMPPChatService","onMessageErrorListener","onDeliveredStatusListener","onJoinOccupant","onLeaveOccupant","onKickOccupant","privacylist","xmppClientListeners","connectPromise","earlyIncomingMessagesQueue","connectionStatus","userJID","removeAllXMPPClientListeners","addXMPPClientListener","postConnectActions","onPresence","onIQ","onSystemMessage","onMessageError","messageId","messageStanza","sendSystemMessage","sendWebRTCSignalingMessage","candidate","opponentId","sendIsTypingStatus","sendIsStopTypingStatus","sendDeliveredStatus","sendReadStatus","editMessage","originMessageId","last","deleteMessage","getLastUserActivity","onLastActivityStanza","seconds","markActive","markInactive","terminate","rawStanza","forwardedStanza","invite","delivered","read","replaceSubElement","reactionsSubElement","removeSubElement","composing","paused","isForwarded","isGroup","recipient","recipientId","currentUserJid","recipient_id","is_forwarded","mucUserId","actorElement","initiatorUserJid","initiatorId","onWebRTCSignalingMessage","extensionElem","getCallExtension","iceCandidates","opponentsIDs","VIDEO","AUDIO","childName","childText","presence","enableCarbons","stanzasCallback","setSubscriptionToUserLastActivity","user_jid","subscribeToUserLastActivityStatus","unsubscribeFromUserLastActivityStatus","_listener","removeXMPPClientListener","_","P","e","enumerable","configurable","writable","I","D","n","U","C","M","endpoint","ws","onopen","onConnectEvent","onmessage","g","u","p","f","q","R","w","S","typing","onUserTypingListener","system_message","o","conversation_created","conversation_updated","conversation_kicked","d","onConversationCreateListener","onConversationUpdateListener","onConversationDeleteListener","onSystemMessageEvent","last_activity","onUserActivityListener","message_read","onMessageStatusListener","message_edit","onMessageEditListener","message_delete","message_reactions_update","responsesPromises","onMessageEvent","ask","mid","resObjKey","L","y","every","onerror","onclose","onDisconnectEvent","disableAutoReconnect","onLine","visibilityState","sendRequest","sendPromise","sendHttpPromise","localStorage","getItem","Authorization","http","statusText","connectSocket","device_id","deviceId","socketLogin","organization_id","disconnectSocket","userCreate","userEdit","userLogin","removeItem","userLogout","userSendOTPToken","userResetPassword","new_password","userDelete","userSearch","keyword","ignore_ids","limit","updated_at","getUsersByIds","getParticipantsByCids","cids","createUploadUrlForFiles","files","getDownloadUrlForFiles","file_ids","messageCreate","cid","replied_message_id","forwarded_message_id","messageSystem","uids","messageList","messageSummary","messageTone","tone","markConversationAsRead","mids","messageEdit","messageDelete","getUserActivity","subscribeToUserActivity","unsubscribeFromUserActivity","sendTypingStatus","conversationCreate","conversationUpdate","description","participants","image_object","conversationList","gt","conversationDelete","conversationSearch","conversationHandlerCreate","content","getConversationHandler","conversationHandlerDelete","pushSubscriptionCreate","platform","web_endpoint","web_key_auth","web_key_p256dh","device_udid","pushSubscriptionDelete","setActivityStatus","isInactive","blockList","blockUsers","unblockUsers","reactionsUpdate","reactionsList","BlockList","samaClient","block","userIds","unblock","SAMAChatService","currentUserNativeId","SAMAClient","removeAllSamaListeners","addAllSamaListeners","authorizedUser","onSamaConnectedListener","onSamaDisconnectListener","onSamaMessageEventListener","onSamaMessageListener","_id","c_type","created_at","messageParams","date_sent","onSamaSystemMessageListener","systemMessage","onWebRTCSignalingSystemMessage","opponentID","iceCandidate","iceObjectKey","onSamaMessageStatusListener","onSamaUserLastActivityListener","lastActivityTs","onSamaTypingListener","isTyping","onSamaMessageEditListener","messageEditParams","isLast","updatedBody","onSamaDeleteListener","onSamaMessageReactionListener","messageReaction","requestParams","ack","server_mid","userIdsOrDialogId","destinationParams","markDialogAsRead","activityDate","ceil","Janus","sessions","mobile","isExtensionEnabled","getDisplayMedia","chromever","maxver","isInstalled","defaultExtension","extensionId","querySelector","getScreen","callback","pending","cache","postMessage","init","origin","location","sourceId","gatewayCallbacks","success","noop","destroyed","initDone","isWebrtcSupported","websockets","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","iceTransportPolicy","bundlePolicy","withCredentials","maxev","max_poll_events","apisecret","destroyOnUnload","keepAlivePeriod","longPollTimeout","getMaxBitrates","simulcastMaxBitrates","maxBitrates","high","medium","low","connected","pluginHandles","that","retries","transactions","eventHandler","longpoll","getTime","httpAPICall","verb","handleEvent","textStatus","errorThrown","skipTimeout","transaction","reportSuccess","sender","pluginHandle","webrtcStuff","pc","remoteSdp","completed","addIceCandidate","endOfCandidates","candidates","webrtcState","hangup","ondetached","detach","mediaState","slowLink","plugindata","jsep","vdebug","keepAlive","janus","session_id","randomString","callbacks","newWebSocket","eventName","sendMessage","handleId","sdp","e2ee","rid_order","force_relay","sendTrickleCandidate","createDataChannel","dclabel","dcprotocol","pendingData","onDataChannelStateChange","label","dcState","dataChannel","readyState","ondataopen","dcoptions","dataChannelOptions","ondata","sendData","dataChanDefaultLabel","sendDtmf","dtmfSender","audioSender","getSenders","track","kind","dtmf","ontonechange","tones","duration","gap","insertDTMF","destroyHandle","noRequest","cleanupWebrtc","detached","createPeerconnectionIfNeeded","pc_config","insertableStreams","tracks","transforms","receiver","createEncodedStreams","createEncodedAudioStreams","createEncodedVideoStreams","forceEncodedAudioInsertableStreams","forceEncodedVideoInsertableStreams","encodedInsertableStreams","getStats","volume","bitrate","trickle","oniceconnectionstatechange","iceState","iceConnectionState","onicecandidate","iceDone","mySdp","localDescription","sdpSent","sendSDP","sdpMid","sdpMLineIndex","ontrack","streams","transceiver","_mid","onremotetrack","onended","trackMutedTimeoutId","ev","transceivers","getTransceivers","_receiver","_track","onmute","onunmute","prepareWebrtc","offer","webrtcError","media","mediaToTracks","simulcast","simulcast2","svc","captureDevices","setRemoteDescription","answer","customizeSdp","createAnswer","setLocalDescription","mediaConstraints","iceRestart","createOffer","prepareWebrtcPeer","replaceTracks","openedConsentDialog","groups","gumGroup","capture","group","audio","video","ondatachannel","channel","nt","trackId","replaceTrack","stream","getAudioTracks","getVideoTracks","consentDialog","constraints","trackConstraints","otherType","otherTrack","otherConstraints","getUserMedia","newDirection","recv","direction","setDirection","myStream","addTrack","webRTCAdapter","browserDetails","browser","addTransceiver","sendEncodings","rid","maxBitrate","scaleResolutionDownBy","parameters","getParameters","encodings","setParameters","scalabilityMode","codec","mimeType","codecs","getCapabilities","setCodecPreferences","framerate","maxFramerate","senderStreams","createAudioEncodedStreams","readableStream","writableStream","pipeThrough","pipeTo","readable","receiverStreams","dontStop","rt","removeTrack","onlocaltrack","curdir","newdir","getLocalTracks","tr","getRemoteTracks","getVolume","remote","stats","remoteSource","audioLevel","isMuted","mute","videostream","audiostream","getBitrate","bsnow","bsbefore","tsnow","tsbefore","setInterval","inStats","mediaType","bytesReceived","googCodecName","timePassed","bitRate","round","setBitrate","hangupRequest","clearInterval","streamExternal","stopAllTracks","oncleanup","getServer","getSessionId","getInfo","destroy","unload","notifyDestroyed","cleanupHandles","sendBeacon","unbindWebSocket","onUnbindMessage","onUnbindError","attach","ordered","plugin","opaqueId","loopIndex","handleToken","opaque_id","loop_index","started","getId","getPlugin","getRemoteVolume","getLocalVolume","isAudioMuted","muteAudio","unmuteAudio","isVideoMuted","muteVideo","unmuteVideo","setMaxBitrate","handleRemoteJsep","createHandle","useDefaultDependencies","deps","socketCls","proto","arr","fetchOptions","Accept","fetching","timerId","parsed","useOldDependencies","jq","jQuery","payload","xhrFields","extend","xhr","keepAudio","audioSend","audioRecv","addAudio","replaceAudio","removeAudio","keepVideo","videoSend","videoRecv","addVideo","replaceVideo","removeVideo","screenshareFrameRate","frameRate","screenshareHeight","height","screenshareWidth","width","ideal","getTracks","mst","usedDependencies","dependencies","listDevices","isGetUserMediaAvailable","enumerateDevices","devices","safariVp8","testpc","offerToReceiveVideo","charSet","randomPoz","charAt","JanusClient","engine","videoRoomPlugin","isOnlyAudio","currentRoomId","remoteFeeds","remoteJseps","remoteFeedsAttachingInProgress","bitrateTimers","env","timeoutSessionCallback","JanusEngine","attachVideoConferencingPlugin","isRemote","skipMedia","remoteFeed","localStream","displayName","listen","room","ptype","feed","display","uplink","nacks","msg","feedId","offerParams","publishers","userDisplayName","PARTICIPANT_JOINED","detachRemoteFeed","PARTICIPANT_LEFT","onLocalTrack","metadata","onRemoteTrack","channelLabel","DATA_CHANNEL_OPEN","DATA_CHANNEL_MESSAGE","eventType","CREATED","isStreamNoExistedBefore","REMOTE_STREAM","ENDED","trackToRemove","streamTrack","REMOTE_TRACKS_UPDATED","getPluginId","detachVideoConferencingPlugin","roomId","joinEvent","leaveEvent","listOnlineParticipants","listRequest","toggleAudioMute","toggleRemoteAudioMute","audioTracks","isRemoteAudioMuted","toggleVideoMute","toggleRemoteVideoMute","videoTracks","isRemoteVideoMuted","sendKeyframeRequest","configureRequest","keyframe","getTracksFromStream","audioTrack","videoTrack","mediaParams","existedStream","createOfferParams","tracksFromStream","tracksFromParams","publish","getTracksMidsFromStream","getUserBitrate","resultCallback","getUserVolume","showBitrate","hideBitrate","ConferenceSession","client","currentUserDisplayName","onParticipantJoinedListener","onParticipantLeftListener","onSlowLinkListener","onRemoteStreamListener","onRemoteTracksUpdatedListener","onRemoteConnectionStateChangedListener","onDataChannelOpenedListener","onDataChannelMessageListener","onSessionConnectionStateChangedListener","onErrorListener","onParticipantJoined","onParticipantLeft","onRemoteStream","onRemoteTracksUpdated","onDataChannelOpen","onDataChannelMessage","currentPublisherPC","isResolved","createHandler","joinInternal","joinAsListener","onRemoteIceStateChanged","onLocalIceStateChanged","onSlowLink","isExistingParticipant","listOfOnlineParticipants","leaveGroup","elementId","upsertStream","shouldUpdateCurrentStream","detachMediaStream","attachMediaStream","getSettings","localTrack","newTrack","switchMediaTracks","device","getRemoteUserBitrate","getRemoteUserVolume","opt","mediaElement","getElementById","srcObject","style","transform","mirror","muted","onloadedmetadata","_event","play","pause","ConferenceClient","sessionsStore","createNewSession","getCurrentSessionToken","getMediaDevices","clearSession","currentSession","LEFT","SLOW_LINK","REMOTE_CONNECTION_STATE","DATA_CHANNEL_OPENED","SESSION_CONNECTION_STATE","DataService","className","isMany","multi","record","createRecord","readPermissions","permissions","isSearch","search_criteria","isCriteria","isOne","MeetingsService","startTimestamp","endTimestamp","defaultParams","toLocaleString","year","month","day","hour","minute","attendees","getRecordings","PushNotificationsService","SubscriptionsService","EventsService","base64Encode","StorageService","blob","createAndUpload","file","content_type","public","isPublic","createParams","blobObject","parseUri","blob_object_access","uploadParams","authority","path","queryKey","decodeURIComponent","upload","markUploaded","getFile","uid","getFileObject","privateUrl","fileUID","publicUrl","strict","loose","exec","$0","$1","$2","UsersService","getV2","signup","resetPassword","listOnline","getOnlineCount","count","filters","dateFields","numberFields","extensions","full_name","facebook_id","twitter_id","phone","tags","external","generateFilter","field","param","WebRTCHelpers","traceWarning","traceError","getVersionFirefox","ua","ffInfo","getVersionSafari","sVer","WebRTCPeerConnection","original","remoteSDP","NEW","remoteStream","onStatusClosedChecker","dialingTimer","statsReportTimer","waitingReconnectTimeoutCallback","released","rtcConfiguration","startCallTime","onMediaTrackHandler","onIceCandidateHandler","onSignalingStateHandler","onIceConnectionStateHandler","callType","getWrappedStats","signalingState","canTrickleIceCandidates","processIceCandidates","CHECKING","onSessionConnectionStateChanged","CONNECTING","CONNECTED","clearWaitingReconnectTimer","COMPLETED","FAILED","startWaitingReconnectTimer","CLOSED","release","closeSessionIfAllConnectionsClosed","clearStatsReportTimer","addCandidates","clearDialingTimer","getAndSetLocalSessionDescription","maxBandwidth","offerOptions","sessionDescription","setRTCRtpSenderMaxBandwidth","senders","encoding","startDialingTimer","withOnNotAnswerCallback","dialingCallback","skipIncrement","processOnNotAnswer","processCall","setRemoteSessionDescription","desc","lastResult","getStatsCustom","results","lastResults","onCallStatsReport","sdpRemote","ID","onSuccess","onFail","statistic","localVideoSettings","frameHeight","frameWidth","getBitratePerSecond","packetsReceived","framerateMean","framesPerSecond","bytesSent","packetsSent","candidateType","mozLocalTransport","transport","ip","ipAddress","portNumber","getFramesPerSecond","isLocal","framesSent","framesReceived","selector","WebRTCSignalingProvider","chatService","sendCandidate","signalingType","userInfo","systemCallMessage","WebRTCSession","initiatorID","currentUserID","peerConnections","signalingProvider","answerTimer","waitingOfferOrAnswerTimer","acceptCallTime","onUserNotAnswerListener","onSessionCloseListener","onCallStatsReportListener","generateUUID","setMaxBandwidth","peers","peersKeys","connectionStateForUser","peerConnection","constrains","prepareExtension","ACTIVE","callInternal","accept","clearAnswerTimer","acceptInternal","startWaitingOfferOrAnswerTimer","callerID","REJECTED","STOPPED","canInitiateIceRestart","processOnCall","rtcSdpType","startAnswerTimer","processOnAccept","processOnReject","clearWaitingOfferOrAnswerTimer","processOnStop","pcKeys","processOnIceCandidates","processOnIceRestart","processOnIceRestartAccept","connectionState","closeLocalMediaStream","isAllClosed","muteStream","unmute","NONE","timeWait","timeDiff","min","max","WebRTCClient","signalingProcessor","SessionConnectionState","onCallListener","onAcceptCallListener","onRejectCallListener","onStopCallListener","onInvalidEventsListener","onDevicesChangeListener","ondevicechange","bandwidth","createAndStoreSession","webRTCSession","callRejectRequest","INVALID","NOT_ANSWER","CONNECTION_STATE","CLOSE","STATS_REPORT","DEVICES","WhiteboardService","getURL","title","paramsOrId","chat_dialog_id","LinkPreviewService","linkPreview","getHostFromUrl","images","ConnectyCube","utils","storage","pushnotifications","meeting","videochatconference","configMap","SAMA","enums"],"mappings":"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","x_google_ignoreList":[12,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,70,71,72,73,77,78,87]}