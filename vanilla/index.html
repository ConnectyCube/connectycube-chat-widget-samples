<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="./public/favicon.ico" />
    <link rel="stylesheet" href="./public/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ConnectyCube Chat Widget</title>
  </head>
  <body>
    <div id="app">
      <div>
        <a href="https://connectycube.com" target="_blank">
          <img src="./public/logo.png" class="logo" alt="ConnectyCube logo" />
        </a>
        <h1>ConnectyCube Chat Widget</h1>
        <div class="card">
          <p><code>Vanilla JS</code></p>
          <br></br>
          <p>
            Click the blue Chat button bottom right to open a chat
          </p>
          <div class="slider-container">
            <div class="slider-title" id="sliderTitle">Property 1</div>
            <img src="./public/propety_image1.png" alt="Image 1" class="slider-image active">
            <img src="./public/propety_image2.png" alt="Image 2" class="slider-image">
            <img src="./public/propety_image3.png" alt="Image 3" class="slider-image">
          
            <button class="slider-button left-button" id="prevBtn">&#10094;</button>
            <button class="slider-button right-button" id="nextBtn">&#10095;</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      const generateRandomID = (length = 8) => {
        const chars =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        let result = "";
        for (let i = 0; i < length; i++) {
          // Pick a random character from the chars string
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      };
      const uniqueUsernameGenerator = () => {
        const marvelCharacters = [
          "Spider-Man",
          "Iron Man",
          "Captain America",
          "Thor",
          "Hulk",
          "Black Widow",
          "Hawkeye",
          "Black Panther",
          "Doctor Strange",
          "Captain Marvel",
        ];
        const randIndx = Math.floor(Math.random() * marvelCharacters.length);
        return `${marvelCharacters[randIndx]}-${generateRandomID()}`
      }

      const userId = localStorage.getItem("userId") || "";
      const userName = localStorage.getItem("userName") || "";
      const userAvatar = localStorage.getItem("userAvatar") || "";
      if (!userName) {
        const promptedName = prompt("What's your name?") || uniqueUsernameGenerator();
        localStorage.setItem("userName", promptedName);
        localStorage.setItem("userId", generateRandomID(10));
      }
      if (!userAvatar) {
        localStorage.setItem("userAvatar", `https://i.pravatar.cc/300?img=${Math.floor(Math.random() * 50) + 1}`);
      }
    </script>
    <!-- @connectycube/chat-widget - start -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/connectycube@4/dist/connectycube.min.js"></script>
    <!-- <script src="https://unpkg.com/@connectycube/chat-widget@latest/dist/index.umd.js"></script> -->
    <script src="../../connectycube-chat-widget/packages/chat-widget/dist/index.umd.js"></script>
    <script>
      const chatWidgetContainer = document.createElement('div');
      // chatWidgetContainer.style.zIndex = '1000';
      let props = {
        appId: 8095,
        authKey: '83146458-4544-4D6A-A818-7882D4D8B3E6',
        splitView: true,
        showOnlineUsersTab: true,
        config: { debug: { mode: 1 } },
        userName: localStorage.getItem("userName"),
        userId: localStorage.getItem("userId"),
        userAvatar: localStorage.getItem("userAvatar"),
        userProfileLink: "https://developers.connectycube.com/js/code-samples",
        translation: "en",
        // hideNewChatButton: true,
        quickActions: {
          title: 'Quick Actions',
          description: 'Select an action from the options below or type a first message to start a conversation.',
          actions: [
            'View Property Details',
            'Schedule a Visit',
            'Mortgage Calculator',
            'Download Brochure',
          ],
        },
        onOpenChange: (open) => {
          console.log("[@connectycube/chat-widget] open:", open)
        },
        onUnreadCountChange:  (count) => {
          console.log(
            "[@connectycube/chat-widget] unread messages count:",
            count
          )
        },
        // muted: true,
        showNotifications: true,
        playSound: true,

        // moderation
        enableContentReporting: true,
        enableBlockList: true,

        // uncomment it if you want to place a Chat button bottom Left
        // buttonClassName: "z-[9999] left-2 right-auto",
        // portalClassName: "z-[50] left-2 right-auto",

        // hideWidgetButton: false,
      };
      chatWidgetContainer.id = 'ConnectyCube_chat-widget';
      document.body.appendChild(chatWidgetContainer);
      const root = ReactDOM.createRoot(chatWidgetContainer);
      root.render(React.createElement(ConnectyCubeChatWidget, props));
    </script>
    <!-- @connectycube/chat-widget - end -->

    <script>
      // Get all slider images and buttons
      const images = document.querySelectorAll('.slider-image');
      const sliderTitle = document.getElementById('sliderTitle');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      const properties = [
        {name: "Property 1", id: "property_1", agentId: 112},
        { name: "Property 2", id: "property_2", agentId: 112 },
        { name: "Property 3", id: "property_3", agentId: 112 }
      ];
      let currentIndex = 0;

      // Function to show the image at the given index
      function showImage(index) {
        images.forEach((img, i) => {
          img.classList.toggle('active', i === index);
        });

        sliderTitle.textContent = properties[index].name;

        props = { 
          ...props, 
          defaultChatId: properties[index].id,
          defaultChatUserId: properties[index].agentId,
          defaultChatName: `${properties[index].name} chat`,
          createDefaultChatIfNotExist: "group",
        };
        root.render(React.createElement(ConnectyCubeChatWidget, props));
      }

      // Show previous image
      prevBtn.addEventListener('click', () => {
        currentIndex = (currentIndex === 0) ? images.length - 1 : currentIndex - 1;
        showImage(currentIndex);
      });

      // Show next image
      nextBtn.addEventListener('click', () => {
        currentIndex = (currentIndex === images.length - 1) ? 0 : currentIndex + 1;
        showImage(currentIndex);
      });
    </script>
  </body>
</html>
